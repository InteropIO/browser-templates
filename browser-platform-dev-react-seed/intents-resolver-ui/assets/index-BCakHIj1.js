var R_=Object.defineProperty;var M_=(i,e,t)=>e in i?R_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>M_(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function j_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ty={exports:{}},Ou={},Ay={exports:{}},_e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $c=Symbol.for("react.element"),O_=Symbol.for("react.portal"),D_=Symbol.for("react.fragment"),$_=Symbol.for("react.strict_mode"),F_=Symbol.for("react.profiler"),L_=Symbol.for("react.provider"),W_=Symbol.for("react.context"),B_=Symbol.for("react.forward_ref"),H_=Symbol.for("react.suspense"),G_=Symbol.for("react.memo"),z_=Symbol.for("react.lazy"),qf=Symbol.iterator;function U_(i){return i===null||typeof i!="object"?null:(i=qf&&i[qf]||i["@@iterator"],typeof i=="function"?i:null)}var Ey={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Py=Object.assign,Ny={};function eo(i,e,t){this.props=i,this.context=e,this.refs=Ny,this.updater=t||Ey}eo.prototype.isReactComponent={};eo.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};eo.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Ry(){}Ry.prototype=eo.prototype;function Np(i,e,t){this.props=i,this.context=e,this.refs=Ny,this.updater=t||Ey}var Rp=Np.prototype=new Ry;Rp.constructor=Np;Py(Rp,eo.prototype);Rp.isPureReactComponent=!0;var Vf=Array.isArray,My=Object.prototype.hasOwnProperty,Mp={current:null},jy={key:!0,ref:!0,__self:!0,__source:!0};function Oy(i,e,t){var n,r={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)My.call(e,n)&&!jy.hasOwnProperty(n)&&(r[n]=e[n]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(i&&i.defaultProps)for(n in a=i.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:$c,type:i,key:s,ref:o,props:r,_owner:Mp.current}}function q_(i,e){return{$$typeof:$c,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function jp(i){return typeof i=="object"&&i!==null&&i.$$typeof===$c}function V_(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var Jf=/\/+/g;function pd(i,e){return typeof i=="object"&&i!==null&&i.key!=null?V_(""+i.key):e.toString(36)}function kl(i,e,t,n,r){var s=typeof i;(s==="undefined"||s==="boolean")&&(i=null);var o=!1;if(i===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(i.$$typeof){case $c:case O_:o=!0}}if(o)return o=i,r=r(o),i=n===""?"."+pd(o,0):n,Vf(r)?(t="",i!=null&&(t=i.replace(Jf,"$&/")+"/"),kl(r,e,t,"",function(l){return l})):r!=null&&(jp(r)&&(r=q_(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Jf,"$&/")+"/")+i)),e.push(r)),1;if(o=0,n=n===""?".":n+":",Vf(i))for(var a=0;a<i.length;a++){s=i[a];var c=n+pd(s,a);o+=kl(s,e,t,c,r)}else if(c=U_(i),typeof c=="function")for(i=c.call(i),a=0;!(s=i.next()).done;)s=s.value,c=n+pd(s,a++),o+=kl(s,e,t,c,r);else if(s==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function zc(i,e,t){if(i==null)return i;var n=[],r=0;return kl(i,n,"","",function(s){return e.call(t,s,r++)}),n}function J_(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var Kt={current:null},Tl={transition:null},K_={ReactCurrentDispatcher:Kt,ReactCurrentBatchConfig:Tl,ReactCurrentOwner:Mp};function Dy(){throw Error("act(...) is not supported in production builds of React.")}_e.Children={map:zc,forEach:function(i,e,t){zc(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return zc(i,function(){e++}),e},toArray:function(i){return zc(i,function(e){return e})||[]},only:function(i){if(!jp(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};_e.Component=eo;_e.Fragment=D_;_e.Profiler=F_;_e.PureComponent=Np;_e.StrictMode=$_;_e.Suspense=H_;_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K_;_e.act=Dy;_e.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var n=Py({},i.props),r=i.key,s=i.ref,o=i._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Mp.current),e.key!==void 0&&(r=""+e.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(c in e)My.call(e,c)&&!jy.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];n.children=a}return{$$typeof:$c,type:i.type,key:r,ref:s,props:n,_owner:o}};_e.createContext=function(i){return i={$$typeof:W_,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:L_,_context:i},i.Consumer=i};_e.createElement=Oy;_e.createFactory=function(i){var e=Oy.bind(null,i);return e.type=i,e};_e.createRef=function(){return{current:null}};_e.forwardRef=function(i){return{$$typeof:B_,render:i}};_e.isValidElement=jp;_e.lazy=function(i){return{$$typeof:z_,_payload:{_status:-1,_result:i},_init:J_}};_e.memo=function(i,e){return{$$typeof:G_,type:i,compare:e===void 0?null:e}};_e.startTransition=function(i){var e=Tl.transition;Tl.transition={};try{i()}finally{Tl.transition=e}};_e.unstable_act=Dy;_e.useCallback=function(i,e){return Kt.current.useCallback(i,e)};_e.useContext=function(i){return Kt.current.useContext(i)};_e.useDebugValue=function(){};_e.useDeferredValue=function(i){return Kt.current.useDeferredValue(i)};_e.useEffect=function(i,e){return Kt.current.useEffect(i,e)};_e.useId=function(){return Kt.current.useId()};_e.useImperativeHandle=function(i,e,t){return Kt.current.useImperativeHandle(i,e,t)};_e.useInsertionEffect=function(i,e){return Kt.current.useInsertionEffect(i,e)};_e.useLayoutEffect=function(i,e){return Kt.current.useLayoutEffect(i,e)};_e.useMemo=function(i,e){return Kt.current.useMemo(i,e)};_e.useReducer=function(i,e,t){return Kt.current.useReducer(i,e,t)};_e.useRef=function(i){return Kt.current.useRef(i)};_e.useState=function(i){return Kt.current.useState(i)};_e.useSyncExternalStore=function(i,e,t){return Kt.current.useSyncExternalStore(i,e,t)};_e.useTransition=function(){return Kt.current.useTransition()};_e.version="18.3.1";Ay.exports=_e;var B=Ay.exports;const ce=j_(B);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q_=B,X_=Symbol.for("react.element"),Y_=Symbol.for("react.fragment"),Z_=Object.prototype.hasOwnProperty,eC=Q_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tC={key:!0,ref:!0,__self:!0,__source:!0};function $y(i,e,t){var n,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)Z_.call(e,n)&&!tC.hasOwnProperty(n)&&(r[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:X_,type:i,key:s,ref:o,props:r,_owner:eC.current}}Ou.Fragment=Y_;Ou.jsx=$y;Ou.jsxs=$y;Ty.exports=Ou;var fd=Ty.exports,dh={},Fy={exports:{}},gn={},Ly={exports:{}},Wy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(H,ne){var J=H.length;H.push(ne);e:for(;0<J;){var me=J-1>>>1,ge=H[me];if(0<r(ge,ne))H[me]=ne,H[J]=ge,J=me;else break e}}function t(H){return H.length===0?null:H[0]}function n(H){if(H.length===0)return null;var ne=H[0],J=H.pop();if(J!==ne){H[0]=J;e:for(var me=0,ge=H.length,ye=ge>>>1;me<ye;){var Ee=2*(me+1)-1,It=H[Ee],gt=Ee+1,yn=H[gt];if(0>r(It,J))gt<ge&&0>r(yn,It)?(H[me]=yn,H[gt]=J,me=gt):(H[me]=It,H[Ee]=J,me=Ee);else if(gt<ge&&0>r(yn,J))H[me]=yn,H[gt]=J,me=gt;else break e}}return ne}function r(H,ne){var J=H.sortIndex-ne.sortIndex;return J!==0?J:H.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,p=null,f=3,w=!1,y=!1,S=!1,O=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(H){for(var ne=t(l);ne!==null;){if(ne.callback===null)n(l);else if(ne.startTime<=H)n(l),ne.sortIndex=ne.expirationTime,e(c,ne);else break;ne=t(l)}}function T(H){if(S=!1,C(H),!y)if(t(c)!==null)y=!0,V(M);else{var ne=t(l);ne!==null&&Q(T,ne.startTime-H)}}function M(H,ne){y=!1,S&&(S=!1,_(E),E=-1),w=!0;var J=f;try{for(C(ne),p=t(c);p!==null&&(!(p.expirationTime>ne)||H&&!x());){var me=p.callback;if(typeof me=="function"){p.callback=null,f=p.priorityLevel;var ge=me(p.expirationTime<=ne);ne=i.unstable_now(),typeof ge=="function"?p.callback=ge:p===t(c)&&n(c),C(ne)}else n(c);p=t(c)}if(p!==null)var ye=!0;else{var Ee=t(l);Ee!==null&&Q(T,Ee.startTime-ne),ye=!1}return ye}finally{p=null,f=J,w=!1}}var $=!1,G=null,E=-1,D=5,A=-1;function x(){return!(i.unstable_now()-A<D)}function N(){if(G!==null){var H=i.unstable_now();A=H;var ne=!0;try{ne=G(!0,H)}finally{ne?b():($=!1,G=null)}}else $=!1}var b;if(typeof v=="function")b=function(){v(N)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,z=R.port2;R.port1.onmessage=N,b=function(){z.postMessage(null)}}else b=function(){O(N,0)};function V(H){G=H,$||($=!0,b())}function Q(H,ne){E=O(function(){H(i.unstable_now())},ne)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(H){H.callback=null},i.unstable_continueExecution=function(){y||w||(y=!0,V(M))},i.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_getFirstCallbackNode=function(){return t(c)},i.unstable_next=function(H){switch(f){case 1:case 2:case 3:var ne=3;break;default:ne=f}var J=f;f=ne;try{return H()}finally{f=J}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(H,ne){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var J=f;f=H;try{return ne()}finally{f=J}},i.unstable_scheduleCallback=function(H,ne,J){var me=i.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?me+J:me):J=me,H){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=J+ge,H={id:u++,callback:ne,priorityLevel:H,startTime:J,expirationTime:ge,sortIndex:-1},J>me?(H.sortIndex=J,e(l,H),t(c)===null&&H===t(l)&&(S?(_(E),E=-1):S=!0,Q(T,J-me))):(H.sortIndex=ge,e(c,H),y||w||(y=!0,V(M))),H},i.unstable_shouldYield=x,i.unstable_wrapCallback=function(H){var ne=f;return function(){var J=f;f=ne;try{return H.apply(this,arguments)}finally{f=J}}}})(Wy);Ly.exports=Wy;var nC=Ly.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iC=B,pn=nC;function X(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var By=new Set,yc={};function us(i,e){Us(i,e),Us(i+"Capture",e)}function Us(i,e){for(yc[i]=e,i=0;i<e.length;i++)By.add(e[i])}var $i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hh=Object.prototype.hasOwnProperty,rC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Kf={},Qf={};function sC(i){return hh.call(Qf,i)?!0:hh.call(Kf,i)?!1:rC.test(i)?Qf[i]=!0:(Kf[i]=!0,!1)}function oC(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function aC(i,e,t,n){if(e===null||typeof e>"u"||oC(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Qt(i,e,t,n,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Mt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Mt[i]=new Qt(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];Mt[e]=new Qt(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Mt[i]=new Qt(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Mt[i]=new Qt(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Mt[i]=new Qt(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Mt[i]=new Qt(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Mt[i]=new Qt(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Mt[i]=new Qt(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Mt[i]=new Qt(i,5,!1,i.toLowerCase(),null,!1,!1)});var Op=/[\-:]([a-z])/g;function Dp(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(Op,Dp);Mt[e]=new Qt(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(Op,Dp);Mt[e]=new Qt(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(Op,Dp);Mt[e]=new Qt(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Mt[i]=new Qt(i,1,!1,i.toLowerCase(),null,!1,!1)});Mt.xlinkHref=new Qt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Mt[i]=new Qt(i,1,!1,i.toLowerCase(),null,!0,!0)});function $p(i,e,t,n){var r=Mt.hasOwnProperty(e)?Mt[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(aC(e,t,r,n)&&(t=null),n||r===null?sC(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):r.mustUseProperty?i[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?i.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var Bi=iC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Uc=Symbol.for("react.element"),xs=Symbol.for("react.portal"),ks=Symbol.for("react.fragment"),Fp=Symbol.for("react.strict_mode"),ph=Symbol.for("react.profiler"),Hy=Symbol.for("react.provider"),Gy=Symbol.for("react.context"),Lp=Symbol.for("react.forward_ref"),fh=Symbol.for("react.suspense"),gh=Symbol.for("react.suspense_list"),Wp=Symbol.for("react.memo"),Qi=Symbol.for("react.lazy"),zy=Symbol.for("react.offscreen"),Xf=Symbol.iterator;function ya(i){return i===null||typeof i!="object"?null:(i=Xf&&i[Xf]||i["@@iterator"],typeof i=="function"?i:null)}var Ge=Object.assign,gd;function Fa(i){if(gd===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);gd=e&&e[1]||""}return`
`+gd+i}var md=!1;function yd(i,e){if(!i||md)return"";md=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(i,[],e)}else{try{e.call()}catch(l){n=l}i.call(e.prototype)}else{try{throw Error()}catch(l){n=l}i()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=n.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return i.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",i.displayName)),c}while(1<=o&&0<=a);break}}}finally{md=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?Fa(i):""}function cC(i){switch(i.tag){case 5:return Fa(i.type);case 16:return Fa("Lazy");case 13:return Fa("Suspense");case 19:return Fa("SuspenseList");case 0:case 2:case 15:return i=yd(i.type,!1),i;case 11:return i=yd(i.type.render,!1),i;case 1:return i=yd(i.type,!0),i;default:return""}}function mh(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ks:return"Fragment";case xs:return"Portal";case ph:return"Profiler";case Fp:return"StrictMode";case fh:return"Suspense";case gh:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Gy:return(i.displayName||"Context")+".Consumer";case Hy:return(i._context.displayName||"Context")+".Provider";case Lp:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Wp:return e=i.displayName||null,e!==null?e:mh(i.type)||"Memo";case Qi:e=i._payload,i=i._init;try{return mh(i(e))}catch{}}return null}function lC(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mh(e);case 8:return e===Fp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function gr(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Uy(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function uC(i){var e=Uy(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function qc(i){i._valueTracker||(i._valueTracker=uC(i))}function qy(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=Uy(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function Vl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function yh(i,e){var t=e.checked;return Ge({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function Yf(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=gr(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Vy(i,e){e=e.checked,e!=null&&$p(i,"checked",e,!1)}function wh(i,e){Vy(i,e);var t=gr(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?vh(i,e.type,t):e.hasOwnProperty("defaultValue")&&vh(i,e.type,gr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function Zf(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function vh(i,e,t){(e!=="number"||Vl(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var La=Array.isArray;function Fs(i,e,t,n){if(i=i.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<i.length;t++)r=e.hasOwnProperty("$"+i[t].value),i[t].selected!==r&&(i[t].selected=r),r&&n&&(i[t].defaultSelected=!0)}else{for(t=""+gr(t),e=null,r=0;r<i.length;r++){if(i[r].value===t){i[r].selected=!0,n&&(i[r].defaultSelected=!0);return}e!==null||i[r].disabled||(e=i[r])}e!==null&&(e.selected=!0)}}function bh(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(X(91));return Ge({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function eg(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(X(92));if(La(t)){if(1<t.length)throw Error(X(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:gr(t)}}function Jy(i,e){var t=gr(e.value),n=gr(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function tg(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function Ky(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _h(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?Ky(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Vc,Qy=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,r)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(Vc=Vc||document.createElement("div"),Vc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Vc.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function wc(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var oc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},dC=["Webkit","ms","Moz","O"];Object.keys(oc).forEach(function(i){dC.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),oc[e]=oc[i]})});function Xy(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||oc.hasOwnProperty(i)&&oc[i]?(""+e).trim():e+"px"}function Yy(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=Xy(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,r):i[t]=r}}var hC=Ge({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ch(i,e){if(e){if(hC[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(X(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(X(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(X(61))}if(e.style!=null&&typeof e.style!="object")throw Error(X(62))}}function Sh(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ih=null;function Bp(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var xh=null,Ls=null,Ws=null;function ng(i){if(i=Wc(i)){if(typeof xh!="function")throw Error(X(280));var e=i.stateNode;e&&(e=Wu(e),xh(i.stateNode,i.type,e))}}function Zy(i){Ls?Ws?Ws.push(i):Ws=[i]:Ls=i}function ew(){if(Ls){var i=Ls,e=Ws;if(Ws=Ls=null,ng(i),e)for(i=0;i<e.length;i++)ng(e[i])}}function tw(i,e){return i(e)}function nw(){}var wd=!1;function iw(i,e,t){if(wd)return i(e,t);wd=!0;try{return tw(i,e,t)}finally{wd=!1,(Ls!==null||Ws!==null)&&(nw(),ew())}}function vc(i,e){var t=i.stateNode;if(t===null)return null;var n=Wu(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(X(231,e,typeof t));return t}var kh=!1;if($i)try{var wa={};Object.defineProperty(wa,"passive",{get:function(){kh=!0}}),window.addEventListener("test",wa,wa),window.removeEventListener("test",wa,wa)}catch{kh=!1}function pC(i,e,t,n,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(u){this.onError(u)}}var ac=!1,Jl=null,Kl=!1,Th=null,fC={onError:function(i){ac=!0,Jl=i}};function gC(i,e,t,n,r,s,o,a,c){ac=!1,Jl=null,pC.apply(fC,arguments)}function mC(i,e,t,n,r,s,o,a,c){if(gC.apply(this,arguments),ac){if(ac){var l=Jl;ac=!1,Jl=null}else throw Error(X(198));Kl||(Kl=!0,Th=l)}}function ds(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function rw(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function ig(i){if(ds(i)!==i)throw Error(X(188))}function yC(i){var e=i.alternate;if(!e){if(e=ds(i),e===null)throw Error(X(188));return e!==i?null:i}for(var t=i,n=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return ig(r),i;if(s===n)return ig(r),e;s=s.sibling}throw Error(X(188))}if(t.return!==n.return)t=r,n=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,n=s;break}if(a===n){o=!0,n=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=r;break}if(a===n){o=!0,n=s,t=r;break}a=a.sibling}if(!o)throw Error(X(189))}}if(t.alternate!==n)throw Error(X(190))}if(t.tag!==3)throw Error(X(188));return t.stateNode.current===t?i:e}function sw(i){return i=yC(i),i!==null?ow(i):null}function ow(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=ow(i);if(e!==null)return e;i=i.sibling}return null}var aw=pn.unstable_scheduleCallback,rg=pn.unstable_cancelCallback,wC=pn.unstable_shouldYield,vC=pn.unstable_requestPaint,Ze=pn.unstable_now,bC=pn.unstable_getCurrentPriorityLevel,Hp=pn.unstable_ImmediatePriority,cw=pn.unstable_UserBlockingPriority,Ql=pn.unstable_NormalPriority,_C=pn.unstable_LowPriority,lw=pn.unstable_IdlePriority,Du=null,li=null;function CC(i){if(li&&typeof li.onCommitFiberRoot=="function")try{li.onCommitFiberRoot(Du,i,void 0,(i.current.flags&128)===128)}catch{}}var Qn=Math.clz32?Math.clz32:xC,SC=Math.log,IC=Math.LN2;function xC(i){return i>>>=0,i===0?32:31-(SC(i)/IC|0)|0}var Jc=64,Kc=4194304;function Wa(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Xl(i,e){var t=i.pendingLanes;if(t===0)return 0;var n=0,r=i.suspendedLanes,s=i.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?n=Wa(a):(s&=o,s!==0&&(n=Wa(s)))}else o=t&~r,o!==0?n=Wa(o):s!==0&&(n=Wa(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-Qn(e),r=1<<t,n|=i[t],e&=~r;return n}function kC(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function TC(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,r=i.expirationTimes,s=i.pendingLanes;0<s;){var o=31-Qn(s),a=1<<o,c=r[o];c===-1?(!(a&t)||a&n)&&(r[o]=kC(a,e)):c<=e&&(i.expiredLanes|=a),s&=~a}}function Ah(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function uw(){var i=Jc;return Jc<<=1,!(Jc&4194240)&&(Jc=64),i}function vd(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function Fc(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-Qn(e),i[e]=t}function AC(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var n=i.eventTimes;for(i=i.expirationTimes;0<t;){var r=31-Qn(t),s=1<<r;e[r]=0,n[r]=-1,i[r]=-1,t&=~s}}function Gp(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-Qn(t),r=1<<n;r&e|i[n]&e&&(i[n]|=e),t&=~r}}var Ne=0;function dw(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var hw,zp,pw,fw,gw,Eh=!1,Qc=[],or=null,ar=null,cr=null,bc=new Map,_c=new Map,Zi=[],EC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sg(i,e){switch(i){case"focusin":case"focusout":or=null;break;case"dragenter":case"dragleave":ar=null;break;case"mouseover":case"mouseout":cr=null;break;case"pointerover":case"pointerout":bc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_c.delete(e.pointerId)}}function va(i,e,t,n,r,s){return i===null||i.nativeEvent!==s?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Wc(e),e!==null&&zp(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),i)}function PC(i,e,t,n,r){switch(e){case"focusin":return or=va(or,i,e,t,n,r),!0;case"dragenter":return ar=va(ar,i,e,t,n,r),!0;case"mouseover":return cr=va(cr,i,e,t,n,r),!0;case"pointerover":var s=r.pointerId;return bc.set(s,va(bc.get(s)||null,i,e,t,n,r)),!0;case"gotpointercapture":return s=r.pointerId,_c.set(s,va(_c.get(s)||null,i,e,t,n,r)),!0}return!1}function mw(i){var e=Yr(i.target);if(e!==null){var t=ds(e);if(t!==null){if(e=t.tag,e===13){if(e=rw(t),e!==null){i.blockedOn=e,gw(i.priority,function(){pw(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Al(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=Ph(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);Ih=n,t.target.dispatchEvent(n),Ih=null}else return e=Wc(t),e!==null&&zp(e),i.blockedOn=t,!1;e.shift()}return!0}function og(i,e,t){Al(i)&&t.delete(e)}function NC(){Eh=!1,or!==null&&Al(or)&&(or=null),ar!==null&&Al(ar)&&(ar=null),cr!==null&&Al(cr)&&(cr=null),bc.forEach(og),_c.forEach(og)}function ba(i,e){i.blockedOn===e&&(i.blockedOn=null,Eh||(Eh=!0,pn.unstable_scheduleCallback(pn.unstable_NormalPriority,NC)))}function Cc(i){function e(r){return ba(r,i)}if(0<Qc.length){ba(Qc[0],i);for(var t=1;t<Qc.length;t++){var n=Qc[t];n.blockedOn===i&&(n.blockedOn=null)}}for(or!==null&&ba(or,i),ar!==null&&ba(ar,i),cr!==null&&ba(cr,i),bc.forEach(e),_c.forEach(e),t=0;t<Zi.length;t++)n=Zi[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<Zi.length&&(t=Zi[0],t.blockedOn===null);)mw(t),t.blockedOn===null&&Zi.shift()}var Bs=Bi.ReactCurrentBatchConfig,Yl=!0;function RC(i,e,t,n){var r=Ne,s=Bs.transition;Bs.transition=null;try{Ne=1,Up(i,e,t,n)}finally{Ne=r,Bs.transition=s}}function MC(i,e,t,n){var r=Ne,s=Bs.transition;Bs.transition=null;try{Ne=4,Up(i,e,t,n)}finally{Ne=r,Bs.transition=s}}function Up(i,e,t,n){if(Yl){var r=Ph(i,e,t,n);if(r===null)Ed(i,e,n,Zl,t),sg(i,n);else if(PC(r,i,e,t,n))n.stopPropagation();else if(sg(i,n),e&4&&-1<EC.indexOf(i)){for(;r!==null;){var s=Wc(r);if(s!==null&&hw(s),s=Ph(i,e,t,n),s===null&&Ed(i,e,n,Zl,t),s===r)break;r=s}r!==null&&n.stopPropagation()}else Ed(i,e,n,null,t)}}var Zl=null;function Ph(i,e,t,n){if(Zl=null,i=Bp(n),i=Yr(i),i!==null)if(e=ds(i),e===null)i=null;else if(t=e.tag,t===13){if(i=rw(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return Zl=i,null}function yw(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bC()){case Hp:return 1;case cw:return 4;case Ql:case _C:return 16;case lw:return 536870912;default:return 16}default:return 16}}var tr=null,qp=null,El=null;function ww(){if(El)return El;var i,e=qp,t=e.length,n,r="value"in tr?tr.value:tr.textContent,s=r.length;for(i=0;i<t&&e[i]===r[i];i++);var o=t-i;for(n=1;n<=o&&e[t-n]===r[s-n];n++);return El=r.slice(i,1<n?1-n:void 0)}function Pl(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function Xc(){return!0}function ag(){return!1}function mn(i){function e(t,n,r,s,o){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(t=i[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Xc:ag,this.isPropagationStopped=ag,this}return Ge(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Xc)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Xc)},persist:function(){},isPersistent:Xc}),e}var to={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vp=mn(to),Lc=Ge({},to,{view:0,detail:0}),jC=mn(Lc),bd,_d,_a,$u=Ge({},Lc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jp,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==_a&&(_a&&i.type==="mousemove"?(bd=i.screenX-_a.screenX,_d=i.screenY-_a.screenY):_d=bd=0,_a=i),bd)},movementY:function(i){return"movementY"in i?i.movementY:_d}}),cg=mn($u),OC=Ge({},$u,{dataTransfer:0}),DC=mn(OC),$C=Ge({},Lc,{relatedTarget:0}),Cd=mn($C),FC=Ge({},to,{animationName:0,elapsedTime:0,pseudoElement:0}),LC=mn(FC),WC=Ge({},to,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),BC=mn(WC),HC=Ge({},to,{data:0}),lg=mn(HC),GC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qC(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=UC[i])?!!e[i]:!1}function Jp(){return qC}var VC=Ge({},Lc,{key:function(i){if(i.key){var e=GC[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=Pl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?zC[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jp,charCode:function(i){return i.type==="keypress"?Pl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Pl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),JC=mn(VC),KC=Ge({},$u,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ug=mn(KC),QC=Ge({},Lc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jp}),XC=mn(QC),YC=Ge({},to,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZC=mn(YC),eS=Ge({},$u,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),tS=mn(eS),nS=[9,13,27,32],Kp=$i&&"CompositionEvent"in window,cc=null;$i&&"documentMode"in document&&(cc=document.documentMode);var iS=$i&&"TextEvent"in window&&!cc,vw=$i&&(!Kp||cc&&8<cc&&11>=cc),dg=" ",hg=!1;function bw(i,e){switch(i){case"keyup":return nS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _w(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Ts=!1;function rS(i,e){switch(i){case"compositionend":return _w(e);case"keypress":return e.which!==32?null:(hg=!0,dg);case"textInput":return i=e.data,i===dg&&hg?null:i;default:return null}}function sS(i,e){if(Ts)return i==="compositionend"||!Kp&&bw(i,e)?(i=ww(),El=qp=tr=null,Ts=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return vw&&e.locale!=="ko"?null:e.data;default:return null}}var oS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pg(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!oS[i.type]:e==="textarea"}function Cw(i,e,t,n){Zy(n),e=eu(e,"onChange"),0<e.length&&(t=new Vp("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var lc=null,Sc=null;function aS(i){Mw(i,0)}function Fu(i){var e=Ps(i);if(qy(e))return i}function cS(i,e){if(i==="change")return e}var Sw=!1;if($i){var Sd;if($i){var Id="oninput"in document;if(!Id){var fg=document.createElement("div");fg.setAttribute("oninput","return;"),Id=typeof fg.oninput=="function"}Sd=Id}else Sd=!1;Sw=Sd&&(!document.documentMode||9<document.documentMode)}function gg(){lc&&(lc.detachEvent("onpropertychange",Iw),Sc=lc=null)}function Iw(i){if(i.propertyName==="value"&&Fu(Sc)){var e=[];Cw(e,Sc,i,Bp(i)),iw(aS,e)}}function lS(i,e,t){i==="focusin"?(gg(),lc=e,Sc=t,lc.attachEvent("onpropertychange",Iw)):i==="focusout"&&gg()}function uS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Fu(Sc)}function dS(i,e){if(i==="click")return Fu(e)}function hS(i,e){if(i==="input"||i==="change")return Fu(e)}function pS(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var Yn=typeof Object.is=="function"?Object.is:pS;function Ic(i,e){if(Yn(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!hh.call(e,r)||!Yn(i[r],e[r]))return!1}return!0}function mg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function yg(i,e){var t=mg(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=mg(t)}}function xw(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?xw(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function kw(){for(var i=window,e=Vl();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=Vl(i.document)}return e}function Qp(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function fS(i){var e=kw(),t=i.focusedElem,n=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&xw(t.ownerDocument.documentElement,t)){if(n!==null&&Qp(t)){if(e=n.start,i=n.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var r=t.textContent.length,s=Math.min(n.start,r);n=n.end===void 0?s:Math.min(n.end,r),!i.extend&&s>n&&(r=n,n=s,s=r),r=yg(t,s);var o=yg(t,n);r&&o&&(i.rangeCount!==1||i.anchorNode!==r.node||i.anchorOffset!==r.offset||i.focusNode!==o.node||i.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),i.removeAllRanges(),s>n?(i.addRange(e),i.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var gS=$i&&"documentMode"in document&&11>=document.documentMode,As=null,Nh=null,uc=null,Rh=!1;function wg(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Rh||As==null||As!==Vl(n)||(n=As,"selectionStart"in n&&Qp(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),uc&&Ic(uc,n)||(uc=n,n=eu(Nh,"onSelect"),0<n.length&&(e=new Vp("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=As)))}function Yc(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var Es={animationend:Yc("Animation","AnimationEnd"),animationiteration:Yc("Animation","AnimationIteration"),animationstart:Yc("Animation","AnimationStart"),transitionend:Yc("Transition","TransitionEnd")},xd={},Tw={};$i&&(Tw=document.createElement("div").style,"AnimationEvent"in window||(delete Es.animationend.animation,delete Es.animationiteration.animation,delete Es.animationstart.animation),"TransitionEvent"in window||delete Es.transitionend.transition);function Lu(i){if(xd[i])return xd[i];if(!Es[i])return i;var e=Es[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in Tw)return xd[i]=e[t];return i}var Aw=Lu("animationend"),Ew=Lu("animationiteration"),Pw=Lu("animationstart"),Nw=Lu("transitionend"),Rw=new Map,vg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yr(i,e){Rw.set(i,e),us(e,[i])}for(var kd=0;kd<vg.length;kd++){var Td=vg[kd],mS=Td.toLowerCase(),yS=Td[0].toUpperCase()+Td.slice(1);yr(mS,"on"+yS)}yr(Aw,"onAnimationEnd");yr(Ew,"onAnimationIteration");yr(Pw,"onAnimationStart");yr("dblclick","onDoubleClick");yr("focusin","onFocus");yr("focusout","onBlur");yr(Nw,"onTransitionEnd");Us("onMouseEnter",["mouseout","mouseover"]);Us("onMouseLeave",["mouseout","mouseover"]);Us("onPointerEnter",["pointerout","pointerover"]);Us("onPointerLeave",["pointerout","pointerover"]);us("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));us("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));us("onBeforeInput",["compositionend","keypress","textInput","paste"]);us("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));us("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));us("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ba="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ba));function bg(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,mC(n,e,void 0,i),i.currentTarget=null}function Mw(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],r=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;bg(r,a,l),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;bg(r,a,l),s=c}}}if(Kl)throw i=Th,Kl=!1,Th=null,i}function Oe(i,e){var t=e[$h];t===void 0&&(t=e[$h]=new Set);var n=i+"__bubble";t.has(n)||(jw(e,i,2,!1),t.add(n))}function Ad(i,e,t){var n=0;e&&(n|=4),jw(t,i,n,e)}var Zc="_reactListening"+Math.random().toString(36).slice(2);function xc(i){if(!i[Zc]){i[Zc]=!0,By.forEach(function(t){t!=="selectionchange"&&(wS.has(t)||Ad(t,!1,i),Ad(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[Zc]||(e[Zc]=!0,Ad("selectionchange",!1,e))}}function jw(i,e,t,n){switch(yw(e)){case 1:var r=RC;break;case 4:r=MC;break;default:r=Up}t=r.bind(null,e,t,i),r=void 0,!kh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?i.addEventListener(e,t,{capture:!0,passive:r}):i.addEventListener(e,t,!0):r!==void 0?i.addEventListener(e,t,{passive:r}):i.addEventListener(e,t,!1)}function Ed(i,e,t,n,r){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Yr(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}iw(function(){var l=s,u=Bp(t),p=[];e:{var f=Rw.get(i);if(f!==void 0){var w=Vp,y=i;switch(i){case"keypress":if(Pl(t)===0)break e;case"keydown":case"keyup":w=JC;break;case"focusin":y="focus",w=Cd;break;case"focusout":y="blur",w=Cd;break;case"beforeblur":case"afterblur":w=Cd;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=cg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=DC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=XC;break;case Aw:case Ew:case Pw:w=LC;break;case Nw:w=ZC;break;case"scroll":w=jC;break;case"wheel":w=tS;break;case"copy":case"cut":case"paste":w=BC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=ug}var S=(e&4)!==0,O=!S&&i==="scroll",_=S?f!==null?f+"Capture":null:f;S=[];for(var v=l,C;v!==null;){C=v;var T=C.stateNode;if(C.tag===5&&T!==null&&(C=T,_!==null&&(T=vc(v,_),T!=null&&S.push(kc(v,T,C)))),O)break;v=v.return}0<S.length&&(f=new w(f,y,null,t,u),p.push({event:f,listeners:S}))}}if(!(e&7)){e:{if(f=i==="mouseover"||i==="pointerover",w=i==="mouseout"||i==="pointerout",f&&t!==Ih&&(y=t.relatedTarget||t.fromElement)&&(Yr(y)||y[Fi]))break e;if((w||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,w?(y=t.relatedTarget||t.toElement,w=l,y=y?Yr(y):null,y!==null&&(O=ds(y),y!==O||y.tag!==5&&y.tag!==6)&&(y=null)):(w=null,y=l),w!==y)){if(S=cg,T="onMouseLeave",_="onMouseEnter",v="mouse",(i==="pointerout"||i==="pointerover")&&(S=ug,T="onPointerLeave",_="onPointerEnter",v="pointer"),O=w==null?f:Ps(w),C=y==null?f:Ps(y),f=new S(T,v+"leave",w,t,u),f.target=O,f.relatedTarget=C,T=null,Yr(u)===l&&(S=new S(_,v+"enter",y,t,u),S.target=C,S.relatedTarget=O,T=S),O=T,w&&y)t:{for(S=w,_=y,v=0,C=S;C;C=gs(C))v++;for(C=0,T=_;T;T=gs(T))C++;for(;0<v-C;)S=gs(S),v--;for(;0<C-v;)_=gs(_),C--;for(;v--;){if(S===_||_!==null&&S===_.alternate)break t;S=gs(S),_=gs(_)}S=null}else S=null;w!==null&&_g(p,f,w,S,!1),y!==null&&O!==null&&_g(p,O,y,S,!0)}}e:{if(f=l?Ps(l):window,w=f.nodeName&&f.nodeName.toLowerCase(),w==="select"||w==="input"&&f.type==="file")var M=cS;else if(pg(f))if(Sw)M=hS;else{M=uS;var $=lS}else(w=f.nodeName)&&w.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(M=dS);if(M&&(M=M(i,l))){Cw(p,M,t,u);break e}$&&$(i,f,l),i==="focusout"&&($=f._wrapperState)&&$.controlled&&f.type==="number"&&vh(f,"number",f.value)}switch($=l?Ps(l):window,i){case"focusin":(pg($)||$.contentEditable==="true")&&(As=$,Nh=l,uc=null);break;case"focusout":uc=Nh=As=null;break;case"mousedown":Rh=!0;break;case"contextmenu":case"mouseup":case"dragend":Rh=!1,wg(p,t,u);break;case"selectionchange":if(gS)break;case"keydown":case"keyup":wg(p,t,u)}var G;if(Kp)e:{switch(i){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Ts?bw(i,t)&&(E="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(E="onCompositionStart");E&&(vw&&t.locale!=="ko"&&(Ts||E!=="onCompositionStart"?E==="onCompositionEnd"&&Ts&&(G=ww()):(tr=u,qp="value"in tr?tr.value:tr.textContent,Ts=!0)),$=eu(l,E),0<$.length&&(E=new lg(E,i,null,t,u),p.push({event:E,listeners:$}),G?E.data=G:(G=_w(t),G!==null&&(E.data=G)))),(G=iS?rS(i,t):sS(i,t))&&(l=eu(l,"onBeforeInput"),0<l.length&&(u=new lg("onBeforeInput","beforeinput",null,t,u),p.push({event:u,listeners:l}),u.data=G))}Mw(p,e)})}function kc(i,e,t){return{instance:i,listener:e,currentTarget:t}}function eu(i,e){for(var t=e+"Capture",n=[];i!==null;){var r=i,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=vc(i,t),s!=null&&n.unshift(kc(i,s,r)),s=vc(i,e),s!=null&&n.push(kc(i,s,r))),i=i.return}return n}function gs(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function _g(i,e,t,n,r){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,l=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&l!==null&&(a=l,r?(c=vc(t,s),c!=null&&o.unshift(kc(t,c,a))):r||(c=vc(t,s),c!=null&&o.push(kc(t,c,a)))),t=t.return}o.length!==0&&i.push({event:e,listeners:o})}var vS=/\r\n?/g,bS=/\u0000|\uFFFD/g;function Cg(i){return(typeof i=="string"?i:""+i).replace(vS,`
`).replace(bS,"")}function el(i,e,t){if(e=Cg(e),Cg(i)!==e&&t)throw Error(X(425))}function tu(){}var Mh=null,jh=null;function Oh(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Dh=typeof setTimeout=="function"?setTimeout:void 0,_S=typeof clearTimeout=="function"?clearTimeout:void 0,Sg=typeof Promise=="function"?Promise:void 0,CS=typeof queueMicrotask=="function"?queueMicrotask:typeof Sg<"u"?function(i){return Sg.resolve(null).then(i).catch(SS)}:Dh;function SS(i){setTimeout(function(){throw i})}function Pd(i,e){var t=e,n=0;do{var r=t.nextSibling;if(i.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){i.removeChild(r),Cc(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);Cc(e)}function lr(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function Ig(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var no=Math.random().toString(36).slice(2),si="__reactFiber$"+no,Tc="__reactProps$"+no,Fi="__reactContainer$"+no,$h="__reactEvents$"+no,IS="__reactListeners$"+no,xS="__reactHandles$"+no;function Yr(i){var e=i[si];if(e)return e;for(var t=i.parentNode;t;){if(e=t[Fi]||t[si]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=Ig(i);i!==null;){if(t=i[si])return t;i=Ig(i)}return e}i=t,t=i.parentNode}return null}function Wc(i){return i=i[si]||i[Fi],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Ps(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(X(33))}function Wu(i){return i[Tc]||null}var Fh=[],Ns=-1;function wr(i){return{current:i}}function De(i){0>Ns||(i.current=Fh[Ns],Fh[Ns]=null,Ns--)}function je(i,e){Ns++,Fh[Ns]=i.current,i.current=e}var mr={},Lt=wr(mr),nn=wr(!1),is=mr;function qs(i,e){var t=i.type.contextTypes;if(!t)return mr;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=r),r}function rn(i){return i=i.childContextTypes,i!=null}function nu(){De(nn),De(Lt)}function xg(i,e,t){if(Lt.current!==mr)throw Error(X(168));je(Lt,e),je(nn,t)}function Ow(i,e,t){var n=i.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(X(108,lC(i)||"Unknown",r));return Ge({},t,n)}function iu(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||mr,is=Lt.current,je(Lt,i),je(nn,nn.current),!0}function kg(i,e,t){var n=i.stateNode;if(!n)throw Error(X(169));t?(i=Ow(i,e,is),n.__reactInternalMemoizedMergedChildContext=i,De(nn),De(Lt),je(Lt,i)):De(nn),je(nn,t)}var Ei=null,Bu=!1,Nd=!1;function Dw(i){Ei===null?Ei=[i]:Ei.push(i)}function kS(i){Bu=!0,Dw(i)}function vr(){if(!Nd&&Ei!==null){Nd=!0;var i=0,e=Ne;try{var t=Ei;for(Ne=1;i<t.length;i++){var n=t[i];do n=n(!0);while(n!==null)}Ei=null,Bu=!1}catch(r){throw Ei!==null&&(Ei=Ei.slice(i+1)),aw(Hp,vr),r}finally{Ne=e,Nd=!1}}return null}var Rs=[],Ms=0,ru=null,su=0,Cn=[],Sn=0,rs=null,Ni=1,Ri="";function Jr(i,e){Rs[Ms++]=su,Rs[Ms++]=ru,ru=i,su=e}function $w(i,e,t){Cn[Sn++]=Ni,Cn[Sn++]=Ri,Cn[Sn++]=rs,rs=i;var n=Ni;i=Ri;var r=32-Qn(n)-1;n&=~(1<<r),t+=1;var s=32-Qn(e)+r;if(30<s){var o=r-r%5;s=(n&(1<<o)-1).toString(32),n>>=o,r-=o,Ni=1<<32-Qn(e)+r|t<<r|n,Ri=s+i}else Ni=1<<s|t<<r|n,Ri=i}function Xp(i){i.return!==null&&(Jr(i,1),$w(i,1,0))}function Yp(i){for(;i===ru;)ru=Rs[--Ms],Rs[Ms]=null,su=Rs[--Ms],Rs[Ms]=null;for(;i===rs;)rs=Cn[--Sn],Cn[Sn]=null,Ri=Cn[--Sn],Cn[Sn]=null,Ni=Cn[--Sn],Cn[Sn]=null}var hn=null,un=null,Le=!1,Jn=null;function Fw(i,e){var t=Tn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function Tg(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,hn=i,un=lr(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,hn=i,un=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=rs!==null?{id:Ni,overflow:Ri}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Tn(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,hn=i,un=null,!0):!1;default:return!1}}function Lh(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Wh(i){if(Le){var e=un;if(e){var t=e;if(!Tg(i,e)){if(Lh(i))throw Error(X(418));e=lr(t.nextSibling);var n=hn;e&&Tg(i,e)?Fw(n,t):(i.flags=i.flags&-4097|2,Le=!1,hn=i)}}else{if(Lh(i))throw Error(X(418));i.flags=i.flags&-4097|2,Le=!1,hn=i}}}function Ag(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;hn=i}function tl(i){if(i!==hn)return!1;if(!Le)return Ag(i),Le=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!Oh(i.type,i.memoizedProps)),e&&(e=un)){if(Lh(i))throw Lw(),Error(X(418));for(;e;)Fw(i,e),e=lr(e.nextSibling)}if(Ag(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(X(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){un=lr(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}un=null}}else un=hn?lr(i.stateNode.nextSibling):null;return!0}function Lw(){for(var i=un;i;)i=lr(i.nextSibling)}function Vs(){un=hn=null,Le=!1}function Zp(i){Jn===null?Jn=[i]:Jn.push(i)}var TS=Bi.ReactCurrentBatchConfig;function Ca(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(X(309));var n=t.stateNode}if(!n)throw Error(X(147,i));var r=n,s=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof i!="string")throw Error(X(284));if(!t._owner)throw Error(X(290,i))}return i}function nl(i,e){throw i=Object.prototype.toString.call(e),Error(X(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function Eg(i){var e=i._init;return e(i._payload)}function Ww(i){function e(_,v){if(i){var C=_.deletions;C===null?(_.deletions=[v],_.flags|=16):C.push(v)}}function t(_,v){if(!i)return null;for(;v!==null;)e(_,v),v=v.sibling;return null}function n(_,v){for(_=new Map;v!==null;)v.key!==null?_.set(v.key,v):_.set(v.index,v),v=v.sibling;return _}function r(_,v){return _=pr(_,v),_.index=0,_.sibling=null,_}function s(_,v,C){return _.index=C,i?(C=_.alternate,C!==null?(C=C.index,C<v?(_.flags|=2,v):C):(_.flags|=2,v)):(_.flags|=1048576,v)}function o(_){return i&&_.alternate===null&&(_.flags|=2),_}function a(_,v,C,T){return v===null||v.tag!==6?(v=Fd(C,_.mode,T),v.return=_,v):(v=r(v,C),v.return=_,v)}function c(_,v,C,T){var M=C.type;return M===ks?u(_,v,C.props.children,T,C.key):v!==null&&(v.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Qi&&Eg(M)===v.type)?(T=r(v,C.props),T.ref=Ca(_,v,C),T.return=_,T):(T=$l(C.type,C.key,C.props,null,_.mode,T),T.ref=Ca(_,v,C),T.return=_,T)}function l(_,v,C,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==C.containerInfo||v.stateNode.implementation!==C.implementation?(v=Ld(C,_.mode,T),v.return=_,v):(v=r(v,C.children||[]),v.return=_,v)}function u(_,v,C,T,M){return v===null||v.tag!==7?(v=ns(C,_.mode,T,M),v.return=_,v):(v=r(v,C),v.return=_,v)}function p(_,v,C){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Fd(""+v,_.mode,C),v.return=_,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Uc:return C=$l(v.type,v.key,v.props,null,_.mode,C),C.ref=Ca(_,null,v),C.return=_,C;case xs:return v=Ld(v,_.mode,C),v.return=_,v;case Qi:var T=v._init;return p(_,T(v._payload),C)}if(La(v)||ya(v))return v=ns(v,_.mode,C,null),v.return=_,v;nl(_,v)}return null}function f(_,v,C,T){var M=v!==null?v.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return M!==null?null:a(_,v,""+C,T);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Uc:return C.key===M?c(_,v,C,T):null;case xs:return C.key===M?l(_,v,C,T):null;case Qi:return M=C._init,f(_,v,M(C._payload),T)}if(La(C)||ya(C))return M!==null?null:u(_,v,C,T,null);nl(_,C)}return null}function w(_,v,C,T,M){if(typeof T=="string"&&T!==""||typeof T=="number")return _=_.get(C)||null,a(v,_,""+T,M);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Uc:return _=_.get(T.key===null?C:T.key)||null,c(v,_,T,M);case xs:return _=_.get(T.key===null?C:T.key)||null,l(v,_,T,M);case Qi:var $=T._init;return w(_,v,C,$(T._payload),M)}if(La(T)||ya(T))return _=_.get(C)||null,u(v,_,T,M,null);nl(v,T)}return null}function y(_,v,C,T){for(var M=null,$=null,G=v,E=v=0,D=null;G!==null&&E<C.length;E++){G.index>E?(D=G,G=null):D=G.sibling;var A=f(_,G,C[E],T);if(A===null){G===null&&(G=D);break}i&&G&&A.alternate===null&&e(_,G),v=s(A,v,E),$===null?M=A:$.sibling=A,$=A,G=D}if(E===C.length)return t(_,G),Le&&Jr(_,E),M;if(G===null){for(;E<C.length;E++)G=p(_,C[E],T),G!==null&&(v=s(G,v,E),$===null?M=G:$.sibling=G,$=G);return Le&&Jr(_,E),M}for(G=n(_,G);E<C.length;E++)D=w(G,_,E,C[E],T),D!==null&&(i&&D.alternate!==null&&G.delete(D.key===null?E:D.key),v=s(D,v,E),$===null?M=D:$.sibling=D,$=D);return i&&G.forEach(function(x){return e(_,x)}),Le&&Jr(_,E),M}function S(_,v,C,T){var M=ya(C);if(typeof M!="function")throw Error(X(150));if(C=M.call(C),C==null)throw Error(X(151));for(var $=M=null,G=v,E=v=0,D=null,A=C.next();G!==null&&!A.done;E++,A=C.next()){G.index>E?(D=G,G=null):D=G.sibling;var x=f(_,G,A.value,T);if(x===null){G===null&&(G=D);break}i&&G&&x.alternate===null&&e(_,G),v=s(x,v,E),$===null?M=x:$.sibling=x,$=x,G=D}if(A.done)return t(_,G),Le&&Jr(_,E),M;if(G===null){for(;!A.done;E++,A=C.next())A=p(_,A.value,T),A!==null&&(v=s(A,v,E),$===null?M=A:$.sibling=A,$=A);return Le&&Jr(_,E),M}for(G=n(_,G);!A.done;E++,A=C.next())A=w(G,_,E,A.value,T),A!==null&&(i&&A.alternate!==null&&G.delete(A.key===null?E:A.key),v=s(A,v,E),$===null?M=A:$.sibling=A,$=A);return i&&G.forEach(function(N){return e(_,N)}),Le&&Jr(_,E),M}function O(_,v,C,T){if(typeof C=="object"&&C!==null&&C.type===ks&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case Uc:e:{for(var M=C.key,$=v;$!==null;){if($.key===M){if(M=C.type,M===ks){if($.tag===7){t(_,$.sibling),v=r($,C.props.children),v.return=_,_=v;break e}}else if($.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Qi&&Eg(M)===$.type){t(_,$.sibling),v=r($,C.props),v.ref=Ca(_,$,C),v.return=_,_=v;break e}t(_,$);break}else e(_,$);$=$.sibling}C.type===ks?(v=ns(C.props.children,_.mode,T,C.key),v.return=_,_=v):(T=$l(C.type,C.key,C.props,null,_.mode,T),T.ref=Ca(_,v,C),T.return=_,_=T)}return o(_);case xs:e:{for($=C.key;v!==null;){if(v.key===$)if(v.tag===4&&v.stateNode.containerInfo===C.containerInfo&&v.stateNode.implementation===C.implementation){t(_,v.sibling),v=r(v,C.children||[]),v.return=_,_=v;break e}else{t(_,v);break}else e(_,v);v=v.sibling}v=Ld(C,_.mode,T),v.return=_,_=v}return o(_);case Qi:return $=C._init,O(_,v,$(C._payload),T)}if(La(C))return y(_,v,C,T);if(ya(C))return S(_,v,C,T);nl(_,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,v!==null&&v.tag===6?(t(_,v.sibling),v=r(v,C),v.return=_,_=v):(t(_,v),v=Fd(C,_.mode,T),v.return=_,_=v),o(_)):t(_,v)}return O}var Js=Ww(!0),Bw=Ww(!1),ou=wr(null),au=null,js=null,ef=null;function tf(){ef=js=au=null}function nf(i){var e=ou.current;De(ou),i._currentValue=e}function Bh(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function Hs(i,e){au=i,ef=js=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(tn=!0),i.firstContext=null)}function Nn(i){var e=i._currentValue;if(ef!==i)if(i={context:i,memoizedValue:e,next:null},js===null){if(au===null)throw Error(X(308));js=i,au.dependencies={lanes:0,firstContext:i}}else js=js.next=i;return e}var Zr=null;function rf(i){Zr===null?Zr=[i]:Zr.push(i)}function Hw(i,e,t,n){var r=e.interleaved;return r===null?(t.next=t,rf(e)):(t.next=r.next,r.next=t),e.interleaved=t,Li(i,n)}function Li(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var Xi=!1;function sf(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gw(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Oi(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function ur(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,Ie&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,Li(i,t)}return r=n.interleaved,r===null?(e.next=e,rf(n)):(e.next=r.next,r.next=e),n.interleaved=e,Li(i,t)}function Nl(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,Gp(i,t)}}function Pg(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function cu(i,e,t,n){var r=i.updateQueue;Xi=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=i.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var p=r.baseState;o=0,u=l=c=null,a=s;do{var f=a.lane,w=a.eventTime;if((n&f)===f){u!==null&&(u=u.next={eventTime:w,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=i,S=a;switch(f=e,w=t,S.tag){case 1:if(y=S.payload,typeof y=="function"){p=y.call(w,p,f);break e}p=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=S.payload,f=typeof y=="function"?y.call(w,p,f):y,f==null)break e;p=Ge({},p,f);break e;case 2:Xi=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else w={eventTime:w,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=w,c=p):u=u.next=w,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(u===null&&(c=p),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);os|=o,i.lanes=o,i.memoizedState=p}}function Ng(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(X(191,r));r.call(n)}}}var Bc={},ui=wr(Bc),Ac=wr(Bc),Ec=wr(Bc);function es(i){if(i===Bc)throw Error(X(174));return i}function of(i,e){switch(je(Ec,e),je(Ac,i),je(ui,Bc),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_h(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=_h(e,i)}De(ui),je(ui,e)}function Ks(){De(ui),De(Ac),De(Ec)}function zw(i){es(Ec.current);var e=es(ui.current),t=_h(e,i.type);e!==t&&(je(Ac,i),je(ui,t))}function af(i){Ac.current===i&&(De(ui),De(Ac))}var Be=wr(0);function lu(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Rd=[];function cf(){for(var i=0;i<Rd.length;i++)Rd[i]._workInProgressVersionPrimary=null;Rd.length=0}var Rl=Bi.ReactCurrentDispatcher,Md=Bi.ReactCurrentBatchConfig,ss=0,He=null,lt=null,_t=null,uu=!1,dc=!1,Pc=0,AS=0;function jt(){throw Error(X(321))}function lf(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!Yn(i[t],e[t]))return!1;return!0}function uf(i,e,t,n,r,s){if(ss=s,He=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Rl.current=i===null||i.memoizedState===null?RS:MS,i=t(n,r),dc){s=0;do{if(dc=!1,Pc=0,25<=s)throw Error(X(301));s+=1,_t=lt=null,e.updateQueue=null,Rl.current=jS,i=t(n,r)}while(dc)}if(Rl.current=du,e=lt!==null&&lt.next!==null,ss=0,_t=lt=He=null,uu=!1,e)throw Error(X(300));return i}function df(){var i=Pc!==0;return Pc=0,i}function ni(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _t===null?He.memoizedState=_t=i:_t=_t.next=i,_t}function Rn(){if(lt===null){var i=He.alternate;i=i!==null?i.memoizedState:null}else i=lt.next;var e=_t===null?He.memoizedState:_t.next;if(e!==null)_t=e,lt=i;else{if(i===null)throw Error(X(310));lt=i,i={memoizedState:lt.memoizedState,baseState:lt.baseState,baseQueue:lt.baseQueue,queue:lt.queue,next:null},_t===null?He.memoizedState=_t=i:_t=_t.next=i}return _t}function Nc(i,e){return typeof e=="function"?e(i):e}function jd(i){var e=Rn(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=i;var n=lt,r=n.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}n.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,n=n.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((ss&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:i(n,l.action);else{var p={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=p,o=n):c=c.next=p,He.lanes|=u,os|=u}l=l.next}while(l!==null&&l!==s);c===null?o=n:c.next=a,Yn(n,e.memoizedState)||(tn=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(i=t.interleaved,i!==null){r=i;do s=r.lane,He.lanes|=s,os|=s,r=r.next;while(r!==i)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Od(i){var e=Rn(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=i;var n=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=i(s,o.action),o=o.next;while(o!==r);Yn(s,e.memoizedState)||(tn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function Uw(){}function qw(i,e){var t=He,n=Rn(),r=e(),s=!Yn(n.memoizedState,r);if(s&&(n.memoizedState=r,tn=!0),n=n.queue,hf(Kw.bind(null,t,n,i),[i]),n.getSnapshot!==e||s||_t!==null&&_t.memoizedState.tag&1){if(t.flags|=2048,Rc(9,Jw.bind(null,t,n,r,e),void 0,null),Ct===null)throw Error(X(349));ss&30||Vw(t,e,r)}return r}function Vw(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=He.updateQueue,e===null?(e={lastEffect:null,stores:null},He.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function Jw(i,e,t,n){e.value=t,e.getSnapshot=n,Qw(e)&&Xw(i)}function Kw(i,e,t){return t(function(){Qw(e)&&Xw(i)})}function Qw(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!Yn(i,t)}catch{return!0}}function Xw(i){var e=Li(i,1);e!==null&&Xn(e,i,1,-1)}function Rg(i){var e=ni();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Nc,lastRenderedState:i},e.queue=i,i=i.dispatch=NS.bind(null,He,i),[e.memoizedState,i]}function Rc(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=He.updateQueue,e===null?(e={lastEffect:null,stores:null},He.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function Yw(){return Rn().memoizedState}function Ml(i,e,t,n){var r=ni();He.flags|=i,r.memoizedState=Rc(1|e,t,void 0,n===void 0?null:n)}function Hu(i,e,t,n){var r=Rn();n=n===void 0?null:n;var s=void 0;if(lt!==null){var o=lt.memoizedState;if(s=o.destroy,n!==null&&lf(n,o.deps)){r.memoizedState=Rc(e,t,s,n);return}}He.flags|=i,r.memoizedState=Rc(1|e,t,s,n)}function Mg(i,e){return Ml(8390656,8,i,e)}function hf(i,e){return Hu(2048,8,i,e)}function Zw(i,e){return Hu(4,2,i,e)}function ev(i,e){return Hu(4,4,i,e)}function tv(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function nv(i,e,t){return t=t!=null?t.concat([i]):null,Hu(4,4,tv.bind(null,e,i),t)}function pf(){}function iv(i,e){var t=Rn();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&lf(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function rv(i,e){var t=Rn();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&lf(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function sv(i,e,t){return ss&21?(Yn(t,e)||(t=uw(),He.lanes|=t,os|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,tn=!0),i.memoizedState=t)}function ES(i,e){var t=Ne;Ne=t!==0&&4>t?t:4,i(!0);var n=Md.transition;Md.transition={};try{i(!1),e()}finally{Ne=t,Md.transition=n}}function ov(){return Rn().memoizedState}function PS(i,e,t){var n=hr(i);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},av(i))cv(e,t);else if(t=Hw(i,e,t,n),t!==null){var r=qt();Xn(t,i,n,r),lv(t,e,n)}}function NS(i,e,t){var n=hr(i),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(av(i))cv(e,r);else{var s=i.alternate;if(i.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,Yn(a,o)){var c=e.interleaved;c===null?(r.next=r,rf(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}t=Hw(i,e,r,n),t!==null&&(r=qt(),Xn(t,i,n,r),lv(t,e,n))}}function av(i){var e=i.alternate;return i===He||e!==null&&e===He}function cv(i,e){dc=uu=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function lv(i,e,t){if(t&4194240){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,Gp(i,t)}}var du={readContext:Nn,useCallback:jt,useContext:jt,useEffect:jt,useImperativeHandle:jt,useInsertionEffect:jt,useLayoutEffect:jt,useMemo:jt,useReducer:jt,useRef:jt,useState:jt,useDebugValue:jt,useDeferredValue:jt,useTransition:jt,useMutableSource:jt,useSyncExternalStore:jt,useId:jt,unstable_isNewReconciler:!1},RS={readContext:Nn,useCallback:function(i,e){return ni().memoizedState=[i,e===void 0?null:e],i},useContext:Nn,useEffect:Mg,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,Ml(4194308,4,tv.bind(null,e,i),t)},useLayoutEffect:function(i,e){return Ml(4194308,4,i,e)},useInsertionEffect:function(i,e){return Ml(4,2,i,e)},useMemo:function(i,e){var t=ni();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=ni();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},n.queue=i,i=i.dispatch=PS.bind(null,He,i),[n.memoizedState,i]},useRef:function(i){var e=ni();return i={current:i},e.memoizedState=i},useState:Rg,useDebugValue:pf,useDeferredValue:function(i){return ni().memoizedState=i},useTransition:function(){var i=Rg(!1),e=i[0];return i=ES.bind(null,i[1]),ni().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var n=He,r=ni();if(Le){if(t===void 0)throw Error(X(407));t=t()}else{if(t=e(),Ct===null)throw Error(X(349));ss&30||Vw(n,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,Mg(Kw.bind(null,n,s,i),[i]),n.flags|=2048,Rc(9,Jw.bind(null,n,s,t,e),void 0,null),t},useId:function(){var i=ni(),e=Ct.identifierPrefix;if(Le){var t=Ri,n=Ni;t=(n&~(1<<32-Qn(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Pc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=AS++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},MS={readContext:Nn,useCallback:iv,useContext:Nn,useEffect:hf,useImperativeHandle:nv,useInsertionEffect:Zw,useLayoutEffect:ev,useMemo:rv,useReducer:jd,useRef:Yw,useState:function(){return jd(Nc)},useDebugValue:pf,useDeferredValue:function(i){var e=Rn();return sv(e,lt.memoizedState,i)},useTransition:function(){var i=jd(Nc)[0],e=Rn().memoizedState;return[i,e]},useMutableSource:Uw,useSyncExternalStore:qw,useId:ov,unstable_isNewReconciler:!1},jS={readContext:Nn,useCallback:iv,useContext:Nn,useEffect:hf,useImperativeHandle:nv,useInsertionEffect:Zw,useLayoutEffect:ev,useMemo:rv,useReducer:Od,useRef:Yw,useState:function(){return Od(Nc)},useDebugValue:pf,useDeferredValue:function(i){var e=Rn();return lt===null?e.memoizedState=i:sv(e,lt.memoizedState,i)},useTransition:function(){var i=Od(Nc)[0],e=Rn().memoizedState;return[i,e]},useMutableSource:Uw,useSyncExternalStore:qw,useId:ov,unstable_isNewReconciler:!1};function zn(i,e){if(i&&i.defaultProps){e=Ge({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}function Hh(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:Ge({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var Gu={isMounted:function(i){return(i=i._reactInternals)?ds(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=qt(),r=hr(i),s=Oi(n,r);s.payload=e,t!=null&&(s.callback=t),e=ur(i,s,r),e!==null&&(Xn(e,i,r,n),Nl(e,i,r))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=qt(),r=hr(i),s=Oi(n,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=ur(i,s,r),e!==null&&(Xn(e,i,r,n),Nl(e,i,r))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=qt(),n=hr(i),r=Oi(t,n);r.tag=2,e!=null&&(r.callback=e),e=ur(i,r,n),e!==null&&(Xn(e,i,n,t),Nl(e,i,n))}};function jg(i,e,t,n,r,s,o){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!Ic(t,n)||!Ic(r,s):!0}function uv(i,e,t){var n=!1,r=mr,s=e.contextType;return typeof s=="object"&&s!==null?s=Nn(s):(r=rn(e)?is:Lt.current,n=e.contextTypes,s=(n=n!=null)?qs(i,r):mr),e=new e(t,s),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Gu,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=s),e}function Og(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&Gu.enqueueReplaceState(e,e.state,null)}function Gh(i,e,t,n){var r=i.stateNode;r.props=t,r.state=i.memoizedState,r.refs={},sf(i);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Nn(s):(s=rn(e)?is:Lt.current,r.context=qs(i,s)),r.state=i.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Hh(i,e,s,t),r.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Gu.enqueueReplaceState(r,r.state,null),cu(i,t,r,n),r.state=i.memoizedState),typeof r.componentDidMount=="function"&&(i.flags|=4194308)}function Qs(i,e){try{var t="",n=e;do t+=cC(n),n=n.return;while(n);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:i,source:e,stack:r,digest:null}}function Dd(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function zh(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var OS=typeof WeakMap=="function"?WeakMap:Map;function dv(i,e,t){t=Oi(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){pu||(pu=!0,ep=n),zh(i,e)},t}function hv(i,e,t){t=Oi(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){zh(i,e)}}var s=i.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){zh(i,e),typeof n!="function"&&(dr===null?dr=new Set([this]):dr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Dg(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new OS;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),i=KS.bind(null,i,e,t),e.then(i,i))}function $g(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function Fg(i,e,t,n,r){return i.mode&1?(i.flags|=65536,i.lanes=r,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Oi(-1,1),e.tag=2,ur(t,e,1))),t.lanes|=1),i)}var DS=Bi.ReactCurrentOwner,tn=!1;function Ut(i,e,t,n){e.child=i===null?Bw(e,null,t,n):Js(e,i.child,t,n)}function Lg(i,e,t,n,r){t=t.render;var s=e.ref;return Hs(e,r),n=uf(i,e,t,n,s,r),t=df(),i!==null&&!tn?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,Wi(i,e,r)):(Le&&t&&Xp(e),e.flags|=1,Ut(i,e,n,r),e.child)}function Wg(i,e,t,n,r){if(i===null){var s=t.type;return typeof s=="function"&&!_f(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,pv(i,e,s,n,r)):(i=$l(t.type,null,n,e,e.mode,r),i.ref=e.ref,i.return=e,e.child=i)}if(s=i.child,!(i.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:Ic,t(o,n)&&i.ref===e.ref)return Wi(i,e,r)}return e.flags|=1,i=pr(s,n),i.ref=e.ref,i.return=e,e.child=i}function pv(i,e,t,n,r){if(i!==null){var s=i.memoizedProps;if(Ic(s,n)&&i.ref===e.ref)if(tn=!1,e.pendingProps=n=s,(i.lanes&r)!==0)i.flags&131072&&(tn=!0);else return e.lanes=i.lanes,Wi(i,e,r)}return Uh(i,e,t,n,r)}function fv(i,e,t){var n=e.pendingProps,r=n.children,s=i!==null?i.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},je(Ds,ln),ln|=t;else{if(!(t&1073741824))return i=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,je(Ds,ln),ln|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,je(Ds,ln),ln|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,je(Ds,ln),ln|=n;return Ut(i,e,r,t),e.child}function gv(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Uh(i,e,t,n,r){var s=rn(t)?is:Lt.current;return s=qs(e,s),Hs(e,r),t=uf(i,e,t,n,s,r),n=df(),i!==null&&!tn?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,Wi(i,e,r)):(Le&&n&&Xp(e),e.flags|=1,Ut(i,e,t,r),e.child)}function Bg(i,e,t,n,r){if(rn(t)){var s=!0;iu(e)}else s=!1;if(Hs(e,r),e.stateNode===null)jl(i,e),uv(e,t,n),Gh(e,t,n,r),n=!0;else if(i===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=Nn(l):(l=rn(t)?is:Lt.current,l=qs(e,l));var u=t.getDerivedStateFromProps,p=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==l)&&Og(e,o,n,l),Xi=!1;var f=e.memoizedState;o.state=f,cu(e,n,o,r),c=e.memoizedState,a!==n||f!==c||nn.current||Xi?(typeof u=="function"&&(Hh(e,t,u,n),c=e.memoizedState),(a=Xi||jg(e,t,a,n,f,c,l))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=l,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,Gw(i,e),a=e.memoizedProps,l=e.type===e.elementType?a:zn(e.type,a),o.props=l,p=e.pendingProps,f=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Nn(c):(c=rn(t)?is:Lt.current,c=qs(e,c));var w=t.getDerivedStateFromProps;(u=typeof w=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==p||f!==c)&&Og(e,o,n,c),Xi=!1,f=e.memoizedState,o.state=f,cu(e,n,o,r);var y=e.memoizedState;a!==p||f!==y||nn.current||Xi?(typeof w=="function"&&(Hh(e,t,w,n),y=e.memoizedState),(l=Xi||jg(e,t,l,n,f,y,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,y,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=y),o.props=n,o.state=y,o.context=c,n=l):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=1024),n=!1)}return qh(i,e,t,n,s,r)}function qh(i,e,t,n,r,s){gv(i,e);var o=(e.flags&128)!==0;if(!n&&!o)return r&&kg(e,t,!1),Wi(i,e,s);n=e.stateNode,DS.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&o?(e.child=Js(e,i.child,null,s),e.child=Js(e,null,a,s)):Ut(i,e,a,s),e.memoizedState=n.state,r&&kg(e,t,!0),e.child}function mv(i){var e=i.stateNode;e.pendingContext?xg(i,e.pendingContext,e.pendingContext!==e.context):e.context&&xg(i,e.context,!1),of(i,e.containerInfo)}function Hg(i,e,t,n,r){return Vs(),Zp(r),e.flags|=256,Ut(i,e,t,n),e.child}var Vh={dehydrated:null,treeContext:null,retryLane:0};function Jh(i){return{baseLanes:i,cachePool:null,transitions:null}}function yv(i,e,t){var n=e.pendingProps,r=Be.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=i!==null&&i.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(r|=1),je(Be,r&1),i===null)return Wh(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,i=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=qu(o,n,0,null),i=ns(i,n,t,null),s.return=e,i.return=e,s.sibling=i,e.child=s,e.child.memoizedState=Jh(t),e.memoizedState=Vh,i):ff(e,o));if(r=i.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return $S(i,e,o,n,a,r,t);if(s){s=n.fallback,o=e.mode,r=i.child,a=r.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=pr(r,c),n.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=pr(a,s):(s=ns(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=i.child.memoizedState,o=o===null?Jh(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=i.childLanes&~t,e.memoizedState=Vh,n}return s=i.child,i=s.sibling,n=pr(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=n,e.memoizedState=null,n}function ff(i,e){return e=qu({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function il(i,e,t,n){return n!==null&&Zp(n),Js(e,i.child,null,t),i=ff(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function $S(i,e,t,n,r,s,o){if(t)return e.flags&256?(e.flags&=-257,n=Dd(Error(X(422))),il(i,e,o,n)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(s=n.fallback,r=e.mode,n=qu({mode:"visible",children:n.children},r,0,null),s=ns(s,r,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Js(e,i.child,null,o),e.child.memoizedState=Jh(o),e.memoizedState=Vh,s);if(!(e.mode&1))return il(i,e,o,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(X(419)),n=Dd(s,n,void 0),il(i,e,o,n)}if(a=(o&i.childLanes)!==0,tn||a){if(n=Ct,n!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Li(i,r),Xn(n,i,r,-1))}return bf(),n=Dd(Error(X(421))),il(i,e,o,n)}return r.data==="$?"?(e.flags|=128,e.child=i.child,e=QS.bind(null,i),r._reactRetry=e,null):(i=s.treeContext,un=lr(r.nextSibling),hn=e,Le=!0,Jn=null,i!==null&&(Cn[Sn++]=Ni,Cn[Sn++]=Ri,Cn[Sn++]=rs,Ni=i.id,Ri=i.overflow,rs=e),e=ff(e,n.children),e.flags|=4096,e)}function Gg(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),Bh(i.return,e,t)}function $d(i,e,t,n,r){var s=i.memoizedState;s===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=r)}function wv(i,e,t){var n=e.pendingProps,r=n.revealOrder,s=n.tail;if(Ut(i,e,n.children,t),n=Be.current,n&2)n=n&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Gg(i,t,e);else if(i.tag===19)Gg(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(je(Be,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)i=t.alternate,i!==null&&lu(i)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),$d(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(i=r.alternate,i!==null&&lu(i)===null){e.child=r;break}i=r.sibling,r.sibling=t,t=r,r=i}$d(e,!0,t,null,s);break;case"together":$d(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function jl(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function Wi(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),os|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(X(153));if(e.child!==null){for(i=e.child,t=pr(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=pr(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function FS(i,e,t){switch(e.tag){case 3:mv(e),Vs();break;case 5:zw(e);break;case 1:rn(e.type)&&iu(e);break;case 4:of(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;je(ou,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(je(Be,Be.current&1),e.flags|=128,null):t&e.child.childLanes?yv(i,e,t):(je(Be,Be.current&1),i=Wi(i,e,t),i!==null?i.sibling:null);je(Be,Be.current&1);break;case 19:if(n=(t&e.childLanes)!==0,i.flags&128){if(n)return wv(i,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),je(Be,Be.current),n)break;return null;case 22:case 23:return e.lanes=0,fv(i,e,t)}return Wi(i,e,t)}var vv,Kh,bv,_v;vv=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Kh=function(){};bv=function(i,e,t,n){var r=i.memoizedProps;if(r!==n){i=e.stateNode,es(ui.current);var s=null;switch(t){case"input":r=yh(i,r),n=yh(i,n),s=[];break;case"select":r=Ge({},r,{value:void 0}),n=Ge({},n,{value:void 0}),s=[];break;case"textarea":r=bh(i,r),n=bh(i,n),s=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=tu)}Ch(t,n);var o;t=null;for(l in r)if(!n.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(yc.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var c=n[l];if(a=r!=null?r[l]:void 0,n.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(s||(s=[]),s.push(l,t)),t=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(yc.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Oe("scroll",i),s||a===c||(s=[])):(s=s||[]).push(l,c))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};_v=function(i,e,t,n){t!==n&&(e.flags|=4)};function Sa(i,e){if(!Le)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function Ot(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=i,r=r.sibling;else for(r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=i,r=r.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function LS(i,e,t){var n=e.pendingProps;switch(Yp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ot(e),null;case 1:return rn(e.type)&&nu(),Ot(e),null;case 3:return n=e.stateNode,Ks(),De(nn),De(Lt),cf(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(tl(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Jn!==null&&(ip(Jn),Jn=null))),Kh(i,e),Ot(e),null;case 5:af(e);var r=es(Ec.current);if(t=e.type,i!==null&&e.stateNode!=null)bv(i,e,t,n,r),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(X(166));return Ot(e),null}if(i=es(ui.current),tl(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[si]=e,n[Tc]=s,i=(e.mode&1)!==0,t){case"dialog":Oe("cancel",n),Oe("close",n);break;case"iframe":case"object":case"embed":Oe("load",n);break;case"video":case"audio":for(r=0;r<Ba.length;r++)Oe(Ba[r],n);break;case"source":Oe("error",n);break;case"img":case"image":case"link":Oe("error",n),Oe("load",n);break;case"details":Oe("toggle",n);break;case"input":Yf(n,s),Oe("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Oe("invalid",n);break;case"textarea":eg(n,s),Oe("invalid",n)}Ch(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&el(n.textContent,a,i),r=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&el(n.textContent,a,i),r=["children",""+a]):yc.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Oe("scroll",n)}switch(t){case"input":qc(n),Zf(n,s,!0);break;case"textarea":qc(n),tg(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=tu)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Ky(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=o.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=o.createElement(t,{is:n.is}):(i=o.createElement(t),t==="select"&&(o=i,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):i=o.createElementNS(i,t),i[si]=e,i[Tc]=n,vv(i,e,!1,!1),e.stateNode=i;e:{switch(o=Sh(t,n),t){case"dialog":Oe("cancel",i),Oe("close",i),r=n;break;case"iframe":case"object":case"embed":Oe("load",i),r=n;break;case"video":case"audio":for(r=0;r<Ba.length;r++)Oe(Ba[r],i);r=n;break;case"source":Oe("error",i),r=n;break;case"img":case"image":case"link":Oe("error",i),Oe("load",i),r=n;break;case"details":Oe("toggle",i),r=n;break;case"input":Yf(i,n),r=yh(i,n),Oe("invalid",i);break;case"option":r=n;break;case"select":i._wrapperState={wasMultiple:!!n.multiple},r=Ge({},n,{value:void 0}),Oe("invalid",i);break;case"textarea":eg(i,n),r=bh(i,n),Oe("invalid",i);break;default:r=n}Ch(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?Yy(i,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Qy(i,c)):s==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&wc(i,c):typeof c=="number"&&wc(i,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(yc.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Oe("scroll",i):c!=null&&$p(i,s,c,o))}switch(t){case"input":qc(i),Zf(i,n,!1);break;case"textarea":qc(i),tg(i);break;case"option":n.value!=null&&i.setAttribute("value",""+gr(n.value));break;case"select":i.multiple=!!n.multiple,s=n.value,s!=null?Fs(i,!!n.multiple,s,!1):n.defaultValue!=null&&Fs(i,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(i.onclick=tu)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ot(e),null;case 6:if(i&&e.stateNode!=null)_v(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(X(166));if(t=es(Ec.current),es(ui.current),tl(e)){if(n=e.stateNode,t=e.memoizedProps,n[si]=e,(s=n.nodeValue!==t)&&(i=hn,i!==null))switch(i.tag){case 3:el(n.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&el(n.nodeValue,t,(i.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[si]=e,e.stateNode=n}return Ot(e),null;case 13:if(De(Be),n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Le&&un!==null&&e.mode&1&&!(e.flags&128))Lw(),Vs(),e.flags|=98560,s=!1;else if(s=tl(e),n!==null&&n.dehydrated!==null){if(i===null){if(!s)throw Error(X(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(X(317));s[si]=e}else Vs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ot(e),s=!1}else Jn!==null&&(ip(Jn),Jn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(i!==null&&i.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(i===null||Be.current&1?ut===0&&(ut=3):bf())),e.updateQueue!==null&&(e.flags|=4),Ot(e),null);case 4:return Ks(),Kh(i,e),i===null&&xc(e.stateNode.containerInfo),Ot(e),null;case 10:return nf(e.type._context),Ot(e),null;case 17:return rn(e.type)&&nu(),Ot(e),null;case 19:if(De(Be),s=e.memoizedState,s===null)return Ot(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)Sa(s,!1);else{if(ut!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(o=lu(i),o!==null){for(e.flags|=128,Sa(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,i=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,i=o.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return je(Be,Be.current&1|2),e.child}i=i.sibling}s.tail!==null&&Ze()>Xs&&(e.flags|=128,n=!0,Sa(s,!1),e.lanes=4194304)}else{if(!n)if(i=lu(o),i!==null){if(e.flags|=128,n=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Sa(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Le)return Ot(e),null}else 2*Ze()-s.renderingStartTime>Xs&&t!==1073741824&&(e.flags|=128,n=!0,Sa(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ze(),e.sibling=null,t=Be.current,je(Be,n?t&1|2:t&1),e):(Ot(e),null);case 22:case 23:return vf(),n=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?ln&1073741824&&(Ot(e),e.subtreeFlags&6&&(e.flags|=8192)):Ot(e),null;case 24:return null;case 25:return null}throw Error(X(156,e.tag))}function WS(i,e){switch(Yp(e),e.tag){case 1:return rn(e.type)&&nu(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Ks(),De(nn),De(Lt),cf(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return af(e),null;case 13:if(De(Be),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(X(340));Vs()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return De(Be),null;case 4:return Ks(),null;case 10:return nf(e.type._context),null;case 22:case 23:return vf(),null;case 24:return null;default:return null}}var rl=!1,Dt=!1,BS=typeof WeakSet=="function"?WeakSet:Set,re=null;function Os(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){ze(i,e,n)}else t.current=null}function Qh(i,e,t){try{t()}catch(n){ze(i,e,n)}}var zg=!1;function HS(i,e){if(Mh=Yl,i=kw(),Qp(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,l=0,u=0,p=i,f=null;t:for(;;){for(var w;p!==t||r!==0&&p.nodeType!==3||(a=o+r),p!==s||n!==0&&p.nodeType!==3||(c=o+n),p.nodeType===3&&(o+=p.nodeValue.length),(w=p.firstChild)!==null;)f=p,p=w;for(;;){if(p===i)break t;if(f===t&&++l===r&&(a=o),f===s&&++u===n&&(c=o),(w=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=w}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(jh={focusedElem:i,selectionRange:t},Yl=!1,re=e;re!==null;)if(e=re,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,re=i;else for(;re!==null;){e=re;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var S=y.memoizedProps,O=y.memoizedState,_=e.stateNode,v=_.getSnapshotBeforeUpdate(e.elementType===e.type?S:zn(e.type,S),O);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(T){ze(e,e.return,T)}if(i=e.sibling,i!==null){i.return=e.return,re=i;break}re=e.return}return y=zg,zg=!1,y}function hc(i,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&i)===i){var s=r.destroy;r.destroy=void 0,s!==void 0&&Qh(e,t,s)}r=r.next}while(r!==n)}}function zu(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function Xh(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function Cv(i){var e=i.alternate;e!==null&&(i.alternate=null,Cv(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[si],delete e[Tc],delete e[$h],delete e[IS],delete e[xS])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Sv(i){return i.tag===5||i.tag===3||i.tag===4}function Ug(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Sv(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Yh(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=tu));else if(n!==4&&(i=i.child,i!==null))for(Yh(i,e,t),i=i.sibling;i!==null;)Yh(i,e,t),i=i.sibling}function Zh(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(Zh(i,e,t),i=i.sibling;i!==null;)Zh(i,e,t),i=i.sibling}var Et=null,Vn=!1;function Ui(i,e,t){for(t=t.child;t!==null;)Iv(i,e,t),t=t.sibling}function Iv(i,e,t){if(li&&typeof li.onCommitFiberUnmount=="function")try{li.onCommitFiberUnmount(Du,t)}catch{}switch(t.tag){case 5:Dt||Os(t,e);case 6:var n=Et,r=Vn;Et=null,Ui(i,e,t),Et=n,Vn=r,Et!==null&&(Vn?(i=Et,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):Et.removeChild(t.stateNode));break;case 18:Et!==null&&(Vn?(i=Et,t=t.stateNode,i.nodeType===8?Pd(i.parentNode,t):i.nodeType===1&&Pd(i,t),Cc(i)):Pd(Et,t.stateNode));break;case 4:n=Et,r=Vn,Et=t.stateNode.containerInfo,Vn=!0,Ui(i,e,t),Et=n,Vn=r;break;case 0:case 11:case 14:case 15:if(!Dt&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Qh(t,e,o),r=r.next}while(r!==n)}Ui(i,e,t);break;case 1:if(!Dt&&(Os(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){ze(t,e,a)}Ui(i,e,t);break;case 21:Ui(i,e,t);break;case 22:t.mode&1?(Dt=(n=Dt)||t.memoizedState!==null,Ui(i,e,t),Dt=n):Ui(i,e,t);break;default:Ui(i,e,t)}}function qg(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new BS),e.forEach(function(n){var r=XS.bind(null,i,n);t.has(n)||(t.add(n),n.then(r,r))})}}function Wn(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var s=i,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Et=a.stateNode,Vn=!1;break e;case 3:Et=a.stateNode.containerInfo,Vn=!0;break e;case 4:Et=a.stateNode.containerInfo,Vn=!0;break e}a=a.return}if(Et===null)throw Error(X(160));Iv(s,o,r),Et=null,Vn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){ze(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)xv(e,i),e=e.sibling}function xv(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Wn(e,i),ei(i),n&4){try{hc(3,i,i.return),zu(3,i)}catch(S){ze(i,i.return,S)}try{hc(5,i,i.return)}catch(S){ze(i,i.return,S)}}break;case 1:Wn(e,i),ei(i),n&512&&t!==null&&Os(t,t.return);break;case 5:if(Wn(e,i),ei(i),n&512&&t!==null&&Os(t,t.return),i.flags&32){var r=i.stateNode;try{wc(r,"")}catch(S){ze(i,i.return,S)}}if(n&4&&(r=i.stateNode,r!=null)){var s=i.memoizedProps,o=t!==null?t.memoizedProps:s,a=i.type,c=i.updateQueue;if(i.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Vy(r,s),Sh(a,o);var l=Sh(a,s);for(o=0;o<c.length;o+=2){var u=c[o],p=c[o+1];u==="style"?Yy(r,p):u==="dangerouslySetInnerHTML"?Qy(r,p):u==="children"?wc(r,p):$p(r,u,p,l)}switch(a){case"input":wh(r,s);break;case"textarea":Jy(r,s);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var w=s.value;w!=null?Fs(r,!!s.multiple,w,!1):f!==!!s.multiple&&(s.defaultValue!=null?Fs(r,!!s.multiple,s.defaultValue,!0):Fs(r,!!s.multiple,s.multiple?[]:"",!1))}r[Tc]=s}catch(S){ze(i,i.return,S)}}break;case 6:if(Wn(e,i),ei(i),n&4){if(i.stateNode===null)throw Error(X(162));r=i.stateNode,s=i.memoizedProps;try{r.nodeValue=s}catch(S){ze(i,i.return,S)}}break;case 3:if(Wn(e,i),ei(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Cc(e.containerInfo)}catch(S){ze(i,i.return,S)}break;case 4:Wn(e,i),ei(i);break;case 13:Wn(e,i),ei(i),r=i.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(yf=Ze())),n&4&&qg(i);break;case 22:if(u=t!==null&&t.memoizedState!==null,i.mode&1?(Dt=(l=Dt)||u,Wn(e,i),Dt=l):Wn(e,i),ei(i),n&8192){if(l=i.memoizedState!==null,(i.stateNode.isHidden=l)&&!u&&i.mode&1)for(re=i,u=i.child;u!==null;){for(p=re=u;re!==null;){switch(f=re,w=f.child,f.tag){case 0:case 11:case 14:case 15:hc(4,f,f.return);break;case 1:Os(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){n=f,t=f.return;try{e=n,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(S){ze(n,t,S)}}break;case 5:Os(f,f.return);break;case 22:if(f.memoizedState!==null){Jg(p);continue}}w!==null?(w.return=f,re=w):Jg(p)}u=u.sibling}e:for(u=null,p=i;;){if(p.tag===5){if(u===null){u=p;try{r=p.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,c=p.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Xy("display",o))}catch(S){ze(i,i.return,S)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=l?"":p.memoizedProps}catch(S){ze(i,i.return,S)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===i)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===i)break e;for(;p.sibling===null;){if(p.return===null||p.return===i)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Wn(e,i),ei(i),n&4&&qg(i);break;case 21:break;default:Wn(e,i),ei(i)}}function ei(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(Sv(t)){var n=t;break e}t=t.return}throw Error(X(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(wc(r,""),n.flags&=-33);var s=Ug(i);Zh(i,s,r);break;case 3:case 4:var o=n.stateNode.containerInfo,a=Ug(i);Yh(i,a,o);break;default:throw Error(X(161))}}catch(c){ze(i,i.return,c)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function GS(i,e,t){re=i,kv(i)}function kv(i,e,t){for(var n=(i.mode&1)!==0;re!==null;){var r=re,s=r.child;if(r.tag===22&&n){var o=r.memoizedState!==null||rl;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Dt;a=rl;var l=Dt;if(rl=o,(Dt=c)&&!l)for(re=r;re!==null;)o=re,c=o.child,o.tag===22&&o.memoizedState!==null?Kg(r):c!==null?(c.return=o,re=c):Kg(r);for(;s!==null;)re=s,kv(s),s=s.sibling;re=r,rl=a,Dt=l}Vg(i)}else r.subtreeFlags&8772&&s!==null?(s.return=r,re=s):Vg(i)}}function Vg(i){for(;re!==null;){var e=re;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Dt||zu(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Dt)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:zn(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Ng(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Ng(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&Cc(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}Dt||e.flags&512&&Xh(e)}catch(f){ze(e,e.return,f)}}if(e===i){re=null;break}if(t=e.sibling,t!==null){t.return=e.return,re=t;break}re=e.return}}function Jg(i){for(;re!==null;){var e=re;if(e===i){re=null;break}var t=e.sibling;if(t!==null){t.return=e.return,re=t;break}re=e.return}}function Kg(i){for(;re!==null;){var e=re;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{zu(4,e)}catch(c){ze(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(c){ze(e,r,c)}}var s=e.return;try{Xh(e)}catch(c){ze(e,s,c)}break;case 5:var o=e.return;try{Xh(e)}catch(c){ze(e,o,c)}}}catch(c){ze(e,e.return,c)}if(e===i){re=null;break}var a=e.sibling;if(a!==null){a.return=e.return,re=a;break}re=e.return}}var zS=Math.ceil,hu=Bi.ReactCurrentDispatcher,gf=Bi.ReactCurrentOwner,Pn=Bi.ReactCurrentBatchConfig,Ie=0,Ct=null,nt=null,Rt=0,ln=0,Ds=wr(0),ut=0,Mc=null,os=0,Uu=0,mf=0,pc=null,en=null,yf=0,Xs=1/0,ki=null,pu=!1,ep=null,dr=null,sl=!1,nr=null,fu=0,fc=0,tp=null,Ol=-1,Dl=0;function qt(){return Ie&6?Ze():Ol!==-1?Ol:Ol=Ze()}function hr(i){return i.mode&1?Ie&2&&Rt!==0?Rt&-Rt:TS.transition!==null?(Dl===0&&(Dl=uw()),Dl):(i=Ne,i!==0||(i=window.event,i=i===void 0?16:yw(i.type)),i):1}function Xn(i,e,t,n){if(50<fc)throw fc=0,tp=null,Error(X(185));Fc(i,t,n),(!(Ie&2)||i!==Ct)&&(i===Ct&&(!(Ie&2)&&(Uu|=t),ut===4&&er(i,Rt)),sn(i,n),t===1&&Ie===0&&!(e.mode&1)&&(Xs=Ze()+500,Bu&&vr()))}function sn(i,e){var t=i.callbackNode;TC(i,e);var n=Xl(i,i===Ct?Rt:0);if(n===0)t!==null&&rg(t),i.callbackNode=null,i.callbackPriority=0;else if(e=n&-n,i.callbackPriority!==e){if(t!=null&&rg(t),e===1)i.tag===0?kS(Qg.bind(null,i)):Dw(Qg.bind(null,i)),CS(function(){!(Ie&6)&&vr()}),t=null;else{switch(dw(n)){case 1:t=Hp;break;case 4:t=cw;break;case 16:t=Ql;break;case 536870912:t=lw;break;default:t=Ql}t=jv(t,Tv.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function Tv(i,e){if(Ol=-1,Dl=0,Ie&6)throw Error(X(327));var t=i.callbackNode;if(Gs()&&i.callbackNode!==t)return null;var n=Xl(i,i===Ct?Rt:0);if(n===0)return null;if(n&30||n&i.expiredLanes||e)e=gu(i,n);else{e=n;var r=Ie;Ie|=2;var s=Ev();(Ct!==i||Rt!==e)&&(ki=null,Xs=Ze()+500,ts(i,e));do try{VS();break}catch(a){Av(i,a)}while(!0);tf(),hu.current=s,Ie=r,nt!==null?e=0:(Ct=null,Rt=0,e=ut)}if(e!==0){if(e===2&&(r=Ah(i),r!==0&&(n=r,e=np(i,r))),e===1)throw t=Mc,ts(i,0),er(i,n),sn(i,Ze()),t;if(e===6)er(i,n);else{if(r=i.current.alternate,!(n&30)&&!US(r)&&(e=gu(i,n),e===2&&(s=Ah(i),s!==0&&(n=s,e=np(i,s))),e===1))throw t=Mc,ts(i,0),er(i,n),sn(i,Ze()),t;switch(i.finishedWork=r,i.finishedLanes=n,e){case 0:case 1:throw Error(X(345));case 2:Kr(i,en,ki);break;case 3:if(er(i,n),(n&130023424)===n&&(e=yf+500-Ze(),10<e)){if(Xl(i,0)!==0)break;if(r=i.suspendedLanes,(r&n)!==n){qt(),i.pingedLanes|=i.suspendedLanes&r;break}i.timeoutHandle=Dh(Kr.bind(null,i,en,ki),e);break}Kr(i,en,ki);break;case 4:if(er(i,n),(n&4194240)===n)break;for(e=i.eventTimes,r=-1;0<n;){var o=31-Qn(n);s=1<<o,o=e[o],o>r&&(r=o),n&=~s}if(n=r,n=Ze()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*zS(n/1960))-n,10<n){i.timeoutHandle=Dh(Kr.bind(null,i,en,ki),n);break}Kr(i,en,ki);break;case 5:Kr(i,en,ki);break;default:throw Error(X(329))}}}return sn(i,Ze()),i.callbackNode===t?Tv.bind(null,i):null}function np(i,e){var t=pc;return i.current.memoizedState.isDehydrated&&(ts(i,e).flags|=256),i=gu(i,e),i!==2&&(e=en,en=t,e!==null&&ip(e)),i}function ip(i){en===null?en=i:en.push.apply(en,i)}function US(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],s=r.getSnapshot;r=r.value;try{if(!Yn(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function er(i,e){for(e&=~mf,e&=~Uu,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-Qn(e),n=1<<t;i[t]=-1,e&=~n}}function Qg(i){if(Ie&6)throw Error(X(327));Gs();var e=Xl(i,0);if(!(e&1))return sn(i,Ze()),null;var t=gu(i,e);if(i.tag!==0&&t===2){var n=Ah(i);n!==0&&(e=n,t=np(i,n))}if(t===1)throw t=Mc,ts(i,0),er(i,e),sn(i,Ze()),t;if(t===6)throw Error(X(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,Kr(i,en,ki),sn(i,Ze()),null}function wf(i,e){var t=Ie;Ie|=1;try{return i(e)}finally{Ie=t,Ie===0&&(Xs=Ze()+500,Bu&&vr())}}function as(i){nr!==null&&nr.tag===0&&!(Ie&6)&&Gs();var e=Ie;Ie|=1;var t=Pn.transition,n=Ne;try{if(Pn.transition=null,Ne=1,i)return i()}finally{Ne=n,Pn.transition=t,Ie=e,!(Ie&6)&&vr()}}function vf(){ln=Ds.current,De(Ds)}function ts(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,_S(t)),nt!==null)for(t=nt.return;t!==null;){var n=t;switch(Yp(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&nu();break;case 3:Ks(),De(nn),De(Lt),cf();break;case 5:af(n);break;case 4:Ks();break;case 13:De(Be);break;case 19:De(Be);break;case 10:nf(n.type._context);break;case 22:case 23:vf()}t=t.return}if(Ct=i,nt=i=pr(i.current,null),Rt=ln=e,ut=0,Mc=null,mf=Uu=os=0,en=pc=null,Zr!==null){for(e=0;e<Zr.length;e++)if(t=Zr[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,n.next=o}t.pending=n}Zr=null}return i}function Av(i,e){do{var t=nt;try{if(tf(),Rl.current=du,uu){for(var n=He.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}uu=!1}if(ss=0,_t=lt=He=null,dc=!1,Pc=0,gf.current=null,t===null||t.return===null){ut=1,Mc=e,nt=null;break}e:{var s=i,o=t.return,a=t,c=e;if(e=Rt,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var w=$g(o);if(w!==null){w.flags&=-257,Fg(w,o,a,s,e),w.mode&1&&Dg(s,l,e),e=w,c=l;var y=e.updateQueue;if(y===null){var S=new Set;S.add(c),e.updateQueue=S}else y.add(c);break e}else{if(!(e&1)){Dg(s,l,e),bf();break e}c=Error(X(426))}}else if(Le&&a.mode&1){var O=$g(o);if(O!==null){!(O.flags&65536)&&(O.flags|=256),Fg(O,o,a,s,e),Zp(Qs(c,a));break e}}s=c=Qs(c,a),ut!==4&&(ut=2),pc===null?pc=[s]:pc.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var _=dv(s,c,e);Pg(s,_);break e;case 1:a=c;var v=s.type,C=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(dr===null||!dr.has(C)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=hv(s,a,e);Pg(s,T);break e}}s=s.return}while(s!==null)}Nv(t)}catch(M){e=M,nt===t&&t!==null&&(nt=t=t.return);continue}break}while(!0)}function Ev(){var i=hu.current;return hu.current=du,i===null?du:i}function bf(){(ut===0||ut===3||ut===2)&&(ut=4),Ct===null||!(os&268435455)&&!(Uu&268435455)||er(Ct,Rt)}function gu(i,e){var t=Ie;Ie|=2;var n=Ev();(Ct!==i||Rt!==e)&&(ki=null,ts(i,e));do try{qS();break}catch(r){Av(i,r)}while(!0);if(tf(),Ie=t,hu.current=n,nt!==null)throw Error(X(261));return Ct=null,Rt=0,ut}function qS(){for(;nt!==null;)Pv(nt)}function VS(){for(;nt!==null&&!wC();)Pv(nt)}function Pv(i){var e=Mv(i.alternate,i,ln);i.memoizedProps=i.pendingProps,e===null?Nv(i):nt=e,gf.current=null}function Nv(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=WS(t,e),t!==null){t.flags&=32767,nt=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{ut=6,nt=null;return}}else if(t=LS(t,e,ln),t!==null){nt=t;return}if(e=e.sibling,e!==null){nt=e;return}nt=e=i}while(e!==null);ut===0&&(ut=5)}function Kr(i,e,t){var n=Ne,r=Pn.transition;try{Pn.transition=null,Ne=1,JS(i,e,t,n)}finally{Pn.transition=r,Ne=n}return null}function JS(i,e,t,n){do Gs();while(nr!==null);if(Ie&6)throw Error(X(327));t=i.finishedWork;var r=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(X(177));i.callbackNode=null,i.callbackPriority=0;var s=t.lanes|t.childLanes;if(AC(i,s),i===Ct&&(nt=Ct=null,Rt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||sl||(sl=!0,jv(Ql,function(){return Gs(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Pn.transition,Pn.transition=null;var o=Ne;Ne=1;var a=Ie;Ie|=4,gf.current=null,HS(i,t),xv(t,i),fS(jh),Yl=!!Mh,jh=Mh=null,i.current=t,GS(t),vC(),Ie=a,Ne=o,Pn.transition=s}else i.current=t;if(sl&&(sl=!1,nr=i,fu=r),s=i.pendingLanes,s===0&&(dr=null),CC(t.stateNode),sn(i,Ze()),e!==null)for(n=i.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if(pu)throw pu=!1,i=ep,ep=null,i;return fu&1&&i.tag!==0&&Gs(),s=i.pendingLanes,s&1?i===tp?fc++:(fc=0,tp=i):fc=0,vr(),null}function Gs(){if(nr!==null){var i=dw(fu),e=Pn.transition,t=Ne;try{if(Pn.transition=null,Ne=16>i?16:i,nr===null)var n=!1;else{if(i=nr,nr=null,fu=0,Ie&6)throw Error(X(331));var r=Ie;for(Ie|=4,re=i.current;re!==null;){var s=re,o=s.child;if(re.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(re=l;re!==null;){var u=re;switch(u.tag){case 0:case 11:case 15:hc(8,u,s)}var p=u.child;if(p!==null)p.return=u,re=p;else for(;re!==null;){u=re;var f=u.sibling,w=u.return;if(Cv(u),u===l){re=null;break}if(f!==null){f.return=w,re=f;break}re=w}}}var y=s.alternate;if(y!==null){var S=y.child;if(S!==null){y.child=null;do{var O=S.sibling;S.sibling=null,S=O}while(S!==null)}}re=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,re=o;else e:for(;re!==null;){if(s=re,s.flags&2048)switch(s.tag){case 0:case 11:case 15:hc(9,s,s.return)}var _=s.sibling;if(_!==null){_.return=s.return,re=_;break e}re=s.return}}var v=i.current;for(re=v;re!==null;){o=re;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,re=C;else e:for(o=v;re!==null;){if(a=re,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:zu(9,a)}}catch(M){ze(a,a.return,M)}if(a===o){re=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,re=T;break e}re=a.return}}if(Ie=r,vr(),li&&typeof li.onPostCommitFiberRoot=="function")try{li.onPostCommitFiberRoot(Du,i)}catch{}n=!0}return n}finally{Ne=t,Pn.transition=e}}return!1}function Xg(i,e,t){e=Qs(t,e),e=dv(i,e,1),i=ur(i,e,1),e=qt(),i!==null&&(Fc(i,1,e),sn(i,e))}function ze(i,e,t){if(i.tag===3)Xg(i,i,t);else for(;e!==null;){if(e.tag===3){Xg(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(dr===null||!dr.has(n))){i=Qs(t,i),i=hv(e,i,1),e=ur(e,i,1),i=qt(),e!==null&&(Fc(e,1,i),sn(e,i));break}}e=e.return}}function KS(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=qt(),i.pingedLanes|=i.suspendedLanes&t,Ct===i&&(Rt&t)===t&&(ut===4||ut===3&&(Rt&130023424)===Rt&&500>Ze()-yf?ts(i,0):mf|=t),sn(i,e)}function Rv(i,e){e===0&&(i.mode&1?(e=Kc,Kc<<=1,!(Kc&130023424)&&(Kc=4194304)):e=1);var t=qt();i=Li(i,e),i!==null&&(Fc(i,e,t),sn(i,t))}function QS(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),Rv(i,t)}function XS(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,r=i.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=i.stateNode;break;default:throw Error(X(314))}n!==null&&n.delete(e),Rv(i,t)}var Mv;Mv=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||nn.current)tn=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return tn=!1,FS(i,e,t);tn=!!(i.flags&131072)}else tn=!1,Le&&e.flags&1048576&&$w(e,su,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;jl(i,e),i=e.pendingProps;var r=qs(e,Lt.current);Hs(e,t),r=uf(null,e,n,i,r,t);var s=df();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,rn(n)?(s=!0,iu(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,sf(e),r.updater=Gu,e.stateNode=r,r._reactInternals=e,Gh(e,n,i,t),e=qh(null,e,n,!0,s,t)):(e.tag=0,Le&&s&&Xp(e),Ut(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(jl(i,e),i=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=ZS(n),i=zn(n,i),r){case 0:e=Uh(null,e,n,i,t);break e;case 1:e=Bg(null,e,n,i,t);break e;case 11:e=Lg(null,e,n,i,t);break e;case 14:e=Wg(null,e,n,zn(n.type,i),t);break e}throw Error(X(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:zn(n,r),Uh(i,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:zn(n,r),Bg(i,e,n,r,t);case 3:e:{if(mv(e),i===null)throw Error(X(387));n=e.pendingProps,s=e.memoizedState,r=s.element,Gw(i,e),cu(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Qs(Error(X(423)),e),e=Hg(i,e,n,t,r);break e}else if(n!==r){r=Qs(Error(X(424)),e),e=Hg(i,e,n,t,r);break e}else for(un=lr(e.stateNode.containerInfo.firstChild),hn=e,Le=!0,Jn=null,t=Bw(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Vs(),n===r){e=Wi(i,e,t);break e}Ut(i,e,n,t)}e=e.child}return e;case 5:return zw(e),i===null&&Wh(e),n=e.type,r=e.pendingProps,s=i!==null?i.memoizedProps:null,o=r.children,Oh(n,r)?o=null:s!==null&&Oh(n,s)&&(e.flags|=32),gv(i,e),Ut(i,e,o,t),e.child;case 6:return i===null&&Wh(e),null;case 13:return yv(i,e,t);case 4:return of(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=Js(e,null,n,t):Ut(i,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:zn(n,r),Lg(i,e,n,r,t);case 7:return Ut(i,e,e.pendingProps,t),e.child;case 8:return Ut(i,e,e.pendingProps.children,t),e.child;case 12:return Ut(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,je(ou,n._currentValue),n._currentValue=o,s!==null)if(Yn(s.value,o)){if(s.children===r.children&&!nn.current){e=Wi(i,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=Oi(-1,t&-t),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=t,c=s.alternate,c!==null&&(c.lanes|=t),Bh(s.return,t,e),a.lanes|=t;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(X(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Bh(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ut(i,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,Hs(e,t),r=Nn(r),n=n(r),e.flags|=1,Ut(i,e,n,t),e.child;case 14:return n=e.type,r=zn(n,e.pendingProps),r=zn(n.type,r),Wg(i,e,n,r,t);case 15:return pv(i,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:zn(n,r),jl(i,e),e.tag=1,rn(n)?(i=!0,iu(e)):i=!1,Hs(e,t),uv(e,n,r),Gh(e,n,r,t),qh(null,e,n,!0,i,t);case 19:return wv(i,e,t);case 22:return fv(i,e,t)}throw Error(X(156,e.tag))};function jv(i,e){return aw(i,e)}function YS(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tn(i,e,t,n){return new YS(i,e,t,n)}function _f(i){return i=i.prototype,!(!i||!i.isReactComponent)}function ZS(i){if(typeof i=="function")return _f(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Lp)return 11;if(i===Wp)return 14}return 2}function pr(i,e){var t=i.alternate;return t===null?(t=Tn(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function $l(i,e,t,n,r,s){var o=2;if(n=i,typeof i=="function")_f(i)&&(o=1);else if(typeof i=="string")o=5;else e:switch(i){case ks:return ns(t.children,r,s,e);case Fp:o=8,r|=8;break;case ph:return i=Tn(12,t,e,r|2),i.elementType=ph,i.lanes=s,i;case fh:return i=Tn(13,t,e,r),i.elementType=fh,i.lanes=s,i;case gh:return i=Tn(19,t,e,r),i.elementType=gh,i.lanes=s,i;case zy:return qu(t,r,s,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Hy:o=10;break e;case Gy:o=9;break e;case Lp:o=11;break e;case Wp:o=14;break e;case Qi:o=16,n=null;break e}throw Error(X(130,i==null?i:typeof i,""))}return e=Tn(o,t,e,r),e.elementType=i,e.type=n,e.lanes=s,e}function ns(i,e,t,n){return i=Tn(7,i,n,e),i.lanes=t,i}function qu(i,e,t,n){return i=Tn(22,i,n,e),i.elementType=zy,i.lanes=t,i.stateNode={isHidden:!1},i}function Fd(i,e,t){return i=Tn(6,i,null,e),i.lanes=t,i}function Ld(i,e,t){return e=Tn(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function eI(i,e,t,n,r){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vd(0),this.expirationTimes=vd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vd(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Cf(i,e,t,n,r,s,o,a,c){return i=new eI(i,e,t,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Tn(3,null,null,e),i.current=s,s.stateNode=i,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},sf(s),i}function tI(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xs,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function Ov(i){if(!i)return mr;i=i._reactInternals;e:{if(ds(i)!==i||i.tag!==1)throw Error(X(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(rn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(X(171))}if(i.tag===1){var t=i.type;if(rn(t))return Ow(i,t,e)}return e}function Dv(i,e,t,n,r,s,o,a,c){return i=Cf(t,n,!0,i,r,s,o,a,c),i.context=Ov(null),t=i.current,n=qt(),r=hr(t),s=Oi(n,r),s.callback=e??null,ur(t,s,r),i.current.lanes=r,Fc(i,r,n),sn(i,n),i}function Vu(i,e,t,n){var r=e.current,s=qt(),o=hr(r);return t=Ov(t),e.context===null?e.context=t:e.pendingContext=t,e=Oi(s,o),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),i=ur(r,e,o),i!==null&&(Xn(i,r,o,s),Nl(i,r,o)),o}function mu(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Yg(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function Sf(i,e){Yg(i,e),(i=i.alternate)&&Yg(i,e)}function nI(){return null}var $v=typeof reportError=="function"?reportError:function(i){console.error(i)};function If(i){this._internalRoot=i}Ju.prototype.render=If.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(X(409));Vu(i,e,null,null)};Ju.prototype.unmount=If.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;as(function(){Vu(null,i,null,null)}),e[Fi]=null}};function Ju(i){this._internalRoot=i}Ju.prototype.unstable_scheduleHydration=function(i){if(i){var e=fw();i={blockedOn:null,target:i,priority:e};for(var t=0;t<Zi.length&&e!==0&&e<Zi[t].priority;t++);Zi.splice(t,0,i),t===0&&mw(i)}};function xf(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Ku(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Zg(){}function iI(i,e,t,n,r){if(r){if(typeof n=="function"){var s=n;n=function(){var l=mu(o);s.call(l)}}var o=Dv(e,n,i,0,null,!1,!1,"",Zg);return i._reactRootContainer=o,i[Fi]=o.current,xc(i.nodeType===8?i.parentNode:i),as(),o}for(;r=i.lastChild;)i.removeChild(r);if(typeof n=="function"){var a=n;n=function(){var l=mu(c);a.call(l)}}var c=Cf(i,0,!1,null,null,!1,!1,"",Zg);return i._reactRootContainer=c,i[Fi]=c.current,xc(i.nodeType===8?i.parentNode:i),as(function(){Vu(e,c,t,n)}),c}function Qu(i,e,t,n,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=mu(o);a.call(c)}}Vu(e,o,i,r)}else o=iI(t,e,i,r,n);return mu(o)}hw=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=Wa(e.pendingLanes);t!==0&&(Gp(e,t|1),sn(e,Ze()),!(Ie&6)&&(Xs=Ze()+500,vr()))}break;case 13:as(function(){var n=Li(i,1);if(n!==null){var r=qt();Xn(n,i,1,r)}}),Sf(i,1)}};zp=function(i){if(i.tag===13){var e=Li(i,134217728);if(e!==null){var t=qt();Xn(e,i,134217728,t)}Sf(i,134217728)}};pw=function(i){if(i.tag===13){var e=hr(i),t=Li(i,e);if(t!==null){var n=qt();Xn(t,i,e,n)}Sf(i,e)}};fw=function(){return Ne};gw=function(i,e){var t=Ne;try{return Ne=i,e()}finally{Ne=t}};xh=function(i,e,t){switch(e){case"input":if(wh(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var r=Wu(n);if(!r)throw Error(X(90));qy(n),wh(n,r)}}}break;case"textarea":Jy(i,t);break;case"select":e=t.value,e!=null&&Fs(i,!!t.multiple,e,!1)}};tw=wf;nw=as;var rI={usingClientEntryPoint:!1,Events:[Wc,Ps,Wu,Zy,ew,wf]},Ia={findFiberByHostInstance:Yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},sI={bundleType:Ia.bundleType,version:Ia.version,rendererPackageName:Ia.rendererPackageName,rendererConfig:Ia.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Bi.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=sw(i),i===null?null:i.stateNode},findFiberByHostInstance:Ia.findFiberByHostInstance||nI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ol=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ol.isDisabled&&ol.supportsFiber)try{Du=ol.inject(sI),li=ol}catch{}}gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rI;gn.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xf(e))throw Error(X(200));return tI(i,e,null,t)};gn.createRoot=function(i,e){if(!xf(i))throw Error(X(299));var t=!1,n="",r=$v;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Cf(i,1,!1,null,null,t,!1,n,r),i[Fi]=e.current,xc(i.nodeType===8?i.parentNode:i),new If(e)};gn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(X(188)):(i=Object.keys(i).join(","),Error(X(268,i)));return i=sw(e),i=i===null?null:i.stateNode,i};gn.flushSync=function(i){return as(i)};gn.hydrate=function(i,e,t){if(!Ku(e))throw Error(X(200));return Qu(null,i,e,!0,t)};gn.hydrateRoot=function(i,e,t){if(!xf(i))throw Error(X(405));var n=t!=null&&t.hydratedSources||null,r=!1,s="",o=$v;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=Dv(e,null,i,1,t??null,r,!1,s,o),i[Fi]=e.current,xc(i),n)for(i=0;i<n.length;i++)t=n[i],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new Ju(e)};gn.render=function(i,e,t){if(!Ku(e))throw Error(X(200));return Qu(null,i,e,!1,t)};gn.unmountComponentAtNode=function(i){if(!Ku(i))throw Error(X(40));return i._reactRootContainer?(as(function(){Qu(null,null,i,!1,function(){i._reactRootContainer=null,i[Fi]=null})}),!0):!1};gn.unstable_batchedUpdates=wf;gn.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!Ku(t))throw Error(X(200));if(i==null||i._reactInternals===void 0)throw Error(X(38));return Qu(i,e,t,!1,n)};gn.version="18.3.1-next-f1338f8080-20240426";function Fv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Fv)}catch(i){console.error(i)}}Fv(),Fy.exports=gn;var oI=Fy.exports,em=oI;dh.createRoot=em.createRoot,dh.hydrateRoot=em.hydrateRoot;var Lv={exports:{}},aI="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",cI=aI,lI=cI;function Wv(){}function Bv(){}Bv.resetWarningCache=Wv;var uI=function(){function i(n,r,s,o,a,c){if(c!==lI){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}i.isRequired=i;function e(){return i}var t={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:e,element:i,elementType:i,instanceOf:e,node:i,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Bv,resetWarningCache:Wv};return t.PropTypes=t,t};Lv.exports=uI();var Wd=Lv.exports;const dI=i=>{const e=i.message?JSON.stringify(i.message):JSON.stringify(i);return typeof i=="string"?i:e},hI=(i,e)=>{const[t,n]=B.useState(null);return B.useEffect(()=>{(async()=>{var s,o,a,c,l,u,p,f,w,y;try{if(i.browser&&i.browserPlatform)throw new Error("Cannot initialize, because the settings are over-specified: defined are both browser and browserPlatform. Please set one or the other");if(typeof window.glue42gd<"u"||typeof window.iodesktop<"u"){const C=((s=i.desktop)==null?void 0:s.factory)||((o=i.browser)==null?void 0:o.factory)||((a=i.browserPlatform)==null?void 0:a.factory)||window.Glue,T=((c=i.desktop)==null?void 0:c.config)||((l=i.browser)==null?void 0:l.config)||((u=i.browserPlatform)==null?void 0:u.config),M=await C(T);n(M.io||M.glue||M);return}const O=((p=i.browser)==null?void 0:p.config)||((f=i.browserPlatform)==null?void 0:f.config),v=await(((w=i.browser)==null?void 0:w.factory)||((y=i.browserPlatform)==null?void 0:y.factory)||window.IOBrowser||window.IOBrowserPlatform)(O);n(v.io||v.glue||v)}catch(S){console.error(S),e==null||e(S instanceof Error?S:new Error(dI(S)))}})()},[]),t},kf=B.createContext(null),Tf=B.memo(({children:i,fallback:e=null,settings:t={},onInitError:n})=>{const r=hI(t,n);return r?ce.createElement(kf.Provider,{value:r},i):ce.createElement(ce.Fragment,null,e)});Tf.propTypes={children:Wd.node,settings:Wd.object,fallback:Wd.node};Tf.displayName="IOConnectProvider";var Hv={};const pI={logger:"info",gateway:{webPlatform:{}},libraries:[],exposeAPI:!0},fI=i=>{var n,r;const e=!!((r=(n=i==null?void 0:i.gateway)==null?void 0:n.webPlatform)!=null&&r.port),t=Object.assign({},pI,i,{isPlatformInternal:e});return t.systemLogger&&(t.logger=t.systemLogger.level??"info"),t},wn={platformUnload:{name:"platformUnload"},transportSwitchRequest:{name:"transportSwitchRequest"},transportSwitchResponse:{name:"transportSwitchResponse"},getCurrentTransport:{name:"getCurrentTransport"},getCurrentTransportResponse:{name:"getCurrentTransportResponse"},checkPreferredLogic:{name:"checkPreferredLogic"},checkPreferredConnection:{name:"checkPreferredConnection"},checkPreferredLogicResponse:{name:"checkPreferredLogicResponse"},checkPreferredConnectionResponse:{name:"checkPreferredConnectionResponse"}},tm="web-platform",nm="latest_fdc3_type",Gv=new MessageChannel,gI=i=>typeof i=="string"?i:i!=null&&i.message?typeof i.message=="string"?i.message:JSON.stringify(i.message):JSON.stringify(i),Z=(i,e)=>{try{return i.runWithException(e)}catch(t){return ie.raiseError(t,!0)}};class mI{raiseError(e,t){const n=gI(e);throw Gv.port1.postMessage(n),t?e:new Error(n)}}const ie=new mI,yI=()=>{const i=window.glue42core||window.iobrowser;if(i&&i.webStarted)return ie.raiseError("IoConnect Browser has already been started for this application.");if(!i){window.iobrowser={webStarted:!0};return}i.webStarted=!0},wI=i=>{var n;const e={windows:!0,layouts:"full",appManager:"full",channels:!0,libraries:(i==null?void 0:i.libraries)??[],logger:((n=i==null?void 0:i.systemLogger)==null?void 0:n.level)??"warn"};return(window.IODesktop||window.Glue)(e)};var mt=function(i){return{ok:!0,result:i}},ot=function(i){return{ok:!1,error:i}},vI=function(i){return i.ok===!0?Promise.resolve(i.result):Promise.reject(i.error)},bI=function(i,e){return e.ok===!0?e.result:i},_I=function(i){if(i.ok===!0)return i.result;throw i.error},CI=function(i,e){return e.ok===!0?mt(i(e.result)):e},im=function(i,e,t){return e.ok===!1?e:t.ok===!1?t:mt(i(e.result,t.result))},Bd=function(i,e){return e.ok===!0?e:ot(i(e.error))},SI=function(i,e){return e.ok===!0?i(e.result):e};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var rp=function(){return rp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},rp.apply(this,arguments)};function II(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(i);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(i,n[r])&&(t[n[r]]=i[n[r]]);return t}function sp(i,e){if(i===e||i===null&&e===null)return!0;if(typeof i!=typeof e)return!1;if(typeof i=="object"){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(var t=0;t<i.length;t++)if(!sp(i[t],e[t]))return!1;return!0}var n=Object.keys(i);if(n.length!==Object.keys(e).length)return!1;for(var t=0;t<n.length;t++)if(!e.hasOwnProperty(n[t])||!sp(i[n[t]],e[n[t]]))return!1;return!0}}var Ha=function(i){return Array.isArray(i)},al=function(i){return typeof i=="object"&&i!==null&&!Ha(i)},xI=function(i){switch(typeof i){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return i instanceof Array?"an array":i===null?"null":"an object";default:return JSON.stringify(i)}},Ci=function(i,e){return"expected "+i+", got "+xI(e)},xa=function(i){return i.map(function(e){return typeof e=="string"?"."+e:"["+e+"]"}).join("")},ka=function(i,e){var t=e.at,n=II(e,["at"]);return rp({at:i+(t||"")},n)},dt=function(){function i(e){var t=this;this.decode=e,this.run=function(n){return Bd(function(r){return{kind:"DecoderError",input:n,at:"input"+(r.at||""),message:r.message||""}},t.decode(n))},this.runPromise=function(n){return vI(t.run(n))},this.runWithException=function(n){return _I(t.run(n))},this.map=function(n){return new i(function(r){return CI(n,t.decode(r))})},this.andThen=function(n){return new i(function(r){return SI(function(s){return n(s).decode(r)},t.decode(r))})},this.where=function(n,r){return t.andThen(function(s){return n(s)?i.succeed(s):i.fail(r)})}}return i.string=function(){return new i(function(e){return typeof e=="string"?mt(e):ot({message:Ci("a string",e)})})},i.number=function(){return new i(function(e){return typeof e=="number"?mt(e):ot({message:Ci("a number",e)})})},i.boolean=function(){return new i(function(e){return typeof e=="boolean"?mt(e):ot({message:Ci("a boolean",e)})})},i.constant=function(e){return new i(function(t){return sp(t,e)?mt(e):ot({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(t)})})},i.object=function(e){return new i(function(t){if(al(t)&&e){var n={};for(var r in e)if(e.hasOwnProperty(r)){var s=e[r].decode(t[r]);if(s.ok===!0)s.result!==void 0&&(n[r]=s.result);else return t[r]===void 0?ot({message:"the key '"+r+"' is required but was not present"}):ot(ka("."+r,s.error))}return mt(n)}else return al(t)?mt(t):ot({message:Ci("an object",t)})})},i.array=function(e){return new i(function(t){if(Ha(t)&&e){var n=function(r,s){return Bd(function(o){return ka("["+s+"]",o)},e.decode(r))};return t.reduce(function(r,s,o){return im(function(a,c){return a.concat([c])},r,n(s,o))},mt([]))}else return Ha(t)?mt(t):ot({message:Ci("an array",t)})})},i.tuple=function(e){return new i(function(t){if(Ha(t)){if(t.length!==e.length)return ot({message:"expected a tuple of length "+e.length+", got one of length "+t.length});for(var n=[],r=0;r<e.length;r++){var s=e[r].decode(t[r]);if(s.ok)n[r]=s.result;else return ot(ka("["+r+"]",s.error))}return mt(n)}else return ot({message:Ci("a tuple of length "+e.length,t)})})},i.union=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return i.oneOf.apply(i,[e,t].concat(n))},i.intersection=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return new i(function(s){return[e,t].concat(n).reduce(function(o,a){return im(Object.assign,o,a.decode(s))},mt({}))})},i.anyJson=function(){return new i(function(e){return mt(e)})},i.unknownJson=function(){return new i(function(e){return mt(e)})},i.dict=function(e){return new i(function(t){if(al(t)){var n={};for(var r in t)if(t.hasOwnProperty(r)){var s=e.decode(t[r]);if(s.ok===!0)n[r]=s.result;else return ot(ka("."+r,s.error))}return mt(n)}else return ot({message:Ci("an object",t)})})},i.optional=function(e){return new i(function(t){return t==null?mt(void 0):e.decode(t)})},i.oneOf=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new i(function(n){for(var r=[],s=0;s<e.length;s++){var o=e[s].decode(n);if(o.ok===!0)return o;r[s]=o.error}var a=r.map(function(c){return"at error"+(c.at||"")+": "+c.message}).join('", "');return ot({message:'expected a value matching one of the decoders, got the errors ["'+a+'"]'})})},i.withDefault=function(e,t){return new i(function(n){return mt(bI(e,t.decode(n)))})},i.valueAt=function(e,t){return new i(function(n){for(var r=n,s=0;s<e.length;s++){if(r===void 0)return ot({at:xa(e.slice(0,s+1)),message:"path does not exist"});if(typeof e[s]=="string"&&!al(r))return ot({at:xa(e.slice(0,s+1)),message:Ci("an object",r)});if(typeof e[s]=="number"&&!Ha(r))return ot({at:xa(e.slice(0,s+1)),message:Ci("an array",r)});r=r[e[s]]}return Bd(function(o){return r===void 0?{at:xa(e),message:"path does not exist"}:ka(xa(e),o)},t.decode(r))})},i.succeed=function(e){return new i(function(t){return mt(e)})},i.fail=function(e){return new i(function(t){return ot({message:e})})},i.lazy=function(e){return new i(function(t){return e().decode(t)})},i}(),fe=dt.string,Re=dt.number,ue=dt.boolean,xe=dt.anyJson;dt.unknownJson;var F=dt.constant,W=dt.object,le=dt.array;dt.tuple;dt.dict;var k=dt.optional,be=dt.oneOf;dt.union;dt.intersection;dt.withDefault;dt.valueAt;dt.succeed;dt.fail;var op=dt.lazy;const rm=["name","title","version","customProperties","icon","caption","type"],kI=["appId","name","type","details","version","title","tooltip","lang","description","categories","icons","screenshots","contactEmail","moreInfo","publisher","customConfig","hostManifests","interop","localizedVersions"];var yt=function(i){return{ok:!0,result:i}},at=function(i){return{ok:!1,error:i}},TI=function(i){return i.ok===!0?Promise.resolve(i.result):Promise.reject(i.error)},AI=function(i,e){return e.ok===!0?e.result:i},EI=function(i){if(i.ok===!0)return i.result;throw i.error},PI=function(i,e){return e.ok===!0?yt(i(e.result)):e},sm=function(i,e,t){return e.ok===!1?e:t.ok===!1?t:yt(i(e.result,t.result))},Hd=function(i,e){return e.ok===!0?e:at(i(e.error))},NI=function(i,e){return e.ok===!0?i(e.result):e};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ap=function(){return ap=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},ap.apply(this,arguments)};function RI(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(i);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(i,n[r])&&(t[n[r]]=i[n[r]]);return t}function cp(i,e){if(i===e||i===null&&e===null)return!0;if(typeof i!=typeof e)return!1;if(typeof i=="object"){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(var t=0;t<i.length;t++)if(!cp(i[t],e[t]))return!1;return!0}var n=Object.keys(i);if(n.length!==Object.keys(e).length)return!1;for(var t=0;t<n.length;t++)if(!e.hasOwnProperty(n[t])||!cp(i[n[t]],e[n[t]]))return!1;return!0}}var Ga=function(i){return Array.isArray(i)},cl=function(i){return typeof i=="object"&&i!==null&&!Ga(i)},MI=function(i){switch(typeof i){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return i instanceof Array?"an array":i===null?"null":"an object";default:return JSON.stringify(i)}},Si=function(i,e){return"expected "+i+", got "+MI(e)},Ta=function(i){return i.map(function(e){return typeof e=="string"?"."+e:"["+e+"]"}).join("")},Aa=function(i,e){var t=e.at,n=RI(e,["at"]);return ap({at:i+(t||"")},n)},ht=function(){function i(e){var t=this;this.decode=e,this.run=function(n){return Hd(function(r){return{kind:"DecoderError",input:n,at:"input"+(r.at||""),message:r.message||""}},t.decode(n))},this.runPromise=function(n){return TI(t.run(n))},this.runWithException=function(n){return EI(t.run(n))},this.map=function(n){return new i(function(r){return PI(n,t.decode(r))})},this.andThen=function(n){return new i(function(r){return NI(function(s){return n(s).decode(r)},t.decode(r))})},this.where=function(n,r){return t.andThen(function(s){return n(s)?i.succeed(s):i.fail(r)})}}return i.string=function(){return new i(function(e){return typeof e=="string"?yt(e):at({message:Si("a string",e)})})},i.number=function(){return new i(function(e){return typeof e=="number"?yt(e):at({message:Si("a number",e)})})},i.boolean=function(){return new i(function(e){return typeof e=="boolean"?yt(e):at({message:Si("a boolean",e)})})},i.constant=function(e){return new i(function(t){return cp(t,e)?yt(e):at({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(t)})})},i.object=function(e){return new i(function(t){if(cl(t)&&e){var n={};for(var r in e)if(e.hasOwnProperty(r)){var s=e[r].decode(t[r]);if(s.ok===!0)s.result!==void 0&&(n[r]=s.result);else return t[r]===void 0?at({message:"the key '"+r+"' is required but was not present"}):at(Aa("."+r,s.error))}return yt(n)}else return cl(t)?yt(t):at({message:Si("an object",t)})})},i.array=function(e){return new i(function(t){if(Ga(t)&&e){var n=function(r,s){return Hd(function(o){return Aa("["+s+"]",o)},e.decode(r))};return t.reduce(function(r,s,o){return sm(function(a,c){return a.concat([c])},r,n(s,o))},yt([]))}else return Ga(t)?yt(t):at({message:Si("an array",t)})})},i.tuple=function(e){return new i(function(t){if(Ga(t)){if(t.length!==e.length)return at({message:"expected a tuple of length "+e.length+", got one of length "+t.length});for(var n=[],r=0;r<e.length;r++){var s=e[r].decode(t[r]);if(s.ok)n[r]=s.result;else return at(Aa("["+r+"]",s.error))}return yt(n)}else return at({message:Si("a tuple of length "+e.length,t)})})},i.union=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return i.oneOf.apply(i,[e,t].concat(n))},i.intersection=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return new i(function(s){return[e,t].concat(n).reduce(function(o,a){return sm(Object.assign,o,a.decode(s))},yt({}))})},i.anyJson=function(){return new i(function(e){return yt(e)})},i.unknownJson=function(){return new i(function(e){return yt(e)})},i.dict=function(e){return new i(function(t){if(cl(t)){var n={};for(var r in t)if(t.hasOwnProperty(r)){var s=e.decode(t[r]);if(s.ok===!0)n[r]=s.result;else return at(Aa("."+r,s.error))}return yt(n)}else return at({message:Si("an object",t)})})},i.optional=function(e){return new i(function(t){return t==null?yt(void 0):e.decode(t)})},i.oneOf=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new i(function(n){for(var r=[],s=0;s<e.length;s++){var o=e[s].decode(n);if(o.ok===!0)return o;r[s]=o.error}var a=r.map(function(c){return"at error"+(c.at||"")+": "+c.message}).join('", "');return at({message:'expected a value matching one of the decoders, got the errors ["'+a+'"]'})})},i.withDefault=function(e,t){return new i(function(n){return yt(AI(e,t.decode(n)))})},i.valueAt=function(e,t){return new i(function(n){for(var r=n,s=0;s<e.length;s++){if(r===void 0)return at({at:Ta(e.slice(0,s+1)),message:"path does not exist"});if(typeof e[s]=="string"&&!cl(r))return at({at:Ta(e.slice(0,s+1)),message:Si("an object",r)});if(typeof e[s]=="number"&&!Ga(r))return at({at:Ta(e.slice(0,s+1)),message:Si("an array",r)});r=r[e[s]]}return Hd(function(o){return r===void 0?{at:Ta(e),message:"path does not exist"}:Aa(Ta(e),o)},t.decode(r))})},i.succeed=function(e){return new i(function(t){return yt(e)})},i.fail=function(e){return new i(function(t){return at({message:e})})},i.lazy=function(e){return new i(function(t){return e().decode(t)})},i}(),jc=ht.string,lp=ht.number,jI=ht.boolean,fr=ht.anyJson;ht.unknownJson;var Ea=ht.constant,St=ht.object,rt=ht.array;ht.tuple;var up=ht.dict,ee=ht.optional,gc=ht.oneOf;ht.union;ht.intersection;ht.withDefault;ht.valueAt;ht.succeed;ht.fail;ht.lazy;const oe=jc().where(i=>i.length>0,"Expected a non-empty string"),dp=lp().where(i=>i>=0,"Expected a non-negative number"),zv=St({name:oe,displayName:ee(jc()),contexts:ee(rt(jc())),customConfig:ee(St())}),OI=gc(Ea("web"),Ea("native"),Ea("citrix"),Ea("onlineNative"),Ea("other")),Uv=St({url:oe}),qv=St({src:oe,size:ee(oe),type:ee(oe)}),Vv=St({src:oe,size:ee(oe),type:ee(oe),label:ee(oe)}),DI=St({contexts:rt(oe),displayName:ee(oe),resultType:ee(oe),customConfig:ee(fr())}),$I=St({listensFor:ee(up(DI)),raises:ee(up(rt(oe)))}),FI=St({broadcasts:ee(rt(oe)),listensFor:ee(rt(oe))}),LI=St({name:oe,description:ee(oe),broadcasts:ee(rt(oe)),listensFor:ee(rt(oe))}),Jv=St({intents:ee($I),userChannels:ee(FI),appChannels:ee(rt(LI))}),WI=St({url:oe,top:ee(lp()),left:ee(lp()),width:ee(dp),height:ee(dp)}),hp=St({name:ee(oe),type:ee(oe.where(i=>i==="window","Expected a value of window")),title:ee(oe),version:ee(oe),customProperties:ee(fr()),icon:ee(jc()),caption:ee(jc()),details:ee(WI),intents:ee(rt(zv)),hidden:ee(jI())}),Kv=gc(St({ioConnect:ee(gc(hp,fr())),Glue42:ee(gc(hp,fr()))}),fr()),Qv=St({name:oe,appId:oe,title:ee(oe),version:ee(oe),manifest:oe,manifestType:oe,tooltip:ee(oe),description:ee(oe),contactEmail:ee(oe),supportEmail:ee(oe),publisher:ee(oe),images:ee(rt(St({url:ee(oe)}))),icons:ee(rt(St({icon:ee(oe)}))),customConfig:fr(),intents:ee(rt(zv))}),BI=St({appId:ee(oe),name:ee(oe),details:ee(Uv),version:ee(oe),title:ee(oe),tooltip:ee(oe),lang:ee(oe),description:ee(oe),categories:ee(rt(oe)),icons:ee(rt(qv)),screenshots:ee(rt(Vv)),contactEmail:ee(oe),supportEmail:ee(oe),moreInfo:ee(oe),publisher:ee(oe),customConfig:ee(rt(fr())),hostManifests:ee(Kv),interop:ee(Jv)}),Xv=St({appId:oe,name:oe,type:OI,details:Uv,version:ee(oe),title:ee(oe),tooltip:ee(oe),lang:ee(oe),description:ee(oe),categories:ee(rt(oe)),icons:ee(rt(qv)),screenshots:ee(rt(Vv)),contactEmail:ee(oe),supportEmail:ee(oe),moreInfo:ee(oe),publisher:ee(oe),customConfig:ee(rt(fr())),hostManifests:ee(Kv),interop:ee(Jv),localizedVersions:ee(up(BI))}),Fl=gc(Qv,Xv),ll=i=>`${i.kind} at ${i.at}: ${JSON.stringify(i.input)}. Reason - ${i.message}`;class HI{constructor(){d(this,"fdc3ToDesktopDefinitionType",{web:"window",native:"exe",citrix:"citrix",onlineNative:"clickonce",other:"window"})}toApi(){return{isFdc3Definition:this.isFdc3Definition.bind(this),parseToBrowserBaseAppData:this.parseToBrowserBaseAppData.bind(this),parseToDesktopAppConfig:this.parseToDesktopAppConfig.bind(this)}}isFdc3Definition(e){const t=Fl.run(e);return t.ok?e.appId&&e.details?{isFdc3:!0,version:"2.0"}:e.manifest?{isFdc3:!0,version:"1.2"}:{isFdc3:!1,reason:"The passed definition is not FDC3"}:{isFdc3:!1,reason:ll(t.error)}}parseToBrowserBaseAppData(e){var u,p;const{isFdc3:t,version:n}=this.isFdc3Definition(e);if(!t)throw new Error("The passed definition is not FDC3");const r=Fl.run(e);if(!r.ok)throw new Error(`Invalid FDC3 ${n} definition. Error: ${ll(r.error)}`);const s=this.getUserPropertiesFromDefinition(e,n),o={url:this.getUrl(e,n)},a={name:e.appId,type:"window",createOptions:o,userProperties:{...s,intents:n==="1.2"?s.intents:this.getIntentsFromV2AppDefinition(e),details:o},title:e.title,version:e.version,icon:this.getIconFromDefinition(e,n),caption:e.description,fdc3:n==="2.0"?{...e,definitionVersion:"2.0"}:void 0},c=((u=e.hostManifests)==null?void 0:u.ioConnect)||((p=e.hostManifests)==null?void 0:p.Glue42);if(!c)return a;const l=hp.run(c);if(!l.ok)throw new Error(`Invalid FDC3 ${n} definition. Error: ${ll(l.error)}`);return Object.keys(l.result).length?this.mergeBaseAppDataWithGlueManifest(a,l.result):a}parseToDesktopAppConfig(e){var c,l,u;const{isFdc3:t,version:n}=this.isFdc3Definition(e);if(!t)throw new Error("The passed definition is not FDC3");const r=Fl.run(e);if(!r.ok)throw new Error(`Invalid FDC3 ${n} definition. Error: ${ll(r.error)}`);if(n==="1.2"){const p=e;return{name:p.appId,type:"window",details:{url:this.getUrl(e,n)},version:p.version,title:p.title,tooltip:p.tooltip,caption:p.description,icon:(c=p.icons)==null?void 0:c[0].icon,intents:p.intents,customProperties:{manifestType:p.manifestType,images:p.images,contactEmail:p.contactEmail,supportEmail:p.supportEmail,publisher:p.publisher,icons:p.icons,customConfig:p.customConfig}}}const s=e,o={name:s.appId,type:this.fdc3ToDesktopDefinitionType[s.type],details:s.details,version:s.version,title:s.title,tooltip:s.tooltip,caption:s.description,icon:this.getIconFromDefinition(s,"2.0"),intents:this.getIntentsFromV2AppDefinition(s),fdc3:{...s,definitionVersion:"2.0"}},a=((l=e.hostManifests)==null?void 0:l.ioConnect)||((u=e.hostManifests)==null?void 0:u.Glue42);if(!a)return o;if(typeof a!="object"||Array.isArray(a))throw new Error(`Invalid '${e.hostManifests.ioConnect?"hostManifests.ioConnect":"hostManifests['Glue42']"}' key`);return this.mergeDesktopConfigWithGlueManifest(o,a)}getUserPropertiesFromDefinition(e,t){return Object.fromEntries(t==="1.2"?Object.entries(e).filter(([n])=>!rm.includes(n)):Object.entries(e).filter(([n])=>!rm.includes(n)&&!kI.includes(n)))}getUrl(e,t){var r,s;let n;if(t==="1.2"){const o=JSON.parse(e.manifest);n=((r=o.details)==null?void 0:r.url)||o.url}else n=(s=e.details)==null?void 0:s.url;if(!n||typeof n!="string")throw new Error(`Invalid FDC3 ${t} definition. Provide valid 'url' under '${t==="1.2"?"manifest":"details"}' key`);return n}getIntentsFromV2AppDefinition(e){var r,s;const t=(s=(r=e.interop)==null?void 0:r.intents)==null?void 0:s.listensFor;return t?Object.entries(t).map(o=>{const[a,c]=o;return{name:a,...c}}):void 0}getIconFromDefinition(e,t){var n,r,s,o;return t==="1.2"?((r=(n=e.icons)==null?void 0:n.find(a=>a.icon))==null?void 0:r.icon)||void 0:((o=(s=e.icons)==null?void 0:s.find(a=>a.src))==null?void 0:o.src)||void 0}mergeBaseAppDataWithGlueManifest(e,t){let n=e;if(t.details){const r={...e.createOptions,...t.details};n.createOptions=r,n.userProperties.details=r}return Array.isArray(t.intents)&&(n.userProperties.intents=(n.userProperties.intents||[]).concat(t.intents)),n={...n,...t},delete n.details,delete n.intents,n}mergeDesktopConfigWithGlueManifest(e,t){const n=Object.assign({},e,t,{details:{...e.details,...t.details}});return Array.isArray(t.intents)&&(n.intents=(e.intents||[]).concat(t.intents)),n}}const GI={common:{nonEmptyStringDecoder:oe,nonNegativeNumberDecoder:dp},fdc3:{allDefinitionsDecoder:Fl,v1DefinitionDecoder:Qv,v2DefinitionDecoder:Xv}};var pp;(function(i){i.USER_CANCELLED="User Closed Intents Resolver UI without choosing a handler",i.CALLER_NOT_DEFINED="Caller Id is not defined",i.TIMEOUT_HIT="Timeout hit",i.INTENT_NOT_FOUND="Cannot find Intent",i.HANDLER_NOT_FOUND="Cannot find Intent Handler",i.TARGET_INSTANCE_UNAVAILABLE="Cannot start Target Instance",i.INTENT_DELIVERY_FAILED="Target Instance did not add a listener",i.RESOLVER_UNAVAILABLE="Intents Resolver UI unavailable",i.RESOLVER_TIMEOUT="User did not choose a handler",i.INVALID_RESOLVER_RESPONSE="Intents Resolver UI returned invalid response",i.INTENT_HANDLER_REJECTION="Intent Handler function processing the raised intent threw an error or rejected the promise it returned"})(pp||(pp={}));let zI=class{constructor(){d(this,"_fdc3");d(this,"_decoders",GI);d(this,"_errors",{intents:pp})}get fdc3(){return this._fdc3||(this._fdc3=new HI().toApi()),this._fdc3}get decoders(){return this._decoders}get errors(){return this._errors}};const Af=new zI;Af.fdc3;const fp=Af.decoders;Af.errors;const j=fe().where(i=>i.length>0,"Expected a non-empty string"),Me=Re().where(i=>i>=0,"Expected a non-negative number"),om=k(j),UI=be(F("system"),F("windows"),F("appManager"),F("layouts"),F("intents"),F("notifications"),F("channels"),F("extension"),F("themes"),F("prefs")),qI=be(F("openWindow"),F("windowHello"),F("windowAdded"),F("windowRemoved"),F("getBounds"),F("getFrameBounds"),F("getUrl"),F("moveResize"),F("focus"),F("close"),F("getTitle"),F("setTitle"),F("focusChange"),F("getChannel")),VI=be(F("appHello"),F("appDirectoryStateChange"),F("instanceStarted"),F("instanceStopped"),F("applicationStart"),F("instanceStop"),F("clear")),JI=be(F("layoutAdded"),F("layoutChanged"),F("layoutRemoved"),F("layoutRenamed"),F("get"),F("getAll"),F("export"),F("import"),F("remove"),F("rename"),F("clientSaveRequest"),F("getGlobalPermissionState"),F("checkGlobalActivated"),F("requestGlobalPermission"),F("getDefaultGlobal"),F("setDefaultGlobal"),F("clearDefaultGlobal"),F("updateMetadata")),KI=be(F("raiseNotification"),F("requestPermission"),F("notificationShow"),F("notificationClick"),F("getPermission"),F("list"),F("notificationRaised"),F("notificationClosed"),F("click"),F("clear"),F("clearAll"),F("configure"),F("getConfiguration"),F("configurationChanged"),F("setState"),F("clearOld"),F("activeCountChange"),F("stateChange")),QI=be(F("getEnvironment"),F("getBase"),F("platformShutdown"),F("isFdc3DataWrappingSupported"),F("clientError")),Ef=be(F("top"),F("left"),F("right"),F("bottom")),Pf=W({top:Re(),left:Re(),width:Me,height:Me}),Nf=k(W({top:k(Re()),left:k(Re()),width:k(Me),height:k(Me),context:k(xe()),relativeTo:k(j),relativeDirection:k(Ef),windowId:k(j),layoutComponentId:k(j)})),XI=W({name:j,url:j,options:Nf}),Yv=W({windowId:k(j)}),gp=W({windowId:j,name:j}),qi=W({windowId:j}),YI=W({windows:le(gp),isWorkspaceFrame:ue()}),am=W({windowId:j,title:fe()}),ZI=W({windowId:j,hasFocus:ue()}),ex=W({windowId:j,top:k(Re()),left:k(Re()),width:k(Me),height:k(Me),relative:k(ue())}),tx=W({windowId:j,bounds:W({top:Re(),left:Re(),width:Me,height:Me})}),nx=W({bounds:W({top:Re(),left:Re(),width:Me,height:Me})}),ix=W({windowId:j,url:j}),yu=xe(),rx=W({top:k(Re()),left:k(Re()),width:k(Me),height:k(Me)}),Ll=W({id:j,applicationName:j}),sx=W({url:j,top:k(Re()),left:k(Re()),width:k(Me),height:k(Me)}),Zv=W({name:j,displayName:k(fe()),contexts:k(le(fe())),customConfig:k(W())});W({name:j,title:k(j),version:k(j),appId:k(j),manifest:j,manifestType:j,tooltip:k(j),description:k(j),contactEmail:k(j),supportEmail:k(j),publisher:k(j),images:k(le(W({url:k(j)}))),icons:k(le(W({icon:k(j)}))),customConfig:xe(),intents:k(le(Zv))});const eb=W({name:j,type:j.where(i=>i==="window","Expected a value of window"),title:k(j),version:k(j),customProperties:k(xe()),icon:k(fe()),caption:k(fe()),details:sx,intents:k(le(Zv)),hidden:k(ue()),fdc3:k(fp.fdc3.v2DefinitionDecoder)}),tb=be(eb,fp.fdc3.v2DefinitionDecoder,fp.fdc3.v1DefinitionDecoder);W({definitions:le(tb),mode:be(F("replace"),F("merge"))});const ox=W({name:j}),ax=W({definitions:le(eb)}),cx=W({name:j,type:j.where(i=>i==="window","Expected a value of window"),instances:le(Ll),userProperties:k(xe()),title:k(j),version:k(j),icon:k(j),caption:k(j)}),Gd=W({name:j,type:j.where(i=>i==="window","Expected a value of window"),userProperties:xe(),title:k(j),version:k(j),icon:k(j),caption:k(j)}),lx=W({appsAdded:le(Gd),appsChanged:le(Gd),appsRemoved:le(Gd)}),ux=W({apps:le(cx),initialChannelId:k(j)}),dx=W({id:j}),hx=W({name:j,waitForAGMReady:ue(),id:k(j),context:k(xe()),top:k(Re()),left:k(Re()),width:k(Me),height:k(Me),relativeTo:k(j),relativeDirection:k(Ef),forceChromeTab:k(ue()),layoutComponentId:k(j),channelId:k(j)}),ir=be(F("Global"),F("Activity"),F("ApplicationDefault"),F("Swimlane"),F("Workspace")),nb=be(F("application"),F("activity")),px=W({context:k(xe()),bounds:Pf,createArgs:W({name:k(j),url:k(j),context:k(xe())}),windowState:k(j),restoreState:k(j),instanceId:j,isCollapsed:k(ue()),isSticky:k(ue()),restoreSettings:W({groupId:k(j),groupZOrder:k(Re())})}),fx=W({type:F("window"),componentType:k(nb),application:j,state:px}),Xu=W({type:F("window"),config:W({appName:j,url:k(j),title:k(fe()),allowExtract:k(ue()),allowReorder:k(ue()),showCloseButton:k(ue()),isMaximized:k(ue())})}),Rf=W({type:F("group"),config:xe(),children:le(be(Xu))}),Mf=W({type:F("column"),config:xe(),children:le(be(Rf,Xu,op(()=>Mf),op(()=>jf)))}),jf=W({type:F("row"),config:xe(),children:le(be(Mf,Rf,Xu,op(()=>jf)))}),ib=W({config:xe(),context:xe(),children:le(be(jf,Mf,Rf,Xu))}),gx=W({type:F("Workspace"),application:k(j),state:ib}),mx=W({bounds:Pf,instanceId:j,selectedWorkspace:Me,workspaces:le(ib),windowState:k(j),restoreState:k(j),context:k(xe())}),yx=W({type:F("workspaceFrame"),application:j,componentType:k(nb),state:mx}),dn=W({name:j,type:ir,components:le(be(fx,gx,yx)),context:k(xe()),metadata:k(xe()),version:k(Re())}),rb=W({name:j,context:k(xe()),metadata:k(xe()),instances:k(le(j)),ignoreInstances:k(le(j))}),sb=W({name:j,context:k(xe()),closeRunningInstance:k(ue()),closeMe:k(ue()),timeout:k(Me)}),wx=W({name:j,type:ir,context:k(xe()),metadata:k(xe())}),cm=W({name:j,type:ir}),vx=W({layout:rb}),bx=W({layout:dn,newName:j}),_x=W({status:j}),Cx=W({layout:dn}),Sx=W({layout:sb}),lm=W({type:ir}),Ix=W({layouts:le(dn)}),Of=be(F("replace"),F("merge")),xx=W({layouts:le(dn),mode:Of,skipManagerRequest:k(ue())}),kx=W({summaries:le(wx)}),Tx=W({layout:dn}),um=W({layout:k(dn)}),Ax=W({name:j}),Ex=be(F("findIntent"),F("getIntents"),F("raiseIntent"),F("raise"),F("filterHandlers")),hs=W({applicationName:j,applicationTitle:k(fe()),applicationDescription:k(fe()),applicationIcon:k(fe()),type:be(F("app"),F("instance")),displayName:k(fe()),contextTypes:k(le(j)),instanceId:k(fe()),instanceTitle:k(fe()),resultType:k(fe())});W({applicationName:fe(),applicationIcon:k(fe()),instanceId:k(fe())});const Px=W({intent:j,handler:hs}),Nx=W({name:j,handlers:le(hs)}),Rx=be(F("startNew"),F("reuse"),W({app:k(j),instance:k(j)})),Mx=W({type:k(j),data:k(xe())}),jx=le(Nx),dm=W({intents:jx}),ob=W({name:k(j),contextType:k(j),resultType:k(j)}),Ox=be(j,ob),Dx=W({filter:k(ob)}),Yu=W({intent:j,target:k(Rx),context:k(Mx),options:k(Nf),handlers:k(le(hs)),timeout:k(Me),waitUserResponseIndefinitely:k(ue()),clearSavedHandler:k(ue())}),$x=be(j,Yu),ab=W({enabled:ue(),appName:j,waitResponseTimeout:Re()}),Fx=W({intentRequest:Yu,resolverConfig:ab}),hm=W({request:Yu,handler:hs,result:xe()}),cb=W({title:k(j),openResolver:k(ue()),timeout:k(Me),intent:k(j),contextTypes:k(le(j)),resultType:k(j),applicationNames:k(le(j))}),Lx=W({handlers:le(hs)}),Wx=W({filterHandlersRequest:cb,resolverConfig:ab}),Bx=W({intent:j,contextTypes:k(le(j)),displayName:k(fe()),icon:k(fe()),description:k(fe()),resultType:k(fe())}),pm=be(j,Bx),Hx=W({intent:j,contextTypes:k(le(j)),description:k(j),displayName:k(j),icon:k(j),resultType:k(j)}),Gx=W({intents:le(Hx)}),qr=i=>j.where(e=>i.includes(e),"Expected a valid channel name"),zx=k(be(j,W({name:k(j),fdc3:k(ue())}))),Ux=xe().where(i=>typeof i.type=="string","Expected a valid FDC3 Context with compulsory 'type' field"),Df=W({method:j,arguments:k(xe()),target:k(be(F("all"),F("best")))}),lb=W({action:fe(),title:j,icon:k(fe()),interop:k(Df)}),Zu=be(F("Active"),F("Acknowledged"),F("Seen"),F("Closed"),F("Stale"),F("Snoozed"),F("Processing")),qx=W({count:Re()}),Vx=W({badge:k(fe()),body:k(fe()),data:k(xe()),dir:k(be(F("auto"),F("ltr"),F("rtl"))),icon:k(fe()),image:k(fe()),lang:k(fe()),renotify:k(ue()),requireInteraction:k(ue()),silent:k(ue()),tag:k(fe()),timestamp:k(Me),vibrate:k(le(Re()))}),$f=W({title:j,clickInterop:k(Df),actions:k(le(lb)),focusPlatformOnDefaultClick:k(ue()),badge:k(fe()),body:k(fe()),data:k(xe()),dir:k(be(F("auto"),F("ltr"),F("rtl"))),icon:k(fe()),image:k(fe()),lang:k(fe()),renotify:k(ue()),requireInteraction:k(ue()),silent:k(ue()),tag:k(fe()),timestamp:k(Me),vibrate:k(le(Re())),severity:k(be(F("Low"),F("None"),F("Medium"),F("High"),F("Critical"))),showToast:k(ue()),showInPanel:k(ue()),state:k(Zu)}),fm=W({id:j,state:Zu}),ub=W({name:j,meta:W({color:j}),data:k(W())}),Jx=W({name:j}),db=W({name:j,read:ue(),write:ue(),windowId:k(j)}),Kx=W({name:j,read:ue(),write:ue(),windowId:j}),Qx=W({config:Kx}),Xx=W({channels:le(db)}),Yx=W({windowId:j}),hb=W({read:ue(),write:ue(),windowId:k(j)}),Zx=W({restrictions:hb}),e0=W({settings:$f,id:j}),t0=W({settings:$f}),n0=W({permissionGranted:ue()}),i0=W({permission:be(F("default"),F("granted"),F("denied"))}),gm=W({definition:Vx,action:k(fe()),id:k(j)}),pb=W({allowed:k(le(j)),blocked:k(le(j))}),fb=W({enable:k(ue()),enableToasts:k(ue()),sourceFilter:k(pb)}),r0=W({configuration:fb}),mm=W({configuration:W({enable:ue(),enableToasts:ue(),sourceFilter:W({allowed:le(j),blocked:le(j)})})}),s0=W({layoutType:be(F("Global"),F("Workspace")),layoutName:j,context:k(xe())}),o0=W({windowContext:k(xe())}),a0=W({state:be(F("prompt"),F("denied"),F("granted"))}),ym=W({isAvailable:ue()}),c0=W({itemId:j}),l0=W({isSupported:ue()}),u0=W({operation:j}),d0=W({bounds:Pf}),gb=W({displayName:j,name:j}),mb=W({theme:gb}),h0=W({themes:le(gb)}),p0=W({name:j}),yb=W({id:j,title:j,clickInterop:k(Df),actions:k(le(lb)),focusPlatformOnDefaultClick:k(ue()),badge:k(fe()),body:k(fe()),data:k(xe()),dir:k(be(F("auto"),F("ltr"),F("rtl"))),icon:k(fe()),image:k(fe()),lang:k(fe()),renotify:k(ue()),requireInteraction:k(ue()),silent:k(ue()),tag:k(fe()),timestamp:k(Me),vibrate:k(le(Re())),severity:k(be(F("Low"),F("None"),F("Medium"),F("High"),F("Critical"))),showToast:k(ue()),showInPanel:k(ue()),state:k(Zu)}),f0=W({notification:yb}),g0=W({notifications:le(yb)}),m0=W({id:j}),y0=W({channel:j}),w0=W({windowIds:le(j)}),v0=be(F("addChannel"),F("getMyChannel"),F("getWindowIdsOnChannel"),F("getWindowIdsWithChannels"),F("joinChannel"),F("restrict"),F("getRestrictions"),F("restrictAll")),b0=W({channel:k(j)}),wb=W({application:k(j),channels:k(le(j)),windowIds:k(le(j))}),_0=W({filter:k(wb)}),C0=W({windowIdsWithChannels:le(W({application:j,channel:k(j),windowId:j}))}),S0=k(xe()),I0=k(W({top:k(Re()),left:k(Re()),width:k(Me),height:k(Me),relativeTo:k(j),relativeDirection:k(Ef),waitForAGMReady:k(ue()),channelId:k(j),reuseId:k(j)})),x0=W({channel:j,windowId:j}),k0=W({channel:k(j)}),T0=be(F("clear"),F("clearAll"),F("get"),F("getAll"),F("set"),F("update"),F("prefsChanged"),F("prefsHello")),vb=W({app:j,data:W(),lastUpdate:k(j)}),wu=W({app:j}),wm=W({prefs:vb}),A0=W({all:le(vb)}),vm=W({app:j,data:W()}),E0=W({platform:W({app:j})}),P0=W({message:j}),Fe={openWindow:{name:"openWindow",dataDecoder:XI,resultDecoder:gp},windowHello:{name:"windowHello",dataDecoder:Yv,resultDecoder:YI},windowAdded:{name:"windowAdded",dataDecoder:gp},windowRemoved:{name:"windowRemoved",dataDecoder:qi},getBounds:{name:"getBounds",dataDecoder:qi,resultDecoder:tx},getFrameBounds:{name:"getFrameBounds",dataDecoder:qi,resultDecoder:nx},getUrl:{name:"getUrl",dataDecoder:qi,resultDecoder:ix},moveResize:{name:"moveResize",dataDecoder:ex},focus:{name:"focus",dataDecoder:qi},close:{name:"close",dataDecoder:qi},getTitle:{name:"getTitle",dataDecoder:qi,resultDecoder:am},setTitle:{name:"setTitle",dataDecoder:am},focusChange:{name:"focusChange",dataDecoder:ZI},getChannel:{name:"getChannel",dataDecoder:qi,resultDecoder:k0}};function N0(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function mp(i){if(i&&i.errorHandling&&typeof i.errorHandling!="function"&&i.errorHandling!=="log"&&i.errorHandling!=="silent"&&i.errorHandling!=="throw")throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof i.errorHandling+" was passed");var e=i&&typeof i.errorHandling=="function"&&i.errorHandling,t={};function n(c,l,u){var p=t[c];return p||(p=[],t[c]=p),p.push(l),u&&setTimeout(function(){u.forEach(function(f){var w;if(!((w=t[c])===null||w===void 0)&&w.includes(l))try{Array.isArray(f)?l.apply(void 0,f):l.apply(void 0,[f])}catch(y){s(y,c)}})},0),function(){var f=t[c];f&&(f=f.reduce(function(w,y,S){return y===l&&w.length===S||w.push(y),w},[]),f.length===0?delete t[c]:t[c]=f)}}function r(c){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];var p=t[c];if(!p||p.length===0)return[];var f=[];return p.forEach(function(w){try{var y=w.apply(void 0,l);f.push(y)}catch(S){f.push(void 0),s(S,c)}}),f}function s(c,l){var u=c instanceof Error?c:new Error(c);if(e){e(u);return}var p='[ERROR] callback-registry: User callback for key "'+l+'" failed: '+u.stack;if(i)switch(i.errorHandling){case"log":return console.error(p);case"silent":return;case"throw":throw new Error(p)}console.error(p)}function o(){t={}}function a(c){var l=t[c];l&&delete t[c]}return{add:n,execute:r,clear:o,clearKey:a}}mp.default=mp;var R0=mp,Hi=N0(R0);class M0{constructor(e,t,n){d(this,"_id");d(this,"_name");d(this,"_bridge");d(this,"registry",Hi());d(this,"myCtxKey");d(this,"ctxUnsubscribe");d(this,"me");this._id=e,this._name=t,this._bridge=n,this.myCtxKey=`___window___${this.id}`}get id(){return this._id.slice()}get name(){return this._name.slice()}clean(){this.ctxUnsubscribe&&this.ctxUnsubscribe()}processSelfFocusEvent(e){this.me.isFocused=e,this.registry.execute("focus-change",this.me)}async toApi(){return this.ctxUnsubscribe=await this._bridge.contextLib.subscribe(this.myCtxKey,e=>this.registry.execute("context-updated",e)),this.me={id:this.id,name:this.name,isFocused:!1,getURL:this.getURL.bind(this),moveResize:this.moveResize.bind(this),resizeTo:this.resizeTo.bind(this),moveTo:this.moveTo.bind(this),focus:this.focus.bind(this),close:this.close.bind(this),getTitle:this.getTitle.bind(this),setTitle:this.setTitle.bind(this),getBounds:this.getBounds.bind(this),getContext:this.getContext.bind(this),updateContext:this.updateContext.bind(this),setContext:this.setContext.bind(this),onContextUpdated:this.onContextUpdated.bind(this),onFocusChanged:this.onFocusChanged.bind(this),getChannel:this.getChannel.bind(this)},this.me}async getURL(){return(await this._bridge.send("windows",Fe.getUrl,{windowId:this.id})).url}onFocusChanged(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to context changes, because the provided callback is not a function!"):this.registry.add("focus-change",e)}async moveResize(e){const t=Z(rx,e),n=Object.assign({},t,{windowId:this.id,relative:!1});return await this._bridge.send("windows",Fe.moveResize,n),this.me}async resizeTo(e,t){if(typeof e>"u"&&typeof t>"u")return this.me;typeof e<"u"&&Z(Me,e),typeof t<"u"&&Z(Me,t);const n=Object.assign({},{width:e,height:t},{windowId:this.id,relative:!0});return await this._bridge.send("windows",Fe.moveResize,n),this.me}async moveTo(e,t){if(typeof e>"u"&&typeof t>"u")return this.me;typeof e<"u"&&Z(Re(),e),typeof t<"u"&&Z(Re(),t);const n=Object.assign({},{top:e,left:t},{windowId:this.id,relative:!0});return await this._bridge.send("windows",Fe.moveResize,n),this.me}async focus(){return this.name==="Platform"?window.open(void 0,this.id):await this._bridge.send("windows",Fe.focus,{windowId:this.id}),this.me}async close(){return await this._bridge.send("windows",Fe.close,{windowId:this.id}),this.me}async getTitle(){return(await this._bridge.send("windows",Fe.getTitle,{windowId:this.id})).title}async setTitle(e){const t=Z(j,e);return await this._bridge.send("windows",Fe.setTitle,{windowId:this.id,title:t}),this.me}async getBounds(){return(await this._bridge.send("windows",Fe.getBounds,{windowId:this.id})).bounds}async getContext(){const e=await this._bridge.contextLib.get(this.myCtxKey),{___io___:t,...n}=e;return n}async updateContext(e){const t=Z(yu,e);return await this._bridge.contextLib.update(this.myCtxKey,t),this.me}async setContext(e){const t=Z(yu,e),n=await this._bridge.contextLib.get(this.myCtxKey),r=n.___io___?{...t,___io___:n.___io___}:t;return await this._bridge.contextLib.set(this.myCtxKey,r),this.me}onContextUpdated(e){if(typeof e!="function")return ie.raiseError("Cannot subscribe to context changes, because the provided callback is not a function!");const t=n=>{const{___io___:r,...s}=n;e(s,this.me)};return this.registry.add("context-updated",t)}async getChannel(){return(await this._bridge.send("windows",Fe.getChannel,{windowId:this.id},void 0,{includeOperationCheck:!0})).channel}}const Oc={operationCheck:{name:"operationCheck",dataDecoder:u0,resultDecoder:l0},getWorkspaceWindowFrameBounds:{name:"getWorkspaceWindowFrameBounds",resultDecoder:d0,dataDecoder:c0}},j0=(i,e,t)=>new Promise((n,r)=>{let s=!0;const o=setTimeout(()=>{if(!s)return;s=!1,r(t)},e);i().then(a=>{s&&(s=!1,clearTimeout(o),n(a))}).catch(a=>{s&&(s=!1,clearTimeout(o),r(a))})}),Ff=(i,e,t)=>new Promise((n,r)=>{const s=setTimeout(()=>{const a=t||`Promise timeout hit: ${e}`;r(a)},e);new Promise(i).then(a=>{clearTimeout(s),n(a)}).catch(a=>{clearTimeout(s),r(a)})});class O0{constructor(){d(this,"focusEventHandler");d(this,"registry",Hi());d(this,"platformRegistration");d(this,"ioc");d(this,"bridge");d(this,"publicWindowId");d(this,"allWindowProjections",[]);d(this,"me");d(this,"logger");d(this,"isWorkspaceFrame");d(this,"instanceId");d(this,"channelsController")}async start(e,t){this.logger=e.logger.subLogger("windows.controller.web"),this.logger.trace("starting the web windows controller"),this.publicWindowId=t.publicWindowId,this.addWindowOperationExecutors(),this.ioc=t,this.bridge=t.bridge,this.instanceId=e.interop.instance.instance,this.channelsController=t.channelsController,this.logger.trace(`set the public window id: ${this.publicWindowId}, set the bridge operations and ioc, registering with the platform now`),this.platformRegistration=this.registerWithPlatform(),await this.platformRegistration,await this.initializeFocusTracking(),this.logger.trace("registration with the platform successful, attaching the windows property to glue and returning");const n=this.toApi();e.windows=n}handlePlatformShutdown(){this.registry.clear(),this.allWindowProjections=[],this.focusEventHandler&&(document.removeEventListener("visibilityChange",this.focusEventHandler),window.removeEventListener("focus",this.focusEventHandler),window.removeEventListener("blur",this.focusEventHandler))}async handleBridgeMessage(e){await this.platformRegistration;const t=Z(qI,e.operation),n=Fe[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}async open(e,t,n){Z(j,e),Z(j,t);const r=Z(Nf,n),s=await this.bridge.send("windows",Fe.openWindow,{name:e,url:t,options:r});return this.waitForWindowAdded(s.windowId)}list(){return this.allWindowProjections.map(e=>e.api)}findById(e){var t;return Z(j,e),(t=this.allWindowProjections.find(n=>n.id===e))==null?void 0:t.api}toApi(){return{open:this.open.bind(this),my:this.my.bind(this),list:this.list.bind(this),findById:this.findById.bind(this),onWindowAdded:this.onWindowAdded.bind(this),onWindowRemoved:this.onWindowRemoved.bind(this),onWindowGotFocus:this.onWindowGotFocus.bind(this),onWindowLostFocus:this.onWindowLostFocus.bind(this)}}addWindowOperationExecutors(){Fe.focusChange.execute=this.handleFocusChangeEvent.bind(this),Fe.windowAdded.execute=this.handleWindowAdded.bind(this),Fe.windowRemoved.execute=this.handleWindowRemoved.bind(this),Fe.getBounds.execute=this.handleGetBounds.bind(this),Fe.getFrameBounds.execute=this.handleGetBounds.bind(this),Fe.getTitle.execute=this.handleGetTitle.bind(this),Fe.getUrl.execute=this.handleGetUrl.bind(this),Fe.moveResize.execute=this.handleMoveResize.bind(this),Fe.setTitle.execute=this.handleSetTitle.bind(this),Fe.getChannel.execute=this.handleGetChannel.bind(this)}my(){return Object.assign({},this.me)}onWindowAdded(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to window added, because the provided callback is not a function!"):this.registry.add("window-added",e)}onWindowRemoved(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to window removed, because the provided callback is not a function!"):this.registry.add("window-removed",e)}onWindowGotFocus(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to onWindowGotFocus, because the provided callback is not a function!"):this.registry.add("window-got-focus",e)}onWindowLostFocus(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to onWindowLostFocus, because the provided callback is not a function!"):this.registry.add("window-lost-focus",e)}async sayHello(){return await this.bridge.send("windows",Fe.windowHello,{windowId:this.publicWindowId})}async registerWithPlatform(){const{windows:e,isWorkspaceFrame:t}=await this.sayHello();if(this.isWorkspaceFrame=t,this.logger.trace("the platform responded to the hello message"),!this.isWorkspaceFrame&&this.publicWindowId){this.logger.trace("i am not treated as a workspace frame, setting my window");const r=e.find(o=>o.windowId===this.publicWindowId);if(!r)return ie.raiseError("Cannot initialize the window library, because I received no information about me from the platform");const s=await this.ioc.buildWebWindow(this.publicWindowId,r.name);this.me=s.api,this.allWindowProjections.push(s)}const n=await Promise.all(e.filter(r=>r.windowId!==this.publicWindowId).map(r=>this.ioc.buildWebWindow(r.windowId,r.name)));this.logger.trace("all windows projections are completed, building the list collection"),this.allWindowProjections.push(...n)}async handleFocusChangeEvent(e){const t=this.allWindowProjections.find(r=>r.id===e.windowId);if(!t)return;t.model.processSelfFocusEvent(e.hasFocus);const n=e.hasFocus?"window-got-focus":"window-lost-focus";this.registry.execute(n,t.api)}async handleWindowAdded(e){if(this.allWindowProjections.some(n=>n.id===e.windowId))return;const t=await this.ioc.buildWebWindow(e.windowId,e.name);this.allWindowProjections.push(t),this.registry.execute("window-added",t.api)}async handleWindowRemoved(e){const t=this.allWindowProjections.find(n=>n.id===e.windowId);t&&(this.allWindowProjections=this.allWindowProjections.filter(n=>n.id!==e.windowId),t.model.clean(),this.registry.execute("window-removed",t.api))}async handleGetBounds(){return!this.me&&!this.isWorkspaceFrame?ie.raiseError("This window cannot report it's bounds, because it is not a Glue Window, most likely because it is an iframe"):{windowId:this.isWorkspaceFrame?"noop":this.me.id,bounds:{top:window.screenTop,left:window.screenLeft,width:window.innerWidth,height:window.innerHeight}}}async handleGetTitle(){return this.me?{windowId:this.me.id,title:document.title}:ie.raiseError("This window cannot report it's title, because it is not a Glue Window, most likely because it is an iframe")}async handleGetUrl(){return this.me?{windowId:this.me.id,url:window.location.href}:ie.raiseError("This window cannot report it's url, because it is not a Glue Window, most likely because it is an iframe")}async handleMoveResize(e){const t=typeof e.top=="number"?e.top:e.relative?0:window.screenTop,n=typeof e.left=="number"?e.left:e.relative?0:window.screenLeft,r=typeof e.height=="number"?e.height:e.relative?0:window.innerHeight,s=typeof e.width=="number"?e.width:e.relative?0:window.innerWidth,o=e.relative?window.moveBy:window.moveTo,a=e.relative?window.resizeBy:window.resizeTo;o(n,t),a(s,r)}async handleSetTitle(e){document.title=e.title}async initializeFocusTracking(){if(this.isWorkspaceFrame){this.logger.trace("Ignoring the focus tracking, because this client is a workspace frame");return}try{await this.bridge.send("windows",Oc.operationCheck,{operation:"focusChange"})}catch{this.logger.warn("The platform of this client is outdated and does not support focus tracking, disabling focus events for this client.");return}const e=document.hasFocus();await this.transmitFocusChange(!0),e||await this.transmitFocusChange(!1),this.defineEventListeners()}processFocusEvent(){const e=document.hasFocus();this.transmitFocusChange(e)}waitForWindowAdded(e){const t=this.allWindowProjections.find(n=>n.id===e);return t?Promise.resolve(t.api):Ff(n=>{const r=this.onWindowAdded(s=>{s.id===e&&(r(),n(s))})},3e4,`Timed out waiting for ${e} to be announced`)}async transmitFocusChange(e){var n;const t={windowId:((n=this.me)==null?void 0:n.id)||`iframe-${this.instanceId}`,hasFocus:e};this.me&&(this.me.isFocused=e),await this.bridge.send("windows",Fe.focusChange,t)}defineEventListeners(){this.focusEventHandler=this.processFocusEvent.bind(this),document.addEventListener("visibilityChange",this.focusEventHandler),window.addEventListener("focus",this.focusEventHandler),window.addEventListener("blur",this.focusEventHandler)}async handleGetChannel(){if(!this.me)return ie.raiseError("This window cannot report it's channel, because it is not a Glue Window, most likely because it is an iframe");const e=this.channelsController.my();return{...e?{channel:e}:{}}}}const bm="T42.Web.Platform.Control",_m="T42.Web.Platform.Stream",Cm="T42.Web.Client.Control",Sm="T42.Core.Plus.Themes.Stream";class D0{constructor(e,t){d(this,"coreGlue");d(this,"communicationId");d(this,"platformMethodTimeoutMs",1e4);d(this,"controllers");d(this,"sub");d(this,"running");this.coreGlue=e,this.communicationId=t}get contextLib(){return this.coreGlue.contexts}get interopInstance(){return this.coreGlue.interop.instance.instance}async stop(){this.running=!1,this.sub.close(),await this.coreGlue.interop.unregister(Cm)}async start(e){this.running=!0,this.controllers=e,await Promise.all([this.checkWaitMethod(bm),this.checkWaitMethod(_m)]);const t=this.communicationId,[n]=await Promise.all([this.coreGlue.interop.subscribe(_m,t?{target:{instance:this.communicationId}}:void 0),this.coreGlue.interop.registerAsync(Cm,(r,s,o,a)=>this.passMessageController(r,o,a))]);this.sub=n,this.sub.onData(r=>this.passMessageController(r.data))}getInteropInstance(e){const t=this.coreGlue.interop.servers().find(n=>n.windowId&&n.windowId===e);return{application:t==null?void 0:t.application,applicationName:t==null?void 0:t.applicationName,peerId:t==null?void 0:t.peerId,instance:t==null?void 0:t.instance,windowId:t==null?void 0:t.windowId}}async send(e,t,n,r,s){if(t.dataDecoder)try{t.dataDecoder.runWithException(n)}catch(a){return ie.raiseError(`Unexpected Web->Platform outgoing validation error: ${a.message}, for operation: ${t.name} and input: ${JSON.stringify(a.input)}`)}if(!(s!=null&&s.includeOperationCheck?(await this.checkOperationSupported(e,t)).isSupported:!0))return ie.raiseError(`Cannot complete operation: ${t.name} for domain: ${e} because this client is connected to a platform which does not support it`);try{const a=await this.transmitMessage(e,t,n,r);return t.resultDecoder&&t.resultDecoder.runWithException(a),a}catch(a){return a!=null&&a.kind?ie.raiseError(`Unexpected Web<-Platform incoming validation error: ${a.message}, for operation: ${t.name} and input: ${JSON.stringify(a.input)}`):ie.raiseError(a)}}async createNotificationsSteam(){return this.coreGlue.interop.methods().some(t=>t.name===Sm)?this.coreGlue.interop.subscribe(Sm,this.communicationId?{target:{instance:this.communicationId}}:void 0):ie.raiseError("Cannot subscribe to theme changes, because the underlying interop stream does not exist. Most likely this is the case when this client is not connected to Core Plus.")}async checkOperationSupported(e,t){try{return await this.send(e,Oc.operationCheck,{operation:t.name})}catch{return{isSupported:!1}}}checkWaitMethod(e){return Ff(t=>{if(this.coreGlue.interop.methods().some(s=>{const o=s.name===e,a=this.communicationId?s.getServers().some(c=>c.instance===this.communicationId):!0;return o&&a}))return t();const r=this.coreGlue.interop.serverMethodAdded(s=>{const o=s.method,a=s.server,c=this.communicationId?a.instance===this.communicationId:!0;o.name===e&&c&&(r(),t())})},this.platformMethodTimeoutMs,`Cannot initiate Glue Web, because a system method's discovery timed out: ${e}`)}passMessageController(e,t,n){const r=UI.run(e.domain);if(!r.ok){n&&n(`Cannot execute this client control, because of domain validation error: ${JSON.stringify(r.error)}`);return}const s=r.result;this.controllers[s].handleBridgeMessage(e).then(o=>{t&&t(o)}).catch(o=>{n&&n(o),console.warn(o)})}async transmitMessage(e,t,n,r){const s={domain:e,data:n,operation:t.name};let o;const a=`Internal Platform Communication Error. Attempted operation: ${JSON.stringify(t.name)} with data: ${JSON.stringify(n)}. `,c=this.communicationId;try{if(!this.running)throw new Error("Cannot send a control message, because the platform shut down");if(o=await this.coreGlue.interop.invoke(bm,s,c?{instance:this.communicationId}:void 0,r),!o)throw new Error("Received unsupported result from the platform - empty result");if(!Array.isArray(o.all_return_values)||o.all_return_values.length===0)throw new Error("Received unsupported result from the platform - empty values collection")}catch(l){if(l&&l.all_errors&&l.all_errors.length){const u=l.all_errors[0].message;throw new Error(`${a} -> Inner message: ${u}`)}throw new Error(`${a} -> Inner message: ${l.message}`)}return o.all_return_values[0].returned}}const Bn={appHello:{name:"appHello",dataDecoder:Yv,resultDecoder:ux},appDirectoryStateChange:{name:"appDirectoryStateChange",dataDecoder:lx},instanceStarted:{name:"instanceStarted",dataDecoder:Ll},instanceStopped:{name:"instanceStopped",dataDecoder:Ll},applicationStart:{name:"applicationStart",dataDecoder:hx,resultDecoder:Ll},instanceStop:{name:"instanceStop",dataDecoder:dx},import:{name:"import"},remove:{name:"remove",dataDecoder:ox},export:{name:"export",resultDecoder:ax},clear:{name:"clear"}};class $0{constructor(){d(this,"me");d(this,"baseApplicationsTimeoutMS",6e4);d(this,"appImportTimeoutMS",20);d(this,"registry",Hi());d(this,"ioc");d(this,"bridge");d(this,"publicWindowId");d(this,"applications",[]);d(this,"instances",[]);d(this,"platformRegistration");d(this,"logger");d(this,"channelsController");d(this,"sessionController")}handlePlatformShutdown(){this.registry.clear(),this.applications=[],this.instances=[],delete this.me}async start(e,t){this.logger=e.logger.subLogger("appManger.controller.web"),this.logger.trace("starting the web appManager controller"),this.publicWindowId=t.publicWindowId,this.addOperationsExecutors(),this.ioc=t,this.bridge=t.bridge,this.channelsController=t.channelsController,this.sessionController=t.sessionController,this.platformRegistration=this.registerWithPlatform(),await this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the appManager property to glue and returning");const n=this.toApi();e.appManager=n}async handleBridgeMessage(e){await this.platformRegistration;const t=Z(VI,e.operation),n=Bn[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}onInstanceStarted(e){return typeof e!="function"?ie.raiseError("onInstanceStarted requires a single argument of type function"):this.registry.add("instance-started",e,this.instances)}onInstanceStopped(e){return typeof e!="function"?ie.raiseError("onInstanceStopped requires a single argument of type function"):this.registry.add("instance-stopped",e)}async startApplication(e,t,n){const r=await this.channelsController.all();if(n!=null&&n.channelId&&!r.includes(n.channelId))return ie.raiseError(`The channel with name "${n.channelId}" doesn't exist!`);const s={name:e,waitForAGMReady:(n==null?void 0:n.waitForAGMReady)??!0,context:t,top:n==null?void 0:n.top,left:n==null?void 0:n.left,width:n==null?void 0:n.width,height:n==null?void 0:n.height,relativeTo:n==null?void 0:n.relativeTo,relativeDirection:n==null?void 0:n.relativeDirection,id:n==null?void 0:n.reuseId,forceChromeTab:n==null?void 0:n.forceTab,layoutComponentId:n==null?void 0:n.layoutComponentId,channelId:n==null?void 0:n.channelId},o=await this.bridge.send("appManager",Bn.applicationStart,s),a=this.applications.find(c=>c.name===o.applicationName);return this.ioc.buildInstance(o,a)}getApplication(e){const t=Z(j,e);return this.applications.find(n=>n.name===t)}getInstances(){return this.instances.slice()}toApi(){return{myInstance:this.me,inMemory:{import:this.import.bind(this),remove:this.remove.bind(this),export:this.export.bind(this),clear:this.clear.bind(this)},application:this.getApplication.bind(this),applications:this.getApplications.bind(this),instances:this.getInstances.bind(this),onAppAdded:this.onAppAdded.bind(this),onAppChanged:this.onAppChanged.bind(this),onAppRemoved:this.onAppRemoved.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)}}addOperationsExecutors(){Bn.appDirectoryStateChange.execute=this.handleAppDirectoryStateChange.bind(this),Bn.instanceStarted.execute=this.handleInstanceStartedMessage.bind(this),Bn.instanceStopped.execute=this.handleInstanceStoppedMessage.bind(this)}async handleAppDirectoryStateChange(e){e.appsAdded.forEach(this.handleApplicationAddedMessage.bind(this)),e.appsChanged.forEach(this.handleApplicationChangedMessage.bind(this)),e.appsRemoved.forEach(this.handleApplicationRemovedMessage.bind(this))}onAppAdded(e){return typeof e!="function"?ie.raiseError("onAppAdded requires a single argument of type function"):this.registry.add("application-added",e,this.applications)}onAppRemoved(e){return typeof e!="function"?ie.raiseError("onAppRemoved requires a single argument of type function"):this.registry.add("application-removed",e)}onAppChanged(e){return typeof e!="function"?ie.raiseError("onAppChanged requires a single argument of type function"):this.registry.add("application-changed",e)}async handleApplicationAddedMessage(e){if(this.applications.some(r=>r.name===e.name))return;const t=await this.ioc.buildApplication(e,[]),n=this.instances.filter(r=>r.application.name===t.name);t.instances.push(...n),this.applications.push(t),this.registry.execute("application-added",t)}async handleApplicationRemovedMessage(e){const t=this.applications.findIndex(r=>r.name===e.name);if(t<0)return;const n=this.applications[t];this.applications.splice(t,1),this.registry.execute("application-removed",n)}async handleApplicationChangedMessage(e){const t=this.applications.find(n=>n.name===e.name);if(!t)return this.handleApplicationAddedMessage(e);t.title=e.title,t.version=e.version,t.icon=e.icon,t.caption=e.caption,t.userProperties=e.userProperties,this.registry.execute("application-changed",t)}async handleInstanceStartedMessage(e){if(this.instances.some(r=>r.id===e.id))return;const t=this.applications.find(r=>r.name===e.applicationName);if(!t)return ie.raiseError(`Cannot add instance: ${e.id}, because there is no application definition associated with it`);const n=this.ioc.buildInstance(e,t);this.instances.push(n),t.instances.push(n),this.registry.execute("instance-started",n)}async handleInstanceStoppedMessage(e){const t=this.instances.find(r=>r.id===e.id);if(t){const r=this.instances.findIndex(s=>s.id===e.id);this.instances.splice(r,1)}const n=this.applications.find(r=>r.instances.some(s=>s.id===e.id));if(n){const r=n.instances.findIndex(s=>s.id===e.id);n.instances.splice(r,1)}t&&this.registry.execute("instance-stopped",t)}async import(e,t="replace"){if(Z(Of,t),!Array.isArray(e))return ie.raiseError("Import must be called with an array of definitions");if(e.length>1e4)return ie.raiseError("Cannot import more than 10000 app definitions in Glue42 Core.");const n=e.reduce((s,o)=>{const a=tb.run(o);return a.ok?s.valid.push(o):s.invalid.push({app:o==null?void 0:o.name,error:JSON.stringify(a.error)}),s},{valid:[],invalid:[]}),r=this.baseApplicationsTimeoutMS+this.appImportTimeoutMS*n.valid.length;return await this.bridge.send("appManager",Bn.import,{definitions:n.valid,mode:t},{methodResponseTimeoutMs:r}),{imported:n.valid.map(s=>s.name),errors:n.invalid}}async remove(e){Z(j,e),await this.bridge.send("appManager",Bn.remove,{name:e},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}async clear(){await this.bridge.send("appManager",Bn.clear,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}async export(){return(await this.bridge.send("appManager",Bn.export,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})).definitions}getApplications(){return this.applications.slice()}async joinInitialChannel(e){try{await this.channelsController.join(e)}catch(t){this.logger.warn(`Application instance ${this.me} was unable to join the ${e} channel. Reason: ${JSON.stringify(t)}`)}}async registerWithPlatform(){const e=await this.bridge.send("appManager",Bn.appHello,{windowId:this.publicWindowId},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});this.logger.trace("the platform responded to the hello message with a full list of apps"),this.applications=await Promise.all(e.apps.map(r=>this.ioc.buildApplication(r,r.instances))),this.instances=this.applications.reduce((r,s)=>(r.push(...s.instances),r),[]),this.me=this.findMyInstance(),this.logger.trace(`all applications were parsed and saved. I am ${this.me?"NOT a":"a"} valid instance`);const{channels:t}=this.sessionController.getWindowData(),n=t?t.currentName:e.initialChannelId;n&&await this.joinInitialChannel(n)}findMyInstance(){for(const e of this.applications){const t=e.instances.find(n=>n.id===this.publicWindowId);if(t)return t}}}class F0{constructor(e,t,n){d(this,"data");d(this,"bridge");d(this,"application");d(this,"me");d(this,"myCtxKey");this.data=e,this.bridge=t,this.application=n,this.myCtxKey=`___instance___${this.data.id}`}toApi(){const e=this.bridge.getInteropInstance(this.data.id),t={id:this.data.id,agm:e,application:this.application,stop:this.stop.bind(this),getContext:this.getContext.bind(this)};return this.me=Object.freeze(t),this.me}async getContext(){return this.bridge.contextLib.get(this.myCtxKey)}async stop(){await this.bridge.send("appManager",Bn.instanceStop,{id:this.data.id})}}class L0{constructor(e,t,n){d(this,"data");d(this,"instances");d(this,"controller");d(this,"me");this.data=e,this.instances=t,this.controller=n}toApi(){const e={name:this.data.name,title:this.data.title,version:this.data.version,icon:this.data.icon,caption:this.data.caption,userProperties:this.data.userProperties,instances:this.instances,start:this.start.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return this.me=e,this.me}onInstanceStarted(e){return typeof e!="function"?ie.raiseError("OnInstanceStarted requires a single argument of type function"):this.controller.onInstanceStarted(t=>{t.application.name===this.data.name&&e(t)})}onInstanceStopped(e){return typeof e!="function"?ie.raiseError("OnInstanceStarted requires a single argument of type function"):this.controller.onInstanceStopped(t=>{t.application.name===this.data.name&&e(t)})}async start(e,t){const n=Z(S0,e),r=Z(I0,t);return this.controller.startApplication(this.data.name,n,r)}}const Pe={layoutAdded:{name:"layoutAdded",dataDecoder:dn},layoutChanged:{name:"layoutChanged",dataDecoder:dn},layoutRemoved:{name:"layoutRemoved",dataDecoder:dn},layoutRenamed:{name:"layoutRenamed",dataDecoder:dn},get:{name:"get",dataDecoder:cm,resultDecoder:um},getAll:{name:"getAll",dataDecoder:lm,resultDecoder:kx},export:{name:"export",dataDecoder:lm,resultDecoder:Ix},import:{name:"import",dataDecoder:xx},remove:{name:"remove",dataDecoder:cm},rename:{name:"rename",dataDecoder:bx,resultDecoder:_x},save:{name:"save",dataDecoder:vx,resultDecoder:Tx},restore:{name:"restore",dataDecoder:Sx},clientSaveRequest:{name:"clientSaveRequest",dataDecoder:s0,resultDecoder:o0},getGlobalPermissionState:{name:"getGlobalPermissionState",resultDecoder:a0},requestGlobalPermission:{name:"requestGlobalPermission",resultDecoder:ym},checkGlobalActivated:{name:"checkGlobalActivated",resultDecoder:ym},getDefaultGlobal:{name:"getDefaultGlobal",resultDecoder:um},setDefaultGlobal:{name:"setDefaultGlobal",dataDecoder:Ax},clearDefaultGlobal:{name:"clearDefaultGlobal"},updateMetadata:{name:"updateMetadata",dataDecoder:Cx}};class W0{constructor(){d(this,"defaultLayoutRestoreTimeoutMS",12e4);d(this,"registry",Hi());d(this,"bridge");d(this,"logger");d(this,"windowsController");d(this,"saveRequestSubscription")}handlePlatformShutdown(){this.registry.clear()}async start(e,t){this.logger=e.logger.subLogger("layouts.controller.web"),this.logger.trace("starting the web layouts controller"),this.bridge=t.bridge,this.windowsController=t.windowsController,this.addOperationsExecutors();const n=this.toApi();this.logger.trace("no need for platform registration, attaching the layouts property to glue and returning"),e.layouts=n}async handleBridgeMessage(e){const t=Z(JI,e.operation),n=Pe[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}toApi(){const e={get:this.get.bind(this),getAll:this.getAll.bind(this),export:this.export.bind(this),import:this.import.bind(this),save:this.save.bind(this),restore:this.restore.bind(this),remove:this.remove.bind(this),onAdded:this.onAdded.bind(this),onChanged:this.onChanged.bind(this),onRemoved:this.onRemoved.bind(this),onSaveRequested:this.subscribeOnSaveRequested.bind(this),getMultiScreenPermissionState:this.getGlobalPermissionState.bind(this),requestMultiScreenPermission:this.requestGlobalPermission.bind(this),getGlobalTypeState:this.checkGlobalActivated.bind(this),getDefaultGlobal:this.getDefaultGlobal.bind(this),setDefaultGlobal:this.setDefaultGlobal.bind(this),clearDefaultGlobal:this.clearDefaultGlobal.bind(this),rename:this.rename.bind(this),onRenamed:this.onRenamed.bind(this),updateMetadata:this.updateMetadata.bind(this)};return Object.freeze(e)}addOperationsExecutors(){Pe.layoutAdded.execute=this.handleOnAdded.bind(this),Pe.layoutChanged.execute=this.handleOnChanged.bind(this),Pe.layoutRemoved.execute=this.handleOnRemoved.bind(this),Pe.layoutRenamed.execute=this.handleOnRenamed.bind(this),Pe.clientSaveRequest.execute=this.handleSaveRequest.bind(this)}async get(e,t){return Z(j,e),Z(ir,t),(await this.bridge.send("layouts",Pe.get,{name:e,type:t})).layout}async getAll(e){return Z(ir,e),(await this.bridge.send("layouts",Pe.getAll,{type:e})).summaries}async export(e){return Z(ir,e),(await this.bridge.send("layouts",Pe.export,{type:e})).layouts}async import(e,t="replace"){if(Z(Of,t),!Array.isArray(e))return ie.raiseError("Import must be called with an array of layouts");if(e.length>1e3)return ie.raiseError("Cannot import more than 1000 layouts at once in Glue42 Core.");const n=e.reduce((s,o)=>{const a=dn.run(o);return a.ok?s.valid.push(o):this.logger.warn(`A layout with name: ${o.name} was not imported, because of error: ${JSON.stringify(a.error)}`),s},{valid:[]}),r=e.filter(s=>n.valid.some(o=>o.name===s.name));await this.bridge.send("layouts",Pe.import,{layouts:r,mode:t})}async save(e){return Z(rb,e),(await this.bridge.send("layouts",Pe.save,{layout:e})).layout}async restore(e){Z(sb,e);const t=e.timeout?e.timeout*2:this.defaultLayoutRestoreTimeoutMS;await this.bridge.send("layouts",Pe.restore,{layout:e},{methodResponseTimeoutMs:t})}async remove(e,t){Z(ir,e),Z(j,t),await this.bridge.send("layouts",Pe.remove,{type:e,name:t})}async handleSaveRequest(e){const t={};if(this.saveRequestSubscription)try{const n=this.saveRequestSubscription(e);t.windowContext=n==null?void 0:n.windowContext}catch(n){this.logger.warn(`An error was thrown by the onSaveRequested callback, ignoring the callback: ${JSON.stringify(n)}`)}return t}async getGlobalPermissionState(){return await this.bridge.send("layouts",Pe.getGlobalPermissionState,void 0)}async requestGlobalPermission(){const e=(await this.getGlobalPermissionState()).state;if(e==="denied")return{permissionGranted:!1};if(e==="granted")return{permissionGranted:!0};const t=this.windowsController.my(),r=(window.glue42core||window.iobrowser).isPlatformFrame;return t.name!=="Platform"&&!r?ie.raiseError("Cannot request permission for multi-window placement from any app other than the Platform."):{permissionGranted:(await this.bridge.send("layouts",Pe.requestGlobalPermission,void 0,{methodResponseTimeoutMs:18e4})).isAvailable}}async checkGlobalActivated(){return{activated:(await this.bridge.send("layouts",Pe.checkGlobalActivated,void 0)).isAvailable}}async getDefaultGlobal(){return(await this.bridge.send("layouts",Pe.getDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})).layout}async setDefaultGlobal(e){Z(j,e),await this.bridge.send("layouts",Pe.setDefaultGlobal,{name:e},void 0,{includeOperationCheck:!0})}async clearDefaultGlobal(){await this.bridge.send("layouts",Pe.clearDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})}async rename(e,t){return Z(dn,e),Z(j,t),await this.bridge.send("layouts",Pe.rename,{layout:e,newName:t},void 0,{includeOperationCheck:!0})}async updateMetadata(e){Z(dn,e),await this.bridge.send("layouts",Pe.updateMetadata,{layout:e},void 0,{includeOperationCheck:!0})}onAdded(e){return this.export("Global").then(t=>t.forEach(n=>e(n))).catch(()=>{}),this.export("Workspace").then(t=>t.forEach(n=>e(n))).catch(()=>{}),this.registry.add(Pe.layoutAdded.name,e)}onChanged(e){return this.registry.add(Pe.layoutChanged.name,e)}onRemoved(e){return this.registry.add(Pe.layoutRemoved.name,e)}onRenamed(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to onRenamed, because the provided callback is not a function!"):this.registry.add(Pe.layoutRenamed.name,e)}subscribeOnSaveRequested(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to onSaveRequested, because the provided argument is not a valid callback function."):this.saveRequestSubscription?ie.raiseError("Cannot subscribe to onSaveRequested, because this client has already subscribed and only one subscription is supported. Consider unsubscribing from the initial one."):(this.saveRequestSubscription=e,()=>{delete this.saveRequestSubscription})}async handleOnAdded(e){this.registry.execute(Pe.layoutAdded.name,e)}async handleOnChanged(e){this.registry.execute(Pe.layoutChanged.name,e)}async handleOnRemoved(e){this.registry.execute(Pe.layoutRemoved.name,e)}async handleOnRenamed(e){this.registry.execute(Pe.layoutRenamed.name,e)}}const Qe={raiseNotification:{name:"raiseNotification",dataDecoder:e0,resultDecoder:t0},requestPermission:{name:"requestPermission",resultDecoder:n0},notificationShow:{name:"notificationShow",dataDecoder:gm},notificationClick:{name:"notificationClick",dataDecoder:gm},getPermission:{name:"getPermission",resultDecoder:i0},list:{name:"list",resultDecoder:g0},notificationRaised:{name:"notificationRaised",dataDecoder:f0},notificationClosed:{name:"notificationClosed",dataDecoder:m0},click:{name:"click"},clear:{name:"clear"},clearAll:{name:"clearAll"},clearOld:{name:"clearOld"},configure:{name:"configure",dataDecoder:r0},getConfiguration:{name:"getConfiguration",resultDecoder:mm},configurationChanged:{name:"configurationChanged",resultDecoder:mm},setState:{name:"setState",dataDecoder:fm},activeCountChange:{name:"activeCountChange",resultDecoder:qx},stateChange:{name:"stateChange",resultDecoder:fm}};let B0="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Lf=(i=21)=>{let e="",t=i;for(;t--;)e+=B0[Math.random()*64|0];return e};class H0{constructor(){d(this,"registry",Hi());d(this,"logger");d(this,"bridge");d(this,"notificationsSettings");d(this,"notifications",{});d(this,"coreGlue");d(this,"buildNotificationFunc")}handlePlatformShutdown(){this.notifications={},this.registry.clear()}async start(e,t){this.logger=e.logger.subLogger("notifications.controller.web"),this.logger.trace("starting the web notifications controller"),this.bridge=t.bridge,this.coreGlue=e,this.notificationsSettings=t.config.notifications,this.buildNotificationFunc=t.buildNotification;const n=this.toApi();this.addOperationExecutors(),e.notifications=n,this.logger.trace("notifications are ready")}async handleBridgeMessage(e){const t=Z(KI,e.operation),n=Qe[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}toApi(){const e={raise:this.raise.bind(this),requestPermission:this.requestPermission.bind(this),getPermission:this.getPermission.bind(this),list:this.list.bind(this),onRaised:this.onRaised.bind(this),onClosed:this.onClosed.bind(this),click:this.click.bind(this),clear:this.clear.bind(this),clearAll:this.clearAll.bind(this),clearOld:this.clearOld.bind(this),configure:this.configure.bind(this),getConfiguration:this.getConfiguration.bind(this),getFilter:this.getFilter.bind(this),setFilter:this.setFilter.bind(this),setState:this.setState.bind(this),onConfigurationChanged:this.onConfigurationChanged.bind(this),onActiveCountChanged:this.onActiveCountChanged.bind(this),onStateChanged:this.onStateChanged.bind(this)};return Object.freeze(e)}async getPermission(){return(await this.bridge.send("notifications",Qe.getPermission,void 0)).permission}async requestPermission(){return(await this.bridge.send("notifications",Qe.requestPermission,void 0)).permissionGranted}async raise(e){const t=Z($f,e);if(t.showToast=typeof t.showToast=="boolean"?t.showToast:!0,t.showInPanel=typeof t.showInPanel=="boolean"?t.showInPanel:!0,!await this.requestPermission())return ie.raiseError("Cannot raise the notification, because the user has declined the permission request");const r=Lf(10),s=await this.bridge.send("notifications",Qe.raiseNotification,{settings:t,id:r}),o=this.buildNotificationFunc(s.settings,r);return this.notifications[r]=o,o}async list(){return(await this.bridge.send("notifications",Qe.list,void 0,void 0,{includeOperationCheck:!0})).notifications}onRaised(e){return typeof e!="function"?ie.raiseError("onRaised expects a callback of type function"):this.registry.add("notification-raised",e)}onClosed(e){return typeof e!="function"?ie.raiseError("onClosed expects a callback of type function"):this.registry.add("notification-closed",e)}async click(e,t){Z(j,e),t&&Z(j,t),await this.bridge.send("notifications",Qe.click,{id:e,action:t},void 0,{includeOperationCheck:!0})}async clear(e){Z(j,e),await this.bridge.send("notifications",Qe.clear,{id:e},void 0,{includeOperationCheck:!0})}async clearAll(){await this.bridge.send("notifications",Qe.clearAll,void 0,void 0,{includeOperationCheck:!0})}async clearOld(){await this.bridge.send("notifications",Qe.clearOld,void 0,void 0,{includeOperationCheck:!0})}async configure(e){const t=Z(fb,e);await this.bridge.send("notifications",Qe.configure,{configuration:t},void 0,{includeOperationCheck:!0})}async getConfiguration(){return(await this.bridge.send("notifications",Qe.getConfiguration,void 0,void 0,{includeOperationCheck:!0})).configuration}async getFilter(){return(await this.bridge.send("notifications",Qe.getConfiguration,void 0,void 0,{includeOperationCheck:!0})).configuration.sourceFilter}async setFilter(e){const t=Z(pb,e);return await this.bridge.send("notifications",Qe.configure,{configuration:{sourceFilter:t}},void 0,{includeOperationCheck:!0}),t}async setState(e,t){Z(j,e),Z(Zu,t),await this.bridge.send("notifications",Qe.setState,{id:e,state:t},void 0,{includeOperationCheck:!0})}onConfigurationChanged(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to configuration changed, because the provided callback is not a function!"):this.registry.add("notifications-config-changed",e)}onActiveCountChanged(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to onActiveCountChanged changed, because the provided callback is not a function!"):this.registry.add("notifications-active-count-changed",e)}onStateChanged(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to onStateChanged changed, because the provided callback is not a function!"):this.registry.add("notification-state-changed",e)}addOperationExecutors(){Qe.notificationShow.execute=this.handleNotificationShow.bind(this),Qe.notificationClick.execute=this.handleNotificationClick.bind(this),Qe.notificationRaised.execute=this.handleNotificationRaised.bind(this),Qe.notificationClosed.execute=this.handleNotificationClosed.bind(this),Qe.configurationChanged.execute=this.handleConfigurationChanged.bind(this),Qe.activeCountChange.execute=this.handleActiveCountChanged.bind(this),Qe.stateChange.execute=this.handleNotificationStateChanged.bind(this)}async handleConfigurationChanged(e){this.registry.execute("notifications-config-changed",e.configuration)}async handleActiveCountChanged(e){this.registry.execute("notifications-active-count-changed",e)}async handleNotificationStateChanged(e){this.registry.execute("notification-state-changed",{id:e.id},e.state)}async handleNotificationShow(e){if(!e.id)return;const t=this.notifications[e.id];t&&t.onshow&&t.onshow()}async handleNotificationClick(e){var n,r,s,o,a;if(!e.action&&((n=this.notificationsSettings)!=null&&n.defaultClick)&&this.notificationsSettings.defaultClick(this.coreGlue,e.definition),e.action&&((s=(r=this.notificationsSettings)==null?void 0:r.actionClicks)!=null&&s.some(c=>c.action===e.action))&&((a=(o=this.notificationsSettings)==null?void 0:o.actionClicks)==null?void 0:a.find(l=>l.action===e.action)).handler(this.coreGlue,e.definition),!e.id)return;const t=this.notifications[e.id];t&&t.onclick&&(t.onclick(),delete this.notifications[e.id])}async handleNotificationRaised(e){this.registry.execute("notification-raised",e.notification)}async handleNotificationClosed(e){this.registry.execute("notification-closed",e)}}const Vi={getIntents:{name:"getIntents",resultDecoder:dm},findIntent:{name:"findIntent",dataDecoder:Dx,resultDecoder:dm},raiseIntent:{name:"raiseIntent",dataDecoder:Yu,resultDecoder:hm},raise:{name:"raise",dataDecoder:Fx,resultDecoder:hm},filterHandlers:{name:"filterHandlers",dataDecoder:Wx,resultDecoder:Lx},getIntentsByHandler:{name:"getIntentsByHandler",dataDecoder:hs,resultDecoder:Gx}},G0="Tick42.FDC3.Intents.",z0="T42.Intents.Resolver.Control.",U0="intentsResolver",q0=60*1e3,Im=30*1e3,xm=400,km=440,Tm=2147483647,zd=90*1e3;class V0{constructor(){d(this,"bridge");d(this,"logger");d(this,"interop");d(this,"legacyIntentsController");d(this,"myIntents",new Set);d(this,"prefsController");d(this,"useIntentsResolverUI",!0);d(this,"intentsResolverAppName");d(this,"intentResolverResponseTimeout");d(this,"unregisterIntentPromises",[])}async start(e,t){this.logger=e.logger.subLogger("intents.controller.web"),this.logger.trace("starting the web intents controller"),this.bridge=t.bridge,this.interop=e.interop,this.legacyIntentsController=t.legacyIntentsHelper,this.prefsController=t.prefsController,this.checkIfIntentsResolverIsEnabled(t.config);const n=this.toApi();this.logger.trace("no need for platform registration, attaching the intents property to glue and returning"),e.intents=n}handlePlatformShutdown(){this.myIntents=new Set,this.unregisterIntentPromises=[]}async handleBridgeMessage(e){const t=Z(Ex,e.operation),n=Vi[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}toApi(){return{raise:this.raise.bind(this),all:this.all.bind(this),addIntentListener:this.addIntentListener.bind(this),register:this.register.bind(this),find:this.find.bind(this),filterHandlers:this.filterHandlers.bind(this),getIntents:this.getIntentsByHandler.bind(this),clearSavedHandlers:this.clearSavedHandlers.bind(this)}}async raise(e){const t=Z($x,e),n=typeof t=="string"?{intent:t}:t;await Promise.all(this.unregisterIntentPromises),n.clearSavedHandler&&(this.logger.trace(`User removes saved handler for intent ${n.intent}`),await this.removeRememberedHandler(n.intent));const r=await this.checkHandleRaiseWithRememberedHandler(n);if(r)return r;const s={intentRequest:n,resolverConfig:this.getResolverConfigByRequest({intentRequest:n})},o=await this.isRaiseOperationSupported();if(!o.supported)return this.logger.warn(`${o.reason}. Invoking legacy raise method`),this.legacyIntentsController.raise(s,this.find.bind(this));this.logger.trace(`Sending raise request to the platform: ${JSON.stringify(e)} and method response timeout of ${this.intentResolverResponseTimeout}ms`);const a=n.waitUserResponseIndefinitely?Tm:(n.timeout||this.intentResolverResponseTimeout)+Im;return await this.bridge.send("intents",Vi.raise,s,{methodResponseTimeoutMs:a,waitTimeoutMs:a})}getResolverConfigByRequest(e){var n,r,s,o;if(e.handlerFilter)return{enabled:typeof((n=e.handlerFilter)==null?void 0:n.openResolver)=="boolean"?(r=e.handlerFilter)==null?void 0:r.openResolver:this.useIntentsResolverUI,appName:this.intentsResolverAppName,waitResponseTimeout:((s=e.handlerFilter)==null?void 0:s.timeout)||zd};const t=(o=e.intentRequest)!=null&&o.waitUserResponseIndefinitely?Tm:this.intentResolverResponseTimeout;return{enabled:this.useIntentsResolverUI,appName:this.intentsResolverAppName,waitResponseTimeout:t}}async isRaiseOperationSupported(){try{const{isSupported:e}=await this.bridge.send("intents",Oc.operationCheck,{operation:"raise"});return{supported:e,reason:e?"":'The platform of this client is outdated and does not support "raise" operation'}}catch{return{supported:!1,reason:'The platform of this client is outdated and does not support "operationCheck" command'}}}async all(){return await Promise.all(this.unregisterIntentPromises),(await this.bridge.send("intents",Vi.getIntents,void 0)).intents}addIntentListener(e,t){if(Z(pm,e),typeof t!="function")return ie.raiseError("Cannot add intent listener, because the provided handler is not a function!");let n;const r=typeof e=="string"?e:e.intent,s=this.buildInteropMethodName(r);if(this.myIntents.has(r))return ie.raiseError(`Intent listener for intent ${r} already registered!`);this.myIntents.add(r);const a={unsubscribe:()=>{this.myIntents.delete(r),n.then(()=>this.interop.unregister(s)).catch(l=>this.logger.trace(`Unregistration of a method with name ${s} failed with reason: ${l}`))}};let c={};if(typeof e=="object"){const{intent:l,...u}=e;c=u}return n=this.interop.register({name:s,flags:{intent:c}},l=>{if(this.myIntents.has(r)){const{_initialCallerId:u,...p}=l;return t(p)}}),n.catch(l=>{this.myIntents.delete(r),this.logger.warn(`Registration of a method with name ${s} failed with reason: ${l}`)}),a}async register(e,t){if(Z(pm,e),typeof t!="function")return ie.raiseError("Cannot add intent listener, because the provided handler is not a function!");await Promise.all(this.unregisterIntentPromises);const n=typeof e=="string"?e:e.intent,r=this.buildInteropMethodName(n);if(this.myIntents.has(n))return ie.raiseError(`Intent listener for intent ${n} already registered!`);this.myIntents.add(n);let o={};if(typeof e=="object"){const{intent:a,...c}=e;o=c}try{await this.interop.register({name:r,flags:{intent:o}},a=>{if(this.myIntents.has(n)){const{_initialCallerId:c,...l}=a,u=this.interop.servers().find(p=>p.instance===c);return t(l,u)}})}catch(a){return this.myIntents.delete(n),ie.raiseError(`Registration of a method with name ${r} failed with reason: ${JSON.stringify(a)}`)}return{unsubscribe:()=>this.unsubscribeIntent(n)}}async find(e){let t;if(typeof e<"u"){const r=Z(Ox,e);typeof r=="string"?t={filter:{name:r}}:typeof r=="object"&&(t={filter:r})}return await Promise.all(this.unregisterIntentPromises),(await this.bridge.send("intents",Vi.findIntent,t)).intents}async clearSavedHandlers(){this.logger.trace("Removing all saved handlers from prefs storage for current app"),await this.prefsController.update({intents:void 0})}checkIfIntentsResolverIsEnabled(e){var t,n,r;this.useIntentsResolverUI=typeof((t=e.intents)==null?void 0:t.enableIntentsResolverUI)=="boolean"?e.intents.enableIntentsResolverUI:!0,this.intentsResolverAppName=((n=e.intents)==null?void 0:n.intentsResolverAppName)??U0,this.intentResolverResponseTimeout=((r=e.intents)==null?void 0:r.methodResponseTimeoutMs)??q0}clearUnregistrationPromise(e){this.unregisterIntentPromises=this.unregisterIntentPromises.filter(t=>t!==e)}buildInteropMethodName(e){return`${G0}${e}`}unsubscribeIntent(e){this.myIntents.delete(e);const t=this.buildInteropMethodName(e),n=this.interop.unregister(t);this.unregisterIntentPromises.push(n),n.then(()=>{this.clearUnregistrationPromise(n)}).catch(r=>{this.logger.error(`Unregistration of a method with name ${t} failed with reason: ${r}`),this.clearUnregistrationPromise(n)})}async filterHandlers(e){if(Z(cb,e),this.checkIfAtLeastOneFilterIsPresent(e),e.openResolver&&!this.useIntentsResolverUI)return ie.raiseError("Cannot resolve 'filterHandlers' request using Intents Resolver UI because it's globally disabled");const t=(e.timeout||zd)+Im,n={filterHandlersRequest:e,resolverConfig:this.getResolverConfigByRequest({handlerFilter:e})};return await this.bridge.send("intents",Vi.filterHandlers,n,{methodResponseTimeoutMs:t,waitTimeoutMs:t},{includeOperationCheck:!0})}checkIfAtLeastOneFilterIsPresent(e){const t="Provide at least one filter criteria of the following: 'intent' | 'contextTypes' | 'resultType' | 'applicationNames'";if(!Object.keys(e).length)return ie.raiseError(t);const{intent:n,resultType:r,contextTypes:s,applicationNames:o}=e,a=s==null?void 0:s.length,c=o==null?void 0:o.length;if(!n&&!r&&!a&&!c)return ie.raiseError(t)}async getIntentsByHandler(e){return Z(hs,e),await this.bridge.send("intents",Vi.getIntentsByHandler,e,void 0,{includeOperationCheck:!0})}async removeRememberedHandler(e){var s;this.logger.trace(`Removing saved handler from prefs storage for intent ${e}`);const t=await this.prefsController.get(),n=(s=t.data)==null?void 0:s.intents;if(!n){this.logger.trace("No app prefs found for current app");return}delete n[e];const r={...t.data,intents:n};await this.prefsController.update(r),this.logger.trace(`Handler saved choice for intent ${e} removed successfully`)}async checkForRememberedHandler(e){var r,s;const n=(s=(r=(await this.prefsController.get()).data)==null?void 0:r.intents)==null?void 0:s[e.intent];return n==null?void 0:n.handler}async checkHandleRaiseWithRememberedHandler(e){const t=await this.checkForRememberedHandler(e);if(!t)return;const n={intentRequest:{...e,target:{app:t.applicationName,instance:t.instanceId}},resolverConfig:{enabled:!1,appName:this.intentsResolverAppName,waitResponseTimeout:e.timeout||zd}};try{return await this.bridge.send("intents",Vi.raise,n)}catch{this.logger.trace("Could not raise intent to remembered handler. Removing it from Prefs store"),await this.removeRememberedHandler(e.intent)}}}const Xt={addChannel:{name:"addChannel",dataDecoder:ub},removeChannel:{name:"removeChannel",dataDecoder:Jx},getMyChannel:{name:"getMyChannel",resultDecoder:b0},getWindowIdsOnChannel:{name:"getWindowIdsOnChannel",dataDecoder:y0,resultDecoder:w0},getWindowIdsWithChannels:{name:"getWindowIdsWithChannels",dataDecoder:_0,resultDecoder:C0},joinChannel:{name:"joinChannel",dataDecoder:x0},restrict:{name:"restrict",dataDecoder:Qx},getRestrictions:{name:"getRestrictions",dataDecoder:Yx,resultDecoder:Xx},restrictAll:{name:"restrictAll",dataDecoder:Zx}};class J0{constructor(){d(this,"registry",Hi());d(this,"logger");d(this,"contexts");d(this,"bridge");d(this,"currentChannelName");d(this,"windowsController");d(this,"sessionController");d(this,"unsubscribeFunc");d(this,"GlueWebChannelsPrefix","___channel___");d(this,"SubsKey","subs");d(this,"ChangedKey","changed");d(this,"replaySubscribe",(e,t)=>{this.get(t).then(n=>{if(typeof n.data=="object"&&Object.keys(n.data).length){const r=this.createContextName(n.name);return this.contexts.subscribe(r,(s,o,a,c,l)=>{e(s.data,s,l==null?void 0:l.updaterId)})}}).then(n=>{n&&typeof n=="function"&&n()}).catch(n=>this.logger.trace(n))})}handlePlatformShutdown(){this.registry.clear()}addOperationsExecutors(){Xt.getMyChannel.execute=this.handleGetMyChannel.bind(this),Xt.joinChannel.execute=this.handleJoinChannel.bind(this),Xt.restrict.execute=({config:e})=>this.restrict(e),Xt.getRestrictions.execute=({windowId:e})=>this.getRestrictions(e),Xt.restrictAll.execute=({restrictions:e})=>this.restrictAll(e)}async start(e,t){this.logger=e.logger.subLogger("channels.controller.web"),this.logger.trace("starting the web channels controller"),this.contexts=e.contexts,this.addOperationsExecutors(),this.bridge=t.bridge,this.windowsController=t.windowsController,this.sessionController=t.sessionController,this.logger.trace("no need for platform registration, attaching the channels property to glue and returning");const n=this.toApi();e.channels=n}async handleBridgeMessage(e){const t=Z(v0,e.operation),n=Xt[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}async list(){const e=this.getAllChannelNames();return await Promise.all(e.map(n=>this.get(n)))}my(){return this.current()}async handleGetMyChannel(){const e=this.my();return e?{channel:e}:{}}async join(e,t){const n=this.getAllChannelNames();Z(qr(n),e),Z(om,t),!t||t===this.windowsController.my().id?await this.switchToChannel(e):await this.bridge.send("channels",Xt.joinChannel,{channel:e,windowId:t},void 0,{includeOperationCheck:!0})}handleJoinChannel({channel:e,windowId:t}){return this.join(e,t)}onChanged(e){return this.changed(e)}async leave(){await this.switchToChannel()}toApi(){const e={subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),publish:this.publish.bind(this),all:this.all.bind(this),list:this.list.bind(this),get:this.get.bind(this),join:this.join.bind(this),leave:this.leave.bind(this),current:this.current.bind(this),my:this.my.bind(this),changed:this.changed.bind(this),onChanged:this.onChanged.bind(this),add:this.add.bind(this),remove:this.remove.bind(this),getMy:this.getMy.bind(this),getWindowsOnChannel:this.getWindowsOnChannel.bind(this),getWindowsWithChannels:this.getWindowsWithChannels.bind(this),restrict:this.restrict.bind(this),getRestrictions:this.getRestrictions.bind(this),restrictAll:this.restrictAll.bind(this)};return Object.freeze(e)}createContextName(e){return`${this.GlueWebChannelsPrefix}${e}`}getAllChannelNames(){return this.contexts.all().filter(r=>r.startsWith(this.GlueWebChannelsPrefix)).map(r=>r.replace(this.GlueWebChannelsPrefix,""))}unsubscribe(){this.unsubscribeFunc&&(this.unsubscribeFunc(),this.unsubscribeFunc=void 0)}async switchToChannel(e){if(this.unsubscribe(),this.currentChannelName=e,typeof e<"u"){const t=this.createContextName(e);this.unsubscribeFunc=await this.contexts.subscribe(t,(n,r,s,o,a)=>{this.registry.execute(this.SubsKey,n.data,n,a==null?void 0:a.updaterId)})}this.registry.execute(this.ChangedKey,e),this.sessionController.setWindowData({currentName:e},"channels")}async updateData(e,t){const n=this.createContextName(e),r=this.getFDC3Type(t);if(this.contexts.setPathSupported){const s=Object.keys(t).map(o=>({path:`data.${o}`,value:t[o]}));r&&s.push({path:nm,value:r}),await this.contexts.setPaths(n,s)}else r&&(t[nm]=r),await this.contexts.update(n,{data:t})}getFDC3Type(e){const t=Object.keys(e).filter(n=>n.indexOf("fdc3_")===0);if(t.length!==0)return t.length>1?ie.raiseError("FDC3 does not support updating of multiple context keys"):t[0].split("_").slice(1).join("_")}subscribe(e){if(typeof e!="function")return ie.raiseError("Cannot subscribe to channels, because the provided callback is not a function!");const t=this.current(),n=this.getWrappedSubscribeCallback(e);return t&&this.replaySubscribe(n,t),this.registry.add(this.SubsKey,n)}async subscribeFor(e,t){const n=this.getAllChannelNames();if(Z(qr(n),e),typeof t!="function")return ie.raiseError(`Cannot subscribe to channel ${e}, because the provided callback is not a function!`);const r=this.createContextName(e),s=this.getWrappedSubscribeCallback(t);return this.contexts.subscribe(r,(o,a,c,l,u)=>{s(o.data,o,u==null?void 0:u.updaterId)})}async publish(e,t){if(typeof e!="object")return ie.raiseError("Cannot publish to channel, because the provided data is not an object!");if(Z(zx,t),typeof t=="object")return this.publishWithOptions(e,t);if(typeof t=="string"){const s=this.getAllChannelNames();Z(qr(s),t)}const n=typeof t=="string"?t:this.currentChannelName;return n?this.isAllowedByRestrictions(n,"write")?this.updateData(n,e):ie.raiseError(`Cannot publish on channel ${n} due to restrictions`):ie.raiseError("Cannot publish to channel, because not joined to a channel!")}async all(){return this.getAllChannelNames()}async get(e){const t=this.getAllChannelNames();Z(qr(t),e);const n=this.createContextName(e),r=await this.contexts.get(n);return r.latest_fdc3_type?this.getContextWithFdc3Data(r):r}getContextWithFdc3Data(e){const{latest_fdc3_type:t,...n}=e,s={type:t.split("&").join("."),...n.data[`fdc3_${t}`]};return delete n.data[`fdc3_${t}`],{name:e.name,meta:e.meta,data:{...n.data,fdc3:s}}}current(){return this.currentChannelName}changed(e){return typeof e!="function"?ie.raiseError("Cannot subscribe to channel changed, because the provided callback is not a function!"):this.registry.add(this.ChangedKey,e)}async add(e){const t=Z(ub,e);return this.getAllChannelNames().includes(t.name)?ie.raiseError("There's an already existing channel with such name"):(await this.bridge.send("channels",Xt.addChannel,t),t)}async remove(e){if(Z(j,e),!this.getAllChannelNames().includes(e))return ie.raiseError("There's no channel with such name");await this.bridge.send("channels",Xt.removeChannel,{name:e},void 0,{includeOperationCheck:!0})}async getMy(){if(this.currentChannelName)return this.get(this.currentChannelName)}async getWindowsOnChannel(e){const t=this.getAllChannelNames();Z(qr(t),e);const{windowIds:n}=await this.bridge.send("channels",Xt.getWindowIdsOnChannel,{channel:e},void 0,{includeOperationCheck:!0});return n.reduce((s,o)=>{const a=this.windowsController.findById(o);return a?[...s,a]:s},[])}async getWindowsWithChannels(e){const t=e!==void 0?{filter:Z(wb,e)}:{},{windowIdsWithChannels:n}=await this.bridge.send("channels",Xt.getWindowIdsWithChannels,t,void 0,{includeOperationCheck:!0});return n.reduce((s,{application:o,channel:a,windowId:c})=>{const l=this.windowsController.findById(c);return l?[...s,{application:o,channel:a,window:l}]:s},[])}async restrict(e){Z(db,e);const t=this.getAllChannelNames();if(Z(qr(t),e.name),e.windowId&&e.windowId!==this.windowsController.my().id)return this.bridge.send("channels",Xt.restrict,{config:e},void 0,{includeOperationCheck:!0});const r=this.sessionController.getWindowData(),s=r!=null&&r.restrictions?{...r.restrictions,[e.name]:e}:{[e.name]:e},o=await this.getMy(),a=this.checkPreviousReadAllowed(o==null?void 0:o.name);this.sessionController.setWindowData(s,"restrictions"),!(!o||a||!e.read||o.name!==e.name)&&this.replaySubscribeCallback(e.name)}async getRestrictions(e){return Z(om,e),!e||e===this.windowsController.my().id?this.getMyRestrictions():this.bridge.send("channels",Xt.getRestrictions,{windowId:e},void 0,{includeOperationCheck:!0})}async restrictAll(e){Z(hb,e);const t=this.getAllChannelNames();if(e.windowId&&e.windowId!==this.windowsController.my().id)return this.bridge.send("channels",Xt.restrictAll,{restrictions:e},void 0,{includeOperationCheck:!0});const r={};t.forEach(a=>{r[a]={...e,name:a}});const s=await this.getMy(),o=this.checkPreviousReadAllowed(s==null?void 0:s.name);this.sessionController.setWindowData(r,"restrictions"),!(!s||o||!e.read)&&this.replaySubscribeCallback(s.name)}isAllowedByRestrictions(e,t){const{channels:n}=this.getMyRestrictions();if(!(n!=null&&n.length))return!0;const r=n.find(s=>s.name===e);return r?r[t]:!0}getMyRestrictions(){const e=this.sessionController.getWindowData();return{channels:Object.values((e==null?void 0:e.restrictions)||{})}}replaySubscribeCallback(e){const t=this.createContextName(e);this.contexts.subscribe(t,(n,r,s,o,a)=>{this.registry.execute(this.SubsKey,n.data,n,a==null?void 0:a.updaterId)}).then(n=>{n&&typeof n=="function"&&n()}).catch(n=>this.logger.error(n))}checkPreviousReadAllowed(e){if(!e)return!0;const t=this.sessionController.getWindowData().restrictions;return t!=null&&t[e]?t[e].read:!0}async publishWithOptions(e,t){if(t.name){const s=this.getAllChannelNames();Z(qr(s),t.name)}const n=t.name||this.currentChannelName;return n?this.isAllowedByRestrictions(n,"write")?t.fdc3?this.publishFdc3Data(n,e):this.updateData(n,e):ie.raiseError(`Cannot publish on channel ${n} due to restrictions`):ie.raiseError("Cannot publish to channel, because not joined to a channel!")}async publishFdc3Data(e,t){Z(Ux,t);const{type:n,...r}=t,o={[`fdc3_${n.split(".").join("&")}`]:r};return this.updateData(e,o)}getWrappedSubscribeCallback(e){return(n,r,s)=>{if(!this.isAllowedByRestrictions(r.name,"read"))return;const{data:a,latest_fdc3_type:c}=r;if(!c){e(n,r,s);return}const l=c.split("&").join("."),u=`fdc3_${c}`,p={type:l,...a[u]},{[u]:f,...w}=n;e({...w,fdc3:p},r,s)}}}const ms={getEnvironment:{name:"getEnvironment",resultDecoder:yu},getBase:{name:"getBase",resultDecoder:yu},platformShutdown:{name:"platformShutdown"},isFdc3DataWrappingSupported:{name:"isFdc3DataWrappingSupported"},clientError:{name:"clientError",dataDecoder:P0}};class K0{constructor(){d(this,"bridge");d(this,"ioc");d(this,"errorPort",Gv.port2)}async start(e,t){this.bridge=t.bridge,this.ioc=t,this.addOperationsExecutors(),this.errorPort.onmessage=async n=>{await this.bridge.send("system",ms.clientError,{message:n.data},void 0,{includeOperationCheck:!0})},await this.setEnvironment()}async handleBridgeMessage(e){const t=Z(QI,e.operation),n=ms[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}async processPlatformShutdown(){Object.values(this.ioc.controllers).forEach(e=>e.handlePlatformShutdown?e.handlePlatformShutdown():null),this.ioc.preferredConnectionController.stop(),this.ioc.eventsDispatcher.stop(),await this.bridge.stop()}async setEnvironment(){const e=await this.bridge.send("system",ms.getEnvironment,void 0),t=await this.bridge.send("system",ms.getBase,void 0),n=window.glue42core||window.iobrowser,r=window.glue42core?"glue42core":"iobrowser",s=Object.assign({},n,t,{environment:e});window[r]=Object.freeze(s)}addOperationsExecutors(){ms.platformShutdown.execute=this.processPlatformShutdown.bind(this),ms.isFdc3DataWrappingSupported.execute=this.handleIsFdc3DataWrappingSupported.bind(this)}async handleIsFdc3DataWrappingSupported(){return{isSupported:!0}}}class Q0{constructor(e,t){d(this,"onclick",()=>{});d(this,"onshow",()=>{});d(this,"id");d(this,"title");d(this,"badge");d(this,"body");d(this,"data");d(this,"dir");d(this,"icon");d(this,"image");d(this,"lang");d(this,"renotify");d(this,"requireInteraction");d(this,"silent");d(this,"tag");d(this,"timestamp");d(this,"vibrate");d(this,"clickInterop");d(this,"actions");d(this,"focusPlatformOnDefaultClick");d(this,"severity");d(this,"showToast");d(this,"showInPanel");d(this,"state");this.id=t,this.badge=e.badge,this.body=e.body,this.data=e.data,this.dir=e.dir,this.icon=e.icon,this.image=e.image,this.lang=e.lang,this.renotify=e.renotify,this.requireInteraction=e.requireInteraction,this.silent=e.silent,this.tag=e.tag,this.timestamp=e.timestamp,this.vibrate=e.vibrate,this.title=e.title,this.clickInterop=e.clickInterop,this.actions=e.actions,this.focusPlatformOnDefaultClick=e.focusPlatformOnDefaultClick,this.severity=e.severity,this.showToast=e.showToast,this.showInPanel=e.showInPanel,this.state=e.state}}be(F("clientHello"));const X0=W({widget:W({inject:ue()})}),Y0={clientHello:{name:"clientHello",resultDecoder:X0}};class Z0{constructor(){d(this,"windowId");d(this,"logger");d(this,"bridge");d(this,"eventsDispatcher");d(this,"channelsController");d(this,"config");d(this,"channels",[]);d(this,"unsubFuncs",[]);d(this,"contentCommands",{widgetVisualizationPermission:{name:"widgetVisualizationPermission",handle:this.handleWidgetVisualizationPermission.bind(this)},changeChannel:{name:"changeChannel",handle:this.handleChangeChannel.bind(this)}})}handlePlatformShutdown(){this.unsubFuncs.forEach(e=>e()),this.channels=[],this.unsubFuncs=[]}async start(e,t){this.logger=e.logger.subLogger("extension.controller.web"),this.windowId=t.publicWindowId,this.logger.trace("starting the extension web controller"),this.bridge=t.bridge,this.channelsController=t.channelsController,this.eventsDispatcher=t.eventsDispatcher;try{await this.registerWithPlatform()}catch{return}this.channels=await this.channelsController.list();const n=this.eventsDispatcher.onContentMessage(this.handleContentMessage.bind(this)),r=this.channelsController.onChanged(s=>{this.eventsDispatcher.sendContentMessage({command:"channelChange",newChannel:s})});this.unsubFuncs.push(n),this.unsubFuncs.push(r)}async handleBridgeMessage(e){}handleContentMessage(e){if(!e||typeof e.command!="string")return;const t=this.contentCommands[e.command];t&&t.handle(e)}async registerWithPlatform(){this.logger.trace("registering with the platform"),this.config=await this.bridge.send("extension",Y0.clientHello,{windowId:this.windowId}),this.logger.trace("the platform responded to the hello message with a valid extension config")}async handleWidgetVisualizationPermission(){var t;if(!((t=this.config)!=null&&t.widget.inject))return this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!1});const e=this.channels.find(n=>n.name===this.channelsController.my());this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!0,channels:this.channels,currentChannel:e})}async handleChangeChannel(e){if(e.name==="no-channel"){await this.channelsController.leave();return}await this.channelsController.join(e.name)}}let ek=class{constructor(e){d(this,"config");d(this,"glue");d(this,"registry",Hi());d(this,"glue42EventName","Glue42");d(this,"_handleMessage");d(this,"events",{notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},contentInc:{name:"contentInc",handle:this.handleContentInc.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)}});this.config=e}stop(){window.removeEventListener(this.glue42EventName,this._handleMessage)}start(e){this.glue=e,this.wireCustomEventListener(),this.announceStarted()}sendContentMessage(e){this.send("contentOut","glue42core",e)}onContentMessage(e){return this.registry.add("content-inc",e)}wireCustomEventListener(){this._handleMessage=this.handleMessage.bind(this),window.addEventListener(this.glue42EventName,this._handleMessage)}handleMessage(e){const t=e.detail,n=(t==null?void 0:t.glue42)??(t==null?void 0:t.glue42core);if(!n)return;const r=n.event,s=this.events[r];s&&s.handle(n.message)}announceStarted(){this.send("start","glue42")}handleRequestGlue(){if(!this.config.exposeAPI){this.send("requestGlueResponse","glue42",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."});return}this.send("requestGlueResponse","glue42",{glue:this.glue})}handleNotifyStarted(){this.announceStarted()}handleContentInc(e){this.registry.execute("content-inc",e)}send(e,t,n){const r={};r[t]={event:e,message:n};const s=new CustomEvent(this.glue42EventName,{detail:r});window.dispatchEvent(s)}};class tk{constructor(e){d(this,"coreGlue");d(this,"transactionTimeout",15e3);d(this,"transactionLocks",{});d(this,"webPlatformTransport");d(this,"webPlatformMessagesUnsubscribe");d(this,"reconnectCounter",0);d(this,"logger");this.coreGlue=e,this.logger=this.coreGlue.logger.subLogger("web.preferred.connection.controller")}stop(){this.webPlatformMessagesUnsubscribe&&this.webPlatformMessagesUnsubscribe()}async start(e){if(e.isPlatformInternal){this.logger.trace("This is an internal client to the platform, skipping all client preferred communication logic.");return}if(!(this.coreGlue.connection.transport.name()===tm))return ie.raiseError("Cannot initiate the Glue Web Bridge, because the initial connection was not handled by a Web Platform transport.");if(!this.coreGlue.connection.transport.isPreferredActivated){this.logger.trace("The platform of this client was configured without a preferred connection, skipping the rest of the initialization.");return}this.webPlatformTransport=this.coreGlue.connection.transport,this.webPlatformMessagesUnsubscribe=this.webPlatformTransport.onMessage(this.handleWebPlatformMessage.bind(this));const n=await this.getCurrentPlatformTransportState();await this.checkSwitchTransport(n)}handleWebPlatformMessage(e){if(typeof e=="string")return;const t=this.coreGlue.connection.transport.name()===tm,n=e.type,r=e.args,s=e.transactionId;if(n===wn.transportSwitchRequest.name)return this.handleTransportSwitchRequest(r,s);if(n===wn.platformUnload.name&&!t)return this.handlePlatformUnload();if(n===wn.getCurrentTransportResponse.name)return this.handleGetCurrentTransportResponse(r,s);if(n===wn.checkPreferredLogic.name)return this.handleCheckPreferredLogic(s);if(n===wn.checkPreferredConnection.name)return this.handleCheckPreferredConnection(r,s)}async reEstablishPlatformPort(){try{await this.webPlatformTransport.connect()}catch(t){if(this.logger.trace(`Error when re-establishing port connection to the platform: ${JSON.stringify(t)}`),--this.reconnectCounter,this.reconnectCounter>0)return this.reEstablishPlatformPort();this.logger.warn("This client lost connection to the platform while connected to a preferred GW and was not able to re-connect to the platform.")}this.logger.trace("The connection to the platform was re-established, closing the connection to the web gateway."),this.reconnectCounter=0,this.webPlatformTransport.close();const e=await this.getCurrentPlatformTransportState();await this.checkSwitchTransport(e)}async checkSwitchTransport(e){const t=this.coreGlue.connection.transport.name();if(t===e.transportName){this.logger.trace("A check switch was requested, but the platform transport and my transport are identical, no switch is necessary");return}this.logger.trace(`A check switch was requested and a transport switch is necessary, because this client is now on ${t}, but it should reconnect to ${JSON.stringify(e)}`);const n=await this.coreGlue.connection.switchTransport(e);this.setConnected(),this.logger.trace(`The transport switch was completed with result: ${JSON.stringify(n)}`)}async getCurrentPlatformTransportState(){this.logger.trace("Requesting the current transport state of the platform.");const e=this.setTransaction(wn.getCurrentTransport.name);this.sendPlatformMessage(wn.getCurrentTransport.name,e.id);const t=await e.lock;return this.logger.trace(`The platform responded with transport state: ${JSON.stringify(t)}`),t}setTransaction(e){const t={},n=Lf(10),r=new Promise((s,o)=>{let a=!0;t.lift=c=>{a=!1,delete this.transactionLocks[n],s(c)},t.fail=c=>{a=!1,delete this.transactionLocks[n],o(c)},setTimeout(()=>{a&&(a=!1,this.logger.warn(`Transaction for operation: ${e} timed out.`),delete this.transactionLocks[n],o(`Transaction for operation: ${e} timed out.`))},this.transactionTimeout)});return t.lock=r,t.id=n,this.transactionLocks[n]=t,t}sendPlatformMessage(e,t,n){this.logger.trace(`Sending a platform message of type: ${e}, id: ${t} and args: ${JSON.stringify(n)}`),this.webPlatformTransport.sendObject({glue42core:{type:e,args:n,transactionId:t}})}handleTransportSwitchRequest(e,t){this.logger.trace(`Received a transport switch request with id: ${t} and data: ${JSON.stringify(e)}`),this.coreGlue.connection.switchTransport(e.switchSettings).then(n=>{this.logger.trace(`The transport switch was completed with result: ${JSON.stringify(n)}`),this.setConnected(),this.sendPlatformMessage(wn.transportSwitchResponse.name,t,{success:n.success})}).catch(n=>{this.logger.error(n),this.sendPlatformMessage(wn.transportSwitchResponse.name,t,{success:!1})})}handlePlatformUnload(){this.reconnectCounter=5,this.logger.trace("The platform was unloaded while I am connected to a preferred connection, re-establishing the port connection."),this.reEstablishPlatformPort()}handleGetCurrentTransportResponse(e,t){this.logger.trace(`Got a current transport response from the platform with id: ${t} and data: ${JSON.stringify(e)}`);const n=e.transportState,r=this.transactionLocks[t];r==null||r.lift(n)}handleCheckPreferredLogic(e){setTimeout(()=>this.sendPlatformMessage(wn.checkPreferredLogicResponse.name,e),0)}handleCheckPreferredConnection(e,t){const n=e.url;this.logger.trace(`Testing the possible connection to: ${n}`),this.checkPreferredConnection(n).then(r=>{this.logger.trace(`The connection to ${n} is possible`),this.sendPlatformMessage(wn.checkPreferredConnectionResponse.name,t,r)}).catch(r=>{this.logger.trace(`The connection to ${n} is not possible`),this.sendPlatformMessage(wn.checkPreferredConnectionResponse.name,t,{error:r})})}checkPreferredConnection(e){return new Promise(t=>{const n=new WebSocket(e);n.onerror=()=>t({live:!1}),n.onopen=()=>{n.close(),t({live:!0})}})}setConnected(){this.webPlatformTransport.manualSetReadyState()}}class nk{constructor(e,t,n,r,s){d(this,"bridge");d(this,"interop");d(this,"appManagerController");d(this,"windowsController");d(this,"logger");d(this,"intentsResolverResponsePromises",{});this.bridge=t,this.interop=n,this.appManagerController=r,this.windowsController=s,this.logger=this.configureLogger(e)}async raise(e,t){var l;const{intentRequest:n,resolverConfig:r}=e,s=(await t(n.intent)).find(u=>u.name===n.intent);if(!s)return ie.raiseError(`Intent with name ${n.intent} not found`);const{open:o,reason:a}=this.checkIfResolverShouldBeOpened(s,n,r);return o?await this.raiseIntentWithResolverApp(e):((l=this.logger)==null||l.trace(`Intent Resolver UI won't be used. Reason: ${a}`),this.invokeRaiseIntent(n))}configureLogger(e){return e.subLogger("intents.legacy.helper.web")}async raiseIntentWithResolverApp(e){const{intentRequest:t,resolverConfig:n}=e;this.logger.trace(`Intents Resolver UI with app name ${n.appName} will be used`);const r=await this.registerResponseMethod();this.logger.trace(`Registered interop method ${r}`);const s=await this.openIntentResolverApplication(e,r);this.logger.trace(`Intents Resolver Instance with id ${s.id} opened`);const o=await this.handleInstanceResponse(s.id),a=o.type==="app"?{app:o.applicationName}:{instance:o.instanceId};return this.logger.trace(`Intent handler chosen by the user: ${JSON.stringify(a)}`),await this.invokeRaiseIntent({...t,target:a})}async handleInstanceResponse(e){var t;try{const{handler:n,intent:r}=await this.intentsResolverResponsePromises[e].promise;return(t=this.logger)==null||t.trace(`Intent handler chosen for intent ${r}: ${JSON.stringify(n)}`),this.stopResolverInstance(e),n}catch(n){return this.stopResolverInstance(e),ie.raiseError(n)}}invokeRaiseIntent(e){return this.bridge.send("intents",Vi.raiseIntent,e)}async registerResponseMethod(){const e=z0+Lf(10);return await this.interop.register(e,this.resolverResponseHandler.bind(this)),e}async openIntentResolverApplication(e,t){const{intentRequest:n,resolverConfig:r}=e,s=this.buildStartContext(n,t),o=await this.buildStartOptions();this.logger.trace(`Starting Intents Resolver UI with context: ${JSON.stringify(s)} and options: ${o}`);const a=await this.appManagerController.getApplication(r.appName).start(s,o);return this.logger.trace(`Intents Resolver instance with id ${a.id} opened`),this.subscribeOnInstanceStopped(a),this.createResponsePromise(n.intent,a.id,t,r.waitResponseTimeout),a}async cleanUpIntentResolverPromise(e){const t=this.intentsResolverResponsePromises[e];if(!t)return;this.interop.unregister(t.methodName).catch(r=>this.logger.warn(r)),delete this.intentsResolverResponsePromises[e]}buildStartContext(e,t){return{intent:e,callerId:this.interop.instance.instance,methodName:t}}async buildStartOptions(){const e=await this.getTargetBounds();return{top:(e.height-km)/2+e.top,left:(e.width-xm)/2+e.left,width:xm,height:km}}async getTargetBounds(){const e=await this.tryGetWindowBasedBounds()||await this.tryGetWorkspaceBasedBounds();if(e)return this.logger.trace(`Opening Intents Resolver UI with bounds: ${JSON.stringify(e)}`),e;const t={top:window.screen.availTop||0,left:window.screen.availLeft||0,width:window.screen.width,height:window.screen.height};return this.logger.trace(`Opening Intents Resolver UI relative to my screen bounds: ${JSON.stringify(t)}`),t}async tryGetWindowBasedBounds(){try{const e=await this.windowsController.my().getBounds();return this.logger.trace(`Opening the resolver UI relative to my window bounds: ${JSON.stringify(e)}`),e}catch(e){this.logger.trace(`Failure to get my window bounds: ${JSON.stringify(e)}`)}}async tryGetWorkspaceBasedBounds(){try{await this.bridge.send("workspaces",Oc.operationCheck,{operation:"getWorkspaceWindowFrameBounds"});const t=(await this.bridge.send("workspaces",Oc.getWorkspaceWindowFrameBounds,{itemId:this.windowsController.my().id})).bounds;return this.logger.trace(`Opening the resolver UI relative to my workspace frame window bounds: ${JSON.stringify(t)}`),t}catch(e){this.logger.trace(`Failure to get my workspace frame window bounds: ${JSON.stringify(e)}`)}}subscribeOnInstanceStopped(e){const{application:t}=e,n=t.onInstanceStopped(r=>{if(r.id!==e.id)return;const s=this.intentsResolverResponsePromises[r.id];if(!s)return n();s.reject(`Cannot resolve raised intent "${s.intent}" - User closed ${t.name} app without choosing an intent handler`),this.cleanUpIntentResolverPromise(r.id),n()})}createResponsePromise(e,t,n,r){let s=()=>{},o=()=>{};const a=Ff((c,l)=>{s=c,o=l},r,`Timeout of ${r}ms hit waiting for the user to choose a handler for intent ${e}`);this.intentsResolverResponsePromises[t]={intent:e,resolve:s,reject:o,promise:a,methodName:n}}resolverResponseHandler(e,t){const n=Px.run(e),r=t.instance;if(n.ok)return this.logger.trace(`Intent Resolver instance with id ${r} send a valid response: ${JSON.stringify(n.result)}`),this.intentsResolverResponsePromises[r].resolve(n.result);this.logger.trace(`Intent Resolver instance with id ${r} sent an invalid response. Error: ${JSON.stringify(n.error)}`),this.intentsResolverResponsePromises[r].reject(n.error.message),this.stopResolverInstance(r)}stopResolverInstance(e){const t=this.appManagerController.getInstances().find(n=>n.id===e);t&&t.stop().catch(n=>this.logger.error(n))}checkIfIntentHasMoreThanOneHandler(e,t){return typeof t.target=="object"?!1:t.handlers?t.handlers.length>1:e.handlers.length>1}checkIfResolverShouldBeOpened(e,t,n){return n.enabled?this.appManagerController.getApplication(n.appName)?this.checkIfIntentHasMoreThanOneHandler(e,t)?{open:!0}:{open:!1,reason:"Raised intent has only one handler"}:{open:!1,reason:`Application with name ${n.appName} not found`}:{open:!1,reason:"Intent Resolver is disabled. Raising intent to first found handler"}}}const Ud={getCurrent:{name:"getCurrent",resultDecoder:mb},list:{name:"list",resultDecoder:h0},select:{name:"select",dataDecoder:p0}};class ik{constructor(){d(this,"logger");d(this,"bridge");d(this,"registry",Hi());d(this,"themesSubscription");d(this,"activeThemeSubs",0)}async start(e,t){this.logger=e.logger.subLogger("themes.controller.web"),this.logger.trace("starting the web themes controller"),this.bridge=t.bridge;const n=this.toApi();e.themes=n,this.logger.trace("themes are ready")}handlePlatformShutdown(){var e;this.registry.clear(),this.activeThemeSubs=0,(e=this.themesSubscription)==null||e.close(),delete this.themesSubscription}async handleBridgeMessage(){}toApi(){const e={getCurrent:this.getCurrent.bind(this),list:this.list.bind(this),select:this.select.bind(this),onChanged:this.onChanged.bind(this)};return Object.freeze(e)}async getCurrent(){return(await this.bridge.send("themes",Ud.getCurrent,void 0,void 0,{includeOperationCheck:!0})).theme}async list(){return(await this.bridge.send("themes",Ud.list,void 0,void 0,{includeOperationCheck:!0})).themes}async select(e){Z(j,e),await this.bridge.send("themes",Ud.select,{name:e},void 0,{includeOperationCheck:!0})}async onChanged(e){if(typeof e!="function")return ie.raiseError("onChanged requires a callback of type function");await(this.themesSubscription?Promise.resolve():this.configureThemeSubscription()),++this.activeThemeSubs;const n=this.registry.add("on-theme-change",e);return()=>this.themeUnsub(n)}async configureThemeSubscription(){this.themesSubscription||(this.themesSubscription=await this.bridge.createNotificationsSteam(),this.themesSubscription.onData(e=>{const t=e.data,n=mb.run(t);if(!n.ok){this.logger.warn(`Received invalid theme data on the theme event stream: ${JSON.stringify(n.error)}`);return}const r=n.result;this.registry.execute("on-theme-change",r.theme)}),this.themesSubscription.onClosed(()=>{this.logger.warn("The Themes interop stream was closed, no theme changes notifications will be received"),this.registry.clear(),this.activeThemeSubs=0,delete this.themesSubscription}))}themeUnsub(e){var t;e(),--this.activeThemeSubs,!this.activeThemeSubs&&((t=this.themesSubscription)==null||t.close(),delete this.themesSubscription)}}class rk{constructor(){d(this,"sessionStorage",window.sessionStorage);d(this,"windowId")}get allNamespaces(){return[{namespace:this.windowNamespace,defaultValue:{}}]}configure(e){this.windowId=e.windowId,this.allNamespaces.forEach(({namespace:t,defaultValue:n})=>{this.sessionStorage.getItem(t)||this.sessionStorage.setItem(t,JSON.stringify(n))})}get windowNamespace(){return`io_connect_window_${this.windowId}`}getWindowData(){return JSON.parse(this.sessionStorage.getItem(this.windowNamespace))}setWindowData(e,t){const n=this.getWindowData();n[t]=e,this.sessionStorage.setItem(this.windowNamespace,JSON.stringify(n))}}const Ii={clear:{name:"clear",dataDecoder:wu},clearAll:{name:"clearAll"},get:{name:"get",dataDecoder:wu,resultDecoder:wm},getAll:{name:"getAll",resultDecoder:A0},set:{name:"set",dataDecoder:vm},update:{name:"update",dataDecoder:vm},prefsChanged:{name:"prefsChanged",dataDecoder:wm},prefsHello:{name:"prefsHello",resultDecoder:E0}};class sk{constructor(){d(this,"bridge");d(this,"config");d(this,"logger");d(this,"appManagerController");d(this,"platformAppName");d(this,"registry",Hi())}handlePlatformShutdown(){this.registry.clear()}async start(e,t){this.logger=e.logger.subLogger("prefs.controller.web"),this.logger.trace("starting the web prefs controller"),this.addOperationsExecutors(),this.bridge=t.bridge,this.config=t.config,this.appManagerController=t.appManagerController;try{const r=await this.bridge.send("prefs",Ii.prefsHello,void 0,void 0,{includeOperationCheck:!0});this.platformAppName=r.platform.app}catch{this.logger.warn("The platform of this client is outdated and does not support Prefs API.");return}this.logger.trace("no need for platform registration, attaching the prefs property to glue and returning");const n=this.toApi();e.prefs=n}async handleBridgeMessage(e){const t=Z(T0,e.operation),n=Ii[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=Z(n.dataDecoder,e.data)),await n.execute(r)}async get(e){const t=e==null?this.getMyAppName():j.runWithException(e),{prefs:n}=await this.bridge.send("prefs",Ii.get,{app:t},void 0,{includeOperationCheck:!0});return n}async update(e,t){const n=k(wu).runWithException(t),r=(n==null?void 0:n.app)??this.getMyAppName();await this.updateFor(r,e)}addOperationsExecutors(){Ii.prefsChanged.execute=this.handleOnChanged.bind(this)}toApi(){return{clear:this.clear.bind(this),clearAll:this.clearAll.bind(this),clearFor:this.clearFor.bind(this),get:this.get.bind(this),getAll:this.getAll.bind(this),set:this.set.bind(this),setFor:this.setFor.bind(this),subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),update:this.update.bind(this),updateFor:this.updateFor.bind(this)}}async clear(){const e=this.getMyAppName();await this.clearFor(e)}async clearAll(){await this.bridge.send("prefs",Ii.clearAll,void 0,void 0,{includeOperationCheck:!0})}async clearFor(e){const t=Z(j,e);await this.bridge.send("prefs",Ii.clear,{app:t},void 0,{includeOperationCheck:!0})}async getAll(){return await this.bridge.send("prefs",Ii.getAll,void 0,void 0,{includeOperationCheck:!0})}async set(e,t){const n=Z(k(wu),t),r=(n==null?void 0:n.app)??this.getMyAppName();await this.setFor(r,e)}async setFor(e,t){const n=Z(j,e),r=Z(W(),t);await this.bridge.send("prefs",Ii.set,{app:n,data:r},void 0,{includeOperationCheck:!0})}subscribe(e){const t=this.getMyAppName();return this.subscribeFor(t,e)}subscribeFor(e,t){const n=Z(j,e),r=this.appManagerController.getApplications();if(!(n===this.platformAppName||r.some(a=>a.name===n)))return ie.raiseError(`The provided app name "${e}" is not valid.`);if(typeof t!="function")return ie.raiseError("Cannot subscribe to prefs, because the provided callback is not a function!");const o=this.getSubscriptionKey(n);return this.get(n).then(t),this.registry.add(o,t)}async updateFor(e,t){const n=Z(j,e),r=Z(W(),t);await this.bridge.send("prefs",Ii.update,{app:n,data:r},void 0,{includeOperationCheck:!0})}getMyAppName(){var t;const e=this.config.isPlatformInternal?this.platformAppName:(t=this.appManagerController.me)==null?void 0:t.application.name;return e||ie.raiseError("App Preferences operations can not be executed for windows that do not have app!")}getSubscriptionKey(e){return`prefs-changed-${e}`}async handleOnChanged({prefs:e}){const t=this.getSubscriptionKey(e.app);this.registry.execute(t,e)}}class ok{constructor(){d(this,"_coreGlue");d(this,"_communicationId");d(this,"_publicWindowId");d(this,"_webConfig");d(this,"_windowsControllerInstance");d(this,"_appManagerControllerInstance");d(this,"_layoutsControllerInstance");d(this,"_notificationsControllerInstance");d(this,"_intentsControllerInstance");d(this,"_legacyIntentsHelperInstance");d(this,"_channelsControllerInstance");d(this,"_themesControllerInstance");d(this,"_extensionController");d(this,"_systemControllerInstance");d(this,"_bridgeInstance");d(this,"_eventsDispatcher");d(this,"_preferredConnectionController");d(this,"_sessionController");d(this,"_prefsControllerInstance");d(this,"controllers",{windows:this.windowsController,appManager:this.appManagerController,layouts:this.layoutsController,notifications:this.notificationsController,intents:this.intentsController,channels:this.channelsController,system:this.systemController,extension:this.extensionController,themes:this.themesController,prefs:this.prefsController})}get communicationId(){return this._communicationId}get publicWindowId(){return this._publicWindowId}get windowsController(){return this._windowsControllerInstance||(this._windowsControllerInstance=new O0),this._windowsControllerInstance}get appManagerController(){return this._appManagerControllerInstance||(this._appManagerControllerInstance=new $0),this._appManagerControllerInstance}get layoutsController(){return this._layoutsControllerInstance||(this._layoutsControllerInstance=new W0),this._layoutsControllerInstance}get themesController(){return this._themesControllerInstance||(this._themesControllerInstance=new ik),this._themesControllerInstance}get notificationsController(){return this._notificationsControllerInstance||(this._notificationsControllerInstance=new H0),this._notificationsControllerInstance}get intentsController(){return this._intentsControllerInstance||(this._intentsControllerInstance=new V0),this._intentsControllerInstance}get legacyIntentsHelper(){return this._legacyIntentsHelperInstance||(this._legacyIntentsHelperInstance=new nk(this._coreGlue.logger,this.bridge,this._coreGlue.interop,this.appManagerController,this.windowsController)),this._legacyIntentsHelperInstance}get systemController(){return this._systemControllerInstance||(this._systemControllerInstance=new K0),this._systemControllerInstance}get channelsController(){return this._channelsControllerInstance||(this._channelsControllerInstance=new J0),this._channelsControllerInstance}get prefsController(){return this._prefsControllerInstance||(this._prefsControllerInstance=new sk),this._prefsControllerInstance}get extensionController(){return this._extensionController||(this._extensionController=new Z0),this._extensionController}get eventsDispatcher(){return this._eventsDispatcher||(this._eventsDispatcher=new ek(this.config)),this._eventsDispatcher}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new D0(this._coreGlue,this.communicationId)),this._bridgeInstance}get preferredConnectionController(){return this._preferredConnectionController||(this._preferredConnectionController=new tk(this._coreGlue)),this._preferredConnectionController}get sessionController(){return this._sessionController||(this._sessionController=new rk),this._sessionController}get config(){return this._webConfig}defineGlue(e){this._coreGlue=e,this._publicWindowId=e.connection.transport.publicWindowId;const t=window.glue42core||window.iobrowser;this._communicationId=e.connection.transport.communicationId||t.communicationId}defineConfig(e){this._webConfig=e}async buildWebWindow(e,t){const n=new M0(e,t,this.bridge),r=await n.toApi();return{id:e,model:n,api:r}}buildNotification(e,t){return new Q0(e,t)}async buildApplication(e,t){const n=new L0(e,[],this.appManagerController).toApi(),r=t.map(s=>this.buildInstance(s,n));return n.instances.push(...r),n}buildInstance(e,t){return new F0(e,this.bridge,t).toApi()}}var bb="3.4.0";const ak=i=>async e=>{if(window.glue42gd||window.iodesktop)return wI(e);const t=new ok,n=fI(e);yI();const r=await j0(()=>i(n,{version:bb}),3e4,"Glue Web initialization timed out, because core didn't resolve"),s=r.logger.subLogger("web.main.controller");t.defineGlue(r),t.sessionController.configure({windowId:r.interop.instance.instance}),await t.preferredConnectionController.start(n),await t.bridge.start(t.controllers),t.defineConfig(n),s.trace("the bridge has been started, initializing all controllers"),await Promise.all(Object.values(t.controllers).map(o=>o.start(r,t))),s.trace("all controllers reported started, starting all additional libraries");try{return await Promise.all(n.libraries.map(o=>o(r,n))),s.trace("all libraries were started"),t.eventsDispatcher.start(r),s.trace("start event dispatched, glue is ready, returning it"),r}catch(o){return ie.raiseError(o,!0)}};var An={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function _b(i){return i.type===An.TIMESTAMP?"timestamp":i.type===An.NUMBER?"number":i.type===An.STRING?"string":i.type===An.OBJECT?"object":"unknown"}function Cb(i){return i.constructor===Date?"timestamp":typeof i=="number"?"number":typeof i=="string"?"string":typeof i=="object"?"object":"string"}function ck(i){const e={},t=_b(i);if(t==="object"){const n=Object.keys(i.value).reduce((r,s)=>{const o=Cb(i.value[s]);if(o==="object"){const a=Sb(i.value[s]);r[s]={type:"object",description:"",context:{},composite:a}}else r[s]={type:o,description:"",context:{}};return r},{});e.composite=n}return e.name=Wl(i.path.join("/")+"/"+i.name),e.type=t,e.description=i.description,e.context={},e}function Sb(i){return Object.keys(i).reduce((e,t)=>{const n=Cb(i[t]);return n==="object"?e[t]={type:"object",description:"",context:{},composite:Sb(i[t])}:e[t]={type:n,description:"",context:{}},e},{})}function Wl(i){return typeof i<"u"&&i.length>0&&i[0]!=="/"?"/"+i:i}function lk(i){return _b(i)==="timestamp"?Date.now():Ib(i.value)}function Ib(i){return typeof i!="object"?i:Object.keys(i).reduce((e,t)=>{const n=i[t];return typeof n=="object"&&n.constructor!==Date?e[t]=Ib(n):n.constructor===Date?e[t]=new Date(n).getTime():n.constructor===Boolean?e[t]=n.toString():e[t]=n,e},{})}function xb(i){return i.reduce((e,t)=>e.concat(Array.isArray(t)?xb(t):t),[])}function uk(i){return i.sort((e,t)=>e.state?t.state?t.state-e.state:-1:1)[0]}function dk(i){let e="";return i.forEach((t,n,r)=>{const s=t.path.join(".");n===r.length-1?e+=s+"."+t.name+": "+t.description:e+=s+"."+t.name+": "+t.description+","}),e.length>100?e.slice(0,100)+"...":e}function hk(i){const e=i.root.getAggregateState(),t=xb(e),n=uk(t);return{description:dk(t),value:n.state}}function pk(i,e){if(!i||typeof i!="object")throw new Error("Connection is required parameter");let t,n;const r=y=>{let S;t=new Promise(O=>{S=O}),n=i.domain("metrics"),n.onJoined(O=>{!O&&S&&(S(),S=void 0);const v={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};n.send(v),O&&s(y)}),n.join({system:e.system,service:e.service,instance:e.instance})},s=y=>{o(y.root)},o=y=>{a(y),y.metrics.forEach(S=>{l(S)}),y.subSystems.forEach(S=>{o(S)})},a=async y=>{if(y.parent===void 0)return;await t;const O={type:"define",metrics:[{name:Wl(y.path.join("/")+"/"+y.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};n.send(O)},c=async(y,S)=>{await t;const O={type:"publish",values:[{name:Wl(y.path.join("/")+"/"+y.name+"/State"),value:{Description:S.description,Value:S.state},timestamp:Date.now()}]};n.send(O);const _=hk(y),v={type:"publish",peer_id:i.peerId,values:[{name:"/State",value:{Description:_.description,Value:_.value},timestamp:Date.now()}]};n.send(v)},l=async y=>{const S=f(y);await t;const _={type:"define",metrics:[ck(S)]};n.send(_),typeof S.value<"u"&&p(S)},u=async y=>{const S=f(y);await t,p(S)},p=y=>{if(w()){const S=lk(y),O={type:"publish",values:[{name:Wl(y.path.join("/")+"/"+y.name),value:S,timestamp:Date.now()}]};return n.sendFireAndForget(O)}return Promise.resolve()},f=y=>{const S={...y};return typeof y.value=="object"&&y.value!==null&&(S.value={...y.value}),S},w=()=>{try{return(e.canUpdateMetric??(()=>!0))()}catch{return!0}};return{init:r,createSystem:a,updateSystem:c,createMetric:l,updateMetric:u}}var fk={validate:(i,e,t)=>{if(i===null||typeof i!="object")throw new Error("Missing definition");if(e===null||typeof e!="object")throw new Error("Missing parent");if(t===null||typeof t!="object")throw new Error("Missing transport")}};let ed=class{constructor(e,t,n,r,s){d(this,"definition");d(this,"system");d(this,"transport");d(this,"value");d(this,"type");d(this,"path",[]);d(this,"name");d(this,"description");this.definition=e,this.system=t,this.transport=n,this.value=r,this.type=s,fk.validate(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}get repo(){var e;return(e=this.system)==null?void 0:e.repo}get id(){return`${this.system.path}/${name}`}update(e){return this.value=e,this.transport.updateMetric(this)}},gk=class extends ed{constructor(e,t,n,r){super(e,t,n,r,An.NUMBER)}incrementBy(e){this.update(this.value+e)}increment(){this.incrementBy(1)}decrement(){this.incrementBy(-1)}decrementBy(e){this.incrementBy(e*-1)}},mk=class extends ed{constructor(e,t,n,r){super(e,t,n,r,An.OBJECT)}update(e){return this.mergeValues(e),this.transport.updateMetric(this)}mergeValues(e){return Object.keys(this.value).forEach(t=>{typeof e[t]<"u"&&(this.value[t]=e[t])})}},yk=class extends ed{constructor(e,t,n,r){super(e,t,n,r,An.STRING)}},wk=class extends ed{constructor(e,t,n,r){super(e,t,n,r,An.TIMESTAMP)}now(){this.update(new Date)}};function kb(i,e,t,n,r){if(!e)throw new Error("Repository is required");if(!t)throw new Error("Transport is required");const s=t,o=i,a=r||"",c=e,l=n,u=G(n);let p={};const f=E(u,"/")+i,w=e.root,y=[],S=[];function O(x,N){if(!x||x.length===0)throw new Error("name is required");const b=y.filter(z=>z.name===x);if(b.length>0)return b[0];const R=kb(x,c,s,A,N);return y.push(R),R}function _(x,N){p={state:x,description:N},s.updateSystem(A,p)}function v(x,N){return $(x,An.STRING,N,b=>new yk(b,A,s,N))}function C(x,N){return $(x,An.NUMBER,N,b=>new gk(b,A,s,N))}function T(x,N){return $(x,An.OBJECT,N,b=>new mk(b,A,s,N))}function M(x,N){return $(x,An.TIMESTAMP,N,b=>new wk(b,A,s,N))}function $(x,N,b,R){let z={name:""};typeof x=="string"?z={name:x}:z=x;const V=S.filter(H=>H.name===z.name);if(V.length>0){const H=V[0];if(H.type!==N)throw new Error(`A metric named ${z.name} is already defined with different type.`);return typeof b<"u"&&H.update(b).catch(()=>{}),H}const Q=R(z);return S.push(Q),Q}function G(x){if(!x||!x.parent)return[];const N=G(x.parent);return N.push(x.name),N}function E(x,N){return x&&x.length>0?x.join(N):""}function D(){const x=[];return Object.keys(p).length>0&&x.push({name:o,path:u,state:p.state,description:p.description}),y.forEach(N=>{const b=N.getAggregateState();b.length>0&&x.push(...b)}),x}const A={get name(){return o},get description(){return a},get repo(){return c},get parent(){return l},path:u,id:f,root:w,get subSystems(){return y},get metrics(){return S},subSystem:O,getState:()=>p,setState:_,stringMetric:v,timestampMetric:M,objectMetric:T,numberMetric:C,getAggregateState:D};return s.createSystem(A),A}let vk=class{constructor(e,t){d(this,"root");t.init(this),this.root=kb("",this,t),this.addSystemMetrics(this.root,e.clickStream||e.clickStream===void 0)}addSystemMetrics(e,t){if(typeof navigator<"u"&&e.stringMetric("UserAgent",navigator.userAgent),t&&typeof document<"u"){const s=e.subSystem("ClickStream"),o=a=>{if(!a.target)return;const c=a.target,l=c?c.getAttribute("class")??"":"";s.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:l,id:c.id,type:"<"+c.tagName.toLowerCase()+">",href:c.href||""}})};s.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",o):document.attachEvent("onclick",o)}e.stringMetric("StartTime",new Date().toString());const n=e.stringMetric("StartURL",""),r=e.stringMetric("AppName","");if(typeof window<"u"){if(typeof window.location<"u"){const s=window.location.href;n.update(s)}typeof window.glue42gd<"u"&&r.update(window.glue42gd.appName)}}},bk=class{init(e){}createSystem(e){return Promise.resolve()}updateSystem(e,t){return Promise.resolve()}createMetric(e){return Promise.resolve()}updateMetric(e){return Promise.resolve()}},_k=class{constructor(e,t,n){d(this,"api");d(this,"lastCount",0);d(this,"initialPublishTimeout",10*1e3);d(this,"publishInterval",60*1e3);d(this,"system");this.api=e,this.initialPublishTimeout=t??this.initialPublishTimeout,this.publishInterval=n??this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}scheduleCollection(){setTimeout(()=>{this.collect(),setInterval(()=>{this.collect()},this.publishInterval)},this.initialPublishTimeout)}collect(){try{this.collectMemory(),this.collectEntries()}catch{}}collectMemory(){const e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))}collectEntries(){const e=window.performance.getEntries();if(e.length<=this.lastCount)return;this.lastCount=e.length;const t=e.map(n=>n.toJSON());this.system.stringMetric("entries",JSON.stringify(t))}};var Ck=i=>{let e;!i.connection||typeof i.connection!="object"?e=new bk:e=pk(i.connection,i);let n=new vk(i,e).root;i.disableAutoAppSystem||(n=n.subSystem("App"));const r=Ik(n);return Sk(r,i.pagePerformanceMetrics),r};function Sk(i,e){var n,r;if(typeof window>"u")return;const t=(r=(n=window==null?void 0:window.glue42gd)==null?void 0:n.metrics)==null?void 0:r.pagePerformanceMetrics;t&&(e=t),e!=null&&e.enabled&&new _k(i,e.initialPublishTimeout,e.publishInterval)}function Ik(i){const e=i.subSystem("reporting"),t={name:"features"};let n;const r=(s,o,a)=>{if(typeof s>"u"||s==="")throw new Error("name is mandatory");if(typeof o>"u"||o==="")throw new Error("action is mandatory");if(typeof a>"u"||a==="")throw new Error("payload is mandatory");n?n.update({name:s,action:o,payload:a}):n=e.objectMetric(t,{name:s,action:o,payload:a})};return i.featureMetric=r,i}var ul=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tb(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function yp(i){if(i&&i.errorHandling&&typeof i.errorHandling!="function"&&i.errorHandling!=="log"&&i.errorHandling!=="silent"&&i.errorHandling!=="throw")throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof i.errorHandling+" was passed");var e=i&&typeof i.errorHandling=="function"&&i.errorHandling,t={};function n(c,l,u){var p=t[c];return p||(p=[],t[c]=p),p.push(l),u&&setTimeout(function(){u.forEach(function(f){var w;if(!((w=t[c])===null||w===void 0)&&w.includes(l))try{Array.isArray(f)?l.apply(void 0,f):l.apply(void 0,[f])}catch(y){s(y,c)}})},0),function(){var f=t[c];f&&(f=f.reduce(function(w,y,S){return y===l&&w.length===S||w.push(y),w},[]),f.length===0?delete t[c]:t[c]=f)}}function r(c){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];var p=t[c];if(!p||p.length===0)return[];var f=[];return p.forEach(function(w){try{var y=w.apply(void 0,l);f.push(y)}catch(S){f.push(void 0),s(S,c)}}),f}function s(c,l){var u=c instanceof Error?c:new Error(c);if(e){e(u);return}var p='[ERROR] callback-registry: User callback for key "'+l+'" failed: '+u.stack;if(i)switch(i.errorHandling){case"log":return console.error(p);case"silent":return;case"throw":throw new Error(p)}console.error(p)}function o(){t={}}function a(c){var l=t[c];l&&delete t[c]}return{add:n,execute:r,clear:o,clearKey:a}}yp.default=yp;var xk=yp,Gi=Tb(xk);let kk=class{constructor(e,t){d(this,"gw");d(this,"registry",Gi());d(this,"client");this.gw=e.facade,this.gw.connect((n,r)=>{this.messageHandler(r)}).then(n=>{this.client=n})}get isObjectBasedTransport(){return!0}sendObject(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")}send(e){return Promise.reject("not supported")}onMessage(e){return this.registry.add("onMessage",e)}onConnectedChanged(e){return e(!0),()=>{}}close(){return Promise.resolve()}open(){return Promise.resolve()}name(){return"in-memory"}reconnect(){return Promise.resolve()}messageHandler(e){this.registry.execute("onMessage",e)}},Tk=class{constructor(e,t){d(this,"logger");d(this,"worker");d(this,"registry",Gi());this.logger=t,this.worker=new SharedWorker(e),this.worker.port.onmessage=n=>{this.messageHandler(n.data)}}get isObjectBasedTransport(){return!0}sendObject(e){return this.worker.port.postMessage(e),Promise.resolve()}send(e){return Promise.reject("not supported")}onMessage(e){return this.registry.add("onMessage",e)}onConnectedChanged(e){return e(!0),()=>{}}close(){return Promise.resolve()}open(){return Promise.resolve()}name(){return"shared-worker"}reconnect(){return Promise.resolve()}messageHandler(e){this.registry.execute("onMessage",e)}};const Ti=class Ti{static isNode(){if(typeof Ti._isNode<"u")return Ti._isNode;if(typeof window<"u")return Ti._isNode=!1,!1;try{Ti._isNode=Object.prototype.toString.call(global.process)==="[object process]"}catch{Ti._isNode=!1}return Ti._isNode}};d(Ti,"_isNode");let Pi=Ti,vu=class{constructor(){d(this,"resolve");d(this,"reject");d(this,"promise");d(this,"rejected",!1);d(this,"resolved",!1);this.promise=new Promise((e,t)=>{this.resolve=n=>{this.resolved=!0,e(n)},this.reject=n=>{this.rejected=!0,t(n)}})}static delay(e){return new Promise(t=>setTimeout(t,e))}get ended(){return this.rejected||this.resolved}};const wp={};function Ak(){return wp}function Un(i){const e=wp[i];if(e)return e;const t=[];function n(){return new Date().getTime()}const r=n();c("start",r);let s,o;function a(){return s=n(),c("end",s),o=s-r,o}function c(u,p){const f=p??n();let w=0;t.length>0&&(w=f-t[t.length-1].time),t.push({name:u,time:f,diff:w})}const l={get startTime(){return r},get endTime(){return s},get period(){return o},stop:a,mark:c,marks:t};return wp[i]=l,l}const Ek=Pi.isNode()?null:window.WebSocket;let Am=class{constructor(e,t){d(this,"ws");d(this,"logger");d(this,"settings");d(this,"startupTimer",Un("connection"));d(this,"_running",!0);d(this,"_registry",Gi());d(this,"wsRequests",[]);if(this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}onMessage(e){return this._registry.add("onMessage",e)}send(e,t){return new Promise((n,r)=>{this.waitForSocketConnection(()=>{var s;try{(s=this.ws)==null||s.send(e),n()}catch(o){r(o)}},r)})}open(){return this.logger.info("opening ws..."),this._running=!0,new Promise((e,t)=>{this.waitForSocketConnection(e,t)})}close(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()}onConnectedChanged(e){return this._registry.add("onConnectedChanged",e)}name(){return this.settings.ws}reconnect(){var t;(t=this.ws)==null||t.close();const e=new vu;return this.waitForSocketConnection(()=>{e.resolve()}),e.promise}waitForSocketConnection(e,t){var n;if(t=t??(()=>{}),!this._running){t(`wait for socket on ${this.settings.ws} failed - socket closed by user`);return}if(((n=this.ws)==null?void 0:n.readyState)===1){e();return}this.wsRequests.push({callback:e,failed:t}),!(this.wsRequests.length>1)&&this.openSocket()}async openSocket(e,t){if(this.logger.info(`opening ws to ${this.settings.ws}, retryInterval: ${e}, retriesLeft: ${t}...`),this.startupTimer.mark("opening-socket"),e===void 0&&(e=this.settings.reconnectInterval),typeof t>"u"&&(t=this.settings.reconnectAttempts),t!==void 0){if(t===0){this.notifyForSocketState(`wait for socket on ${this.settings.ws} failed - no more retries left`);return}this.logger.debug(`will retry ${t} more times (every ${e} ms)`)}try{await this.initiateSocket(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState()}catch{setTimeout(()=>{const n=t===void 0?void 0:t-1;this.openSocket(e,n)},e)}}initiateSocket(){const e=new vu;return this.logger.debug(`initiating ws to ${this.settings.ws}...`),this.ws=new Ek(this.settings.ws??""),this.ws.onerror=t=>{let n="";try{n=JSON.stringify(t)}catch{const s=new WeakSet;n=JSON.stringify(t,(a,c)=>{if(typeof c=="object"&&c!==null){if(s.has(c))return;s.add(c)}return c})}this.logger.info(`ws error - reason: ${n}`),e.reject("error"),this.notifyStatusChanged(!1,n)},this.ws.onclose=t=>{this.logger.info(`ws closed - code: ${t==null?void 0:t.code} reason: ${t==null?void 0:t.reason}`),e.reject("closed"),this.notifyStatusChanged(!1)},this.ws.onopen=()=>{var t;this.startupTimer.mark("ws-opened"),this.logger.info(`ws opened ${(t=this.settings.identity)==null?void 0:t.application}`),e.resolve(),this.notifyStatusChanged(!0)},this.ws.onmessage=t=>{this._registry.execute("onMessage",t.data)},e.promise}notifyForSocketState(e){this.wsRequests.forEach(t=>{e?t.failed&&t.failed(e):t.callback()}),this.wsRequests=[]}notifyStatusChanged(e,t){this._registry.execute("onConnectedChanged",e,t)}},Pk=class{constructor(e){d(this,"specs");d(this,"specsNames",[]);d(this,"messages",{});d(this,"isDone");d(this,"subs",{});d(this,"subsRefCount",{});d(this,"connection");this.specs={};for(const t of e)this.specs[t.name]=t,this.specsNames.push(t.name)}init(e){this.connection=e;for(const t of this.specsNames)for(const n of this.specs[t].types){let r=this.subsRefCount[n];if(r||(r=0),r+=1,this.subsRefCount[n]=r,r>1)continue;const s=e.on(n,o=>this.processMessage(n,o));this.subs[n]=s}}processMessage(e,t){if(!(this.isDone||!t)){for(const n of this.specsNames)if(this.specs[n].types.indexOf(e)!==-1){const r=this.messages[n]||[];this.messages[n]=r,r.push(t)}}}drain(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(const r of this.specs[e].types)this.subsRefCount[r]-=1,this.subsRefCount[r]<=0&&((n=this.connection)==null||n.off(this.subs[r]),delete this.subs[r],delete this.subsRefCount[r]);delete this.specs[e],this.specs.length||(this.isDone=!0)}},Nk="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",oi=(i=21)=>{let e="",t=i;for(;t--;)e+=Nk[Math.random()*64|0];return e};const za=(i,e,t)=>new Promise((n,r)=>{const s=setTimeout(()=>{const a=t||`Promise timeout hit: ${e}`;r(a)},e);new Promise(i).then(a=>{clearTimeout(s),n(a)}).catch(a=>{clearTimeout(s),r(a)})});let Rk=class{constructor(e,t,n){d(this,"settings");d(this,"logger");d(this,"identity");d(this,"isPreferredActivated");d(this,"_communicationId");d(this,"publicWindowId");d(this,"selfAssignedWindowId");d(this,"iAmConnected",!1);d(this,"parentReady",!1);d(this,"rejected",!1);d(this,"parentPingResolve");d(this,"parentPingInterval");d(this,"connectionResolve");d(this,"extConnectionResolve");d(this,"extConnectionReject");d(this,"connectionReject");d(this,"port");d(this,"myClientId");d(this,"children",[]);d(this,"extContentAvailable",!1);d(this,"extContentConnecting",!1);d(this,"extContentConnected",!1);d(this,"parentWindowId");d(this,"parentInExtMode",!1);d(this,"webNamespace","g42_core_web");d(this,"parent");d(this,"parentType");d(this,"parentPingTimeout",5e3);d(this,"connectionRequestTimeout",7e3);d(this,"defaultTargetString","*");d(this,"registry",Gi());d(this,"messages",{connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:()=>{}},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}});this.settings=e,this.logger=t,this.identity=n,this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.parentType=window.name.includes("#wsp")?"workspace":void 0}manualSetReadyState(){this.iAmConnected=!0,this.parentReady=!0}get transportWindowId(){return this.publicWindowId}get communicationId(){return this._communicationId}async sendObject(e){if(this.extContentConnected)return window.postMessage({glue42ExtOut:e},this.defaultTargetString);if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");this.port.postMessage(e)}get isObjectBasedTransport(){return!0}onMessage(e){return this.registry.add("onMessage",e)}send(){return Promise.reject("not supported")}onConnectedChanged(e){return this.registry.add("onConnectedChanged",e)}async open(){this.logger.debug("opening a connection to the web platform gateway."),await this.connect(),this.notifyStatusChanged(!0)}close(){var t,n;const e={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:(t=this.identity)==null?void 0:t.windowId}}};return(n=this.port)==null||n.postMessage(e),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()}name(){return"web-platform"}async reconnect(){return await this.close(),Promise.resolve()}initiateInternalConnection(){return new Promise((e,t)=>{if(this.logger.debug("opening an internal web platform connection"),this.port=this.settings.port,this.iAmConnected){this.logger.warn("cannot open a new connection, because this client is currently connected");return}this.port.onmessage=n=>{var s,o;if(this.iAmConnected&&!((s=n.data)!=null&&s.glue42core)){this.registry.execute("onMessage",n.data);return}const r=(o=n.data)==null?void 0:o.glue42core;r&&(r.type===this.messages.gatewayInternalConnect.name&&r.success&&(this.publicWindowId=this.settings.windowId,this.identity&&this.publicWindowId&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.publicWindowId),e()),r.type===this.messages.gatewayInternalConnect.name&&r.error&&t(r.error))},this.port.postMessage({glue42core:{type:this.messages.gatewayInternalConnect.name}})})}initiateRemoteConnection(e){return za((t,n)=>{this.connectionResolve=t,this.connectionReject=n,this.myClientId=this.myClientId??oi(10);const r=this.getMyWindowId()||oi(10),s={glue42core:{type:this.messages.connectionRequest.name,clientId:this.myClientId,clientType:"child",bridgeInstanceId:r,selfAssignedWindowId:this.selfAssignedWindowId}};if(this.logger.debug("sending connection request"),this.extContentConnecting)return s.glue42core.clientType="child",s.glue42core.bridgeInstanceId=this.myClientId,s.glue42core.parentWindowId=this.parentWindowId,window.postMessage(s,this.defaultTargetString);if(!e)throw new Error("Cannot send a connection request, because no glue target was specified!");e.postMessage(s,this.defaultTargetString)},this.connectionRequestTimeout,"The connection to the target glue window timed out")}async isParentCheckSuccess(e){try{return await e,{success:!0}}catch{return{success:!1}}}setUpMessageListener(){if(this.settings.port){this.logger.debug("skipping generic message listener, because this is an internal client");return}window.addEventListener("message",e=>{var s;const t=(s=e.data)==null?void 0:s.glue42core;if(!t||this.rejected)return;const n=this.settings.allowedOrigins||[];if(n.length&&!n.includes(e.origin)){this.logger.warn(`received a message from an origin which is not in the allowed list: ${e.origin}`);return}if(!this.checkMessageTypeValid(t.type)){this.logger.error(`cannot handle the incoming glue42 core message, because the type is invalid: ${t.type}`);return}const r=t.type;this.logger.debug(`received valid glue42core message of type: ${r}`),this.messages[r].handle(e)})}setUpUnload(){if(this.settings.port){this.logger.debug("skipping unload event listener, because this is an internal client");return}window.addEventListener("beforeunload",()=>{var t,n;if(this.extContentConnected)return;const e={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:(t=this.identity)==null?void 0:t.windowId}}};this.parent&&this.parent.postMessage(e,this.defaultTargetString),(n=this.port)==null||n.postMessage(e)})}handlePlatformReady(e){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval),this.parent=e.source,this.parentType=window.name.includes("#wsp")?"workspace":"window"}handleConnectionAccepted(e){var n;const t=(n=e.data)==null?void 0:n.glue42core;return this.myClientId===t.clientId?this.handleAcceptanceOfMyRequest(t):this.handleAcceptanceOfGrandChildRequest(t,e)}handleAcceptanceOfMyRequest(e){if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(!e.port){this.logger.error("cannot set up my connection, because I was not provided with a port");return}if(this.publicWindowId=this.getMyWindowId(),this.identity&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.identity.instance?this.identity.instance:this.publicWindowId||oi(10)),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=t=>this.registry.execute("onMessage",t.data),this.connectionResolve){this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),delete this.connectionResolve;return}this.logger.error("unable to call the connection resolve, because no connection promise was found")}processExtContentConnection(e){if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",t=>{var s;const n=(s=t.data)==null?void 0:s.glue42ExtInc;if(!n)return;const r=this.settings.allowedOrigins||[];if(r.length&&!r.includes(t.origin)){this.logger.warn(`received a message from an origin which is not in the allowed list: ${t.origin}`);return}this.registry.execute("onMessage",n)}),this.connectionResolve){this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),delete this.connectionResolve;return}}handleAcceptanceOfGrandChildRequest(e,t){if(this.extContentConnecting||this.extContentConnected){this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");return}this.logger.debug(`handling a connection accepted signal targeted at a grandchild: ${e.clientId}`);const n=this.children.find(r=>r.grandChildId===e.clientId);if(!n){this.logger.error(`cannot handle connection accepted for grandchild: ${e.clientId}, because there is no grandchild with this id`);return}n.connected=!0,this.logger.debug(`the grandchild connection for ${e.clientId} is set up, forwarding the success message and the gateway port`),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])}handleConnectionRejected(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)}handleConnectionRequest(e){if(this.extContentConnecting){this.logger.debug("This connection request event is targeted at the extension content");return}const t=e.source,n=e.data.glue42core;if(!n.clientType||n.clientType!=="grandChild")return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if(!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug(`handling a connection request for a grandchild: ${n.clientId}`),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug(`grandchild: ${n.clientId} is prepared, forwarding connection request to the platform`),this.parent.postMessage(e.data,this.defaultTargetString)}handleParentPing(e){if(!this.parentReady){this.logger.debug("my parent is not ready, I am ignoring the parent ping");return}if(!this.iAmConnected){this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");return}const t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});const n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}setupPlatformUnloadListener(){this.onMessage(e=>{e.type==="platformUnload"&&(this.logger.debug("detected a web platform unload"),this.parentReady=!1,this.notifyStatusChanged(!1,"Gateway unloaded"))})}handleManualUnload(){var t,n;const e={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:(t=this.identity)==null?void 0:t.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:e},this.defaultTargetString);(n=this.port)==null||n.postMessage(e)}handleClientUnload(e){const t=e.data.glue42core,n=t==null?void 0:t.data.clientId;if(!n){this.logger.warn("cannot process grand child unload, because the provided id was not valid");return}if(!this.children.find(s=>s.grandChildId===n)){this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild");return}this.logger.debug(`handling grandchild unload for id: ${n}`),this.children=this.children.filter(s=>s.grandChildId!==n)}handlePlatformPing(){}notifyStatusChanged(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)}checkMessageTypeValid(e){return typeof e=="string"&&!!this.messages[e]}rejectConnectionRequest(e,t,n){this.rejected=!0,this.logger.error(n);const r={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(r,t)}requestConnectionPermissionFromExt(){return this.waitForContentScript().then(()=>za((e,t)=>{this.extConnectionResolve=e,this.extConnectionReject=t;const n={glue42core:{type:"extSetupRequest"}};this.logger.debug("permission request to the extension content script was sent"),window.postMessage(n,this.defaultTargetString)},this.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out"))}handleExtConnectionResponse(e){var n;if(!((n=e.data)==null?void 0:n.glue42core).approved)return this.extConnectionReject?this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected"):void 0;this.extConnectionResolve&&(this.extConnectionResolve(),delete this.extConnectionResolve),this.extContentConnecting=!0,this.parentType="extension",this.logger.debug("The extension connection was approved, proceeding.")}handleExtSetupRequest(){}handleGatewayDisconnect(){}handleGatewayInternalConnect(){}waitForContentScript(){var t;return(t=window.glue42ext)!=null&&t.content?Promise.resolve():za(n=>{window.addEventListener("Glue42EXTReady",()=>{n()})},this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")}async connect(){if(this.settings.port){await this.initiateInternalConnection(),this.logger.debug("internal web platform connection completed");return}this.logger.debug("opening a client web platform connection"),await this.findParent(),await this.initiateRemoteConnection(this.parent),this.logger.debug("the client is connected")}async findParent(){var o;const e="Cannot initiate glue, because this window was not opened or created by a glue client",t=this.getPossibleParentsInWindow(window),n=this.getPossibleParentsOutsideWindow((o=window.top)==null?void 0:o.opener,window.top),r=new Set([...t,...n]);if(!r.size&&!this.extContentAvailable)throw new Error(e);if(!r.size&&this.extContentAvailable){await this.requestConnectionPermissionFromExt();return}if((await this.isParentCheckSuccess(this.confirmParent(Array.from(r)))).success){this.logger.debug("The default parent was found!");return}if(!this.extContentAvailable)throw new Error(e);await this.requestConnectionPermissionFromExt()}getPossibleParentsInWindow(e){return!e||e===e.top?[]:[e.parent,...this.getPossibleParentsInWindow(e.parent)]}getPossibleParentsOutsideWindow(e,t){return!e||!t||e===t?[]:[e,...this.getPossibleParentsInWindow(e),...this.getPossibleParentsOutsideWindow(e.opener,e)]}confirmParent(e){const n=za(r=>{this.parentPingResolve=r;const s={glue42core:{type:this.messages.platformPing.name}};this.parentPingInterval=setInterval(()=>{e.forEach(o=>{o.postMessage(s,this.defaultTargetString)})},1e3)},this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client");return n.catch(()=>{this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval)}),n}getMyWindowId(){var e;if(this.parentType==="workspace")return window.name.substring(0,window.name.indexOf("#wsp"));if(window===window.top)return(e=window.name)!=null&&e.includes("g42")?window.name:(this.selfAssignedWindowId=this.selfAssignedWindowId||`g42-${oi(10)}`,this.selfAssignedWindowId)}};const Mk=(i,e)=>{let t=i;return()=>{t--,t===0&&e()}};let jk=class{constructor(e=0){d(this,"minSequenceInterval");d(this,"queue",[]);d(this,"isExecutingQueue",!1);this.minSequenceInterval=e}enqueue(e){return new Promise((t,n)=>{this.queue.push({action:e,resolve:t,reject:n}),this.executeQueue()})}async executeQueue(){if(!this.isExecutingQueue){for(this.isExecutingQueue=!0;this.queue.length;){const e=this.queue.shift();if(!e){this.isExecutingQueue=!1;return}try{const t=await e.action();e.resolve(t)}catch(t){e.reject(t)}await this.intervalBreak()}this.isExecutingQueue=!1}}intervalBreak(){return new Promise(e=>setTimeout(e,this.minSequenceInterval))}};function Em(i,e,t,n,r){i==null&&(i="global"),n=n??["success"],r=r??["error"];let s=i==="global",o=!1,a,c=!1;const l=Gi();e.disconnected(y),e.loggedIn(S),e.on("success",E=>C(E)),e.on("error",E=>v(E)),e.on("result",E=>C(E)),n&&n.forEach(E=>{e.on(E,D=>C(D))}),r&&r.forEach(E=>{e.on(E,D=>v(D))});const u={};function p(E){return a=E,new Promise((D,A)=>{if(s){D({});return}let x;i==="global"?x=c?Promise.resolve({}):Promise.reject("not connected to gateway"):(t.debug(`joining domain ${i}`),x=$({type:"join",destination:i,domain:"global",options:E})),x.then(()=>{w(),D({})}).catch(N=>{t.debug("error joining "+i+" domain: "+JSON.stringify(N)),A(N)})})}function f(){if(i==="global")return Promise.resolve();t.debug("stopping session "+i+"...");const E={type:"leave",destination:i,domain:"global"};return o=!1,$(E).then(()=>{s=!1,l.execute("onLeft")}).catch(()=>{s=!1,l.execute("onLeft")})}function w(){t.debug("did join "+i),s=!0;const E=o;o=!1,l.execute("onJoined",E)}function y(){c=!1,t.debug("connection is down"),s=!1,o=!0,l.execute("onLeft",{disconnected:!0})}function S(){c=!0,o&&(t.debug("connection is now up - trying to reconnect..."),p(a))}function O(E){return s&&E(!1),l.add("onJoined",E)}function _(E){return s||E(),l.add("onLeft",E)}function v(E){if(i!==E.domain)return;const D=E.request_id;if(!D)return;const A=u[D];A&&A.error(E)}function C(E){if(E.domain!==i)return;const D=E.request_id;if(!D)return;const A=u[D];A&&A.success(E)}function T(){return oi(10)}let M=[];function $(E,D,A){const x=["hello","join"];if(E.type&&x.indexOf(E.type)===-1&&!s){console.warn(`trying to send a message (${E.domain} ${E.type}) but not connected, will queue`);const b=new vu;if(M.push({msg:E,tag:D,options:A,pw:b}),M.length===1){const R=O(()=>{t.info(`joined - will now send queued messages (${M.length} -> [${M.map(z=>z.msg.type)}])`),M.forEach(z=>{$(z.msg,z.tag,z.options).then(V=>z.pw.resolve(V)).catch(V=>z.pw.reject(V))}),M=[],R()})}return b.promise}A=A??{},E.request_id=E.request_id??T(),E.domain=E.domain??i,A.skipPeerId||(E.peer_id=e.peerId);const N=E.request_id;return new Promise((b,R)=>{u[N]={success:z=>{delete u[N],z._tag=D,b(z)},error:z=>{t.warn(`Gateway error - ${JSON.stringify(z)}`),delete u[N],z._tag=D,R(z)}},e.send(E,A).catch(z=>{u[N].error({err:z})})})}function G(E){return E.request_id=E.request_id?E.request_id:T(),E.domain=E.domain??i,E.peer_id=e.peerId,e.send(E)}return{join:p,leave:f,onJoined:O,onLeft:_,send:$,sendFireAndForget:G,on:(E,D)=>{e.on(E,A=>{if(A.domain===i)try{D(A)}catch(x){t.error(`Callback  failed: ${x} 
 ${x.stack} 
 msg was: ${JSON.stringify(A)}`,x)}})},loggedIn:E=>e.loggedIn(E),connected:E=>e.connected(E),disconnected:E=>e.disconnected(E),get peerId(){return e.peerId},get domain(){return i}}}let Ok=class{constructor(e,t){d(this,"settings");d(this,"logger");d(this,"protocolVersion",3);d(this,"peerId");d(this,"token");d(this,"info");d(this,"resolvedIdentity");d(this,"availableDomains");d(this,"gatewayToken");d(this,"replayer");d(this,"messageHandlers",{});d(this,"ids",1);d(this,"registry",Gi());d(this,"_connected",!1);d(this,"isTrace",!1);d(this,"transport");d(this,"_defaultTransport");d(this,"_defaultAuth");d(this,"_targetTransport");d(this,"_targetAuth");d(this,"_swapTransport",!1);d(this,"_switchInProgress",!1);d(this,"_transportSubscriptions",[]);d(this,"datePrefix","#T42_DATE#");d(this,"datePrefixLen",this.datePrefix.length);d(this,"dateMinLen",this.datePrefixLen+1);d(this,"datePrefixFirstChar",this.datePrefix[0]);d(this,"_sequelizer",new jk);d(this,"_isLoggedIn",!1);d(this,"shouldTryLogin",!0);d(this,"pingTimer");d(this,"sessions",[]);d(this,"globalDomain");d(this,"initialLogin",!0);d(this,"initialLoginAttempts",3);d(this,"loginConfig");if(this.settings=e,this.logger=t,e=e||{},e.reconnectAttempts=e.reconnectAttempts??10,e.reconnectInterval=e.reconnectInterval??1e3,e.inproc)this.transport=new kk(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new Tk(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new Rk(e.webPlatform,t.subLogger("web-platform"),e.identity);else if(e.ws!==void 0)this.transport=new Am(e,t.subLogger("ws"));else throw new Error("No connection information specified");this.isTrace=t.canPublish("trace"),t.debug(`starting with ${this.transport.name()} transport`);const n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),r=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(r),this._defaultTransport=this.transport,this.ping()}async switchTransport(e){return this._sequelizer.enqueue(async()=>{if(!e||typeof e!="object")throw new Error("Cannot switch transports, because the settings are missing or invalid.");if(typeof e.type>"u")throw new Error("Cannot switch the transport, because the type is not defined");this.logger.trace(`Starting transport switch with settings: ${JSON.stringify(e)}`);const t=e.type==="secondary"?this.getNewSecondaryTransport(e):this._defaultTransport;this._targetTransport=t,this._targetAuth=e.type==="secondary"?this.getNewSecondaryAuth(e):this._defaultAuth;const n=this.verifyConnection();this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),await this.transport.close();try{await n;const r=this.transport===t;return this.logger.info(`The reconnection after the switch was completed. Was the switch a success: ${r}`),this._switchInProgress=!1,{success:r}}catch{return this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,{success:!1}}})}onLibReAnnounced(e){return this.registry.add("libReAnnounced",e)}setLibReAnnounced(e){this.registry.execute("libReAnnounced",e)}send(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){const n=this.createObjectMessage(e);return this.isTrace&&this.logger.trace(`>> ${JSON.stringify(n)}`),this.transport.sendObject(n,t)}else{const n=this.createStringMessage(e);return this.isTrace&&this.logger.trace(`>> ${n}`),this.transport.send(n,t)}}on(e,t){e=e.toLowerCase(),this.messageHandlers[e]===void 0&&(this.messageHandlers[e]={});const n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}}off(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]}get isConnected(){return this._isLoggedIn}connected(e){return this.loggedIn(()=>{const t=this.transport.name();e(t)})}disconnected(e){return this.registry.add("disconnected",e)}async login(e,t){this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),e=this.transportSwap()??e),this.logger.trace(`Starting login for transport: ${this.transport.name()} and auth ${JSON.stringify(e)}`);try{await this.transport.open(),this.logger.trace(`Transport: ${this.transport.name()} opened, logging in`),Un("connection").mark("transport-opened");const n=await this.loginCore(e,t);return this.logger.trace(`Logged in with identity: ${JSON.stringify(n)}`),Un("connection").mark("protocol-logged-in"),n}catch(n){throw this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(n)}}async logout(){await this.logoutCore(),await this.transport.close()}loggedIn(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)}domain(e,t,n){let r=this.sessions.find(s=>s.domain===e);return r||(r=Em(e,this,this.logger.subLogger(`domain=${e}`),t,n),this.sessions.push(r)),r}authToken(){const e={domain:"global",type:"create-token"};return this.globalDomain?this.globalDomain.send(e).then(t=>t.token):Promise.reject(new Error("no global domain session"))}reconnect(){return this.transport.reconnect()}setLoggedIn(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")}distributeMessage(e,t){const n=this.messageHandlers[t.toLowerCase()];n!==void 0&&Object.keys(n).forEach(r=>{const s=n[r];if(s!==void 0)try{s(e)}catch(o){try{this.logger.error(`Message handler failed with ${o.stack}`,o)}catch{console.log("Message handler failed",o)}}})}handleConnectionChanged(e){var t,n;this._connected!==e&&(this._connected=e,e?((n=(t=this.settings)==null?void 0:t.replaySpecs)!=null&&n.length&&(this.replayer=new Pk(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):(this.handleDisconnected(),this.registry.execute("disconnected")))}handleDisconnected(){if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.login(this.loginConfig,!0).catch(()=>{setTimeout(this.handleDisconnected.bind(this),this.settings.reconnectInterval||1e3)})}}handleTransportMessage(e){let t;typeof e=="string"?t=this.processStringMessage(e):t=this.processObjectMessage(e),this.isTrace&&this.logger.trace(`<< ${JSON.stringify(t)}`),this.distributeMessage(t.msg,t.msgType)}verifyConnection(){return za(e=>{let t;const n=Mk(2,()=>{t&&t(),e()});t=this.onLibReAnnounced(r=>{if(r.name==="interop"||r.name==="contexts")return n()})},1e4,"Transport switch timed out waiting for all libraries to be re-announced")}getNewSecondaryTransport(e){var t;if(!((t=e.transportConfig)!=null&&t.url))throw new Error("Missing secondary transport URL.");return new Am(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))}getNewSecondaryAuth(e){var t;if(!((t=e.transportConfig)!=null&&t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth}transportSwap(){if(this._swapTransport=!1,!this._targetTransport||!this._targetAuth){this.logger.warn(`Error while switching transports - either the target transport or auth is not defined: transport defined -> ${!!this._defaultTransport}, auth defined -> ${!!this._targetAuth}. Staying on the current one.`);return}this._transportSubscriptions.forEach(n=>n()),this._transportSubscriptions=[],this.transport=this._targetTransport;const e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}prepareDefaultSwap(){this._transportSubscriptions.forEach(e=>e()),this._transportSubscriptions=[],this.transport.close().catch(e=>this.logger.warn(`Error closing the ${this.transport.name()} transport after a failed connection attempt: ${JSON.stringify(e)}`)),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0}processStringMessage(e){const t=JSON.parse(e,(n,r)=>{if(typeof r!="string"||r.length<this.dateMinLen||!r.startsWith(this.datePrefixFirstChar)||r.substring(0,this.datePrefixLen)!==this.datePrefix)return r;try{const s=parseInt(r.substring(this.datePrefixLen,r.length),10);return isNaN(s)?r:new Date(s)}catch{return r}});return{msg:t,msgType:t.type}}createStringMessage(e){const t=Date.prototype.toJSON;try{const n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}}processObjectMessage(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}}createObjectMessage(e){return e}async loginCore(e,t){this.logger.info("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0;const n=await this.setupAuthConfig(e,t),r={type:"hello",identity:this.settings.identity,authentication:n};e.sessionId&&(r.request_id=e.sessionId),this.globalDomain=Em("global",this,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]);const s={skipPeerId:!0};this.initialLogin&&(s.retryInterval=this.settings.reconnectInterval,s.maxRetries=this.settings.reconnectAttempts);try{const o=await this.tryAuthenticate(this.globalDomain,r,s,e);return this.initialLogin=!1,this.logger.info("login successful with peerId "+o.peer_id),this.peerId=o.peer_id,this.resolvedIdentity=o.resolved_identity,this.availableDomains=o.available_domains,o.options&&(this.token=o.options.access_token,this.info=o.options.info),this.setLoggedIn(!0),o.resolved_identity}catch(o){throw this.logger.error("error sending hello message - "+(o.message||o.msg||o.reason||o),o),o}finally{e!=null&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null)}}async tryAuthenticate(e,t,n,r){let s;for(;;){const o=await e.send(t,void 0,n);if(o.type==="authentication-request"){const a=Buffer.from(o.authentication.token,"base64");r.flowCallback&&r.sessionId&&(t.authentication.token=(await r.flowCallback(r.sessionId,a)).data.toString("base64")),t.request_id=r.sessionId}else if(o.type==="welcome"){s=o;break}else throw o.type==="error"?new Error("Authentication failed: "+o.reason):new Error("Unexpected message type during authentication: "+o.type)}return s}async setupAuthConfig(e,t){const n={};if(this.gatewayToken=e.gatewayToken,e.gatewayToken){if(t)try{e.gatewayToken=await this.getNewGWToken()}catch(r){this.logger.warn(`failed to get GW token when reconnecting ${(r==null?void 0:r.message)||r}`)}n.method="gateway-token",n.token=e.gatewayToken,this.gatewayToken=e.gatewayToken}else if(e.flowName==="sspi")if(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId)n.token=(await e.flowCallback(e.sessionId,null)).data.toString("base64");else throw new Error("Invalid SSPI config");else if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else if(e.provider)n.provider=e.provider,n.providerContext=e.providerContext;else throw new Error("invalid auth message"+JSON.stringify(e));return n}async logoutCore(){this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer);const e=this.sessions.map(t=>{t.leave()});await Promise.all(e)}getNewGWToken(){if(typeof window<"u"){const e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))}ping(){this.shouldTryLogin&&(this._isLoggedIn&&this.send({type:"ping"}),this.pingTimer=setTimeout(()=>{this.ping()},30*1e3))}};const Pm=["trace","debug","info","warn","error","off"],Ai=class Ai{constructor(e,t,n){d(this,"name");d(this,"parent");d(this,"path");d(this,"subLoggers",[]);d(this,"_consoleLevel");d(this,"_publishLevel");d(this,"loggerFullName");d(this,"includeTimeAndLevel");d(this,"logFn",console);d(this,"customLogFn",!1);this.name=e,this.parent=t,this.name=e,t?this.path=`${t.path}.${e}`:this.path=e,this.loggerFullName=`[${this.path}]`,this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}subLogger(e){const t=this.subLoggers.filter(r=>r.name===e)[0];if(t!==void 0)return t;Object.keys(this).forEach(r=>{if(r===e)throw new Error("This sub logger name is not allowed.")});const n=new Ai(e,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(n),n}publishLevel(e){var t;return e&&(this._publishLevel=e),this._publishLevel||((t=this.parent)==null?void 0:t.publishLevel())}consoleLevel(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||((t=this.parent)==null?void 0:t.consoleLevel())}log(e,t,n){this.publishMessage(t||"info",e,n)}trace(e){this.log(e,"trace")}debug(e){this.log(e,"debug")}info(e){this.log(e,"info")}warn(e){this.log(e,"warn")}error(e,t){this.log(e,"error")}canPublish(e,t){const n=Pm.indexOf(e),r=Pm.indexOf(t||this.consoleLevel()||"trace");return n>=r}publishMessage(e,t,n){const r=this.loggerFullName;if(e==="error"&&!n){const s=new Error;s.stack&&(t=t+`
`+s.stack.split(`
`).slice(3).join(`
`))}if(this.canPublish(e,this.publishLevel())){const s=Ai.Interop;if(s)try{s.methods({name:Ai.InteropMethodName}).length>0&&s.invoke(Ai.InteropMethodName,{msg:`${t}`,logger:r,level:e})}catch{}}if(this.canPublish(e)){let s="";if(this.includeTimeAndLevel){const a=new Date;s=`[${`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}:${a.getMilliseconds()}`}] [${e}] `}const o=`${s}${r}: ${t}`;switch(e){case"trace":this.logFn.debug(o);break;case"debug":this.logFn.debug?this.logFn.debug(o):this.logFn.log(o);break;case"info":this.logFn.info(o);break;case"warn":this.logFn.warn(o);break;case"error":this.logFn.error(o,n);break}}}};d(Ai,"Interop"),d(Ai,"InteropMethodName","T42.AppLogger.Log"),d(Ai,"Instance");let bu=Ai;const Ab="create-context",Ua="created",qa="destroyed",Va="context-created",Ja="context-added",Eb="subscribe-context",Ji="subscribed-context",Pb="unsubscribe-context",Nb="destroy-context",Ka="context-destroyed",Bl="update-context",vs="context-updated",bs="joined",_u={get name(){return"context"},get types(){return[Ab,Ua,qa,Va,Ja,Eb,Ji,Pb,Nb,Ka,Bl,vs,bs]}};var Cu="6.4.0";function Dk(i,e,t){var p;let n;if(Pi.isNode()){const f=Hv._GD_STARTING_CONTEXT_;if(f)try{n=JSON.parse(f)}catch{}}function r(){var R;const f=i.gateway,w=(f==null?void 0:f.protocolVersion)??3,y=f==null?void 0:f.reconnectInterval,S=f==null?void 0:f.reconnectAttempts,O="ws://localhost:8385";let _=f==null?void 0:f.ws;const v=f==null?void 0:f.sharedWorker,C=f==null?void 0:f.inproc,T=(f==null?void 0:f.webPlatform)??void 0;t&&(_=t.gwURL),Pi.isNode()&&n&&n.gwURL&&(_=n.gwURL),!_&&!v&&!C&&(_=O);let M,$,G,E,D;const A=o();let x=A;typeof t<"u"?($=t.windowId,G=t.pid,t.env&&(E=t.env.env,D=t.env.region),x=t.application??"glue-app",M=t.appInstanceId):Pi.isNode()?(G=process.pid,n&&(E=n.env,D=n.region,M=n.instanceId)):typeof(window==null?void 0:window.glue42electron)<"u"&&($=window==null?void 0:window.glue42electron.instanceId,G=window==null?void 0:window.glue42electron.pid,E=window==null?void 0:window.glue42electron.env,D=window==null?void 0:window.glue42electron.region,x=(window==null?void 0:window.glue42electron.application)??"glue-app",M=window==null?void 0:window.glue42electron.instanceId);const N=((R=i.gateway)==null?void 0:R.replaySpecs)??[];N.push(_u);let b={application:x,applicationName:A,windowId:$,instance:M,process:G,region:D,environment:E,api:e.version||Cu};return i.identity&&(b=Object.assign(b,i.identity)),{identity:b,reconnectInterval:y,ws:_,sharedWorker:v,webPlatform:T,inproc:C,protocolVersion:w,reconnectAttempts:S,replaySpecs:N}}function s(){return typeof i.contexts>"u"?{reAnnounceKnownContexts:!0}:typeof i.contexts=="boolean"&&i.contexts?{reAnnounceKnownContexts:!0}:typeof i.contexts=="object"?Object.assign({},{reAnnounceKnownContexts:!0},i.contexts):!1}function o(){if(i.application)return i.application;if(t)return t.applicationName;if(typeof window<"u"&&typeof window.glue42electron<"u")return window.glue42electron.application;const f=oi(10);return Pi.isNode()?n?n.applicationConfig.name:"NodeJS"+f:typeof window<"u"&&typeof document<"u"?document.title+` (${f})`:f}function a(){var f,w,y;if(typeof i.auth=="string")return{token:i.auth};if(i.auth)return i.auth;if(Pi.isNode()&&n&&n.gwToken)return{gatewayToken:n.gwToken};if((f=i.gateway)!=null&&f.webPlatform||(w=i.gateway)!=null&&w.inproc||(y=i.gateway)!=null&&y.sharedWorker)return{username:"glue42",password:"glue42"}}function c(){let f=i.logger;const w="warn";f||(f=w);let y;return t&&(y=t.consoleLogLevel),typeof f=="string"?{console:y??f,publish:w}:{console:y??f.console??w,publish:f.publish??w}}const l=r();let u=o();if(typeof window<"u"){const f=window,w=f.htmlContainer?`${f.htmlContainer.containerName}.${f.htmlContainer.application}`:(p=f==null?void 0:f.glue42gd)==null?void 0:p.application;w&&(u=w)}return{bus:i.bus??!1,application:u,auth:a(),logger:c(),connection:l,metrics:i.metrics??!0,contexts:s(),version:e.version||Cu,libs:e.libs??[],customLogger:i.customLogger}}let Pa=class{constructor(e,t,n,r){d(this,"name");d(this,"contextId");d(this,"context");d(this,"isAnnounced");d(this,"joinedActivity");d(this,"updateCallbacks",{});d(this,"activityId");d(this,"sentExplicitSubscription");d(this,"hasReceivedSnapshot");this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=r,this.context={}}hasCallbacks(){return Object.keys(this.updateCallbacks).length>0}getState(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0}};var Su={exports:{}};Su.exports;(function(i,e){var t=200,n="__lodash_hash_undefined__",r=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",c="[object Date]",l="[object Error]",u="[object Function]",p="[object GeneratorFunction]",f="[object Map]",w="[object Number]",y="[object Object]",S="[object Promise]",O="[object RegExp]",_="[object Set]",v="[object String]",C="[object Symbol]",T="[object WeakMap]",M="[object ArrayBuffer]",$="[object DataView]",G="[object Float32Array]",E="[object Float64Array]",D="[object Int8Array]",A="[object Int16Array]",x="[object Int32Array]",N="[object Uint8Array]",b="[object Uint8ClampedArray]",R="[object Uint16Array]",z="[object Uint32Array]",V=/[\\^$.*+?()[\]{}|]/g,Q=/\w*$/,H=/^\[object .+?Constructor\]$/,ne=/^(?:0|[1-9]\d*)$/,J={};J[s]=J[o]=J[M]=J[$]=J[a]=J[c]=J[G]=J[E]=J[D]=J[A]=J[x]=J[f]=J[w]=J[y]=J[O]=J[_]=J[v]=J[C]=J[N]=J[b]=J[R]=J[z]=!0,J[l]=J[u]=J[T]=!1;var me=typeof ul=="object"&&ul&&ul.Object===Object&&ul,ge=typeof self=="object"&&self&&self.Object===Object&&self,ye=me||ge||Function("return this")(),Ee=e&&!e.nodeType&&e,It=Ee&&!0&&i&&!i.nodeType&&i,gt=It&&It.exports===Ee;function yn(h,I){return h.set(I[0],I[1]),h}function _r(h,I){return h.add(I),h}function io(h,I){for(var P=-1,q=h?h.length:0;++P<q&&I(h[P],P,h)!==!1;);return h}function ro(h,I){for(var P=-1,q=I.length,ve=h.length;++P<q;)h[ve+P]=I[P];return h}function Cr(h,I,P,q){for(var ve=-1,ke=h?h.length:0;++ve<ke;)P=I(P,h[ve],ve,h);return P}function so(h,I){for(var P=-1,q=Array(h);++P<h;)q[P]=I(P);return q}function oo(h,I){return h==null?void 0:h[I]}function Sr(h){var I=!1;if(h!=null&&typeof h.toString!="function")try{I=!!(h+"")}catch{}return I}function Ir(h){var I=-1,P=Array(h.size);return h.forEach(function(q,ve){P[++I]=[ve,q]}),P}function hi(h,I){return function(P){return h(I(P))}}function xr(h){var I=-1,P=Array(h.size);return h.forEach(function(q){P[++I]=q}),P}var ao=Array.prototype,co=Function.prototype,Mn=Object.prototype,jn=ye["__core-js_shared__"],kr=function(){var h=/[^.]+$/.exec(jn&&jn.keys&&jn.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),Tr=co.toString,st=Mn.hasOwnProperty,On=Mn.toString,lo=RegExp("^"+Tr.call(st).replace(V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ar=gt?ye.Buffer:void 0,Er=ye.Symbol,Pr=ye.Uint8Array,uo=hi(Object.getPrototypeOf,Object),ho=Object.create,po=Mn.propertyIsEnumerable,fo=ao.splice,Nr=Object.getOwnPropertySymbols,go=Ar?Ar.isBuffer:void 0,Rr=hi(Object.keys,Object),pi=Ht(ye,"DataView"),an=Ht(ye,"Map"),fi=Ht(ye,"Promise"),gi=Ht(ye,"Set"),mi=Ht(ye,"WeakMap"),cn=Ht(Object,"create"),mo=Tt(pi),yo=Tt(an),wo=Tt(fi),vo=Tt(gi),bo=Tt(mi),Mr=Er?Er.prototype:void 0,jr=Mr?Mr.valueOf:void 0;function xt(h){var I=-1,P=h?h.length:0;for(this.clear();++I<P;){var q=h[I];this.set(q[0],q[1])}}function _o(){this.__data__=cn?cn(null):{}}function Co(h){return this.has(h)&&delete this.__data__[h]}function So(h){var I=this.__data__;if(cn){var P=I[h];return P===n?void 0:P}return st.call(I,h)?I[h]:void 0}function Io(h){var I=this.__data__;return cn?I[h]!==void 0:st.call(I,h)}function xo(h,I){var P=this.__data__;return P[h]=cn&&I===void 0?n:I,this}xt.prototype.clear=_o,xt.prototype.delete=Co,xt.prototype.get=So,xt.prototype.has=Io,xt.prototype.set=xo;function Je(h){var I=-1,P=h?h.length:0;for(this.clear();++I<P;){var q=h[I];this.set(q[0],q[1])}}function ko(){this.__data__=[]}function To(h){var I=this.__data__,P=Dn(I,h);if(P<0)return!1;var q=I.length-1;return P==q?I.pop():fo.call(I,P,1),!0}function Ao(h){var I=this.__data__,P=Dn(I,h);return P<0?void 0:I[P][1]}function Eo(h){return Dn(this.__data__,h)>-1}function Po(h,I){var P=this.__data__,q=Dn(P,h);return q<0?P.push([h,I]):P[q][1]=I,this}Je.prototype.clear=ko,Je.prototype.delete=To,Je.prototype.get=Ao,Je.prototype.has=Eo,Je.prototype.set=Po;function Wt(h){var I=-1,P=h?h.length:0;for(this.clear();++I<P;){var q=h[I];this.set(q[0],q[1])}}function No(){this.__data__={hash:new xt,map:new(an||Je),string:new xt}}function Ro(h){return $n(this,h).delete(h)}function Mo(h){return $n(this,h).get(h)}function jo(h){return $n(this,h).has(h)}function Oo(h,I){return $n(this,h).set(h,I),this}Wt.prototype.clear=No,Wt.prototype.delete=Ro,Wt.prototype.get=Mo,Wt.prototype.has=jo,Wt.prototype.set=Oo;function Bt(h){this.__data__=new Je(h)}function Do(){this.__data__=new Je}function $o(h){return this.__data__.delete(h)}function Fo(h){return this.__data__.get(h)}function Lo(h){return this.__data__.has(h)}function Wo(h,I){var P=this.__data__;if(P instanceof Je){var q=P.__data__;if(!an||q.length<t-1)return q.push([h,I]),this;P=this.__data__=new Wt(q)}return P.set(h,I),this}Bt.prototype.clear=Do,Bt.prototype.delete=$o,Bt.prototype.get=Fo,Bt.prototype.has=Lo,Bt.prototype.set=Wo;function Bo(h,I){var P=vi(h)||la(h)?so(h.length,String):[],q=P.length,ve=!!q;for(var ke in h)st.call(h,ke)&&!(ve&&(ke=="length"||Se(ke,q)))&&P.push(ke);return P}function Or(h,I,P){var q=h[I];(!(st.call(h,I)&&Lr(q,P))||P===void 0&&!(I in h))&&(h[I]=P)}function Dn(h,I){for(var P=h.length;P--;)if(Lr(h[P][0],I))return P;return-1}function Ho(h,I){return h&&Dr(I,bi(I),h)}function yi(h,I,P,q,ve,ke,Ke){var Te;if(q&&(Te=ke?q(h,ve,ke,Ke):q(h)),Te!==void 0)return Te;if(!Fn(h))return h;var Hr=vi(h);if(Hr){if(Te=ia(h),!I)return ta(h,Te)}else{var Gt=kt(h),Gr=Gt==u||Gt==p;if(da(h))return Jo(h,I);if(Gt==y||Gt==s||Gr&&!ke){if(Sr(h))return ke?h:{};if(Te=ra(Gr?{}:h),!I)return ps(h,Ho(Te,h))}else{if(!J[Gt])return ke?h:{};Te=sa(h,Gt,yi,I)}}Ke||(Ke=new Bt);var zr=Ke.get(h);if(zr)return zr;if(Ke.set(h,Te),!Hr)var Ur=P?na(h):bi(h);return io(Ur||h,function(_i,Ln){Ur&&(Ln=_i,_i=h[Ln]),Or(Te,Ln,yi(_i,I,P,q,Ln,h,Ke))}),Te}function Go(h){return Fn(h)?ho(h):{}}function zo(h,I,P){var q=I(h);return vi(h)?q:ro(q,P(h))}function Uo(h){return On.call(h)}function qo(h){if(!Fn(h)||aa(h))return!1;var I=Br(h)||Sr(h)?lo:H;return I.test(Tt(h))}function Vo(h){if(!Fr(h))return Rr(h);var I=[];for(var P in Object(h))st.call(h,P)&&P!="constructor"&&I.push(P);return I}function Jo(h,I){if(I)return h.slice();var P=new h.constructor(h.length);return h.copy(P),P}function wi(h){var I=new h.constructor(h.byteLength);return new Pr(I).set(new Pr(h)),I}function Ko(h,I){var P=I?wi(h.buffer):h.buffer;return new h.constructor(P,h.byteOffset,h.byteLength)}function Qo(h,I,P){var q=I?P(Ir(h),!0):Ir(h);return Cr(q,yn,new h.constructor)}function Xo(h){var I=new h.constructor(h.source,Q.exec(h));return I.lastIndex=h.lastIndex,I}function Yo(h,I,P){var q=I?P(xr(h),!0):xr(h);return Cr(q,_r,new h.constructor)}function Zo(h){return jr?Object(jr.call(h)):{}}function ea(h,I){var P=I?wi(h.buffer):h.buffer;return new h.constructor(P,h.byteOffset,h.length)}function ta(h,I){var P=-1,q=h.length;for(I||(I=Array(q));++P<q;)I[P]=h[P];return I}function Dr(h,I,P,q){P||(P={});for(var ve=-1,ke=I.length;++ve<ke;){var Ke=I[ve],Te=void 0;Or(P,Ke,Te===void 0?h[Ke]:Te)}return P}function ps(h,I){return Dr(h,$r(h),I)}function na(h){return zo(h,bi,$r)}function $n(h,I){var P=h.__data__;return oa(I)?P[typeof I=="string"?"string":"hash"]:P.map}function Ht(h,I){var P=oo(h,I);return qo(P)?P:void 0}var $r=Nr?hi(Nr,Object):fa,kt=Uo;(pi&&kt(new pi(new ArrayBuffer(1)))!=$||an&&kt(new an)!=f||fi&&kt(fi.resolve())!=S||gi&&kt(new gi)!=_||mi&&kt(new mi)!=T)&&(kt=function(h){var I=On.call(h),P=I==y?h.constructor:void 0,q=P?Tt(P):void 0;if(q)switch(q){case mo:return $;case yo:return f;case wo:return S;case vo:return _;case bo:return T}return I});function ia(h){var I=h.length,P=h.constructor(I);return I&&typeof h[0]=="string"&&st.call(h,"index")&&(P.index=h.index,P.input=h.input),P}function ra(h){return typeof h.constructor=="function"&&!Fr(h)?Go(uo(h)):{}}function sa(h,I,P,q){var ve=h.constructor;switch(I){case M:return wi(h);case a:case c:return new ve(+h);case $:return Ko(h,q);case G:case E:case D:case A:case x:case N:case b:case R:case z:return ea(h,q);case f:return Qo(h,q,P);case w:case v:return new ve(h);case O:return Xo(h);case _:return Yo(h,q,P);case C:return Zo(h)}}function Se(h,I){return I=I??r,!!I&&(typeof h=="number"||ne.test(h))&&h>-1&&h%1==0&&h<I}function oa(h){var I=typeof h;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?h!=="__proto__":h===null}function aa(h){return!!kr&&kr in h}function Fr(h){var I=h&&h.constructor,P=typeof I=="function"&&I.prototype||Mn;return h===P}function Tt(h){if(h!=null){try{return Tr.call(h)}catch{}try{return h+""}catch{}}return""}function ca(h){return yi(h,!0,!0)}function Lr(h,I){return h===I||h!==h&&I!==I}function la(h){return ua(h)&&st.call(h,"callee")&&(!po.call(h,"callee")||On.call(h)==s)}var vi=Array.isArray;function Wr(h){return h!=null&&ha(h.length)&&!Br(h)}function ua(h){return pa(h)&&Wr(h)}var da=go||ga;function Br(h){var I=Fn(h)?On.call(h):"";return I==u||I==p}function ha(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=r}function Fn(h){var I=typeof h;return!!h&&(I=="object"||I=="function")}function pa(h){return!!h&&typeof h=="object"}function bi(h){return Wr(h)?Bo(h):Vo(h)}function fa(){return[]}function ga(){return!1}i.exports=ca})(Su,Su.exports);var $k=Su.exports,Fk=Tb($k);function Nm(i,e,t){try{if(t!=null&&t.canPublish("trace")&&(t==null||t.trace(`applying context delta ${JSON.stringify(e)} on context ${JSON.stringify(i)}`)),!e)return i;if(e.reset)return i={...e.reset},i;if(i=Hn(i,void 0),e.commands){for(const o of e.commands)o.type==="remove"?Wk(i,o.path):o.type==="set"&&Hl(i,o.value,o.path);return i}const n=e.added,r=e.updated,s=e.removed;return n&&Object.keys(n).forEach(o=>{i[o]=n[o]}),r&&Object.keys(r).forEach(o=>{Lk(o,i,r)}),s&&s.forEach(o=>{delete i[o]}),i}catch(n){return t==null||t.error(`error applying context delta ${JSON.stringify(e)} on context ${JSON.stringify(i)}`,n),i}}function Hn(i,e){return Fk(i)}const Lk=(i,e,t)=>{const n=t[i];if(n===void 0)return e;const r=e[i];return!r||!n||typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof n=="string"||typeof n=="number"||typeof n=="boolean"||Array.isArray(r)||Array.isArray(n)?(e[i]=n,e):(e[i]=Object.assign({},r,n),e)};function Qa(i,e){if(i===e)return!0;if(!(i instanceof Object)||!(e instanceof Object)||i.constructor!==e.constructor)return!1;for(const t in i)if(i.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return!1;if(i[t]!==e[t]&&(typeof i[t]!="object"||!Qa(i[t],e[t])))return!1}for(const t in e)if(e.hasOwnProperty(t)&&!i.hasOwnProperty(t))return!1;return!0}function Hl(i,e,t){const n=t.split(".");let r;for(r=0;r<n.length-1;r++)i[n[r]]||(i[n[r]]={}),typeof i[n[r]]!="object"&&(i[n[r]]={}),i=i[n[r]];i[n[r]]=e}function Rb(i,e){return Object.keys(e).every(t=>typeof e[t]=="object"?Rb((i==null?void 0:i[t])||{},e[t]||{}):e[t]===(i==null?void 0:i[t]))}function Wk(i,e){const t=e.split(".");let n;for(n=0;n<t.length-1;n++){if(!i[t[n]])return;i=i[t[n]]}delete i[t[n]]}class Bk{constructor(e){d(this,"_logger");d(this,"_connection");d(this,"_trackAllContexts");d(this,"_reAnnounceKnownContexts");d(this,"_gw3Session");d(this,"_contextNameToData",{});d(this,"_gw3Subscriptions",[]);d(this,"_nextCallbackSubscriptionNumber",0);d(this,"_creationPromises",{});d(this,"_contextNameToId",{});d(this,"_contextIdToName",{});d(this,"_protocolVersion");d(this,"_contextsTempCache",{});d(this,"_contextsSubscriptionsCache",[]);d(this,"_systemContextsSubKey");var t;this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[Va,Ji,Ka,vs]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined(n=>{if(n){if(!this._reAnnounceKnownContexts)return this._connection.setLibReAnnounced({name:"contexts"});this.reInitiateState().then(()=>this._connection.setLibReAnnounced({name:"contexts"}))}}),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),(t=this._connection.replayer)==null||t.drain(_u.name,n=>{const r=n.type;r&&(r===Va||r===Ja||r===Ua?this.handleContextCreatedMessage(n):r===Ji||r===vs||r===bs?this.handleContextUpdatedMessage(n):(r===Ka||r===qa)&&this.handleContextDestroyedMessage(n))})}get protocolVersion(){if(!this._protocolVersion){const e=this._connection.availableDomains.find(t=>t.uri==="context");this._protocolVersion=(e==null?void 0:e.version)??1}return this._protocolVersion}get setPathSupported(){return this.protocolVersion>=2}dispose(){for(const e of this._gw3Subscriptions)this._connection.off(e);this._gw3Subscriptions.length=0;for(const e in this._contextNameToData)this._contextNameToId.hasOwnProperty(e)&&delete this._contextNameToData[e]}createContext(e,t){return e in this._creationPromises?this._creationPromises[e]:(this._creationPromises[e]=this._gw3Session.send({type:Ab,domain:"global",name:e,data:t,lifetime:"retained"}).then(n=>{this._contextNameToId[e]=n.context_id,this._contextIdToName[n.context_id]=e;const r=this._contextNameToData[e]||new Pa(n.context_id,e,!0,void 0);return r.isAnnounced=!0,r.name=e,r.contextId=n.context_id,r.context=n.data||Hn(t),r.hasReceivedSnapshot=!0,this._contextNameToData[e]=r,delete this._creationPromises[e],n.context_id}),this._creationPromises[e])}all(){return Object.keys(this._contextNameToData).filter(e=>this._contextNameToData[e].isAnnounced)}async update(e,t){var o;t&&(t=Hn(t)),e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];if(!n||!n.isAnnounced)return this.createContext(e,t);let r=n.context;n.hasCallbacks()||(r=await this.get(n.name));const s=this.setPathSupported?this.calculateContextDeltaV2(r,t):this.calculateContextDeltaV1(r,t);return!Object.keys(s.added).length&&!Object.keys(s.updated).length&&!s.removed.length&&!((o=s.commands)!=null&&o.length)?Promise.resolve():this._gw3Session.send({type:Bl,domain:"global",context_id:n.contextId,delta:s},{},{skipPeerId:!1}).then(a=>{this.handleUpdated(n,s,{updaterId:a.peer_id})})}async set(e,t){t&&(t=Hn(t)),e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];return!n||!n.isAnnounced?this.createContext(e,t):this._gw3Session.send({type:Bl,domain:"global",context_id:n.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then(r=>{this.handleUpdated(n,{reset:t,added:{},removed:[],updated:{}},{updaterId:r.peer_id})})}setPath(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")}async setPaths(e,t){if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");t&&(t=Hn(t)),e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];if(!n||!n.isAnnounced){const s={};for(const o of t)Hl(s,o.value,o.path);return this.createContext(e,s)}const r=[];for(const s of t)s.value===null?r.push({type:"remove",path:s.path}):r.push({type:"set",path:s.path,value:s.value});return this._gw3Session.send({type:Bl,domain:"global",context_id:n.contextId,delta:{commands:r}},{},{skipPeerId:!1}).then(s=>{this.handleUpdated(n,{added:{},removed:[],updated:{},commands:r},{updaterId:s.peer_id})})}async get(e){e in this._creationPromises&&await this._creationPromises[e];const t=this._contextNameToData[e];if(!t||!t.isAnnounced)return Promise.resolve({});if(t&&(!t.hasCallbacks()||!t.hasReceivedSnapshot))return new Promise(r=>{this.subscribe(e,(s,o,a,c)=>{this.unsubscribe(c),r(s)})});const n=(t==null?void 0:t.context)??{};return Promise.resolve(Hn(n))}async subscribe(e,t,n){e in this._creationPromises&&await this._creationPromises[e];const r=typeof n>"u"?this._nextCallbackSubscriptionNumber:n;typeof n>"u"&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every(a=>a.subKey!==this._nextCallbackSubscriptionNumber)&&this._contextsSubscriptionsCache.push({contextName:e,subKey:r,callback:t});let s=this._contextNameToData[e];if(!s||!s.isAnnounced)return s=s||new Pa(void 0,e,!1,void 0),this._contextNameToData[e]=s,s.updateCallbacks[r]=t,Promise.resolve(r);const o=s.hasCallbacks();if(s.updateCallbacks[r]=t,o){if(s.hasReceivedSnapshot){const a=Hn(s.context);t(a,a,[],r)}return Promise.resolve(r)}else if(s.joinedActivity){if(s.hasReceivedSnapshot){const a=Hn(s.context);t(a,a,[],r)}return Promise.resolve(r)}else{if(s.context&&s.sentExplicitSubscription){if(s.hasReceivedSnapshot){const a=Hn(s.context);t(a,a,[],r)}return Promise.resolve(r)}return this.sendSubscribe(s).then(()=>r)}}unsubscribe(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter(t=>t.subKey!==e);for(const t of Object.keys(this._contextNameToData)){const n=this._contextNameToData[t];if(!n)return;const r=n.hasCallbacks();delete n.updateCallbacks[e],n.isAnnounced&&r&&!n.hasCallbacks()&&n.sentExplicitSubscription&&this.sendUnsubscribe(n).catch(()=>{}),!n.isAnnounced&&!n.hasCallbacks()&&delete this._contextNameToData[t]}}async destroy(e){e in this._creationPromises&&await this._creationPromises[e];const t=this._contextNameToData[e];return t?this._gw3Session.send({type:Nb,domain:"global",context_id:t.contextId}).then(n=>{}):Promise.reject(`context with ${e} does not exist`)}handleUpdated(e,t,n){const r=e.context;e.context=Nm(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]===e&&!Qa(r,e.context)&&this.invokeUpdateCallbacks(e,t,n)}subscribeToContextCreatedMessages(){const e=[Ja,Va,Ua];for(const t of e){const n=this._connection.on(t,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(n)}}handleContextCreatedMessage(e){const t=e.type;t===Ua?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):t===Ja&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);const n=this._contextIdToName[e.context_id];if(!n)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[n])throw new Error("Received created event for context with unknown id: "+e.context_id);let r=this._contextNameToData[n];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=e.context_id,r.activityId=e.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[n]=r=new Pa(e.context_id,n,!0,e.activity_id),this._trackAllContexts&&this.subscribe(n,()=>{}).then(s=>this._systemContextsSubKey=s)}subscribeToContextUpdatedMessages(){const e=[vs,Ji,bs];for(const t of e){const n=this._connection.on(t,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(n)}}handleContextUpdatedMessage(e){const t=e.type,n=e.context_id;let r=this._contextNameToData[this._contextIdToName[n]];const s=!r||!r.isAnnounced;if(t===bs)r||(r=this._contextNameToData[e.activity_id]||new Pa(n,e.activity_id,!0,e.activity_id)),this._contextNameToData[e.activity_id]=r,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n,r.contextId=n,r.isAnnounced=!0,r.activityId=e.activity_id,r.joinedActivity=!0;else if(!r||!r.isAnnounced){t===Ji?(r=r||new Pa(n,e.name,!0,void 0),r.sentExplicitSubscription=!0,this._contextNameToData[e.name]=r,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error(`Received 'update' for unknown context: ${n}`);return}const o=r.context;if(r.hasReceivedSnapshot=!0,t===Ji)r.context=e.data||{};else if(t===bs)r.context=e.context_snapshot||{};else if(t===vs)r.context=Nm(r.context,e.delta,this._logger);else throw new Error("Unrecognized context update message "+t);(s||!Qa(r.context,o)||t===Ji)&&this.invokeUpdateCallbacks(r,e.delta,{updaterId:e.updater_id})}invokeUpdateCallbacks(e,t,n){if(t=t||{added:{},updated:{},reset:{},removed:[]},t.commands){t.added=t.updated=t.reset={},t.removed=[];for(const r of t.commands)r.type==="remove"?(r.path.indexOf(".")===-1&&t.removed.push(r.path),Hl(t.updated,null,r.path)):r.type==="set"&&Hl(t.updated,r.value,r.path)}for(const r in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(r))try{const s=e.updateCallbacks[r];s(Hn(e.context),Hn(Object.assign({},t.added||{},t.updated||{},t.reset||{})),t.removed,parseInt(r,10),n)}catch(s){this._logger.debug("callback error: "+JSON.stringify(s))}}subscribeToContextDestroyedMessages(){const e=[Ka,qa];for(const t of e){const n=this._connection.on(t,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(n)}}handleContextDestroyedMessage(e){const t=e.type;let n,r;if(t===qa){if(r=e.activity_id,n=this._contextNameToId[r],!n){this._logger.error(`Received 'destroyed' for unknown activity: ${e.activity_id}`);return}}else if(n=e.context_id,r=this._contextIdToName[n],!r){this._logger.error(`Received 'destroyed' for unknown context: ${e.context_id}`);return}delete this._contextIdToName[n],delete this._contextNameToId[r];const s=this._contextNameToData[r];if(delete this._contextNameToData[r],!s||!s.isAnnounced){this._logger.error(`Received 'destroyed' for unknown context: ${n}`);return}}sendSubscribe(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:Eb,domain:"global",context_id:e.contextId}).then(t=>{})}sendUnsubscribe(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:Pb,domain:"global",context_id:e.contextId}).then(t=>{})}calculateContextDeltaV1(e,t){const n={added:{},updated:{},removed:[],reset:void 0};if(e)for(const r of Object.keys(e))Object.keys(t).indexOf(r)!==-1&&t[r]!==null&&!Qa(e[r],t[r])&&(n.updated[r]=t[r]);for(const r of Object.keys(t))!e||Object.keys(e).indexOf(r)===-1?t[r]!==null&&(n.added[r]=t[r]):t[r]===null&&n.removed.push(r);return n}calculateContextDeltaV2(e,t){var r,s;const n={added:{},updated:{},removed:[],reset:void 0,commands:[]};for(const o of Object.keys(t))if(t[o]!==null){const a=e?e[o]:null;Qa(a,t[o])||(r=n.commands)==null||r.push({type:"set",path:o,value:t[o]})}else(s=n.commands)==null||s.push({type:"remove",path:o});return n}resetState(){for(const e of this._gw3Subscriptions)this._connection.off(e);this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((e,t)=>(e[t]=this._contextNameToData[t].context,e),{}),this._contextNameToData={}}async reInitiateState(){var e;this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),(e=this._connection.replayer)==null||e.drain(_u.name,t=>{const n=t.type;n&&(n===Va||n===Ja||n===Ua?this.handleContextCreatedMessage(t):n===Ji||n===vs||n===bs?this.handleContextUpdatedMessage(t):(n===Ka||n===qa)&&this.handleContextDestroyedMessage(t))}),await Promise.all(this._contextsSubscriptionsCache.map(t=>this.subscribe(t.contextName,t.callback,t.subKey))),await this.flushQueue();for(const t in this._contextsTempCache){if(typeof this._contextsTempCache[t]!="object"||Object.keys(this._contextsTempCache[t]).length===0)continue;const n=this._contextsTempCache[t];this._logger.info(`Re-announcing known context: ${t}`),await this.flushQueue(),await this.update(t,n)}this._contextsTempCache={},this._logger.info("Contexts are re-announced")}flushQueue(){return new Promise(e=>setTimeout(()=>e(),0))}}let Hk=class{constructor(e){d(this,"initTime");d(this,"initStartTime");d(this,"initEndTime");d(this,"_bridge");this._bridge=new Bk(e)}all(){return this._bridge.all()}update(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)}set(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)}setPath(e,t,n){return this.checkName(e),this.checkPath(t),t===""?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)}setPaths(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(const{path:n,value:r}of t)this.checkPath(n),n===""&&this.checkData(r);return this._bridge.setPaths(e,t)}subscribe(e,t){if(this.checkName(e),typeof t!="function")throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(n,r,s,o,a)=>t(n,r,s,()=>this._bridge.unsubscribe(o),a)).then(n=>()=>{this._bridge.unsubscribe(n)})}get(e){return this.checkName(e),this._bridge.get(e)}ready(){return Promise.resolve(this)}destroy(e){return this.checkName(e),this._bridge.destroy(e)}get setPathSupported(){return this._bridge.setPathSupported}checkName(e){if(typeof e!="string"||e==="")throw new Error("Please provide the name as a non-empty string!")}checkPath(e){if(typeof e!="string")throw new Error("Please provide the path as a dot delimited string!")}checkData(e){if(typeof e!="object")throw new Error("Please provide the data as an object!")}};function vp(i,e,t){return typeof e!="function"&&typeof t!="function"?i:(typeof e!="function"?e=()=>{}:typeof t!="function"&&(t=()=>{}),i.then(e,t))}function Gk(i=0,e,t){let n;const r=()=>{n&&clearTimeout(n)};return e.then(()=>{r()}).catch(()=>{r()}),new Promise((s,o)=>{n=setTimeout(()=>o(t),i)})}var Mi;(function(i){i[i.Success=0]="Success",i[i.Error=1]="Error"})(Mi||(Mi={}));let zk=class{constructor(e,t,n,r){d(this,"protocol");d(this,"repo");d(this,"instance");d(this,"configuration");this.protocol=e,this.repo=t,this.instance=n,this.configuration=r}subscribe(e,t,n,r,s){const o=(c,l,u,p)=>{t.methodResponseTimeout=t.methodResponseTimeout??t.waitTimeoutMs,this.protocol.client.subscribe(l,t,c,u,p,s)},a=new Promise((c,l)=>{const u=_=>{c(_)},p=_=>{l(_)};if(!e){l("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");return}let f;if(typeof e=="string"?f={name:e}:f=e,!f.name){l("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");return}t===void 0&&(t={});let w=t.target;if(w===void 0&&(w="best"),typeof w=="string"&&w!=="all"&&w!=="best"){l(new Error(`"${w}" is not a valid target. Valid targets are "all", "best", or an instance.`));return}t.methodResponseTimeout===void 0&&(t.methodResponseTimeout=t.method_response_timeout,t.methodResponseTimeout===void 0&&(t.methodResponseTimeout=this.configuration.methodResponseTimeout)),t.waitTimeoutMs===void 0&&(t.waitTimeoutMs=t.wait_for_method_timeout,t.waitTimeoutMs===void 0&&(t.waitTimeoutMs=this.configuration.waitTimeoutMs));const y=500;let S=0,O=this.getServerMethodsByFilterAndTarget(f,w);if(O.length>0)o(O,O[0].methods[0],u,p);else{const _=()=>{if(!(!w||!t.waitTimeoutMs))if(S+=y,O=this.getServerMethodsByFilterAndTarget(f,w),O.length>0){const v=O[0].methods[0];o(O,v,u,p)}else S>=t.waitTimeoutMs?o(O,typeof e=="string"?{name:e}:e,u,p):setTimeout(_,y)};setTimeout(_,y)}});return vp(a,n,r)}servers(e){const t=e===void 0?void 0:{...e};return this.getServers(t).map(n=>n.server.instance)}methods(e){return typeof e=="string"?e={name:e}:e={...e},this.getMethods(e)}methodsForInstance(e){return this.getMethodsForInstance(e)}methodAdded(e){return this.repo.onMethodAdded(e)}methodRemoved(e){return this.repo.onMethodRemoved(e)}serverAdded(e){return this.repo.onServerAdded(e)}serverRemoved(e){return this.repo.onServerRemoved((t,n)=>{e(t,n)})}serverMethodAdded(e){return this.repo.onServerMethodAdded((t,n)=>{e({server:t,method:n})})}serverMethodRemoved(e){return this.repo.onServerMethodRemoved((t,n)=>{e({server:t,method:n})})}async invoke(e,t,n,r,s,o){return vp((async()=>{var O;let c;if(typeof e=="string"?c={name:e}:c={...e},!c.name)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if(t||(t={}),n||(n="best"),typeof n=="string"&&n!=="all"&&n!=="best"&&n!=="skipMine")return Promise.reject(new Error(`"${n}" is not a valid target. Valid targets are "all" and "best".`));if(r||(r={}),r.methodResponseTimeoutMs===void 0&&(r.methodResponseTimeoutMs=r.method_response_timeout,r.methodResponseTimeoutMs===void 0&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),r.waitTimeoutMs===void 0&&(r.waitTimeoutMs=r.wait_for_method_timeout,r.waitTimeoutMs===void 0&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),r.waitTimeoutMs!==void 0&&typeof r.waitTimeoutMs!="number")return Promise.reject(new Error(`"${r.waitTimeoutMs}" is not a valid number for "waitTimeoutMs" `));if(typeof t!="object")return Promise.reject(new Error(`The method arguments must be an object. method: ${c.name}`));let l=this.getServerMethodsByFilterAndTarget(c,n);if(l.length===0)try{l=await this.tryToAwaitForMethods(c,n,r)}catch{const C={method:{...c,getServers:()=>[],supportsStreaming:!1,objectTypes:c.objectTypes??[],flags:((O=c.flags)==null?void 0:O.metadata)??{}},called_with:t,message:`Can not find a method matching ${JSON.stringify(e)} with server filter ${JSON.stringify(n)}`,executed_by:void 0,returned:void 0,status:void 0};return Promise.reject(C)}const u=r.methodResponseTimeoutMs,p=r,f=l.map(_=>{const v=oi(10),C=_.methods[0],T=_.server,M=this.protocol.client.invoke(v,C,t,T,p);return Promise.race([M,Gk(u,M,{invocationId:v,message:`Invocation timeout (${u} ms) reached for method name: ${C==null?void 0:C.name}, target instance: ${JSON.stringify(T.instance)}, options: ${JSON.stringify(p)}`,status:Mi.Error})])}),w=await Promise.all(f),y=this.getInvocationResultObj(w,c,t);return w.every(_=>_.status===Mi.Error)?Promise.reject(y):y})(),s,o)}getInvocationResultObj(e,t,n){const r=e.filter(c=>c.status===Mi.Success).reduce((c,l)=>(c=[...c,{executed_by:l.instance,returned:l.result,called_with:n,method:t,message:l.message,status:l.status}],c),[]),s=e.filter(c=>c.status===Mi.Error).reduce((c,l)=>(c=[...c,{executed_by:l.instance,called_with:n,name:t.name,message:l.message}],c),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:s,message:o.message,status:o.status}}tryToAwaitForMethods(e,t,n){return new Promise((r,s)=>{if(n.waitTimeoutMs===0){s();return}const o=500;let a=0;const l=setInterval(()=>{a+=o;const u=this.getServerMethodsByFilterAndTarget(e,t);if(u.length>0)clearInterval(l),r(u);else if(a>=(n.waitTimeoutMs||1e4)){clearInterval(l),s();return}},o)})}filterByTarget(e,t){if(typeof e=="string"){if(e==="all")return[...t];if(e==="best"){const n=t.find(r=>r.server.instance.isLocal);if(n)return[n];if(t[0]!==void 0)return[t[0]]}else if(e==="skipMine")return t.filter(({server:n})=>n.instance.peerId!==this.instance.peerId)}else{let n;return Array.isArray(e)?n=e:n=[e],n.reduce((s,o)=>{const a=t.filter(c=>this.instanceMatch(o,c.server.instance));return s.concat(a)},[])}return[]}instanceMatch(e,t){return this.containsProps(e,t)}methodMatch(e,t){return this.containsProps(e,t)}containsProps(e,t){return Object.keys(e).filter(r=>e[r]!==void 0&&e[r]!==null&&typeof e[r]!="function"&&r!=="object_types"&&r!=="display_name"&&r!=="id"&&r!=="gatewayId"&&r!=="identifier"&&r[0]!=="_").every(r=>{let s;const o=e[r],a=t[r];switch(r){case"objectTypes":s=(o||[]).every(c=>(a||[]).includes(c));break;case"flags":s=Rb(a||{},o||{});break;default:s=String(o).toLowerCase()===String(a).toLowerCase()}return s})}getMethods(e){return e===void 0?this.repo.getMethods():this.repo.getMethods().filter(n=>this.methodMatch(e,n))}getMethodsForInstance(e){const n=this.repo.getServers().filter(s=>this.instanceMatch(e,s.instance));if(n.length===0)return[];let r={};return n.length===1?r=n[0].methods:n.forEach(s=>{Object.keys(s.methods).forEach(o=>{const a=s.methods[o];r[a.identifier]=a})}),Object.keys(r).map(s=>r[s])}getServers(e){const t=this.repo.getServers();return e===void 0?t.map(n=>({server:n,methods:[]})):t.reduce((n,r)=>{const o=Object.values(r.methods).filter(a=>this.methodMatch(e,a));return o.length>0&&n.push({server:r,methods:o}),n},[])}getServerMethodsByFilterAndTarget(e,t){const n=this.getServers(e);return this.filterByTarget(t,n)}},Iu=class{constructor(e,t,n){d(this,"protocol");d(this,"repoMethod");d(this,"subscription");this.protocol=e,this.repoMethod=t,this.subscription=n}get stream(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream}get arguments(){return this.subscription.arguments||{}}get branchKey(){return this.subscription.branchKey}get instance(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance}close(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)}push(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)}},Uk=class{constructor(e,t,n){d(this,"protocol");d(this,"repoMethod");d(this,"requestContext");d(this,"arguments");d(this,"instance");this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}accept(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")}acceptOnBranch(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)}reject(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)}},qk=class{constructor(e,t){d(this,"protocol");d(this,"server");this.protocol=e,this.server=t,e.server.onSubRequest((n,r)=>this.handleSubRequest(n,r)),e.server.onSubAdded((n,r)=>this.handleSubAdded(n,r)),e.server.onSubRemoved((n,r)=>this.handleSubRemoved(n,r))}handleSubRequest(e,t){if(!(t&&t.streamCallbacks&&typeof t.streamCallbacks.subscriptionRequestHandler=="function"))return;const n=new Uk(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}handleSubAdded(e,t){if(!(t&&t.streamCallbacks&&typeof t.streamCallbacks.subscriptionAddedHandler=="function"))return;const n=new Iu(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}handleSubRemoved(e,t){if(!(t&&t.streamCallbacks&&typeof t.streamCallbacks.subscriptionRemovedHandler=="function"))return;const n=new Iu(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},Rm=class{constructor(e,t,n){d(this,"key");d(this,"protocol");d(this,"repoMethod");this.key=e,this.protocol=t,this.repoMethod=n}subscriptions(){return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map(t=>new Iu(this.protocol,this.repoMethod,t))}close(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)}push(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])}},Vk=class{constructor(e,t,n){d(this,"_protocol");d(this,"_repoMethod");d(this,"_server");d(this,"name");this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}branches(e){const t=this._protocol.server.getBranchList(this._repoMethod);return e?t.indexOf(e)>-1?new Rm(e,this._protocol,this._repoMethod):void 0:t.map(n=>new Rm(n,this._protocol,this._repoMethod))}branch(e){return this.branches(e)}subscriptions(){return this._protocol.server.getSubscriptionList(this._repoMethod).map(t=>new Iu(this._protocol,this._repoMethod,t))}get definition(){var t;const e=this._repoMethod.definition;return{accepts:e.accepts,description:e.description,displayName:e.displayName,name:e.name,objectTypes:e.objectTypes,returns:e.returns,supportsStreaming:e.supportsStreaming,flags:(t=e.flags)==null?void 0:t.metadata}}close(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)}push(e,t){if(typeof t!="string"&&!Array.isArray(t)&&t!==void 0)throw new Error("invalid branches should be string or string array");if(typeof e!="object")throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)}updateRepoMethod(e){this._repoMethod=e}},Jk=class{constructor(e,t){d(this,"protocol");d(this,"serverRepository");d(this,"streaming");d(this,"invocations",0);d(this,"currentlyUnregistering",{});this.protocol=e,this.serverRepository=t,this.streaming=new qk(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}createStream(e,t,n,r,s){const o=new Promise((a,c)=>{if(!e){c("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.");return}let l;if(typeof e=="string"?l={name:""+e}:l={...e},!l.name)return c(`The name property is required for the streamDefinition object and must be unique. Stream definition: ${JSON.stringify(l)}`);if(this.serverRepository.getList().some(f=>f.definition.name===l.name))return c(`A stream with the name "${l.name}" already exists! Please, provide a unique name for the stream.`);l.supportsStreaming=!0,t||(t={}),typeof t.subscriptionRequestHandler!="function"&&(t.subscriptionRequestHandler=f=>{f.accept()});const p=this.serverRepository.add({definition:l,streamCallbacks:t,protocolState:{}});this.protocol.server.createStream(p).then(()=>{let f;s?(f=s,s.updateRepoMethod(p)):f=new Vk(this.protocol,p,this),p.stream=f,a(f)}).catch(f=>{p.repoId&&this.serverRepository.remove(p.repoId),c(f)})});return vp(o,n,r)}register(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if(typeof t!="function")return Promise.reject(`The second parameter must be a callback function. Method: ${typeof e=="string"?e:e.name}`);const n=async(r,s)=>{try{const o=t(r.args,r.instance);if(o&&typeof o.then=="function"){const a=await o;s(void 0,a)}else s(void 0,o)}catch(o){s(o??"",o??"")}};return n.userCallback=t,this.registerCore(e,n)}registerAsync(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if(typeof t!="function")return Promise.reject(`The second parameter must be a callback function. Method: ${typeof e=="string"?e:e.name}`);const n=async(r,s)=>{try{let o=!1;const a=u=>{o||s(void 0,u),o=!0},c=u=>{o||(u||(u=""),s(u,u)),o=!0},l=t(r.args,r.instance,a,c);l&&typeof l.then=="function"&&l.then(a).catch(c)}catch(o){s(o,void 0)}};return n.userCallbackAsync=t,this.registerCore(e,n)}async unregister(e,t=!1){if(e===void 0)return Promise.reject("Please, provide either a unique string for a name or an object containing a name property.");if(typeof e=="function"){await this.unregisterWithPredicate(e,t);return}let n;if(typeof e=="string"?n={name:e}:n=e,n.name===void 0)return Promise.reject("Method name is required. Cannot find a method if the method name is undefined!");const r=this.serverRepository.getList().find(s=>s.definition.name===n.name&&(s.definition.supportsStreaming||!1)===t);if(!r)return Promise.reject(`Method with a name "${n.name}" does not exist or is not registered by your application!`);await this.removeMethodsOrStreams([r])}async unregisterWithPredicate(e,t){const n=this.serverRepository.getList().filter(r=>e(r.definition)).filter(r=>(r.definition.supportsStreaming||!1)===t);if(!n||n.length===0)return Promise.reject(`Could not find a ${t?"stream":"method"} matching the specified condition!`);await this.removeMethodsOrStreams(n)}removeMethodsOrStreams(e){const t=[];return e.forEach(n=>{const r=this.protocol.server.unregister(n).then(()=>{n.repoId&&this.serverRepository.remove(n.repoId)});t.push(r),this.addAsCurrentlyUnregistering(n.definition.name,r)}),Promise.all(t)}async addAsCurrentlyUnregistering(e,t){const n=new Promise(r=>setTimeout(r,5e3));this.currentlyUnregistering[e]=Promise.race([t,n]).then(()=>{delete this.currentlyUnregistering[e]})}async registerCore(e,t){let n;if(typeof e=="string"?n={name:""+e}:n={...e},!n.name)return Promise.reject(`Please, provide a (unique) string value for the name property in the methodDefinition object: ${JSON.stringify(e)}`);const r=this.currentlyUnregistering[n.name];if(typeof r<"u"&&await r,this.serverRepository.getList().some(a=>a.definition.name===n.name))return Promise.reject(`A method with the name "${n.name}" already exists! Please, provide a unique name for the method.`);if(n.supportsStreaming)return Promise.reject(`When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want ${n.name} to be a stream, please use the glue.interop.createStream() method.`);const o=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}});return this.protocol.server.register(o).catch(a=>{throw o!=null&&o.repoId&&this.serverRepository.remove(o.repoId),a})}onMethodInvoked(e,t,n){!e||!e.theFunction||e.theFunction(n,(r,s)=>{if(r!=null){if(r.message&&typeof r.message=="string")r=r.message;else if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=`un-stringifyable error in onMethodInvoked! Top level prop names: ${Object.keys(r)}`}}s?(typeof s!="object"||Array.isArray(s))&&(s={_value:s}):s={},this.protocol.server.methodInvocationResult(e,t,r,s)})}},Mb=class{constructor(e,t,n){d(this,"wrapped",{});this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter(r=>r.supportsStreaming)},t&&this.refreshWrappedObject(t),n&&(n.loggedIn(()=>{this.refresh(n)}),this.refresh(n))}unwrap(){return this.wrapped}refresh(e){if(!e)return;const t=e==null?void 0:e.resolvedIdentity,n=Object.assign({},t??{},{peerId:e==null?void 0:e.peerId});this.refreshWrappedObject(n)}refreshWrappedObject(e){Object.keys(e).forEach(t=>{this.wrapped[t]=e[t]}),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=e.application??oi(10),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=e.pid??e.process??Math.floor(Math.random()*1e10),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=e.isLocal??!0,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId}};const dl=i=>({...i,flags:i.flags.metadata||{}});let Kk=class{constructor(e,t){d(this,"logger");d(this,"API");d(this,"servers",{});d(this,"myServer");d(this,"methodsCount",{});d(this,"callbacks",Gi());this.logger=e,this.API=t;const n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}addServer(e,t){this.logger.debug(`adding server ${t}`);const n=this.servers[t];if(n)return n.id;const r=new Mb(this.API,e),s={id:t,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[t]=s,this.callbacks.execute("onServerAdded",s.instance),t}removeServerById(e,t){const n=this.servers[e];if(n)this.logger.debug(`removing server ${e}`);else{this.logger.warn(`not aware of server ${e}, my state ${JSON.stringify(Object.keys(this.servers))}`);return}Object.keys(n.methods).forEach(r=>{this.removeServerMethod(e,r)}),delete this.servers[e],this.callbacks.execute("onServerRemoved",n.instance,t)}addServerMethod(e,t){const n=this.servers[e];if(!n)throw new Error("server does not exists");if(n.methods[t.id])return;const r=this.createMethodIdentifier(t),s=this,o={identifier:r,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:typeof t.flags<"u"?t.flags.streaming:!1,flags:t.flags??{},getServers:()=>s.getServersByMethod(r)};o.object_types=o.objectTypes,o.display_name=o.displayName,o.version=o.version,n.methods[t.id]=o;const a=dl(o);return this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",a)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",n.instance,a),o}removeServerMethod(e,t){const n=this.servers[e];if(!n)throw new Error("server does not exists");const r=n.methods[t];delete n.methods[t];const s=dl(r);this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,this.methodsCount[r.identifier]===0&&this.callbacks.execute("onMethodRemoved",s),this.callbacks.execute("onServerMethodRemoved",n.instance,s)}getMethods(){return this.extractMethodsFromServers(Object.values(this.servers)).map(dl)}getServers(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)}onServerAdded(e){const t=this.callbacks.add("onServerAdded",e),n=this.getServers().map(r=>r.instance);return this.returnUnsubWithDelayedReplay(t,n,e)}onMethodAdded(e){const t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)}onServerMethodAdded(e){const t=this.callbacks.add("onServerMethodAdded",e);let n=!1;const r=this.getServers();return setTimeout(()=>{r.forEach(s=>{const o=s.methods;Object.keys(o).forEach(a=>{n||e(s.instance,o[a])})})},0),()=>{n=!0,t()}}onMethodRemoved(e){return this.callbacks.add("onMethodRemoved",e)}onServerRemoved(e){return this.callbacks.add("onServerRemoved",e)}onServerMethodRemoved(e){return this.callbacks.add("onServerMethodRemoved",e)}getServerById(e){if(this.servers[e])return this.hideServerMethodSystemFlags(this.servers[e])}reset(){Object.keys(this.servers).forEach(e=>{this.removeServerById(e,"reset")}),this.servers={[this.myServer.id]:this.myServer},this.methodsCount={}}createMethodIdentifier(e){const t=e.input_signature??"",n=e.result_signature??"";return(e.name+t+n).toLowerCase()}getServersByMethod(e){const t=[];return Object.values(this.servers).forEach(n=>{Object.values(n.methods).forEach(r=>{r.identifier===e&&t.push(n.instance)})}),t}returnUnsubWithDelayedReplay(e,t,n){let r=!1;return setTimeout(()=>{t.forEach(s=>{r||n(s)})},0),()=>{r=!0,e()}}hideServerMethodSystemFlags(e){const t={};return Object.entries(e.methods).forEach(([n,r])=>{t[n]=dl(r)}),{...e,methods:t}}extractMethodsFromServers(e){return Object.values(e).reduce((n,r)=>[...n,...Object.values(r.methods)],[])}},Qk=class{constructor(){d(this,"nextId",0);d(this,"methods",[])}add(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e}remove(e){if(typeof e!="string")return new TypeError("Expecting a string");this.methods=this.methods.filter(t=>t.repoId!==e)}getById(e){if(typeof e=="string")return this.methods.find(t=>t.repoId===e)}getList(){return this.methods.map(e=>e)}length(){return this.methods.length}reset(){this.methods=[]}};const Mm="onSubscriptionRequest",jm="onSubscriptionAdded",qd="onSubscriptionRemoved";let Xk=class{constructor(e,t,n){d(this,"session");d(this,"repository");d(this,"serverRepository");d(this,"ERR_URI_SUBSCRIPTION_FAILED","com.tick42.agm.errors.subscription.failure");d(this,"callbacks",Gi());d(this,"nextStreamId",0);this.session=e,this.repository=t,this.serverRepository=n,e.on("add-interest",r=>{this.handleAddInterest(r)}),e.on("remove-interest",r=>{this.handleRemoveInterest(r)})}acceptRequestOnBranch(e,t,n){if(typeof n!="string"&&(n=""),typeof t.protocolState.subscriptionsMap!="object")throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");const r=this.getStreamId(t,n),s=e.msg.subscription_id,o={id:s,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:r,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[s]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:s,stream_id:r}),this.callbacks.execute(jm,o,t)}rejectRequest(e,t,n){typeof n!="string"&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)}pushData(e,t,n){if(typeof e!="object"||!Array.isArray(e.protocolState.branchKeyToStreamIdMap))return;if(typeof t!="object")throw new Error("Invalid arguments. Data must be an object.");typeof n=="string"?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter(s=>!n||n.length===0?!0:n.indexOf(s.key)>=0).map(s=>s.streamId).forEach(s=>{const o={type:"publish",stream_id:s,data:t};this.session.sendFireAndForget(o)})}pushDataToSingle(e,t,n){if(typeof n!="object")throw new Error("Invalid arguments. Data must be an object.");const r={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(r)}closeSingleSubscription(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];const n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n),t.instance,this.callbacks.execute(qd,t,e)}closeMultipleSubscriptions(e,t){if(typeof e!="object"||typeof e.protocolState.subscriptionsMap!="object"||!e.protocolState.subscriptionsMap)return;const n=e.protocolState.subscriptionsMap;let r=Object.keys(n).map(s=>n[s]);typeof t=="string"&&(r=r.filter(s=>s.branchKey===t)),r.forEach(s=>{delete n[s.id];const o={type:"drop-subscription",subscription_id:s.id,reason:"Server dropping all subscriptions on stream_id: "+s.streamId};this.session.sendFireAndForget(o)})}getSubscriptionList(e,t){if(typeof e!="object")return[];let n=[];if(!e.protocolState.subscriptionsMap)return[];const r=e.protocolState.subscriptionsMap,s=Object.keys(r).map(o=>r[o]);return typeof t!="string"?n=s:n=s.filter(o=>o.branchKey===t),n}getBranchList(e){if(typeof e!="object")return[];if(!e.protocolState.subscriptionsMap)return[];const t=e.protocolState.subscriptionsMap,n=Object.keys(t).map(s=>t[s]),r=[];return n.forEach(s=>{let o="";typeof s=="object"&&typeof s.branchKey=="string"&&(o=s.branchKey),r.indexOf(o)===-1&&r.push(o)}),r}onSubAdded(e){this.onSubscriptionLifetimeEvent(jm,e)}onSubRequest(e){this.onSubscriptionLifetimeEvent(Mm,e)}onSubRemoved(e){this.onSubscriptionLifetimeEvent(qd,e)}handleRemoveInterest(e){const t=this.serverRepository.getById(e.method_id);if(typeof e.subscription_id!="string"||typeof t!="object"||!t.protocolState.subscriptionsMap||typeof t.protocolState.subscriptionsMap[e.subscription_id]!="object")return;const n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(qd,n,t)}onSubscriptionLifetimeEvent(e,t){this.callbacks.add(e,t)}getNextStreamId(){return this.nextStreamId+++""}handleAddInterest(e){const t=this.repository.getServerById(e.caller_id),n=(t==null?void 0:t.instance)??{},r={msg:e,arguments:e.arguments_kv||{},instance:n},s=this.serverRepository.getById(e.method_id);if(s===void 0){const o="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(o,e.subscription_id);return}if(s.protocolState.subscriptionsMap&&s.protocolState.subscriptionsMap[e.subscription_id]){this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id);return}this.callbacks.execute(Mm,r,s)}sendSubscriptionFailed(e,t){const n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)}getStreamId(e,t){if(typeof t!="string"&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error(`streaming ${e.definition.name} method without protocol state`);const n=e.protocolState.branchKeyToStreamIdMap.filter(s=>s.key===t)[0];let r=n?n.streamId:void 0;return(typeof r!="string"||r==="")&&(r=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:r})),r}},Yk=class{constructor(e,t,n,r){d(this,"session");d(this,"clientRepository");d(this,"serverRepository");d(this,"logger");d(this,"callbacks",Gi());d(this,"streaming");this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=r,this.streaming=new Xk(e,t,n),this.session.on("invoke",s=>this.handleInvokeMessage(s))}createStream(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)}register(e,t){const n=e.definition,r=Object.assign({},{metadata:n.flags??{}},{streaming:t||!1}),s={type:"register",methods:[{id:e.repoId,name:n.name,display_name:n.displayName,description:n.description,version:n.version,flags:r,object_types:n.objectTypes||n.object_types,input_signature:n.accepts,result_signature:n.returns,restrictions:void 0}]};return this.session.send(s,{methodId:e.repoId}).then(()=>{this.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)}).catch(o=>{throw this.logger.warn(`failed to register method ${e.definition.name} with id ${e.repoId} - ${JSON.stringify(o)}`),o})}onInvoked(e){this.callbacks.add("onInvoked",e)}methodInvocationResult(e,t,n,r){let s;n||n===""?s={type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:r,peer_id:void 0}:s={type:"yield",invocation_id:t,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(s)}async unregister(e){const t={type:"unregister",methods:[e.repoId]};await this.session.send(t)}getBranchList(e){return this.streaming.getBranchList(e)}getSubscriptionList(e,t){return this.streaming.getSubscriptionList(e,t)}closeAllSubscriptions(e,t){this.streaming.closeMultipleSubscriptions(e,t)}pushData(e,t,n){this.streaming.pushData(e,t,n)}pushDataToSingle(e,t,n){this.streaming.pushDataToSingle(e,t,n)}closeSingleSubscription(e,t){this.streaming.closeSingleSubscription(e,t)}acceptRequestOnBranch(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)}rejectRequest(e,t,n){this.streaming.rejectRequest(e,t,n)}onSubRequest(e){this.streaming.onSubRequest(e)}onSubAdded(e){this.streaming.onSubAdded(e)}onSubRemoved(e){this.streaming.onSubRemoved(e)}handleInvokeMessage(e){var u;const t=e.invocation_id,n=e.caller_id,r=e.method_id,s=e.arguments_kv,a=this.serverRepository.getList().filter(p=>p.repoId===r)[0];if(a===void 0)return;const c=(u=this.clientRepository.getServerById(n))==null?void 0:u.instance,l={args:s,instance:c};this.callbacks.execute("onInvoked",a,t,l)}},Zk=class{constructor(e,t){d(this,"repository");d(this,"subscriptionData");this.repository=e,this.subscriptionData=t}get requestArguments(){return this.subscriptionData.params.arguments||{}}get servers(){return this.subscriptionData.trackedServers.reduce((e,t)=>{var n;if(t.subscriptionId){const r=(n=this.repository.getServerById(t.serverId))==null?void 0:n.instance;r&&e.push(r)}return e},[])}get serverInstance(){return this.servers[0]}get stream(){return this.subscriptionData.method}onData(e){if(typeof e!="function")throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),this.subscriptionData.handlers.onData.length===1&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach(t=>{e(t)})}onClosed(e){if(typeof e!="function")throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)}onFailed(e){}onConnected(e){if(typeof e!="function")throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)}close(){this.subscriptionData.close()}setNewSubscription(e){this.subscriptionData=e}},eT=class{constructor(e){d(this,"config");d(this,"cache",[]);d(this,"timeoutIds",[]);this.config=e}add(e){const t=oi(10);this.cache.push({id:t,element:e});const n=setTimeout(()=>{const r=this.cache.findIndex(s=>s.id===t);r<0||this.cache.splice(r,1)},this.config.ELEMENT_TTL_MS);this.timeoutIds.push(n)}flush(){const e=this.cache.map(t=>t.element);return this.timeoutIds.forEach(t=>clearInterval(t)),this.cache=[],this.timeoutIds=[],e}};const hl="awaitingAccept",Vd="subscribed",Jd="Subscription failed.",tT="Subscription rejected.",nT="ServerInitiated",Om="ClientInitiated";let iT=class{constructor(e,t,n){d(this,"session");d(this,"repository");d(this,"logger");d(this,"subscriptionsList",{});d(this,"timedCache",new eT({ELEMENT_TTL_MS:1e4}));d(this,"subscriptionIdToLocalKeyMap",{});d(this,"nextSubLocalKey",0);d(this,"handleErrorSubscribing",e=>{const t=e._tag,n=t.subLocalKey,r=this.subscriptionsList[n];if(typeof r=="object"&&(r.trackedServers=r.trackedServers.filter(s=>s.serverId!==t.serverId),r.trackedServers.length<=0)){if(clearTimeout(r.timeoutId),r.status===hl){const s=typeof e.reason=="string"&&e.reason!==""?' Publisher said "'+e.reason+'".':" No reason given.",o=typeof r.params.arguments=="object"?JSON.stringify(r.params.arguments):"{}";r.error({message:tT+s+" Called with:"+o,called_with:r.params.arguments,method:r.method})}else r.status===Vd&&this.callOnClosedHandlers(r);delete this.subscriptionsList[n]}});d(this,"handleSubscribed",e=>{const t=e._tag.subLocalKey,n=this.subscriptionsList[t];if(typeof n!="object")return;const r=e._tag.serverId,s=n.trackedServers.filter(a=>a.serverId===r)[0];if(typeof s!="object")return;s.subscriptionId=e.subscription_id,this.subscriptionIdToLocalKeyMap[e.subscription_id]=t;const o=n.status===hl;if(n.status=Vd,o){let a=!1,c=n.subscription;c?(c.setNewSubscription(n),n.success(c),a=!0):(c=new Zk(this.repository,n),n.subscription=c,n.success(c));for(const l of n.handlers.onConnected)try{l(c.serverInstance,a)}catch{}}});d(this,"handleEventData",e=>{const t=this.subscriptionIdToLocalKeyMap[e.subscription_id];if(typeof t>"u")return;const n=this.subscriptionsList[t];if(typeof n!="object")return;const r=n.trackedServers.filter(p=>p.subscriptionId===e.subscription_id);if(r.length!==1)return;const s=e.oob,o=r[0].serverId,a=this.repository.getServerById(o),c=()=>({data:e.data,server:(a==null?void 0:a.instance)??{},requestArguments:n.params.arguments,message:void 0,private:s}),l=n.handlers.onData,u=n.queued.data;l.length>0?l.forEach(p=>{typeof p=="function"&&p(c())}):u.push(c())});d(this,"handleSubscriptionCancelled",e=>{const t=this.subscriptionIdToLocalKeyMap[e.subscription_id];if(typeof t>"u")return;const n=this.subscriptionsList[t];if(typeof n!="object")return;const r=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter(s=>s.subscriptionId===e.subscription_id?(n.queued.closers.push(s.serverId),!1):!0),n.trackedServers.length===r&&(n.trackedServers.length<=0&&(this.timedCache.add(n),clearTimeout(n.timeoutId),this.callOnClosedHandlers(n),delete this.subscriptionsList[t]),delete this.subscriptionIdToLocalKeyMap[e.subscription_id])});this.session=e,this.repository=t,this.logger=n,e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}subscribe(e,t,n,r,s,o){if(n.length===0){s({method:e,called_with:t.arguments,message:Jd+" No available servers matched the target params."});return}const a=this.getNextSubscriptionLocalKey(),c=this.registerSubscription(a,e,t,r,s,t.methodResponseTimeout||1e4,o);if(typeof c!="object"){s({method:e,called_with:t.arguments,message:Jd+" Unable to register the user callbacks."});return}n.forEach(l=>{const u=l.server.id,p=l.methods.find(w=>w.name===e.name);if(!p){this.logger.error(`can not find method ${e.name} for target ${l.server.id}`);return}c.trackedServers.push({serverId:u,subscriptionId:void 0});const f={type:"subscribe",server_id:u,method_id:p.gatewayId,arguments_kv:t.arguments};this.session.send(f,{serverId:u,subLocalKey:a}).then(w=>this.handleSubscribed(w)).catch(w=>this.handleErrorSubscribing(w))})}drainSubscriptions(){const e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e}drainSubscriptionsCache(){return this.timedCache.flush()}getNextSubscriptionLocalKey(){const e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e}registerSubscription(e,t,n,r,s,o,a){const c={localKey:e,status:hl,method:t,params:n,success:r,error:s,trackedServers:[],handlers:{onData:(a==null?void 0:a.handlers.onData)||[],onClosed:(a==null?void 0:a.handlers.onClosed)||[],onConnected:(a==null?void 0:a.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:()=>this.closeSubscription(e),subscription:a==null?void 0:a.subscription};return a||(n.onData&&c.handlers.onData.push(n.onData),n.onClosed&&c.handlers.onClosed.push(n.onClosed),n.onConnected&&c.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=c,c.timeoutId=setTimeout(()=>{if(this.subscriptionsList[e]===void 0)return;const l=this.subscriptionsList[e];l.status===hl?(s({method:t,called_with:n.arguments,message:Jd+" Subscription attempt timed out after "+o+" ms."}),delete this.subscriptionsList[e]):l.status===Vd&&l.trackedServers.length>0&&(l.trackedServers=l.trackedServers.filter(u=>typeof u.subscriptionId<"u"),delete l.timeoutId,l.trackedServers.length<=0&&(this.callOnClosedHandlers(l),delete this.subscriptionsList[e]))},o),c}callOnClosedHandlers(e,t){var o;const n=e.queued.closers.length,r=n>0?e.queued.closers[n-1]:null;let s;r!==void 0&&typeof r=="string"&&(s=((o=this.repository.getServerById(r))==null?void 0:o.instance)??{}),e.handlers.onClosed.forEach(a=>{typeof a=="function"&&a({message:t||nT,requestArguments:e.params.arguments||{},server:s,stream:e.method})})}closeSubscription(e){const t=this.subscriptionsList[e];typeof t=="object"&&(t.trackedServers.forEach(n=>{typeof n.subscriptionId>"u"||(t.queued.closers.push(n.serverId),this.session.sendFireAndForget({type:"unsubscribe",subscription_id:n.subscriptionId,reason_uri:"",reason:Om}),delete this.subscriptionIdToLocalKeyMap[n.subscriptionId])}),t.trackedServers=[],this.callOnClosedHandlers(t,Om),delete this.subscriptionsList[e])}},rT=class{constructor(e,t,n){d(this,"session");d(this,"repository");d(this,"logger");d(this,"streaming");this.session=e,this.repository=t,this.logger=n,e.on("peer-added",r=>this.handlePeerAdded(r)),e.on("peer-removed",r=>this.handlePeerRemoved(r)),e.on("methods-added",r=>this.handleMethodsAddedMessage(r)),e.on("methods-removed",r=>this.handleMethodsRemovedMessage(r)),this.streaming=new iT(e,t,n)}subscribe(e,t,n,r,s,o){this.streaming.subscribe(e,t,n,r,s,o)}invoke(e,t,n,r){const s=r.id,o=t.gatewayId,a={type:"call",server_id:s,method_id:o,arguments_kv:n};return this.session.send(a,{invocationId:e,serverId:s}).then(c=>this.handleResultMessage(c)).catch(c=>this.handleInvocationError(c))}drainSubscriptions(){return this.streaming.drainSubscriptions()}drainSubscriptionsCache(){return this.streaming.drainSubscriptionsCache()}handlePeerAdded(e){const t=e.new_peer_id,n=e.identity,r=e.meta?e.meta.local:!0,s=Number(n.process),o={machine:n.machine,pid:isNaN(s)?n.process:s,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:r};this.repository.addServer(o,t)}handlePeerRemoved(e){const t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)}handleMethodsAddedMessage(e){const t=e.server_id;e.methods.forEach(r=>{this.repository.addServerMethod(t,r)})}handleMethodsRemovedMessage(e){const t=e.server_id,n=e.methods,r=this.repository.getServerById(t);r&&Object.keys(r.methods).forEach(o=>{const a=r.methods[o];n.indexOf(a.gatewayId)>-1&&this.repository.removeServerMethod(t,o)})}handleResultMessage(e){const t=e._tag.invocationId,n=e.result,r=e._tag.serverId,s=this.repository.getServerById(r);return{invocationId:t,result:n,instance:s==null?void 0:s.instance,status:Mi.Success,message:""}}handleInvocationError(e){if(this.logger.debug(`handle invocation error ${JSON.stringify(e)}`),"_tag"in e){const t=e._tag.invocationId,n=e._tag.serverId,r=this.repository.getServerById(n),s=e.reason,o=e.context;return{invocationId:t,result:o,instance:r==null?void 0:r.instance,status:Mi.Error,message:s}}else return{invocationId:"",message:e.message,status:Mi.Error,error:e}}};function sT(i,e,t,n,r,s){const o=r.logger.subLogger("gw3-protocol");let a;const c=new Promise(y=>{a=y}),l=e.domain("agm",["subscribed"]),u=new Yk(l,t,n,o.subLogger("server")),p=new rT(l,t,o.subLogger("client"));async function f(){var _,v;o.info("reconnected - will replay registered methods and subscriptions"),p.drainSubscriptionsCache().forEach(C=>{const T=C.method,M=Object.assign({},C.params);o.info(`trying to soft-re-subscribe to method ${T.name}, with params: ${JSON.stringify(M)}`),s.client.subscribe(T,M,void 0,void 0,C).then(()=>o.info(`soft-subscribing to method ${T.name} DONE`)).catch($=>o.warn(`subscribing to method ${T.name} failed: ${JSON.stringify($)}}`))});const y=[],S=p.drainSubscriptions();for(const C of S){const T=C.method,M=Object.assign({},C.params);o.info(`trying to re-subscribe to method ${T.name}, with params: ${JSON.stringify(M)}`),y.push(s.client.subscribe(T,M,void 0,void 0,C).then(()=>o.info(`subscribing to method ${T.name} DONE`)))}const O=n.getList();n.reset();for(const C of O){const T=C.definition;C.stream?y.push(s.server.createStream(T,C.streamCallbacks,void 0,void 0,C.stream).then(()=>o.info(`subscribing to method ${T.name} DONE`)).catch(()=>o.warn(`subscribing to method ${T.name} FAILED`))):(_=C==null?void 0:C.theFunction)!=null&&_.userCallback?y.push(s.register(T,C.theFunction.userCallback).then(()=>o.info(`registering method ${T.name} DONE`)).catch(()=>o.warn(`registering method ${T.name} FAILED`))):(v=C==null?void 0:C.theFunction)!=null&&v.userCallbackAsync&&y.push(s.registerAsync(T,C.theFunction.userCallbackAsync).then(()=>o.info(`registering method ${T.name} DONE`)).catch(()=>o.warn(`registering method ${T.name} FAILED`)))}await Promise.all(y),o.info("Interop is re-announced")}function w(){a&&(a({client:p,server:u}),a=void 0)}return l.onJoined(y=>{t.addServer(i,e.peerId),y?f().then(()=>e.setLibReAnnounced({name:"interop"})).catch(S=>o.warn(`Error while re-announcing interop: ${JSON.stringify(S)}`)):w()}),l.onLeft(()=>{t.reset()}),l.join(),c}let oT=class{constructor(e){d(this,"instance");d(this,"readyPromise");d(this,"client");d(this,"server");d(this,"unwrappedInstance");d(this,"protocol");d(this,"clientRepository");d(this,"serverRepository");if(typeof e>"u")throw new Error("configuration is required");if(typeof e.connection>"u")throw new Error("configuration.connections is required");const t=e.connection;typeof e.methodResponseTimeout!="number"&&(e.methodResponseTimeout=30*1e3),typeof e.waitTimeoutMs!="number"&&(e.waitTimeoutMs=30*1e3),this.unwrappedInstance=new Mb(this,void 0,t),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new Kk(e.logger.subLogger("cRep"),this),this.serverRepository=new Qk;let n;if(t.protocolVersion===3)n=sT(this.instance,t,this.clientRepository,this.serverRepository,e,this);else throw new Error(`protocol ${t.protocolVersion} not supported`);this.readyPromise=n.then(r=>(this.protocol=r,this.client=new zk(this.protocol,this.clientRepository,this.instance,e),this.server=new Jk(this.protocol,this.serverRepository),this))}ready(){return this.readyPromise}serverRemoved(e){return this.client.serverRemoved(e)}serverAdded(e){return this.client.serverAdded(e)}serverMethodRemoved(e){return this.client.serverMethodRemoved(e)}serverMethodAdded(e){return this.client.serverMethodAdded(e)}methodRemoved(e){return this.client.methodRemoved(e)}methodAdded(e){return this.client.methodAdded(e)}methodsForInstance(e){return this.client.methodsForInstance(e)}methods(e){return this.client.methods(e)}servers(e){return this.client.servers(e)}subscribe(e,t,n,r){return this.client.subscribe(e,t,n,r)}createStream(e,t,n,r){return this.server.createStream(e,t,n,r)}unregister(e){return this.server.unregister(e)}registerAsync(e,t){return this.server.registerAsync(e,t)}register(e,t){return this.server.register(e,t)}invoke(e,t,n,r,s,o){return this.client.invoke(e,t,n,r,s,o)}waitForMethod(e){const t=new vu,n=this.client.methodAdded(r=>{r.name===e&&(n(),t.resolve(r))});return t.promise}};const aT=["subscribed","success"];let cT=class{constructor(e,t){d(this,"connection");d(this,"logger");d(this,"peerId");d(this,"session");d(this,"subscriptions");d(this,"readyPromise");d(this,"publish",(e,t,n)=>{const{routingKey:r,target:s}=n||{},o=this.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:this.peerId,routing_key:r,target_identity:s});this.session.send(o)});d(this,"subscribe",(e,t,n)=>new Promise((r,s)=>{const{routingKey:o,target:a}=n||{},c=this.removeEmptyValues({type:"subscribe",topic:e,peer_id:this.peerId,routing_key:o,source:a});this.session.send(c).then(l=>{const{subscription_id:u}=l;this.subscriptions.push({subscription_id:u,topic:e,callback:t,source:a}),r({unsubscribe:()=>(this.session.send({type:"unsubscribe",subscription_id:u,peer_id:this.peerId}),this.subscriptions=this.subscriptions.filter(p=>p.subscription_id!==u),Promise.resolve())})}).catch(l=>s(l))}));d(this,"watchOnEvent",()=>{this.session.on("event",e=>{const{data:t,subscription_id:n}=e,r=e["publisher-identity"],s=this.subscriptions.find(o=>o.subscription_id===n);s&&(s.source?this.keysMatch(s.source,r)&&s.callback(t,s.topic,r):s.callback(t,s.topic,r))})});this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",aT),this.readyPromise=this.session.join(),this.readyPromise.then(()=>{this.watchOnEvent()})}ready(){return this.readyPromise}removeEmptyValues(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==null&&(t[n]=e[n])}),t}keysMatch(e,t){const n=Object.keys(e);let r=!0;return n.forEach(s=>{e[s]!==t[s]&&(r=!1)}),r}};const Ys=(i,e)=>{const t=typeof window=="object"?window.iodesktop??window.glue42gd:void 0,n=typeof window=="object"?window.gdPreloadPromise??Promise.resolve():Promise.resolve(),r=Un("glue");i=i||{},e=e||{};const s=Dk(i,e,t);let o,a,c,l,u,p,f;const w={};function y(A,x,N){f=c.canPublish("trace"),f&&c.trace(`registering ${A} module`);const b=()=>{x.initTime=N.stop(),x.initEndTime=N.endTime,x.marks=N.marks,f&&c.trace(`${A} is ready - ${N.endTime-N.startTime}`)};x.initStartTime=N.startTime,x.ready?x.ready().then(()=>{b()}):b(),Array.isArray(A)||(A=[A]),A.forEach(R=>{w[R]=x,Ys[R]=x})}function S(){const A=Un("connection");o=new Ok(s.connection,c.subLogger("connection"));let x=Promise.resolve(s.auth);return s.connection&&!s.auth&&(t?x=t.getGWToken().then(N=>({gatewayToken:N})):typeof window<"u"&&(window!=null&&window.glue42electron)?typeof window.glue42electron.gwToken=="string"&&(x=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):x=Promise.reject("You need to provide auth information")),x.then(N=>{A.mark("auth-promise-resolved");let b;if(Object.prototype.toString.call(N)==="[object Object]")b=N;else throw new Error("Invalid auth object - "+JSON.stringify(N));return o.login(b)}).then(()=>(y("connection",o,A),s)).catch(N=>{throw o&&o.logout(),N})}function O(){var x;const A=Un("logger");return c=new bu(`${(x=s.connection.identity)==null?void 0:x.application}`,void 0,s.customLogger),c.consoleLevel(s.logger.console),c.publishLevel(s.logger.publish),c.canPublish("debug")&&c.debug("initializing glue..."),y("logger",c,A),Promise.resolve(void 0)}function _(){const A=Un("metrics"),x=s.metrics,N=t==null?void 0:t.getMetricsPublishingEnabled,b=s.connection.identity,R=N||(()=>!0),z=(typeof x!="boolean"&&x.disableAutoAppSystem)??!1;return l=Ck({connection:x?o:void 0,logger:c.subLogger("metrics"),canUpdateMetric:R,system:"Glue42",service:(b==null?void 0:b.service)??(t==null?void 0:t.applicationName)??s.application,instance:(b==null?void 0:b.instance)??(b==null?void 0:b.windowId)??oi(10),disableAutoAppSystem:z,pagePerformanceMetrics:typeof x!="boolean"?x==null?void 0:x.pagePerformanceMetrics:void 0}),y("metrics",l,A),Promise.resolve()}function v(){const A=Un("interop"),x={connection:o,logger:c.subLogger("interop")};return a=new oT(x),bu.Interop=a,y(["interop","agm"],a,A),Promise.resolve()}function C(){const A=s.activities&&o.protocolVersion===3;if(s.contexts||A){const N=Un("contexts");return u=new Hk({connection:o,logger:c.subLogger("contexts"),trackAllContexts:typeof s.contexts=="object"?s.contexts.trackAllContexts:!1,reAnnounceKnownContexts:typeof s.contexts=="object"?s.contexts.reAnnounceKnownContexts:!1}),y("contexts",u,N),u}else{const N=o.replayer;N&&N.drain(_u.name)}}async function T(){if(!s.bus)return Promise.resolve();const A=Un("bus");return p=new cT(o,c.subLogger("bus")),y("bus",p,A),Promise.resolve()}function M(A){try{return A.forEach(x=>{$(x.name,x.create)}),Promise.resolve()}catch(x){return Promise.reject(x)}}function $(A,x){const N=Un(A),b=x(w);b&&y(A,b,N)}function G(){const A=Object.keys(w).map(x=>{const N=w[x];return N.ready?N.ready():Promise.resolve()});return Promise.all(A)}function E(){const A=b=>{a&&a.invoke("T42.ACS.Feedback",b,"best")},x={coreVersion:Cu,version:s.version};r.stop();const N={feedback:A,info:x,logger:c,interop:a,agm:a,connection:o,metrics:l,contexts:u,bus:p,version:s.version,userConfig:i,done:()=>(c==null||c.info("done called by user..."),o.logout())};if(N.performance={get glueVer(){return s.version},get glueConfig(){return JSON.stringify(i)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){const b=Ak();return Object.keys(b).map(R=>{const z=b[R];return{name:R,duration:z.endTime-z.startTime,marks:z.marks,startTime:z.startTime,endTime:z.endTime}})}},Object.keys(w).forEach(b=>{const R=w[b];N[b]=R}),N.config={},Object.keys(s).forEach(b=>{N.config[b]=s[b]}),e&&e.extOptions&&Object.keys(e.extOptions).forEach(b=>{N.config[b]=e==null?void 0:e.extOptions[b]}),e!=null&&e.enrichGlue&&e.enrichGlue(N),t&&t.updatePerfData&&t.updatePerfData(N.performance),N.agm){const b=(z,V,Q)=>function(){return N.logger.warn(`glue.js - 'glue.agm.${V}' method is deprecated, use 'glue.interop.${Q}' instead.`),z.apply(N.agm,arguments)},R=N.agm;R.method_added=b(N.agm.methodAdded,"method_added","methodAdded"),R.method_removed=b(N.agm.methodRemoved,"method_removed","methodRemoved"),R.server_added=b(N.agm.serverAdded,"server_added","serverAdded"),R.server_method_aded=b(N.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),R.server_method_removed=b(N.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return N}async function D(){const A="T42.ACS.RegisterInstance";if(Pi.isNode()&&typeof Hv._GD_STARTING_CONTEXT_>"u"&&typeof(i==null?void 0:i.application)<"u"&&a.methods({name:A}).length>0)try{await a.invoke(A,{appName:i==null?void 0:i.application,pid:process.pid})}catch(N){const b=N;c.error(`Cannot register as an instance: ${JSON.stringify(b.message)}`)}}return n.then(O).then(S).then(()=>Promise.all([_(),v(),C(),T()])).then(()=>a.readyPromise).then(()=>D()).then(()=>M(s.libs||[])).then(G).then(E).catch(A=>Promise.reject({err:A,libs:w}))};typeof window<"u"&&(window.IOConnectCore=Ys);Ys.version=Cu;Ys.default=Ys;const Wf=ak(Ys);if(typeof window<"u"){const i=window;i.IOBrowser=Wf,delete i.GlueCore,delete i.IOConnectCore}const lT=window.glue42gd||window.glue42core,uT=window.iodesktop||window.iobrowser;!lT&&!uT&&(window.iobrowser={webStarted:!1});Wf.version=bb;var jb={},En={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function Ob(i){return i.type===En.TIMESTAMP?"timestamp":i.type===En.NUMBER?"number":i.type===En.STRING?"string":i.type===En.OBJECT?"object":"unknown"}function Db(i){return i.constructor===Date?"timestamp":typeof i=="number"?"number":typeof i=="string"?"string":typeof i=="object"?"object":"string"}function dT(i){const e={},t=Ob(i);if(t==="object"){const n=Object.keys(i.value).reduce((r,s)=>{const o=Db(i.value[s]);if(o==="object"){const a=$b(i.value[s]);r[s]={type:"object",description:"",context:{},composite:a}}else r[s]={type:o,description:"",context:{}};return r},{});e.composite=n}return e.name=Gl(i.path.join("/")+"/"+i.name),e.type=t,e.description=i.description,e.context={},e}function $b(i){return Object.keys(i).reduce((e,t)=>{const n=Db(i[t]);return n==="object"?e[t]={type:"object",description:"",context:{},composite:$b(i[t])}:e[t]={type:n,description:"",context:{}},e},{})}function Gl(i){return typeof i<"u"&&i.length>0&&i[0]!=="/"?"/"+i:i}function hT(i){return Ob(i)==="timestamp"?Date.now():Fb(i.value)}function Fb(i){return typeof i!="object"?i:Object.keys(i).reduce((e,t)=>{const n=i[t];return typeof n=="object"&&n.constructor!==Date?e[t]=Fb(n):n.constructor===Date?e[t]=new Date(n).getTime():n.constructor===Boolean?e[t]=n.toString():e[t]=n,e},{})}function Lb(i){return i.reduce((e,t)=>e.concat(Array.isArray(t)?Lb(t):t),[])}function pT(i){return i.sort((e,t)=>e.state?t.state?t.state-e.state:-1:1)[0]}function fT(i){let e="";return i.forEach((t,n,r)=>{const s=t.path.join(".");n===r.length-1?e+=s+"."+t.name+": "+t.description:e+=s+"."+t.name+": "+t.description+","}),e.length>100?e.slice(0,100)+"...":e}function gT(i){const e=i.root.getAggregateState(),t=Lb(e),n=pT(t);return{description:fT(t),value:n.state}}function mT(i,e){if(!i||typeof i!="object")throw new Error("Connection is required parameter");let t,n;const r=y=>{let S;t=new Promise(O=>{S=O}),n=i.domain("metrics"),n.onJoined(O=>{!O&&S&&(S(),S=void 0);const v={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};n.send(v),O&&s(y)}),n.join({system:e.system,service:e.service,instance:e.instance})},s=y=>{o(y.root)},o=y=>{a(y),y.metrics.forEach(S=>{l(S)}),y.subSystems.forEach(S=>{o(S)})},a=async y=>{if(y.parent===void 0)return;await t;const O={type:"define",metrics:[{name:Gl(y.path.join("/")+"/"+y.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};n.send(O)},c=async(y,S)=>{await t;const O={type:"publish",values:[{name:Gl(y.path.join("/")+"/"+y.name+"/State"),value:{Description:S.description,Value:S.state},timestamp:Date.now()}]};n.send(O);const _=gT(y),v={type:"publish",peer_id:i.peerId,values:[{name:"/State",value:{Description:_.description,Value:_.value},timestamp:Date.now()}]};n.send(v)},l=async y=>{const S=f(y);await t;const _={type:"define",metrics:[dT(S)]};n.send(_),typeof S.value<"u"&&p(S)},u=async y=>{const S=f(y);await t,p(S)},p=y=>{if(w()){const S=hT(y),O={type:"publish",values:[{name:Gl(y.path.join("/")+"/"+y.name),value:S,timestamp:Date.now()}]};return n.sendFireAndForget(O)}return Promise.resolve()},f=y=>{const S={...y};return typeof y.value=="object"&&y.value!==null&&(S.value={...y.value}),S},w=()=>{try{return(e.canUpdateMetric??(()=>!0))()}catch{return!0}};return{init:r,createSystem:a,updateSystem:c,createMetric:l,updateMetric:u}}var yT={validate:(i,e,t)=>{if(i===null||typeof i!="object")throw new Error("Missing definition");if(e===null||typeof e!="object")throw new Error("Missing parent");if(t===null||typeof t!="object")throw new Error("Missing transport")}};class td{constructor(e,t,n,r,s){d(this,"definition");d(this,"system");d(this,"transport");d(this,"value");d(this,"type");d(this,"path",[]);d(this,"name");d(this,"description");this.definition=e,this.system=t,this.transport=n,this.value=r,this.type=s,yT.validate(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}get repo(){var e;return(e=this.system)==null?void 0:e.repo}get id(){return`${this.system.path}/${name}`}update(e){return this.value=e,this.transport.updateMetric(this)}}class wT extends td{constructor(e,t,n,r){super(e,t,n,r,En.NUMBER)}incrementBy(e){this.update(this.value+e)}increment(){this.incrementBy(1)}decrement(){this.incrementBy(-1)}decrementBy(e){this.incrementBy(e*-1)}}class vT extends td{constructor(e,t,n,r){super(e,t,n,r,En.OBJECT)}update(e){return this.mergeValues(e),this.transport.updateMetric(this)}mergeValues(e){return Object.keys(this.value).forEach(t=>{typeof e[t]<"u"&&(this.value[t]=e[t])})}}class bT extends td{constructor(e,t,n,r){super(e,t,n,r,En.STRING)}}class _T extends td{constructor(e,t,n,r){super(e,t,n,r,En.TIMESTAMP)}now(){this.update(new Date)}}function Wb(i,e,t,n,r){if(!e)throw new Error("Repository is required");if(!t)throw new Error("Transport is required");const s=t,o=i,a=r||"",c=e,l=n,u=G(n);let p={};const f=E(u,"/")+i,w=e.root,y=[],S=[];function O(x,N){if(!x||x.length===0)throw new Error("name is required");const b=y.filter(z=>z.name===x);if(b.length>0)return b[0];const R=Wb(x,c,s,A,N);return y.push(R),R}function _(x,N){p={state:x,description:N},s.updateSystem(A,p)}function v(x,N){return $(x,En.STRING,N,b=>new bT(b,A,s,N))}function C(x,N){return $(x,En.NUMBER,N,b=>new wT(b,A,s,N))}function T(x,N){return $(x,En.OBJECT,N,b=>new vT(b,A,s,N))}function M(x,N){return $(x,En.TIMESTAMP,N,b=>new _T(b,A,s,N))}function $(x,N,b,R){let z={name:""};typeof x=="string"?z={name:x}:z=x;const V=S.filter(H=>H.name===z.name);if(V.length>0){const H=V[0];if(H.type!==N)throw new Error(`A metric named ${z.name} is already defined with different type.`);return typeof b<"u"&&H.update(b).catch(()=>{}),H}const Q=R(z);return S.push(Q),Q}function G(x){if(!x||!x.parent)return[];const N=G(x.parent);return N.push(x.name),N}function E(x,N){return x&&x.length>0?x.join(N):""}function D(){const x=[];return Object.keys(p).length>0&&x.push({name:o,path:u,state:p.state,description:p.description}),y.forEach(N=>{const b=N.getAggregateState();b.length>0&&x.push(...b)}),x}const A={get name(){return o},get description(){return a},get repo(){return c},get parent(){return l},path:u,id:f,root:w,get subSystems(){return y},get metrics(){return S},subSystem:O,getState:()=>p,setState:_,stringMetric:v,timestampMetric:M,objectMetric:T,numberMetric:C,getAggregateState:D};return s.createSystem(A),A}class CT{constructor(e,t){d(this,"root");t.init(this),this.root=Wb("",this,t),this.addSystemMetrics(this.root,e.clickStream||e.clickStream===void 0)}addSystemMetrics(e,t){if(typeof navigator<"u"&&e.stringMetric("UserAgent",navigator.userAgent),t&&typeof document<"u"){const s=e.subSystem("ClickStream"),o=a=>{if(!a.target)return;const c=a.target,l=c?c.getAttribute("class")??"":"";s.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:l,id:c.id,type:"<"+c.tagName.toLowerCase()+">",href:c.href||""}})};s.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",o):document.attachEvent("onclick",o)}e.stringMetric("StartTime",new Date().toString());const n=e.stringMetric("StartURL",""),r=e.stringMetric("AppName","");if(typeof window<"u"){if(typeof window.location<"u"){const s=window.location.href;n.update(s)}typeof window.glue42gd<"u"&&r.update(window.glue42gd.appName)}}}class ST{init(e){}createSystem(e){return Promise.resolve()}updateSystem(e,t){return Promise.resolve()}createMetric(e){return Promise.resolve()}updateMetric(e){return Promise.resolve()}}class IT{constructor(e,t,n){d(this,"api");d(this,"lastCount",0);d(this,"initialPublishTimeout",10*1e3);d(this,"publishInterval",60*1e3);d(this,"system");this.api=e,this.initialPublishTimeout=t??this.initialPublishTimeout,this.publishInterval=n??this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}scheduleCollection(){setTimeout(()=>{this.collect(),setInterval(()=>{this.collect()},this.publishInterval)},this.initialPublishTimeout)}collect(){try{this.collectMemory(),this.collectEntries()}catch{}}collectMemory(){const e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))}collectEntries(){const e=window.performance.getEntries();if(e.length<=this.lastCount)return;this.lastCount=e.length;const t=e.map(n=>n.toJSON());this.system.stringMetric("entries",JSON.stringify(t))}}var xT=i=>{let e;!i.connection||typeof i.connection!="object"?e=new ST:e=mT(i.connection,i);let n=new CT(i,e).root;i.disableAutoAppSystem||(n=n.subSystem("App"));const r=TT(n);return kT(r,i.pagePerformanceMetrics),r};function kT(i,e){var n,r;if(typeof window>"u")return;const t=(r=(n=window==null?void 0:window.glue42gd)==null?void 0:n.metrics)==null?void 0:r.pagePerformanceMetrics;t&&(e=t),e!=null&&e.enabled&&new IT(i,e.initialPublishTimeout,e.publishInterval)}function TT(i){const e=i.subSystem("reporting"),t={name:"features"};let n;const r=(s,o,a)=>{if(typeof s>"u"||s==="")throw new Error("name is mandatory");if(typeof o>"u"||o==="")throw new Error("action is mandatory");if(typeof a>"u"||a==="")throw new Error("payload is mandatory");n?n.update({name:s,action:o,payload:a}):n=e.objectMetric(t,{name:s,action:o,payload:a})};return i.featureMetric=r,i}var pl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bb(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function bp(i){if(i&&i.errorHandling&&typeof i.errorHandling!="function"&&i.errorHandling!=="log"&&i.errorHandling!=="silent"&&i.errorHandling!=="throw")throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof i.errorHandling+" was passed");var e=i&&typeof i.errorHandling=="function"&&i.errorHandling,t={};function n(c,l,u){var p=t[c];return p||(p=[],t[c]=p),p.push(l),u&&setTimeout(function(){u.forEach(function(f){var w;if(!((w=t[c])===null||w===void 0)&&w.includes(l))try{Array.isArray(f)?l.apply(void 0,f):l.apply(void 0,[f])}catch(y){s(y,c)}})},0),function(){var f=t[c];f&&(f=f.reduce(function(w,y,S){return y===l&&w.length===S||w.push(y),w},[]),f.length===0?delete t[c]:t[c]=f)}}function r(c){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];var p=t[c];if(!p||p.length===0)return[];var f=[];return p.forEach(function(w){try{var y=w.apply(void 0,l);f.push(y)}catch(S){f.push(void 0),s(S,c)}}),f}function s(c,l){var u=c instanceof Error?c:new Error(c);if(e){e(u);return}var p='[ERROR] callback-registry: User callback for key "'+l+'" failed: '+u.stack;if(i)switch(i.errorHandling){case"log":return console.error(p);case"silent":return;case"throw":throw new Error(p)}console.error(p)}function o(){t={}}function a(c){var l=t[c];l&&delete t[c]}return{add:n,execute:r,clear:o,clearKey:a}}bp.default=bp;var AT=bp,zi=Bb(AT);class ET{constructor(e,t){d(this,"gw");d(this,"registry",zi());d(this,"client");this.gw=e.facade,this.gw.connect((n,r)=>{this.messageHandler(r)}).then(n=>{this.client=n})}get isObjectBasedTransport(){return!0}sendObject(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")}send(e){return Promise.reject("not supported")}onMessage(e){return this.registry.add("onMessage",e)}onConnectedChanged(e){return e(!0),()=>{}}close(){return Promise.resolve()}open(){return Promise.resolve()}name(){return"in-memory"}reconnect(){return Promise.resolve()}messageHandler(e){this.registry.execute("onMessage",e)}}class PT{constructor(e,t){d(this,"logger");d(this,"worker");d(this,"registry",zi());this.logger=t,this.worker=new SharedWorker(e),this.worker.port.onmessage=n=>{this.messageHandler(n.data)}}get isObjectBasedTransport(){return!0}sendObject(e){return this.worker.port.postMessage(e),Promise.resolve()}send(e){return Promise.reject("not supported")}onMessage(e){return this.registry.add("onMessage",e)}onConnectedChanged(e){return e(!0),()=>{}}close(){return Promise.resolve()}open(){return Promise.resolve()}name(){return"shared-worker"}reconnect(){return Promise.resolve()}messageHandler(e){this.registry.execute("onMessage",e)}}var In;let Qr=(In=class{static isNode(){if(typeof In._isNode<"u")return In._isNode;if(typeof window<"u")return In._isNode=!1,!1;try{In._isNode=Object.prototype.toString.call(global.process)==="[object process]"}catch{In._isNode=!1}return In._isNode}},d(In,"_isNode"),In);class xu{constructor(){d(this,"resolve");d(this,"reject");d(this,"promise");d(this,"rejected",!1);d(this,"resolved",!1);this.promise=new Promise((e,t)=>{this.resolve=n=>{this.resolved=!0,e(n)},this.reject=n=>{this.rejected=!0,t(n)}})}static delay(e){return new Promise(t=>setTimeout(t,e))}get ended(){return this.rejected||this.resolved}}const _p={};function NT(){return _p}function qn(i){const e=_p[i];if(e)return e;const t=[];function n(){return new Date().getTime()}const r=n();c("start",r);let s,o;function a(){return s=n(),c("end",s),o=s-r,o}function c(u,p){const f=p??n();let w=0;t.length>0&&(w=f-t[t.length-1].time),t.push({name:u,time:f,diff:w})}const l={get startTime(){return r},get endTime(){return s},get period(){return o},stop:a,mark:c,marks:t};return _p[i]=l,l}const RT=Qr.isNode()?require("ws"):window.WebSocket;class Dm{constructor(e,t){d(this,"ws");d(this,"logger");d(this,"settings");d(this,"startupTimer",qn("connection"));d(this,"_running",!0);d(this,"_registry",zi());d(this,"wsRequests",[]);if(this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}onMessage(e){return this._registry.add("onMessage",e)}send(e,t){return new Promise((n,r)=>{this.waitForSocketConnection(()=>{var s;try{(s=this.ws)==null||s.send(e),n()}catch(o){r(o)}},r)})}open(){return this.logger.info("opening ws..."),this._running=!0,new Promise((e,t)=>{this.waitForSocketConnection(e,t)})}close(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()}onConnectedChanged(e){return this._registry.add("onConnectedChanged",e)}name(){return this.settings.ws}reconnect(){var t;(t=this.ws)==null||t.close();const e=new xu;return this.waitForSocketConnection(()=>{e.resolve()}),e.promise}waitForSocketConnection(e,t){var n;if(t=t??(()=>{}),!this._running){t(`wait for socket on ${this.settings.ws} failed - socket closed by user`);return}if(((n=this.ws)==null?void 0:n.readyState)===1){e();return}this.wsRequests.push({callback:e,failed:t}),!(this.wsRequests.length>1)&&this.openSocket()}async openSocket(e,t){if(this.logger.info(`opening ws to ${this.settings.ws}, retryInterval: ${e}, retriesLeft: ${t}...`),this.startupTimer.mark("opening-socket"),e===void 0&&(e=this.settings.reconnectInterval),typeof t>"u"&&(t=this.settings.reconnectAttempts),t!==void 0){if(t===0){this.notifyForSocketState(`wait for socket on ${this.settings.ws} failed - no more retries left`);return}this.logger.debug(`will retry ${t} more times (every ${e} ms)`)}try{await this.initiateSocket(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState()}catch{setTimeout(()=>{const n=t===void 0?void 0:t-1;this.openSocket(e,n)},e)}}initiateSocket(){const e=new xu;return this.logger.debug(`initiating ws to ${this.settings.ws}...`),this.ws=new RT(this.settings.ws??""),this.ws.onerror=t=>{let n="";try{n=JSON.stringify(t)}catch{const s=new WeakSet;n=JSON.stringify(t,(a,c)=>{if(typeof c=="object"&&c!==null){if(s.has(c))return;s.add(c)}return c})}this.logger.info(`ws error - reason: ${n}`),e.reject("error"),this.notifyStatusChanged(!1,n)},this.ws.onclose=t=>{this.logger.info(`ws closed - code: ${t==null?void 0:t.code} reason: ${t==null?void 0:t.reason}`),e.reject("closed"),this.notifyStatusChanged(!1)},this.ws.onopen=()=>{var t;this.startupTimer.mark("ws-opened"),this.logger.info(`ws opened ${(t=this.settings.identity)==null?void 0:t.application}`),e.resolve(),this.notifyStatusChanged(!0)},this.ws.onmessage=t=>{this._registry.execute("onMessage",t.data)},e.promise}notifyForSocketState(e){this.wsRequests.forEach(t=>{e?t.failed&&t.failed(e):t.callback()}),this.wsRequests=[]}notifyStatusChanged(e,t){this._registry.execute("onConnectedChanged",e,t)}}class MT{constructor(e){d(this,"specs");d(this,"specsNames",[]);d(this,"messages",{});d(this,"isDone");d(this,"subs",{});d(this,"subsRefCount",{});d(this,"connection");this.specs={};for(const t of e)this.specs[t.name]=t,this.specsNames.push(t.name)}init(e){this.connection=e;for(const t of this.specsNames)for(const n of this.specs[t].types){let r=this.subsRefCount[n];if(r||(r=0),r+=1,this.subsRefCount[n]=r,r>1)continue;const s=e.on(n,o=>this.processMessage(n,o));this.subs[n]=s}}processMessage(e,t){if(!(this.isDone||!t)){for(const n of this.specsNames)if(this.specs[n].types.indexOf(e)!==-1){const r=this.messages[n]||[];this.messages[n]=r,r.push(t)}}}drain(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(const r of this.specs[e].types)this.subsRefCount[r]-=1,this.subsRefCount[r]<=0&&((n=this.connection)==null||n.off(this.subs[r]),delete this.subs[r],delete this.subsRefCount[r]);delete this.specs[e],this.specs.length||(this.isDone=!0)}}let jT="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",ai=(i=21)=>{let e="",t=i;for(;t--;)e+=jT[Math.random()*64|0];return e};const Xa=(i,e,t)=>new Promise((n,r)=>{const s=setTimeout(()=>{const a=t||`Promise timeout hit: ${e}`;r(a)},e);new Promise(i).then(a=>{clearTimeout(s),n(a)}).catch(a=>{clearTimeout(s),r(a)})});class OT{constructor(e,t,n){d(this,"settings");d(this,"logger");d(this,"identity");d(this,"isPreferredActivated");d(this,"_communicationId");d(this,"publicWindowId");d(this,"selfAssignedWindowId");d(this,"iAmConnected",!1);d(this,"parentReady",!1);d(this,"rejected",!1);d(this,"parentPingResolve");d(this,"parentPingInterval");d(this,"connectionResolve");d(this,"extConnectionResolve");d(this,"extConnectionReject");d(this,"connectionReject");d(this,"port");d(this,"myClientId");d(this,"children",[]);d(this,"extContentAvailable",!1);d(this,"extContentConnecting",!1);d(this,"extContentConnected",!1);d(this,"parentWindowId");d(this,"parentInExtMode",!1);d(this,"webNamespace","g42_core_web");d(this,"parent");d(this,"parentType");d(this,"parentPingTimeout",5e3);d(this,"connectionRequestTimeout",7e3);d(this,"defaultTargetString","*");d(this,"registry",zi());d(this,"messages",{connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:()=>{}},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}});this.settings=e,this.logger=t,this.identity=n,this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.parentType=window.name.includes("#wsp")?"workspace":void 0}manualSetReadyState(){this.iAmConnected=!0,this.parentReady=!0}get transportWindowId(){return this.publicWindowId}get communicationId(){return this._communicationId}async sendObject(e){if(this.extContentConnected)return window.postMessage({glue42ExtOut:e},this.defaultTargetString);if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");this.port.postMessage(e)}get isObjectBasedTransport(){return!0}onMessage(e){return this.registry.add("onMessage",e)}send(){return Promise.reject("not supported")}onConnectedChanged(e){return this.registry.add("onConnectedChanged",e)}async open(){this.logger.debug("opening a connection to the web platform gateway."),await this.connect(),this.notifyStatusChanged(!0)}close(){var t,n;const e={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:(t=this.identity)==null?void 0:t.windowId}}};return(n=this.port)==null||n.postMessage(e),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()}name(){return"web-platform"}async reconnect(){return await this.close(),Promise.resolve()}initiateInternalConnection(){return new Promise((e,t)=>{if(this.logger.debug("opening an internal web platform connection"),this.port=this.settings.port,this.iAmConnected){this.logger.warn("cannot open a new connection, because this client is currently connected");return}this.port.onmessage=n=>{var s,o;if(this.iAmConnected&&!((s=n.data)!=null&&s.glue42core)){this.registry.execute("onMessage",n.data);return}const r=(o=n.data)==null?void 0:o.glue42core;r&&(r.type===this.messages.gatewayInternalConnect.name&&r.success&&(this.publicWindowId=this.settings.windowId,this.identity&&this.publicWindowId&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.publicWindowId),e()),r.type===this.messages.gatewayInternalConnect.name&&r.error&&t(r.error))},this.port.postMessage({glue42core:{type:this.messages.gatewayInternalConnect.name}})})}initiateRemoteConnection(e){return Xa((t,n)=>{this.connectionResolve=t,this.connectionReject=n,this.myClientId=this.myClientId??ai(10);const r=this.getMyWindowId()||ai(10),s={glue42core:{type:this.messages.connectionRequest.name,clientId:this.myClientId,clientType:"child",bridgeInstanceId:r,selfAssignedWindowId:this.selfAssignedWindowId}};if(this.logger.debug("sending connection request"),this.extContentConnecting)return s.glue42core.clientType="child",s.glue42core.bridgeInstanceId=this.myClientId,s.glue42core.parentWindowId=this.parentWindowId,window.postMessage(s,this.defaultTargetString);if(!e)throw new Error("Cannot send a connection request, because no glue target was specified!");e.postMessage(s,this.defaultTargetString)},this.connectionRequestTimeout,"The connection to the target glue window timed out")}async isParentCheckSuccess(e){try{return await e,{success:!0}}catch{return{success:!1}}}setUpMessageListener(){if(this.settings.port){this.logger.debug("skipping generic message listener, because this is an internal client");return}window.addEventListener("message",e=>{var s;const t=(s=e.data)==null?void 0:s.glue42core;if(!t||this.rejected)return;const n=this.settings.allowedOrigins||[];if(n.length&&!n.includes(e.origin)){this.logger.warn(`received a message from an origin which is not in the allowed list: ${e.origin}`);return}if(!this.checkMessageTypeValid(t.type)){this.logger.error(`cannot handle the incoming glue42 core message, because the type is invalid: ${t.type}`);return}const r=t.type;this.logger.debug(`received valid glue42core message of type: ${r}`),this.messages[r].handle(e)})}setUpUnload(){if(this.settings.port){this.logger.debug("skipping unload event listener, because this is an internal client");return}window.addEventListener("beforeunload",()=>{var t,n;if(this.extContentConnected)return;const e={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:(t=this.identity)==null?void 0:t.windowId}}};this.parent&&this.parent.postMessage(e,this.defaultTargetString),(n=this.port)==null||n.postMessage(e)})}handlePlatformReady(e){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval),this.parent=e.source,this.parentType=window.name.includes("#wsp")?"workspace":"window"}handleConnectionAccepted(e){var n;const t=(n=e.data)==null?void 0:n.glue42core;return this.myClientId===t.clientId?this.handleAcceptanceOfMyRequest(t):this.handleAcceptanceOfGrandChildRequest(t,e)}handleAcceptanceOfMyRequest(e){if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(!e.port){this.logger.error("cannot set up my connection, because I was not provided with a port");return}if(this.publicWindowId=this.getMyWindowId(),this.identity&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.identity.instance?this.identity.instance:this.publicWindowId||ai(10)),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=t=>this.registry.execute("onMessage",t.data),this.connectionResolve){this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),delete this.connectionResolve;return}this.logger.error("unable to call the connection resolve, because no connection promise was found")}processExtContentConnection(e){if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",t=>{var s;const n=(s=t.data)==null?void 0:s.glue42ExtInc;if(!n)return;const r=this.settings.allowedOrigins||[];if(r.length&&!r.includes(t.origin)){this.logger.warn(`received a message from an origin which is not in the allowed list: ${t.origin}`);return}this.registry.execute("onMessage",n)}),this.connectionResolve){this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),delete this.connectionResolve;return}}handleAcceptanceOfGrandChildRequest(e,t){if(this.extContentConnecting||this.extContentConnected){this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");return}this.logger.debug(`handling a connection accepted signal targeted at a grandchild: ${e.clientId}`);const n=this.children.find(r=>r.grandChildId===e.clientId);if(!n){this.logger.error(`cannot handle connection accepted for grandchild: ${e.clientId}, because there is no grandchild with this id`);return}n.connected=!0,this.logger.debug(`the grandchild connection for ${e.clientId} is set up, forwarding the success message and the gateway port`),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])}handleConnectionRejected(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)}handleConnectionRequest(e){if(this.extContentConnecting){this.logger.debug("This connection request event is targeted at the extension content");return}const t=e.source,n=e.data.glue42core;if(!n.clientType||n.clientType!=="grandChild")return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if(!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug(`handling a connection request for a grandchild: ${n.clientId}`),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug(`grandchild: ${n.clientId} is prepared, forwarding connection request to the platform`),this.parent.postMessage(e.data,this.defaultTargetString)}handleParentPing(e){if(!this.parentReady){this.logger.debug("my parent is not ready, I am ignoring the parent ping");return}if(!this.iAmConnected){this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");return}const t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});const n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}setupPlatformUnloadListener(){this.onMessage(e=>{e.type==="platformUnload"&&(this.logger.debug("detected a web platform unload"),this.parentReady=!1,this.notifyStatusChanged(!1,"Gateway unloaded"))})}handleManualUnload(){var t,n;const e={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:(t=this.identity)==null?void 0:t.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:e},this.defaultTargetString);(n=this.port)==null||n.postMessage(e)}handleClientUnload(e){const t=e.data.glue42core,n=t==null?void 0:t.data.clientId;if(!n){this.logger.warn("cannot process grand child unload, because the provided id was not valid");return}if(!this.children.find(s=>s.grandChildId===n)){this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild");return}this.logger.debug(`handling grandchild unload for id: ${n}`),this.children=this.children.filter(s=>s.grandChildId!==n)}handlePlatformPing(){}notifyStatusChanged(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)}checkMessageTypeValid(e){return typeof e=="string"&&!!this.messages[e]}rejectConnectionRequest(e,t,n){this.rejected=!0,this.logger.error(n);const r={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(r,t)}requestConnectionPermissionFromExt(){return this.waitForContentScript().then(()=>Xa((e,t)=>{this.extConnectionResolve=e,this.extConnectionReject=t;const n={glue42core:{type:"extSetupRequest"}};this.logger.debug("permission request to the extension content script was sent"),window.postMessage(n,this.defaultTargetString)},this.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out"))}handleExtConnectionResponse(e){var n;if(!((n=e.data)==null?void 0:n.glue42core).approved)return this.extConnectionReject?this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected"):void 0;this.extConnectionResolve&&(this.extConnectionResolve(),delete this.extConnectionResolve),this.extContentConnecting=!0,this.parentType="extension",this.logger.debug("The extension connection was approved, proceeding.")}handleExtSetupRequest(){}handleGatewayDisconnect(){}handleGatewayInternalConnect(){}waitForContentScript(){var t;return(t=window.glue42ext)!=null&&t.content?Promise.resolve():Xa(n=>{window.addEventListener("Glue42EXTReady",()=>{n()})},this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")}async connect(){if(this.settings.port){await this.initiateInternalConnection(),this.logger.debug("internal web platform connection completed");return}this.logger.debug("opening a client web platform connection"),await this.findParent(),await this.initiateRemoteConnection(this.parent),this.logger.debug("the client is connected")}async findParent(){var o;const e="Cannot initiate glue, because this window was not opened or created by a glue client",t=this.getPossibleParentsInWindow(window),n=this.getPossibleParentsOutsideWindow((o=window.top)==null?void 0:o.opener,window.top),r=new Set([...t,...n]);if(!r.size&&!this.extContentAvailable)throw new Error(e);if(!r.size&&this.extContentAvailable){await this.requestConnectionPermissionFromExt();return}if((await this.isParentCheckSuccess(this.confirmParent(Array.from(r)))).success){this.logger.debug("The default parent was found!");return}if(!this.extContentAvailable)throw new Error(e);await this.requestConnectionPermissionFromExt()}getPossibleParentsInWindow(e){return!e||e===e.top?[]:[e.parent,...this.getPossibleParentsInWindow(e.parent)]}getPossibleParentsOutsideWindow(e,t){return!e||!t||e===t?[]:[e,...this.getPossibleParentsInWindow(e),...this.getPossibleParentsOutsideWindow(e.opener,e)]}confirmParent(e){const n=Xa(r=>{this.parentPingResolve=r;const s={glue42core:{type:this.messages.platformPing.name}};this.parentPingInterval=setInterval(()=>{e.forEach(o=>{o.postMessage(s,this.defaultTargetString)})},1e3)},this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client");return n.catch(()=>{this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval)}),n}getMyWindowId(){var e;if(this.parentType==="workspace")return window.name.substring(0,window.name.indexOf("#wsp"));if(window===window.top)return(e=window.name)!=null&&e.includes("g42")?window.name:(this.selfAssignedWindowId=this.selfAssignedWindowId||`g42-${ai(10)}`,this.selfAssignedWindowId)}}const DT=(i,e)=>{let t=i;return()=>{t--,t===0&&e()}};class $T{constructor(e=0){d(this,"minSequenceInterval");d(this,"queue",[]);d(this,"isExecutingQueue",!1);this.minSequenceInterval=e}enqueue(e){return new Promise((t,n)=>{this.queue.push({action:e,resolve:t,reject:n}),this.executeQueue()})}async executeQueue(){if(!this.isExecutingQueue){for(this.isExecutingQueue=!0;this.queue.length;){const e=this.queue.shift();if(!e){this.isExecutingQueue=!1;return}try{const t=await e.action();e.resolve(t)}catch(t){e.reject(t)}await this.intervalBreak()}this.isExecutingQueue=!1}}intervalBreak(){return new Promise(e=>setTimeout(e,this.minSequenceInterval))}}function $m(i,e,t,n,r){i==null&&(i="global"),n=n??["success"],r=r??["error"];let s=i==="global",o=!1,a,c=!1;const l=zi();e.disconnected(y),e.loggedIn(S),e.on("success",E=>C(E)),e.on("error",E=>v(E)),e.on("result",E=>C(E)),n&&n.forEach(E=>{e.on(E,D=>C(D))}),r&&r.forEach(E=>{e.on(E,D=>v(D))});const u={};function p(E){return a=E,new Promise((D,A)=>{if(s){D({});return}let x;i==="global"?x=c?Promise.resolve({}):Promise.reject("not connected to gateway"):(t.debug(`joining domain ${i}`),x=$({type:"join",destination:i,domain:"global",options:E})),x.then(()=>{w(),D({})}).catch(N=>{t.debug("error joining "+i+" domain: "+JSON.stringify(N)),A(N)})})}function f(){if(i==="global")return Promise.resolve();t.debug("stopping session "+i+"...");const E={type:"leave",destination:i,domain:"global"};return o=!1,$(E).then(()=>{s=!1,l.execute("onLeft")}).catch(()=>{s=!1,l.execute("onLeft")})}function w(){t.debug("did join "+i),s=!0;const E=o;o=!1,l.execute("onJoined",E)}function y(){c=!1,t.debug("connection is down"),s=!1,o=!0,l.execute("onLeft",{disconnected:!0})}function S(){c=!0,o&&(t.debug("connection is now up - trying to reconnect..."),p(a))}function O(E){return s&&E(!1),l.add("onJoined",E)}function _(E){return s||E(),l.add("onLeft",E)}function v(E){if(i!==E.domain)return;const D=E.request_id;if(!D)return;const A=u[D];A&&A.error(E)}function C(E){if(E.domain!==i)return;const D=E.request_id;if(!D)return;const A=u[D];A&&A.success(E)}function T(){return ai(10)}let M=[];function $(E,D,A){const x=["hello","join"];if(E.type&&x.indexOf(E.type)===-1&&!s){console.warn(`trying to send a message (${E.domain} ${E.type}) but not connected, will queue`);const b=new xu;if(M.push({msg:E,tag:D,options:A,pw:b}),M.length===1){const R=O(()=>{t.info(`joined - will now send queued messages (${M.length} -> [${M.map(z=>z.msg.type)}])`),M.forEach(z=>{$(z.msg,z.tag,z.options).then(V=>z.pw.resolve(V)).catch(V=>z.pw.reject(V))}),M=[],R()})}return b.promise}A=A??{},E.request_id=E.request_id??T(),E.domain=E.domain??i,A.skipPeerId||(E.peer_id=e.peerId);const N=E.request_id;return new Promise((b,R)=>{u[N]={success:z=>{delete u[N],z._tag=D,b(z)},error:z=>{t.warn(`Gateway error - ${JSON.stringify(z)}`),delete u[N],z._tag=D,R(z)}},e.send(E,A).catch(z=>{u[N].error({err:z})})})}function G(E){return E.request_id=E.request_id?E.request_id:T(),E.domain=E.domain??i,E.peer_id=e.peerId,e.send(E)}return{join:p,leave:f,onJoined:O,onLeft:_,send:$,sendFireAndForget:G,on:(E,D)=>{e.on(E,A=>{if(A.domain===i)try{D(A)}catch(x){t.error(`Callback  failed: ${x} 
 ${x.stack} 
 msg was: ${JSON.stringify(A)}`,x)}})},loggedIn:E=>e.loggedIn(E),connected:E=>e.connected(E),disconnected:E=>e.disconnected(E),get peerId(){return e.peerId},get domain(){return i}}}class FT{constructor(e,t){d(this,"settings");d(this,"logger");d(this,"protocolVersion",3);d(this,"peerId");d(this,"token");d(this,"info");d(this,"resolvedIdentity");d(this,"availableDomains");d(this,"gatewayToken");d(this,"replayer");d(this,"messageHandlers",{});d(this,"ids",1);d(this,"registry",zi());d(this,"_connected",!1);d(this,"isTrace",!1);d(this,"transport");d(this,"_defaultTransport");d(this,"_defaultAuth");d(this,"_targetTransport");d(this,"_targetAuth");d(this,"_swapTransport",!1);d(this,"_switchInProgress",!1);d(this,"_transportSubscriptions",[]);d(this,"datePrefix","#T42_DATE#");d(this,"datePrefixLen",this.datePrefix.length);d(this,"dateMinLen",this.datePrefixLen+1);d(this,"datePrefixFirstChar",this.datePrefix[0]);d(this,"_sequelizer",new $T);d(this,"_isLoggedIn",!1);d(this,"shouldTryLogin",!0);d(this,"pingTimer");d(this,"sessions",[]);d(this,"globalDomain");d(this,"initialLogin",!0);d(this,"initialLoginAttempts",3);d(this,"loginConfig");if(this.settings=e,this.logger=t,e=e||{},e.reconnectAttempts=e.reconnectAttempts??10,e.reconnectInterval=e.reconnectInterval??1e3,e.inproc)this.transport=new ET(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new PT(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new OT(e.webPlatform,t.subLogger("web-platform"),e.identity);else if(e.ws!==void 0)this.transport=new Dm(e,t.subLogger("ws"));else throw new Error("No connection information specified");this.isTrace=t.canPublish("trace"),t.debug(`starting with ${this.transport.name()} transport`);const n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),r=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(r),this._defaultTransport=this.transport,this.ping()}async switchTransport(e){return this._sequelizer.enqueue(async()=>{if(!e||typeof e!="object")throw new Error("Cannot switch transports, because the settings are missing or invalid.");if(typeof e.type>"u")throw new Error("Cannot switch the transport, because the type is not defined");this.logger.trace(`Starting transport switch with settings: ${JSON.stringify(e)}`);const t=e.type==="secondary"?this.getNewSecondaryTransport(e):this._defaultTransport;this._targetTransport=t,this._targetAuth=e.type==="secondary"?this.getNewSecondaryAuth(e):this._defaultAuth;const n=this.verifyConnection();this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),await this.transport.close();try{await n;const r=this.transport===t;return this.logger.info(`The reconnection after the switch was completed. Was the switch a success: ${r}`),this._switchInProgress=!1,{success:r}}catch{return this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,{success:!1}}})}onLibReAnnounced(e){return this.registry.add("libReAnnounced",e)}setLibReAnnounced(e){this.registry.execute("libReAnnounced",e)}send(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){const n=this.createObjectMessage(e);return this.isTrace&&this.logger.trace(`>> ${JSON.stringify(n)}`),this.transport.sendObject(n,t)}else{const n=this.createStringMessage(e);return this.isTrace&&this.logger.trace(`>> ${n}`),this.transport.send(n,t)}}on(e,t){e=e.toLowerCase(),this.messageHandlers[e]===void 0&&(this.messageHandlers[e]={});const n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}}off(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]}get isConnected(){return this._isLoggedIn}connected(e){return this.loggedIn(()=>{const t=this.transport.name();e(t)})}disconnected(e){return this.registry.add("disconnected",e)}async login(e,t){this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),e=this.transportSwap()??e),this.logger.trace(`Starting login for transport: ${this.transport.name()} and auth ${JSON.stringify(e)}`);try{await this.transport.open(),this.logger.trace(`Transport: ${this.transport.name()} opened, logging in`),qn("connection").mark("transport-opened");const n=await this.loginCore(e,t);return this.logger.trace(`Logged in with identity: ${JSON.stringify(n)}`),qn("connection").mark("protocol-logged-in"),n}catch(n){throw this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(n)}}async logout(){await this.logoutCore(),await this.transport.close()}loggedIn(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)}domain(e,t,n){let r=this.sessions.find(s=>s.domain===e);return r||(r=$m(e,this,this.logger.subLogger(`domain=${e}`),t,n),this.sessions.push(r)),r}authToken(){const e={domain:"global",type:"create-token"};return this.globalDomain?this.globalDomain.send(e).then(t=>t.token):Promise.reject(new Error("no global domain session"))}reconnect(){return this.transport.reconnect()}setLoggedIn(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")}distributeMessage(e,t){const n=this.messageHandlers[t.toLowerCase()];n!==void 0&&Object.keys(n).forEach(r=>{const s=n[r];if(s!==void 0)try{s(e)}catch(o){try{this.logger.error(`Message handler failed with ${o.stack}`,o)}catch{console.log("Message handler failed",o)}}})}handleConnectionChanged(e){var t,n;this._connected!==e&&(this._connected=e,e?((n=(t=this.settings)==null?void 0:t.replaySpecs)!=null&&n.length&&(this.replayer=new MT(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):(this.handleDisconnected(),this.registry.execute("disconnected")))}handleDisconnected(){if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.login(this.loginConfig,!0).catch(()=>{setTimeout(this.handleDisconnected.bind(this),this.settings.reconnectInterval||1e3)})}}handleTransportMessage(e){let t;typeof e=="string"?t=this.processStringMessage(e):t=this.processObjectMessage(e),this.isTrace&&this.logger.trace(`<< ${JSON.stringify(t)}`),this.distributeMessage(t.msg,t.msgType)}verifyConnection(){return Xa(e=>{let t;const n=DT(2,()=>{t&&t(),e()});t=this.onLibReAnnounced(r=>{if(r.name==="interop"||r.name==="contexts")return n()})},1e4,"Transport switch timed out waiting for all libraries to be re-announced")}getNewSecondaryTransport(e){var t;if(!((t=e.transportConfig)!=null&&t.url))throw new Error("Missing secondary transport URL.");return new Dm(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))}getNewSecondaryAuth(e){var t;if(!((t=e.transportConfig)!=null&&t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth}transportSwap(){if(this._swapTransport=!1,!this._targetTransport||!this._targetAuth){this.logger.warn(`Error while switching transports - either the target transport or auth is not defined: transport defined -> ${!!this._defaultTransport}, auth defined -> ${!!this._targetAuth}. Staying on the current one.`);return}this._transportSubscriptions.forEach(n=>n()),this._transportSubscriptions=[],this.transport=this._targetTransport;const e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}prepareDefaultSwap(){this._transportSubscriptions.forEach(e=>e()),this._transportSubscriptions=[],this.transport.close().catch(e=>this.logger.warn(`Error closing the ${this.transport.name()} transport after a failed connection attempt: ${JSON.stringify(e)}`)),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0}processStringMessage(e){const t=JSON.parse(e,(n,r)=>{if(typeof r!="string"||r.length<this.dateMinLen||!r.startsWith(this.datePrefixFirstChar)||r.substring(0,this.datePrefixLen)!==this.datePrefix)return r;try{const s=parseInt(r.substring(this.datePrefixLen,r.length),10);return isNaN(s)?r:new Date(s)}catch{return r}});return{msg:t,msgType:t.type}}createStringMessage(e){const t=Date.prototype.toJSON;try{const n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}}processObjectMessage(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}}createObjectMessage(e){return e}async loginCore(e,t){this.logger.info("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0;const n=await this.setupAuthConfig(e,t),r={type:"hello",identity:this.settings.identity,authentication:n};e.sessionId&&(r.request_id=e.sessionId),this.globalDomain=$m("global",this,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]);const s={skipPeerId:!0};this.initialLogin&&(s.retryInterval=this.settings.reconnectInterval,s.maxRetries=this.settings.reconnectAttempts);try{const o=await this.tryAuthenticate(this.globalDomain,r,s,e);return this.initialLogin=!1,this.logger.info("login successful with peerId "+o.peer_id),this.peerId=o.peer_id,this.resolvedIdentity=o.resolved_identity,this.availableDomains=o.available_domains,o.options&&(this.token=o.options.access_token,this.info=o.options.info),this.setLoggedIn(!0),o.resolved_identity}catch(o){throw this.logger.error("error sending hello message - "+(o.message||o.msg||o.reason||o),o),o}finally{e!=null&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null)}}async tryAuthenticate(e,t,n,r){let s;for(;;){const o=await e.send(t,void 0,n);if(o.type==="authentication-request"){const a=Buffer.from(o.authentication.token,"base64");r.flowCallback&&r.sessionId&&(t.authentication.token=(await r.flowCallback(r.sessionId,a)).data.toString("base64")),t.request_id=r.sessionId}else if(o.type==="welcome"){s=o;break}else throw o.type==="error"?new Error("Authentication failed: "+o.reason):new Error("Unexpected message type during authentication: "+o.type)}return s}async setupAuthConfig(e,t){const n={};if(this.gatewayToken=e.gatewayToken,e.gatewayToken){if(t)try{e.gatewayToken=await this.getNewGWToken()}catch(r){this.logger.warn(`failed to get GW token when reconnecting ${(r==null?void 0:r.message)||r}`)}n.method="gateway-token",n.token=e.gatewayToken,this.gatewayToken=e.gatewayToken}else if(e.flowName==="sspi")if(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId)n.token=(await e.flowCallback(e.sessionId,null)).data.toString("base64");else throw new Error("Invalid SSPI config");else if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else if(e.provider)n.provider=e.provider,n.providerContext=e.providerContext;else throw new Error("invalid auth message"+JSON.stringify(e));return n}async logoutCore(){this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer);const e=this.sessions.map(t=>{t.leave()});await Promise.all(e)}getNewGWToken(){if(typeof window<"u"){const e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))}ping(){this.shouldTryLogin&&(this._isLoggedIn&&this.send({type:"ping"}),this.pingTimer=setTimeout(()=>{this.ping()},30*1e3))}}const Fm=["trace","debug","info","warn","error","off"];var xn;let Lm=(xn=class{constructor(e,t,n){d(this,"name");d(this,"parent");d(this,"path");d(this,"subLoggers",[]);d(this,"_consoleLevel");d(this,"_publishLevel");d(this,"loggerFullName");d(this,"includeTimeAndLevel");d(this,"logFn",console);d(this,"customLogFn",!1);this.name=e,this.parent=t,this.name=e,t?this.path=`${t.path}.${e}`:this.path=e,this.loggerFullName=`[${this.path}]`,this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}subLogger(e){const t=this.subLoggers.filter(r=>r.name===e)[0];if(t!==void 0)return t;Object.keys(this).forEach(r=>{if(r===e)throw new Error("This sub logger name is not allowed.")});const n=new xn(e,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(n),n}publishLevel(e){var t;return e&&(this._publishLevel=e),this._publishLevel||((t=this.parent)==null?void 0:t.publishLevel())}consoleLevel(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||((t=this.parent)==null?void 0:t.consoleLevel())}log(e,t,n){this.publishMessage(t||"info",e,n)}trace(e){this.log(e,"trace")}debug(e){this.log(e,"debug")}info(e){this.log(e,"info")}warn(e){this.log(e,"warn")}error(e,t){this.log(e,"error")}canPublish(e,t){const n=Fm.indexOf(e),r=Fm.indexOf(t||this.consoleLevel()||"trace");return n>=r}publishMessage(e,t,n){const r=this.loggerFullName;if(e==="error"&&!n){const s=new Error;s.stack&&(t=t+`
`+s.stack.split(`
`).slice(3).join(`
`))}if(this.canPublish(e,this.publishLevel())){const s=xn.Interop;if(s)try{s.methods({name:xn.InteropMethodName}).length>0&&s.invoke(xn.InteropMethodName,{msg:`${t}`,logger:r,level:e})}catch{}}if(this.canPublish(e)){let s="";if(this.includeTimeAndLevel){const a=new Date;s=`[${`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}:${a.getMilliseconds()}`}] [${e}] `}const o=`${s}${r}: ${t}`;switch(e){case"trace":this.logFn.debug(o);break;case"debug":this.logFn.debug?this.logFn.debug(o):this.logFn.log(o);break;case"info":this.logFn.info(o);break;case"warn":this.logFn.warn(o);break;case"error":this.logFn.error(o,n);break}}}},d(xn,"Interop"),d(xn,"InteropMethodName","T42.AppLogger.Log"),d(xn,"Instance"),xn);const Hb="create-context",Ya="created",Za="destroyed",ec="context-created",tc="context-added",Gb="subscribe-context",Ki="subscribed-context",zb="unsubscribe-context",Ub="destroy-context",nc="context-destroyed",zl="update-context",_s="context-updated",Cs="joined",ku={get name(){return"context"},get types(){return[Hb,Ya,Za,ec,tc,Gb,Ki,zb,Ub,nc,zl,_s,Cs]}};var Tu="6.4.0";function LT(i,e,t){var p;let n;if(Qr.isNode()){const f=jb._GD_STARTING_CONTEXT_;if(f)try{n=JSON.parse(f)}catch{}}function r(){var R;const f=i.gateway,w=(f==null?void 0:f.protocolVersion)??3,y=f==null?void 0:f.reconnectInterval,S=f==null?void 0:f.reconnectAttempts,O="ws://localhost:8385";let _=f==null?void 0:f.ws;const v=f==null?void 0:f.sharedWorker,C=f==null?void 0:f.inproc,T=(f==null?void 0:f.webPlatform)??void 0;t&&(_=t.gwURL),Qr.isNode()&&n&&n.gwURL&&(_=n.gwURL),!_&&!v&&!C&&(_=O);let M,$,G,E,D;const A=o();let x=A;typeof t<"u"?($=t.windowId,G=t.pid,t.env&&(E=t.env.env,D=t.env.region),x=t.application??"glue-app",M=t.appInstanceId):Qr.isNode()?(G=process.pid,n&&(E=n.env,D=n.region,M=n.instanceId)):typeof(window==null?void 0:window.glue42electron)<"u"&&($=window==null?void 0:window.glue42electron.instanceId,G=window==null?void 0:window.glue42electron.pid,E=window==null?void 0:window.glue42electron.env,D=window==null?void 0:window.glue42electron.region,x=(window==null?void 0:window.glue42electron.application)??"glue-app",M=window==null?void 0:window.glue42electron.instanceId);const N=((R=i.gateway)==null?void 0:R.replaySpecs)??[];N.push(ku);let b={application:x,applicationName:A,windowId:$,instance:M,process:G,region:D,environment:E,api:e.version||Tu};return i.identity&&(b=Object.assign(b,i.identity)),{identity:b,reconnectInterval:y,ws:_,sharedWorker:v,webPlatform:T,inproc:C,protocolVersion:w,reconnectAttempts:S,replaySpecs:N}}function s(){return typeof i.contexts>"u"?{reAnnounceKnownContexts:!0}:typeof i.contexts=="boolean"&&i.contexts?{reAnnounceKnownContexts:!0}:typeof i.contexts=="object"?Object.assign({},{reAnnounceKnownContexts:!0},i.contexts):!1}function o(){if(i.application)return i.application;if(t)return t.applicationName;if(typeof window<"u"&&typeof window.glue42electron<"u")return window.glue42electron.application;const f=ai(10);return Qr.isNode()?n?n.applicationConfig.name:"NodeJS"+f:typeof window<"u"&&typeof document<"u"?document.title+` (${f})`:f}function a(){var f,w,y;if(typeof i.auth=="string")return{token:i.auth};if(i.auth)return i.auth;if(Qr.isNode()&&n&&n.gwToken)return{gatewayToken:n.gwToken};if((f=i.gateway)!=null&&f.webPlatform||(w=i.gateway)!=null&&w.inproc||(y=i.gateway)!=null&&y.sharedWorker)return{username:"glue42",password:"glue42"}}function c(){let f=i.logger;const w="warn";f||(f=w);let y;return t&&(y=t.consoleLogLevel),typeof f=="string"?{console:y??f,publish:w}:{console:y??f.console??w,publish:f.publish??w}}const l=r();let u=o();if(typeof window<"u"){const f=window,w=f.htmlContainer?`${f.htmlContainer.containerName}.${f.htmlContainer.application}`:(p=f==null?void 0:f.glue42gd)==null?void 0:p.application;w&&(u=w)}return{bus:i.bus??!1,application:u,auth:a(),logger:c(),connection:l,metrics:i.metrics??!0,contexts:s(),version:e.version||Tu,libs:e.libs??[],customLogger:i.customLogger}}class Na{constructor(e,t,n,r){d(this,"name");d(this,"contextId");d(this,"context");d(this,"isAnnounced");d(this,"joinedActivity");d(this,"updateCallbacks",{});d(this,"activityId");d(this,"sentExplicitSubscription");d(this,"hasReceivedSnapshot");this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=r,this.context={}}hasCallbacks(){return Object.keys(this.updateCallbacks).length>0}getState(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0}}var Au={exports:{}};Au.exports;(function(i,e){var t=200,n="__lodash_hash_undefined__",r=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",c="[object Date]",l="[object Error]",u="[object Function]",p="[object GeneratorFunction]",f="[object Map]",w="[object Number]",y="[object Object]",S="[object Promise]",O="[object RegExp]",_="[object Set]",v="[object String]",C="[object Symbol]",T="[object WeakMap]",M="[object ArrayBuffer]",$="[object DataView]",G="[object Float32Array]",E="[object Float64Array]",D="[object Int8Array]",A="[object Int16Array]",x="[object Int32Array]",N="[object Uint8Array]",b="[object Uint8ClampedArray]",R="[object Uint16Array]",z="[object Uint32Array]",V=/[\\^$.*+?()[\]{}|]/g,Q=/\w*$/,H=/^\[object .+?Constructor\]$/,ne=/^(?:0|[1-9]\d*)$/,J={};J[s]=J[o]=J[M]=J[$]=J[a]=J[c]=J[G]=J[E]=J[D]=J[A]=J[x]=J[f]=J[w]=J[y]=J[O]=J[_]=J[v]=J[C]=J[N]=J[b]=J[R]=J[z]=!0,J[l]=J[u]=J[T]=!1;var me=typeof pl=="object"&&pl&&pl.Object===Object&&pl,ge=typeof self=="object"&&self&&self.Object===Object&&self,ye=me||ge||Function("return this")(),Ee=e&&!e.nodeType&&e,It=Ee&&!0&&i&&!i.nodeType&&i,gt=It&&It.exports===Ee;function yn(h,I){return h.set(I[0],I[1]),h}function _r(h,I){return h.add(I),h}function io(h,I){for(var P=-1,q=h?h.length:0;++P<q&&I(h[P],P,h)!==!1;);return h}function ro(h,I){for(var P=-1,q=I.length,ve=h.length;++P<q;)h[ve+P]=I[P];return h}function Cr(h,I,P,q){for(var ve=-1,ke=h?h.length:0;++ve<ke;)P=I(P,h[ve],ve,h);return P}function so(h,I){for(var P=-1,q=Array(h);++P<h;)q[P]=I(P);return q}function oo(h,I){return h==null?void 0:h[I]}function Sr(h){var I=!1;if(h!=null&&typeof h.toString!="function")try{I=!!(h+"")}catch{}return I}function Ir(h){var I=-1,P=Array(h.size);return h.forEach(function(q,ve){P[++I]=[ve,q]}),P}function hi(h,I){return function(P){return h(I(P))}}function xr(h){var I=-1,P=Array(h.size);return h.forEach(function(q){P[++I]=q}),P}var ao=Array.prototype,co=Function.prototype,Mn=Object.prototype,jn=ye["__core-js_shared__"],kr=function(){var h=/[^.]+$/.exec(jn&&jn.keys&&jn.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),Tr=co.toString,st=Mn.hasOwnProperty,On=Mn.toString,lo=RegExp("^"+Tr.call(st).replace(V,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ar=gt?ye.Buffer:void 0,Er=ye.Symbol,Pr=ye.Uint8Array,uo=hi(Object.getPrototypeOf,Object),ho=Object.create,po=Mn.propertyIsEnumerable,fo=ao.splice,Nr=Object.getOwnPropertySymbols,go=Ar?Ar.isBuffer:void 0,Rr=hi(Object.keys,Object),pi=Ht(ye,"DataView"),an=Ht(ye,"Map"),fi=Ht(ye,"Promise"),gi=Ht(ye,"Set"),mi=Ht(ye,"WeakMap"),cn=Ht(Object,"create"),mo=Tt(pi),yo=Tt(an),wo=Tt(fi),vo=Tt(gi),bo=Tt(mi),Mr=Er?Er.prototype:void 0,jr=Mr?Mr.valueOf:void 0;function xt(h){var I=-1,P=h?h.length:0;for(this.clear();++I<P;){var q=h[I];this.set(q[0],q[1])}}function _o(){this.__data__=cn?cn(null):{}}function Co(h){return this.has(h)&&delete this.__data__[h]}function So(h){var I=this.__data__;if(cn){var P=I[h];return P===n?void 0:P}return st.call(I,h)?I[h]:void 0}function Io(h){var I=this.__data__;return cn?I[h]!==void 0:st.call(I,h)}function xo(h,I){var P=this.__data__;return P[h]=cn&&I===void 0?n:I,this}xt.prototype.clear=_o,xt.prototype.delete=Co,xt.prototype.get=So,xt.prototype.has=Io,xt.prototype.set=xo;function Je(h){var I=-1,P=h?h.length:0;for(this.clear();++I<P;){var q=h[I];this.set(q[0],q[1])}}function ko(){this.__data__=[]}function To(h){var I=this.__data__,P=Dn(I,h);if(P<0)return!1;var q=I.length-1;return P==q?I.pop():fo.call(I,P,1),!0}function Ao(h){var I=this.__data__,P=Dn(I,h);return P<0?void 0:I[P][1]}function Eo(h){return Dn(this.__data__,h)>-1}function Po(h,I){var P=this.__data__,q=Dn(P,h);return q<0?P.push([h,I]):P[q][1]=I,this}Je.prototype.clear=ko,Je.prototype.delete=To,Je.prototype.get=Ao,Je.prototype.has=Eo,Je.prototype.set=Po;function Wt(h){var I=-1,P=h?h.length:0;for(this.clear();++I<P;){var q=h[I];this.set(q[0],q[1])}}function No(){this.__data__={hash:new xt,map:new(an||Je),string:new xt}}function Ro(h){return $n(this,h).delete(h)}function Mo(h){return $n(this,h).get(h)}function jo(h){return $n(this,h).has(h)}function Oo(h,I){return $n(this,h).set(h,I),this}Wt.prototype.clear=No,Wt.prototype.delete=Ro,Wt.prototype.get=Mo,Wt.prototype.has=jo,Wt.prototype.set=Oo;function Bt(h){this.__data__=new Je(h)}function Do(){this.__data__=new Je}function $o(h){return this.__data__.delete(h)}function Fo(h){return this.__data__.get(h)}function Lo(h){return this.__data__.has(h)}function Wo(h,I){var P=this.__data__;if(P instanceof Je){var q=P.__data__;if(!an||q.length<t-1)return q.push([h,I]),this;P=this.__data__=new Wt(q)}return P.set(h,I),this}Bt.prototype.clear=Do,Bt.prototype.delete=$o,Bt.prototype.get=Fo,Bt.prototype.has=Lo,Bt.prototype.set=Wo;function Bo(h,I){var P=vi(h)||la(h)?so(h.length,String):[],q=P.length,ve=!!q;for(var ke in h)st.call(h,ke)&&!(ve&&(ke=="length"||Se(ke,q)))&&P.push(ke);return P}function Or(h,I,P){var q=h[I];(!(st.call(h,I)&&Lr(q,P))||P===void 0&&!(I in h))&&(h[I]=P)}function Dn(h,I){for(var P=h.length;P--;)if(Lr(h[P][0],I))return P;return-1}function Ho(h,I){return h&&Dr(I,bi(I),h)}function yi(h,I,P,q,ve,ke,Ke){var Te;if(q&&(Te=ke?q(h,ve,ke,Ke):q(h)),Te!==void 0)return Te;if(!Fn(h))return h;var Hr=vi(h);if(Hr){if(Te=ia(h),!I)return ta(h,Te)}else{var Gt=kt(h),Gr=Gt==u||Gt==p;if(da(h))return Jo(h,I);if(Gt==y||Gt==s||Gr&&!ke){if(Sr(h))return ke?h:{};if(Te=ra(Gr?{}:h),!I)return ps(h,Ho(Te,h))}else{if(!J[Gt])return ke?h:{};Te=sa(h,Gt,yi,I)}}Ke||(Ke=new Bt);var zr=Ke.get(h);if(zr)return zr;if(Ke.set(h,Te),!Hr)var Ur=P?na(h):bi(h);return io(Ur||h,function(_i,Ln){Ur&&(Ln=_i,_i=h[Ln]),Or(Te,Ln,yi(_i,I,P,q,Ln,h,Ke))}),Te}function Go(h){return Fn(h)?ho(h):{}}function zo(h,I,P){var q=I(h);return vi(h)?q:ro(q,P(h))}function Uo(h){return On.call(h)}function qo(h){if(!Fn(h)||aa(h))return!1;var I=Br(h)||Sr(h)?lo:H;return I.test(Tt(h))}function Vo(h){if(!Fr(h))return Rr(h);var I=[];for(var P in Object(h))st.call(h,P)&&P!="constructor"&&I.push(P);return I}function Jo(h,I){if(I)return h.slice();var P=new h.constructor(h.length);return h.copy(P),P}function wi(h){var I=new h.constructor(h.byteLength);return new Pr(I).set(new Pr(h)),I}function Ko(h,I){var P=I?wi(h.buffer):h.buffer;return new h.constructor(P,h.byteOffset,h.byteLength)}function Qo(h,I,P){var q=I?P(Ir(h),!0):Ir(h);return Cr(q,yn,new h.constructor)}function Xo(h){var I=new h.constructor(h.source,Q.exec(h));return I.lastIndex=h.lastIndex,I}function Yo(h,I,P){var q=I?P(xr(h),!0):xr(h);return Cr(q,_r,new h.constructor)}function Zo(h){return jr?Object(jr.call(h)):{}}function ea(h,I){var P=I?wi(h.buffer):h.buffer;return new h.constructor(P,h.byteOffset,h.length)}function ta(h,I){var P=-1,q=h.length;for(I||(I=Array(q));++P<q;)I[P]=h[P];return I}function Dr(h,I,P,q){P||(P={});for(var ve=-1,ke=I.length;++ve<ke;){var Ke=I[ve],Te=void 0;Or(P,Ke,Te===void 0?h[Ke]:Te)}return P}function ps(h,I){return Dr(h,$r(h),I)}function na(h){return zo(h,bi,$r)}function $n(h,I){var P=h.__data__;return oa(I)?P[typeof I=="string"?"string":"hash"]:P.map}function Ht(h,I){var P=oo(h,I);return qo(P)?P:void 0}var $r=Nr?hi(Nr,Object):fa,kt=Uo;(pi&&kt(new pi(new ArrayBuffer(1)))!=$||an&&kt(new an)!=f||fi&&kt(fi.resolve())!=S||gi&&kt(new gi)!=_||mi&&kt(new mi)!=T)&&(kt=function(h){var I=On.call(h),P=I==y?h.constructor:void 0,q=P?Tt(P):void 0;if(q)switch(q){case mo:return $;case yo:return f;case wo:return S;case vo:return _;case bo:return T}return I});function ia(h){var I=h.length,P=h.constructor(I);return I&&typeof h[0]=="string"&&st.call(h,"index")&&(P.index=h.index,P.input=h.input),P}function ra(h){return typeof h.constructor=="function"&&!Fr(h)?Go(uo(h)):{}}function sa(h,I,P,q){var ve=h.constructor;switch(I){case M:return wi(h);case a:case c:return new ve(+h);case $:return Ko(h,q);case G:case E:case D:case A:case x:case N:case b:case R:case z:return ea(h,q);case f:return Qo(h,q,P);case w:case v:return new ve(h);case O:return Xo(h);case _:return Yo(h,q,P);case C:return Zo(h)}}function Se(h,I){return I=I??r,!!I&&(typeof h=="number"||ne.test(h))&&h>-1&&h%1==0&&h<I}function oa(h){var I=typeof h;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?h!=="__proto__":h===null}function aa(h){return!!kr&&kr in h}function Fr(h){var I=h&&h.constructor,P=typeof I=="function"&&I.prototype||Mn;return h===P}function Tt(h){if(h!=null){try{return Tr.call(h)}catch{}try{return h+""}catch{}}return""}function ca(h){return yi(h,!0,!0)}function Lr(h,I){return h===I||h!==h&&I!==I}function la(h){return ua(h)&&st.call(h,"callee")&&(!po.call(h,"callee")||On.call(h)==s)}var vi=Array.isArray;function Wr(h){return h!=null&&ha(h.length)&&!Br(h)}function ua(h){return pa(h)&&Wr(h)}var da=go||ga;function Br(h){var I=Fn(h)?On.call(h):"";return I==u||I==p}function ha(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=r}function Fn(h){var I=typeof h;return!!h&&(I=="object"||I=="function")}function pa(h){return!!h&&typeof h=="object"}function bi(h){return Wr(h)?Bo(h):Vo(h)}function fa(){return[]}function ga(){return!1}i.exports=ca})(Au,Au.exports);var WT=Au.exports,BT=Bb(WT);function Wm(i,e,t){try{if(t!=null&&t.canPublish("trace")&&(t==null||t.trace(`applying context delta ${JSON.stringify(e)} on context ${JSON.stringify(i)}`)),!e)return i;if(e.reset)return i={...e.reset},i;if(i=Gn(i,void 0),e.commands){for(const o of e.commands)o.type==="remove"?GT(i,o.path):o.type==="set"&&Ul(i,o.value,o.path);return i}const n=e.added,r=e.updated,s=e.removed;return n&&Object.keys(n).forEach(o=>{i[o]=n[o]}),r&&Object.keys(r).forEach(o=>{HT(o,i,r)}),s&&s.forEach(o=>{delete i[o]}),i}catch(n){return t==null||t.error(`error applying context delta ${JSON.stringify(e)} on context ${JSON.stringify(i)}`,n),i}}function Gn(i,e){return BT(i)}const HT=(i,e,t)=>{const n=t[i];if(n===void 0)return e;const r=e[i];return!r||!n||typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof n=="string"||typeof n=="number"||typeof n=="boolean"||Array.isArray(r)||Array.isArray(n)?(e[i]=n,e):(e[i]=Object.assign({},r,n),e)};function ic(i,e){if(i===e)return!0;if(!(i instanceof Object)||!(e instanceof Object)||i.constructor!==e.constructor)return!1;for(const t in i)if(i.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return!1;if(i[t]!==e[t]&&(typeof i[t]!="object"||!ic(i[t],e[t])))return!1}for(const t in e)if(e.hasOwnProperty(t)&&!i.hasOwnProperty(t))return!1;return!0}function Ul(i,e,t){const n=t.split(".");let r;for(r=0;r<n.length-1;r++)i[n[r]]||(i[n[r]]={}),typeof i[n[r]]!="object"&&(i[n[r]]={}),i=i[n[r]];i[n[r]]=e}function qb(i,e){return Object.keys(e).every(t=>typeof e[t]=="object"?qb((i==null?void 0:i[t])||{},e[t]||{}):e[t]===(i==null?void 0:i[t]))}function GT(i,e){const t=e.split(".");let n;for(n=0;n<t.length-1;n++){if(!i[t[n]])return;i=i[t[n]]}delete i[t[n]]}let zT=class{constructor(e){d(this,"_logger");d(this,"_connection");d(this,"_trackAllContexts");d(this,"_reAnnounceKnownContexts");d(this,"_gw3Session");d(this,"_contextNameToData",{});d(this,"_gw3Subscriptions",[]);d(this,"_nextCallbackSubscriptionNumber",0);d(this,"_creationPromises",{});d(this,"_contextNameToId",{});d(this,"_contextIdToName",{});d(this,"_protocolVersion");d(this,"_contextsTempCache",{});d(this,"_contextsSubscriptionsCache",[]);d(this,"_systemContextsSubKey");var t;this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[ec,Ki,nc,_s]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined(n=>{if(n){if(!this._reAnnounceKnownContexts)return this._connection.setLibReAnnounced({name:"contexts"});this.reInitiateState().then(()=>this._connection.setLibReAnnounced({name:"contexts"}))}}),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),(t=this._connection.replayer)==null||t.drain(ku.name,n=>{const r=n.type;r&&(r===ec||r===tc||r===Ya?this.handleContextCreatedMessage(n):r===Ki||r===_s||r===Cs?this.handleContextUpdatedMessage(n):(r===nc||r===Za)&&this.handleContextDestroyedMessage(n))})}get protocolVersion(){if(!this._protocolVersion){const e=this._connection.availableDomains.find(t=>t.uri==="context");this._protocolVersion=(e==null?void 0:e.version)??1}return this._protocolVersion}get setPathSupported(){return this.protocolVersion>=2}dispose(){for(const e of this._gw3Subscriptions)this._connection.off(e);this._gw3Subscriptions.length=0;for(const e in this._contextNameToData)this._contextNameToId.hasOwnProperty(e)&&delete this._contextNameToData[e]}createContext(e,t){return e in this._creationPromises?this._creationPromises[e]:(this._creationPromises[e]=this._gw3Session.send({type:Hb,domain:"global",name:e,data:t,lifetime:"retained"}).then(n=>{this._contextNameToId[e]=n.context_id,this._contextIdToName[n.context_id]=e;const r=this._contextNameToData[e]||new Na(n.context_id,e,!0,void 0);return r.isAnnounced=!0,r.name=e,r.contextId=n.context_id,r.context=n.data||Gn(t),r.hasReceivedSnapshot=!0,this._contextNameToData[e]=r,delete this._creationPromises[e],n.context_id}),this._creationPromises[e])}all(){return Object.keys(this._contextNameToData).filter(e=>this._contextNameToData[e].isAnnounced)}async update(e,t){var o;t&&(t=Gn(t)),e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];if(!n||!n.isAnnounced)return this.createContext(e,t);let r=n.context;n.hasCallbacks()||(r=await this.get(n.name));const s=this.setPathSupported?this.calculateContextDeltaV2(r,t):this.calculateContextDeltaV1(r,t);return!Object.keys(s.added).length&&!Object.keys(s.updated).length&&!s.removed.length&&!((o=s.commands)!=null&&o.length)?Promise.resolve():this._gw3Session.send({type:zl,domain:"global",context_id:n.contextId,delta:s},{},{skipPeerId:!1}).then(a=>{this.handleUpdated(n,s,{updaterId:a.peer_id})})}async set(e,t){t&&(t=Gn(t)),e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];return!n||!n.isAnnounced?this.createContext(e,t):this._gw3Session.send({type:zl,domain:"global",context_id:n.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then(r=>{this.handleUpdated(n,{reset:t,added:{},removed:[],updated:{}},{updaterId:r.peer_id})})}setPath(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")}async setPaths(e,t){if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");t&&(t=Gn(t)),e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];if(!n||!n.isAnnounced){const s={};for(const o of t)Ul(s,o.value,o.path);return this.createContext(e,s)}const r=[];for(const s of t)s.value===null?r.push({type:"remove",path:s.path}):r.push({type:"set",path:s.path,value:s.value});return this._gw3Session.send({type:zl,domain:"global",context_id:n.contextId,delta:{commands:r}},{},{skipPeerId:!1}).then(s=>{this.handleUpdated(n,{added:{},removed:[],updated:{},commands:r},{updaterId:s.peer_id})})}async get(e){e in this._creationPromises&&await this._creationPromises[e];const t=this._contextNameToData[e];if(!t||!t.isAnnounced)return Promise.resolve({});if(t&&(!t.hasCallbacks()||!t.hasReceivedSnapshot))return new Promise(r=>{this.subscribe(e,(s,o,a,c)=>{this.unsubscribe(c),r(s)})});const n=(t==null?void 0:t.context)??{};return Promise.resolve(Gn(n))}async subscribe(e,t,n){e in this._creationPromises&&await this._creationPromises[e];const r=typeof n>"u"?this._nextCallbackSubscriptionNumber:n;typeof n>"u"&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every(a=>a.subKey!==this._nextCallbackSubscriptionNumber)&&this._contextsSubscriptionsCache.push({contextName:e,subKey:r,callback:t});let s=this._contextNameToData[e];if(!s||!s.isAnnounced)return s=s||new Na(void 0,e,!1,void 0),this._contextNameToData[e]=s,s.updateCallbacks[r]=t,Promise.resolve(r);const o=s.hasCallbacks();if(s.updateCallbacks[r]=t,o){if(s.hasReceivedSnapshot){const a=Gn(s.context);t(a,a,[],r)}return Promise.resolve(r)}else if(s.joinedActivity){if(s.hasReceivedSnapshot){const a=Gn(s.context);t(a,a,[],r)}return Promise.resolve(r)}else{if(s.context&&s.sentExplicitSubscription){if(s.hasReceivedSnapshot){const a=Gn(s.context);t(a,a,[],r)}return Promise.resolve(r)}return this.sendSubscribe(s).then(()=>r)}}unsubscribe(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter(t=>t.subKey!==e);for(const t of Object.keys(this._contextNameToData)){const n=this._contextNameToData[t];if(!n)return;const r=n.hasCallbacks();delete n.updateCallbacks[e],n.isAnnounced&&r&&!n.hasCallbacks()&&n.sentExplicitSubscription&&this.sendUnsubscribe(n).catch(()=>{}),!n.isAnnounced&&!n.hasCallbacks()&&delete this._contextNameToData[t]}}async destroy(e){e in this._creationPromises&&await this._creationPromises[e];const t=this._contextNameToData[e];return t?this._gw3Session.send({type:Ub,domain:"global",context_id:t.contextId}).then(n=>{}):Promise.reject(`context with ${e} does not exist`)}handleUpdated(e,t,n){const r=e.context;e.context=Wm(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]===e&&!ic(r,e.context)&&this.invokeUpdateCallbacks(e,t,n)}subscribeToContextCreatedMessages(){const e=[tc,ec,Ya];for(const t of e){const n=this._connection.on(t,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(n)}}handleContextCreatedMessage(e){const t=e.type;t===Ya?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):t===tc&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);const n=this._contextIdToName[e.context_id];if(!n)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[n])throw new Error("Received created event for context with unknown id: "+e.context_id);let r=this._contextNameToData[n];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=e.context_id,r.activityId=e.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[n]=r=new Na(e.context_id,n,!0,e.activity_id),this._trackAllContexts&&this.subscribe(n,()=>{}).then(s=>this._systemContextsSubKey=s)}subscribeToContextUpdatedMessages(){const e=[_s,Ki,Cs];for(const t of e){const n=this._connection.on(t,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(n)}}handleContextUpdatedMessage(e){const t=e.type,n=e.context_id;let r=this._contextNameToData[this._contextIdToName[n]];const s=!r||!r.isAnnounced;if(t===Cs)r||(r=this._contextNameToData[e.activity_id]||new Na(n,e.activity_id,!0,e.activity_id)),this._contextNameToData[e.activity_id]=r,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n,r.contextId=n,r.isAnnounced=!0,r.activityId=e.activity_id,r.joinedActivity=!0;else if(!r||!r.isAnnounced){t===Ki?(r=r||new Na(n,e.name,!0,void 0),r.sentExplicitSubscription=!0,this._contextNameToData[e.name]=r,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error(`Received 'update' for unknown context: ${n}`);return}const o=r.context;if(r.hasReceivedSnapshot=!0,t===Ki)r.context=e.data||{};else if(t===Cs)r.context=e.context_snapshot||{};else if(t===_s)r.context=Wm(r.context,e.delta,this._logger);else throw new Error("Unrecognized context update message "+t);(s||!ic(r.context,o)||t===Ki)&&this.invokeUpdateCallbacks(r,e.delta,{updaterId:e.updater_id})}invokeUpdateCallbacks(e,t,n){if(t=t||{added:{},updated:{},reset:{},removed:[]},t.commands){t.added=t.updated=t.reset={},t.removed=[];for(const r of t.commands)r.type==="remove"?(r.path.indexOf(".")===-1&&t.removed.push(r.path),Ul(t.updated,null,r.path)):r.type==="set"&&Ul(t.updated,r.value,r.path)}for(const r in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(r))try{const s=e.updateCallbacks[r];s(Gn(e.context),Gn(Object.assign({},t.added||{},t.updated||{},t.reset||{})),t.removed,parseInt(r,10),n)}catch(s){this._logger.debug("callback error: "+JSON.stringify(s))}}subscribeToContextDestroyedMessages(){const e=[nc,Za];for(const t of e){const n=this._connection.on(t,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(n)}}handleContextDestroyedMessage(e){const t=e.type;let n,r;if(t===Za){if(r=e.activity_id,n=this._contextNameToId[r],!n){this._logger.error(`Received 'destroyed' for unknown activity: ${e.activity_id}`);return}}else if(n=e.context_id,r=this._contextIdToName[n],!r){this._logger.error(`Received 'destroyed' for unknown context: ${e.context_id}`);return}delete this._contextIdToName[n],delete this._contextNameToId[r];const s=this._contextNameToData[r];if(delete this._contextNameToData[r],!s||!s.isAnnounced){this._logger.error(`Received 'destroyed' for unknown context: ${n}`);return}}sendSubscribe(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:Gb,domain:"global",context_id:e.contextId}).then(t=>{})}sendUnsubscribe(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:zb,domain:"global",context_id:e.contextId}).then(t=>{})}calculateContextDeltaV1(e,t){const n={added:{},updated:{},removed:[],reset:void 0};if(e)for(const r of Object.keys(e))Object.keys(t).indexOf(r)!==-1&&t[r]!==null&&!ic(e[r],t[r])&&(n.updated[r]=t[r]);for(const r of Object.keys(t))!e||Object.keys(e).indexOf(r)===-1?t[r]!==null&&(n.added[r]=t[r]):t[r]===null&&n.removed.push(r);return n}calculateContextDeltaV2(e,t){var r,s;const n={added:{},updated:{},removed:[],reset:void 0,commands:[]};for(const o of Object.keys(t))if(t[o]!==null){const a=e?e[o]:null;ic(a,t[o])||(r=n.commands)==null||r.push({type:"set",path:o,value:t[o]})}else(s=n.commands)==null||s.push({type:"remove",path:o});return n}resetState(){for(const e of this._gw3Subscriptions)this._connection.off(e);this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((e,t)=>(e[t]=this._contextNameToData[t].context,e),{}),this._contextNameToData={}}async reInitiateState(){var e;this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),(e=this._connection.replayer)==null||e.drain(ku.name,t=>{const n=t.type;n&&(n===ec||n===tc||n===Ya?this.handleContextCreatedMessage(t):n===Ki||n===_s||n===Cs?this.handleContextUpdatedMessage(t):(n===nc||n===Za)&&this.handleContextDestroyedMessage(t))}),await Promise.all(this._contextsSubscriptionsCache.map(t=>this.subscribe(t.contextName,t.callback,t.subKey))),await this.flushQueue();for(const t in this._contextsTempCache){if(typeof this._contextsTempCache[t]!="object"||Object.keys(this._contextsTempCache[t]).length===0)continue;const n=this._contextsTempCache[t];this._logger.info(`Re-announcing known context: ${t}`),await this.flushQueue(),await this.update(t,n)}this._contextsTempCache={},this._logger.info("Contexts are re-announced")}flushQueue(){return new Promise(e=>setTimeout(()=>e(),0))}};class UT{constructor(e){d(this,"initTime");d(this,"initStartTime");d(this,"initEndTime");d(this,"_bridge");this._bridge=new zT(e)}all(){return this._bridge.all()}update(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)}set(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)}setPath(e,t,n){return this.checkName(e),this.checkPath(t),t===""?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)}setPaths(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(const{path:n,value:r}of t)this.checkPath(n),n===""&&this.checkData(r);return this._bridge.setPaths(e,t)}subscribe(e,t){if(this.checkName(e),typeof t!="function")throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(n,r,s,o,a)=>t(n,r,s,()=>this._bridge.unsubscribe(o),a)).then(n=>()=>{this._bridge.unsubscribe(n)})}get(e){return this.checkName(e),this._bridge.get(e)}ready(){return Promise.resolve(this)}destroy(e){return this.checkName(e),this._bridge.destroy(e)}get setPathSupported(){return this._bridge.setPathSupported}checkName(e){if(typeof e!="string"||e==="")throw new Error("Please provide the name as a non-empty string!")}checkPath(e){if(typeof e!="string")throw new Error("Please provide the path as a dot delimited string!")}checkData(e){if(typeof e!="object")throw new Error("Please provide the data as an object!")}}function Cp(i,e,t){return typeof e!="function"&&typeof t!="function"?i:(typeof e!="function"?e=()=>{}:typeof t!="function"&&(t=()=>{}),i.then(e,t))}function qT(i=0,e,t){let n;const r=()=>{n&&clearTimeout(n)};return e.then(()=>{r()}).catch(()=>{r()}),new Promise((s,o)=>{n=setTimeout(()=>o(t),i)})}var ji;(function(i){i[i.Success=0]="Success",i[i.Error=1]="Error"})(ji||(ji={}));class VT{constructor(e,t,n,r){d(this,"protocol");d(this,"repo");d(this,"instance");d(this,"configuration");this.protocol=e,this.repo=t,this.instance=n,this.configuration=r}subscribe(e,t,n,r,s){const o=(c,l,u,p)=>{t.methodResponseTimeout=t.methodResponseTimeout??t.waitTimeoutMs,this.protocol.client.subscribe(l,t,c,u,p,s)},a=new Promise((c,l)=>{const u=_=>{c(_)},p=_=>{l(_)};if(!e){l("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");return}let f;if(typeof e=="string"?f={name:e}:f=e,!f.name){l("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");return}t===void 0&&(t={});let w=t.target;if(w===void 0&&(w="best"),typeof w=="string"&&w!=="all"&&w!=="best"){l(new Error(`"${w}" is not a valid target. Valid targets are "all", "best", or an instance.`));return}t.methodResponseTimeout===void 0&&(t.methodResponseTimeout=t.method_response_timeout,t.methodResponseTimeout===void 0&&(t.methodResponseTimeout=this.configuration.methodResponseTimeout)),t.waitTimeoutMs===void 0&&(t.waitTimeoutMs=t.wait_for_method_timeout,t.waitTimeoutMs===void 0&&(t.waitTimeoutMs=this.configuration.waitTimeoutMs));const y=500;let S=0,O=this.getServerMethodsByFilterAndTarget(f,w);if(O.length>0)o(O,O[0].methods[0],u,p);else{const _=()=>{if(!(!w||!t.waitTimeoutMs))if(S+=y,O=this.getServerMethodsByFilterAndTarget(f,w),O.length>0){const v=O[0].methods[0];o(O,v,u,p)}else S>=t.waitTimeoutMs?o(O,typeof e=="string"?{name:e}:e,u,p):setTimeout(_,y)};setTimeout(_,y)}});return Cp(a,n,r)}servers(e){const t=e===void 0?void 0:{...e};return this.getServers(t).map(n=>n.server.instance)}methods(e){return typeof e=="string"?e={name:e}:e={...e},this.getMethods(e)}methodsForInstance(e){return this.getMethodsForInstance(e)}methodAdded(e){return this.repo.onMethodAdded(e)}methodRemoved(e){return this.repo.onMethodRemoved(e)}serverAdded(e){return this.repo.onServerAdded(e)}serverRemoved(e){return this.repo.onServerRemoved((t,n)=>{e(t,n)})}serverMethodAdded(e){return this.repo.onServerMethodAdded((t,n)=>{e({server:t,method:n})})}serverMethodRemoved(e){return this.repo.onServerMethodRemoved((t,n)=>{e({server:t,method:n})})}async invoke(e,t,n,r,s,o){return Cp((async()=>{var O;let c;if(typeof e=="string"?c={name:e}:c={...e},!c.name)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if(t||(t={}),n||(n="best"),typeof n=="string"&&n!=="all"&&n!=="best"&&n!=="skipMine")return Promise.reject(new Error(`"${n}" is not a valid target. Valid targets are "all" and "best".`));if(r||(r={}),r.methodResponseTimeoutMs===void 0&&(r.methodResponseTimeoutMs=r.method_response_timeout,r.methodResponseTimeoutMs===void 0&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),r.waitTimeoutMs===void 0&&(r.waitTimeoutMs=r.wait_for_method_timeout,r.waitTimeoutMs===void 0&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),r.waitTimeoutMs!==void 0&&typeof r.waitTimeoutMs!="number")return Promise.reject(new Error(`"${r.waitTimeoutMs}" is not a valid number for "waitTimeoutMs" `));if(typeof t!="object")return Promise.reject(new Error(`The method arguments must be an object. method: ${c.name}`));let l=this.getServerMethodsByFilterAndTarget(c,n);if(l.length===0)try{l=await this.tryToAwaitForMethods(c,n,r)}catch{const C={method:{...c,getServers:()=>[],supportsStreaming:!1,objectTypes:c.objectTypes??[],flags:((O=c.flags)==null?void 0:O.metadata)??{}},called_with:t,message:`Can not find a method matching ${JSON.stringify(e)} with server filter ${JSON.stringify(n)}`,executed_by:void 0,returned:void 0,status:void 0};return Promise.reject(C)}const u=r.methodResponseTimeoutMs,p=r,f=l.map(_=>{const v=ai(10),C=_.methods[0],T=_.server,M=this.protocol.client.invoke(v,C,t,T,p);return Promise.race([M,qT(u,M,{invocationId:v,message:`Invocation timeout (${u} ms) reached for method name: ${C==null?void 0:C.name}, target instance: ${JSON.stringify(T.instance)}, options: ${JSON.stringify(p)}`,status:ji.Error})])}),w=await Promise.all(f),y=this.getInvocationResultObj(w,c,t);return w.every(_=>_.status===ji.Error)?Promise.reject(y):y})(),s,o)}getInvocationResultObj(e,t,n){const r=e.filter(c=>c.status===ji.Success).reduce((c,l)=>(c=[...c,{executed_by:l.instance,returned:l.result,called_with:n,method:t,message:l.message,status:l.status}],c),[]),s=e.filter(c=>c.status===ji.Error).reduce((c,l)=>(c=[...c,{executed_by:l.instance,called_with:n,name:t.name,message:l.message}],c),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:s,message:o.message,status:o.status}}tryToAwaitForMethods(e,t,n){return new Promise((r,s)=>{if(n.waitTimeoutMs===0){s();return}const o=500;let a=0;const l=setInterval(()=>{a+=o;const u=this.getServerMethodsByFilterAndTarget(e,t);if(u.length>0)clearInterval(l),r(u);else if(a>=(n.waitTimeoutMs||1e4)){clearInterval(l),s();return}},o)})}filterByTarget(e,t){if(typeof e=="string"){if(e==="all")return[...t];if(e==="best"){const n=t.find(r=>r.server.instance.isLocal);if(n)return[n];if(t[0]!==void 0)return[t[0]]}else if(e==="skipMine")return t.filter(({server:n})=>n.instance.peerId!==this.instance.peerId)}else{let n;return Array.isArray(e)?n=e:n=[e],n.reduce((s,o)=>{const a=t.filter(c=>this.instanceMatch(o,c.server.instance));return s.concat(a)},[])}return[]}instanceMatch(e,t){return this.containsProps(e,t)}methodMatch(e,t){return this.containsProps(e,t)}containsProps(e,t){return Object.keys(e).filter(r=>e[r]!==void 0&&e[r]!==null&&typeof e[r]!="function"&&r!=="object_types"&&r!=="display_name"&&r!=="id"&&r!=="gatewayId"&&r!=="identifier"&&r[0]!=="_").every(r=>{let s;const o=e[r],a=t[r];switch(r){case"objectTypes":s=(o||[]).every(c=>(a||[]).includes(c));break;case"flags":s=qb(a||{},o||{});break;default:s=String(o).toLowerCase()===String(a).toLowerCase()}return s})}getMethods(e){return e===void 0?this.repo.getMethods():this.repo.getMethods().filter(n=>this.methodMatch(e,n))}getMethodsForInstance(e){const n=this.repo.getServers().filter(s=>this.instanceMatch(e,s.instance));if(n.length===0)return[];let r={};return n.length===1?r=n[0].methods:n.forEach(s=>{Object.keys(s.methods).forEach(o=>{const a=s.methods[o];r[a.identifier]=a})}),Object.keys(r).map(s=>r[s])}getServers(e){const t=this.repo.getServers();return e===void 0?t.map(n=>({server:n,methods:[]})):t.reduce((n,r)=>{const o=Object.values(r.methods).filter(a=>this.methodMatch(e,a));return o.length>0&&n.push({server:r,methods:o}),n},[])}getServerMethodsByFilterAndTarget(e,t){const n=this.getServers(e);return this.filterByTarget(t,n)}}class Eu{constructor(e,t,n){d(this,"protocol");d(this,"repoMethod");d(this,"subscription");this.protocol=e,this.repoMethod=t,this.subscription=n}get stream(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream}get arguments(){return this.subscription.arguments||{}}get branchKey(){return this.subscription.branchKey}get instance(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance}close(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)}push(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)}}class JT{constructor(e,t,n){d(this,"protocol");d(this,"repoMethod");d(this,"requestContext");d(this,"arguments");d(this,"instance");this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}accept(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")}acceptOnBranch(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)}reject(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)}}let KT=class{constructor(e,t){d(this,"protocol");d(this,"server");this.protocol=e,this.server=t,e.server.onSubRequest((n,r)=>this.handleSubRequest(n,r)),e.server.onSubAdded((n,r)=>this.handleSubAdded(n,r)),e.server.onSubRemoved((n,r)=>this.handleSubRemoved(n,r))}handleSubRequest(e,t){if(!(t&&t.streamCallbacks&&typeof t.streamCallbacks.subscriptionRequestHandler=="function"))return;const n=new JT(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}handleSubAdded(e,t){if(!(t&&t.streamCallbacks&&typeof t.streamCallbacks.subscriptionAddedHandler=="function"))return;const n=new Eu(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}handleSubRemoved(e,t){if(!(t&&t.streamCallbacks&&typeof t.streamCallbacks.subscriptionRemovedHandler=="function"))return;const n=new Eu(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}};class Bm{constructor(e,t,n){d(this,"key");d(this,"protocol");d(this,"repoMethod");this.key=e,this.protocol=t,this.repoMethod=n}subscriptions(){return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map(t=>new Eu(this.protocol,this.repoMethod,t))}close(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)}push(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])}}class QT{constructor(e,t,n){d(this,"_protocol");d(this,"_repoMethod");d(this,"_server");d(this,"name");this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}branches(e){const t=this._protocol.server.getBranchList(this._repoMethod);return e?t.indexOf(e)>-1?new Bm(e,this._protocol,this._repoMethod):void 0:t.map(n=>new Bm(n,this._protocol,this._repoMethod))}branch(e){return this.branches(e)}subscriptions(){return this._protocol.server.getSubscriptionList(this._repoMethod).map(t=>new Eu(this._protocol,this._repoMethod,t))}get definition(){var t;const e=this._repoMethod.definition;return{accepts:e.accepts,description:e.description,displayName:e.displayName,name:e.name,objectTypes:e.objectTypes,returns:e.returns,supportsStreaming:e.supportsStreaming,flags:(t=e.flags)==null?void 0:t.metadata}}close(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)}push(e,t){if(typeof t!="string"&&!Array.isArray(t)&&t!==void 0)throw new Error("invalid branches should be string or string array");if(typeof e!="object")throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)}updateRepoMethod(e){this._repoMethod=e}}class XT{constructor(e,t){d(this,"protocol");d(this,"serverRepository");d(this,"streaming");d(this,"invocations",0);d(this,"currentlyUnregistering",{});this.protocol=e,this.serverRepository=t,this.streaming=new KT(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}createStream(e,t,n,r,s){const o=new Promise((a,c)=>{if(!e){c("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.");return}let l;if(typeof e=="string"?l={name:""+e}:l={...e},!l.name)return c(`The name property is required for the streamDefinition object and must be unique. Stream definition: ${JSON.stringify(l)}`);if(this.serverRepository.getList().some(f=>f.definition.name===l.name))return c(`A stream with the name "${l.name}" already exists! Please, provide a unique name for the stream.`);l.supportsStreaming=!0,t||(t={}),typeof t.subscriptionRequestHandler!="function"&&(t.subscriptionRequestHandler=f=>{f.accept()});const p=this.serverRepository.add({definition:l,streamCallbacks:t,protocolState:{}});this.protocol.server.createStream(p).then(()=>{let f;s?(f=s,s.updateRepoMethod(p)):f=new QT(this.protocol,p,this),p.stream=f,a(f)}).catch(f=>{p.repoId&&this.serverRepository.remove(p.repoId),c(f)})});return Cp(o,n,r)}register(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if(typeof t!="function")return Promise.reject(`The second parameter must be a callback function. Method: ${typeof e=="string"?e:e.name}`);const n=async(r,s)=>{try{const o=t(r.args,r.instance);if(o&&typeof o.then=="function"){const a=await o;s(void 0,a)}else s(void 0,o)}catch(o){s(o??"",o??"")}};return n.userCallback=t,this.registerCore(e,n)}registerAsync(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if(typeof t!="function")return Promise.reject(`The second parameter must be a callback function. Method: ${typeof e=="string"?e:e.name}`);const n=async(r,s)=>{try{let o=!1;const a=u=>{o||s(void 0,u),o=!0},c=u=>{o||(u||(u=""),s(u,u)),o=!0},l=t(r.args,r.instance,a,c);l&&typeof l.then=="function"&&l.then(a).catch(c)}catch(o){s(o,void 0)}};return n.userCallbackAsync=t,this.registerCore(e,n)}async unregister(e,t=!1){if(e===void 0)return Promise.reject("Please, provide either a unique string for a name or an object containing a name property.");if(typeof e=="function"){await this.unregisterWithPredicate(e,t);return}let n;if(typeof e=="string"?n={name:e}:n=e,n.name===void 0)return Promise.reject("Method name is required. Cannot find a method if the method name is undefined!");const r=this.serverRepository.getList().find(s=>s.definition.name===n.name&&(s.definition.supportsStreaming||!1)===t);if(!r)return Promise.reject(`Method with a name "${n.name}" does not exist or is not registered by your application!`);await this.removeMethodsOrStreams([r])}async unregisterWithPredicate(e,t){const n=this.serverRepository.getList().filter(r=>e(r.definition)).filter(r=>(r.definition.supportsStreaming||!1)===t);if(!n||n.length===0)return Promise.reject(`Could not find a ${t?"stream":"method"} matching the specified condition!`);await this.removeMethodsOrStreams(n)}removeMethodsOrStreams(e){const t=[];return e.forEach(n=>{const r=this.protocol.server.unregister(n).then(()=>{n.repoId&&this.serverRepository.remove(n.repoId)});t.push(r),this.addAsCurrentlyUnregistering(n.definition.name,r)}),Promise.all(t)}async addAsCurrentlyUnregistering(e,t){const n=new Promise(r=>setTimeout(r,5e3));this.currentlyUnregistering[e]=Promise.race([t,n]).then(()=>{delete this.currentlyUnregistering[e]})}async registerCore(e,t){let n;if(typeof e=="string"?n={name:""+e}:n={...e},!n.name)return Promise.reject(`Please, provide a (unique) string value for the name property in the methodDefinition object: ${JSON.stringify(e)}`);const r=this.currentlyUnregistering[n.name];if(typeof r<"u"&&await r,this.serverRepository.getList().some(a=>a.definition.name===n.name))return Promise.reject(`A method with the name "${n.name}" already exists! Please, provide a unique name for the method.`);if(n.supportsStreaming)return Promise.reject(`When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want ${n.name} to be a stream, please use the glue.interop.createStream() method.`);const o=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}});return this.protocol.server.register(o).catch(a=>{throw o!=null&&o.repoId&&this.serverRepository.remove(o.repoId),a})}onMethodInvoked(e,t,n){!e||!e.theFunction||e.theFunction(n,(r,s)=>{if(r!=null){if(r.message&&typeof r.message=="string")r=r.message;else if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=`un-stringifyable error in onMethodInvoked! Top level prop names: ${Object.keys(r)}`}}s?(typeof s!="object"||Array.isArray(s))&&(s={_value:s}):s={},this.protocol.server.methodInvocationResult(e,t,r,s)})}}class Vb{constructor(e,t,n){d(this,"wrapped",{});this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter(r=>r.supportsStreaming)},t&&this.refreshWrappedObject(t),n&&(n.loggedIn(()=>{this.refresh(n)}),this.refresh(n))}unwrap(){return this.wrapped}refresh(e){if(!e)return;const t=e==null?void 0:e.resolvedIdentity,n=Object.assign({},t??{},{peerId:e==null?void 0:e.peerId});this.refreshWrappedObject(n)}refreshWrappedObject(e){Object.keys(e).forEach(t=>{this.wrapped[t]=e[t]}),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=e.application??ai(10),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=e.pid??e.process??Math.floor(Math.random()*1e10),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=e.isLocal??!0,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId}}const fl=i=>({...i,flags:i.flags.metadata||{}});class YT{constructor(e,t){d(this,"logger");d(this,"API");d(this,"servers",{});d(this,"myServer");d(this,"methodsCount",{});d(this,"callbacks",zi());this.logger=e,this.API=t;const n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}addServer(e,t){this.logger.debug(`adding server ${t}`);const n=this.servers[t];if(n)return n.id;const r=new Vb(this.API,e),s={id:t,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[t]=s,this.callbacks.execute("onServerAdded",s.instance),t}removeServerById(e,t){const n=this.servers[e];if(n)this.logger.debug(`removing server ${e}`);else{this.logger.warn(`not aware of server ${e}, my state ${JSON.stringify(Object.keys(this.servers))}`);return}Object.keys(n.methods).forEach(r=>{this.removeServerMethod(e,r)}),delete this.servers[e],this.callbacks.execute("onServerRemoved",n.instance,t)}addServerMethod(e,t){const n=this.servers[e];if(!n)throw new Error("server does not exists");if(n.methods[t.id])return;const r=this.createMethodIdentifier(t),s=this,o={identifier:r,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:typeof t.flags<"u"?t.flags.streaming:!1,flags:t.flags??{},getServers:()=>s.getServersByMethod(r)};o.object_types=o.objectTypes,o.display_name=o.displayName,o.version=o.version,n.methods[t.id]=o;const a=fl(o);return this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",a)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",n.instance,a),o}removeServerMethod(e,t){const n=this.servers[e];if(!n)throw new Error("server does not exists");const r=n.methods[t];delete n.methods[t];const s=fl(r);this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,this.methodsCount[r.identifier]===0&&this.callbacks.execute("onMethodRemoved",s),this.callbacks.execute("onServerMethodRemoved",n.instance,s)}getMethods(){return this.extractMethodsFromServers(Object.values(this.servers)).map(fl)}getServers(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)}onServerAdded(e){const t=this.callbacks.add("onServerAdded",e),n=this.getServers().map(r=>r.instance);return this.returnUnsubWithDelayedReplay(t,n,e)}onMethodAdded(e){const t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)}onServerMethodAdded(e){const t=this.callbacks.add("onServerMethodAdded",e);let n=!1;const r=this.getServers();return setTimeout(()=>{r.forEach(s=>{const o=s.methods;Object.keys(o).forEach(a=>{n||e(s.instance,o[a])})})},0),()=>{n=!0,t()}}onMethodRemoved(e){return this.callbacks.add("onMethodRemoved",e)}onServerRemoved(e){return this.callbacks.add("onServerRemoved",e)}onServerMethodRemoved(e){return this.callbacks.add("onServerMethodRemoved",e)}getServerById(e){if(this.servers[e])return this.hideServerMethodSystemFlags(this.servers[e])}reset(){Object.keys(this.servers).forEach(e=>{this.removeServerById(e,"reset")}),this.servers={[this.myServer.id]:this.myServer},this.methodsCount={}}createMethodIdentifier(e){const t=e.input_signature??"",n=e.result_signature??"";return(e.name+t+n).toLowerCase()}getServersByMethod(e){const t=[];return Object.values(this.servers).forEach(n=>{Object.values(n.methods).forEach(r=>{r.identifier===e&&t.push(n.instance)})}),t}returnUnsubWithDelayedReplay(e,t,n){let r=!1;return setTimeout(()=>{t.forEach(s=>{r||n(s)})},0),()=>{r=!0,e()}}hideServerMethodSystemFlags(e){const t={};return Object.entries(e.methods).forEach(([n,r])=>{t[n]=fl(r)}),{...e,methods:t}}extractMethodsFromServers(e){return Object.values(e).reduce((n,r)=>[...n,...Object.values(r.methods)],[])}}class ZT{constructor(){d(this,"nextId",0);d(this,"methods",[])}add(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e}remove(e){if(typeof e!="string")return new TypeError("Expecting a string");this.methods=this.methods.filter(t=>t.repoId!==e)}getById(e){if(typeof e=="string")return this.methods.find(t=>t.repoId===e)}getList(){return this.methods.map(e=>e)}length(){return this.methods.length}reset(){this.methods=[]}}const Hm="onSubscriptionRequest",Gm="onSubscriptionAdded",Kd="onSubscriptionRemoved";class eA{constructor(e,t,n){d(this,"session");d(this,"repository");d(this,"serverRepository");d(this,"ERR_URI_SUBSCRIPTION_FAILED","com.tick42.agm.errors.subscription.failure");d(this,"callbacks",zi());d(this,"nextStreamId",0);this.session=e,this.repository=t,this.serverRepository=n,e.on("add-interest",r=>{this.handleAddInterest(r)}),e.on("remove-interest",r=>{this.handleRemoveInterest(r)})}acceptRequestOnBranch(e,t,n){if(typeof n!="string"&&(n=""),typeof t.protocolState.subscriptionsMap!="object")throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");const r=this.getStreamId(t,n),s=e.msg.subscription_id,o={id:s,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:r,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[s]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:s,stream_id:r}),this.callbacks.execute(Gm,o,t)}rejectRequest(e,t,n){typeof n!="string"&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)}pushData(e,t,n){if(typeof e!="object"||!Array.isArray(e.protocolState.branchKeyToStreamIdMap))return;if(typeof t!="object")throw new Error("Invalid arguments. Data must be an object.");typeof n=="string"?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter(s=>!n||n.length===0?!0:n.indexOf(s.key)>=0).map(s=>s.streamId).forEach(s=>{const o={type:"publish",stream_id:s,data:t};this.session.sendFireAndForget(o)})}pushDataToSingle(e,t,n){if(typeof n!="object")throw new Error("Invalid arguments. Data must be an object.");const r={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(r)}closeSingleSubscription(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];const n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n),t.instance,this.callbacks.execute(Kd,t,e)}closeMultipleSubscriptions(e,t){if(typeof e!="object"||typeof e.protocolState.subscriptionsMap!="object"||!e.protocolState.subscriptionsMap)return;const n=e.protocolState.subscriptionsMap;let r=Object.keys(n).map(s=>n[s]);typeof t=="string"&&(r=r.filter(s=>s.branchKey===t)),r.forEach(s=>{delete n[s.id];const o={type:"drop-subscription",subscription_id:s.id,reason:"Server dropping all subscriptions on stream_id: "+s.streamId};this.session.sendFireAndForget(o)})}getSubscriptionList(e,t){if(typeof e!="object")return[];let n=[];if(!e.protocolState.subscriptionsMap)return[];const r=e.protocolState.subscriptionsMap,s=Object.keys(r).map(o=>r[o]);return typeof t!="string"?n=s:n=s.filter(o=>o.branchKey===t),n}getBranchList(e){if(typeof e!="object")return[];if(!e.protocolState.subscriptionsMap)return[];const t=e.protocolState.subscriptionsMap,n=Object.keys(t).map(s=>t[s]),r=[];return n.forEach(s=>{let o="";typeof s=="object"&&typeof s.branchKey=="string"&&(o=s.branchKey),r.indexOf(o)===-1&&r.push(o)}),r}onSubAdded(e){this.onSubscriptionLifetimeEvent(Gm,e)}onSubRequest(e){this.onSubscriptionLifetimeEvent(Hm,e)}onSubRemoved(e){this.onSubscriptionLifetimeEvent(Kd,e)}handleRemoveInterest(e){const t=this.serverRepository.getById(e.method_id);if(typeof e.subscription_id!="string"||typeof t!="object"||!t.protocolState.subscriptionsMap||typeof t.protocolState.subscriptionsMap[e.subscription_id]!="object")return;const n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(Kd,n,t)}onSubscriptionLifetimeEvent(e,t){this.callbacks.add(e,t)}getNextStreamId(){return this.nextStreamId+++""}handleAddInterest(e){const t=this.repository.getServerById(e.caller_id),n=(t==null?void 0:t.instance)??{},r={msg:e,arguments:e.arguments_kv||{},instance:n},s=this.serverRepository.getById(e.method_id);if(s===void 0){const o="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(o,e.subscription_id);return}if(s.protocolState.subscriptionsMap&&s.protocolState.subscriptionsMap[e.subscription_id]){this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id);return}this.callbacks.execute(Hm,r,s)}sendSubscriptionFailed(e,t){const n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)}getStreamId(e,t){if(typeof t!="string"&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error(`streaming ${e.definition.name} method without protocol state`);const n=e.protocolState.branchKeyToStreamIdMap.filter(s=>s.key===t)[0];let r=n?n.streamId:void 0;return(typeof r!="string"||r==="")&&(r=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:r})),r}}class tA{constructor(e,t,n,r){d(this,"session");d(this,"clientRepository");d(this,"serverRepository");d(this,"logger");d(this,"callbacks",zi());d(this,"streaming");this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=r,this.streaming=new eA(e,t,n),this.session.on("invoke",s=>this.handleInvokeMessage(s))}createStream(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)}register(e,t){const n=e.definition,r=Object.assign({},{metadata:n.flags??{}},{streaming:t||!1}),s={type:"register",methods:[{id:e.repoId,name:n.name,display_name:n.displayName,description:n.description,version:n.version,flags:r,object_types:n.objectTypes||n.object_types,input_signature:n.accepts,result_signature:n.returns,restrictions:void 0}]};return this.session.send(s,{methodId:e.repoId}).then(()=>{this.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)}).catch(o=>{throw this.logger.warn(`failed to register method ${e.definition.name} with id ${e.repoId} - ${JSON.stringify(o)}`),o})}onInvoked(e){this.callbacks.add("onInvoked",e)}methodInvocationResult(e,t,n,r){let s;n||n===""?s={type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:r,peer_id:void 0}:s={type:"yield",invocation_id:t,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(s)}async unregister(e){const t={type:"unregister",methods:[e.repoId]};await this.session.send(t)}getBranchList(e){return this.streaming.getBranchList(e)}getSubscriptionList(e,t){return this.streaming.getSubscriptionList(e,t)}closeAllSubscriptions(e,t){this.streaming.closeMultipleSubscriptions(e,t)}pushData(e,t,n){this.streaming.pushData(e,t,n)}pushDataToSingle(e,t,n){this.streaming.pushDataToSingle(e,t,n)}closeSingleSubscription(e,t){this.streaming.closeSingleSubscription(e,t)}acceptRequestOnBranch(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)}rejectRequest(e,t,n){this.streaming.rejectRequest(e,t,n)}onSubRequest(e){this.streaming.onSubRequest(e)}onSubAdded(e){this.streaming.onSubAdded(e)}onSubRemoved(e){this.streaming.onSubRemoved(e)}handleInvokeMessage(e){var u;const t=e.invocation_id,n=e.caller_id,r=e.method_id,s=e.arguments_kv,a=this.serverRepository.getList().filter(p=>p.repoId===r)[0];if(a===void 0)return;const c=(u=this.clientRepository.getServerById(n))==null?void 0:u.instance,l={args:s,instance:c};this.callbacks.execute("onInvoked",a,t,l)}}class nA{constructor(e,t){d(this,"repository");d(this,"subscriptionData");this.repository=e,this.subscriptionData=t}get requestArguments(){return this.subscriptionData.params.arguments||{}}get servers(){return this.subscriptionData.trackedServers.reduce((e,t)=>{var n;if(t.subscriptionId){const r=(n=this.repository.getServerById(t.serverId))==null?void 0:n.instance;r&&e.push(r)}return e},[])}get serverInstance(){return this.servers[0]}get stream(){return this.subscriptionData.method}onData(e){if(typeof e!="function")throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),this.subscriptionData.handlers.onData.length===1&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach(t=>{e(t)})}onClosed(e){if(typeof e!="function")throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)}onFailed(e){}onConnected(e){if(typeof e!="function")throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)}close(){this.subscriptionData.close()}setNewSubscription(e){this.subscriptionData=e}}class iA{constructor(e){d(this,"config");d(this,"cache",[]);d(this,"timeoutIds",[]);this.config=e}add(e){const t=ai(10);this.cache.push({id:t,element:e});const n=setTimeout(()=>{const r=this.cache.findIndex(s=>s.id===t);r<0||this.cache.splice(r,1)},this.config.ELEMENT_TTL_MS);this.timeoutIds.push(n)}flush(){const e=this.cache.map(t=>t.element);return this.timeoutIds.forEach(t=>clearInterval(t)),this.cache=[],this.timeoutIds=[],e}}const gl="awaitingAccept",Qd="subscribed",Xd="Subscription failed.",rA="Subscription rejected.",sA="ServerInitiated",zm="ClientInitiated";class oA{constructor(e,t,n){d(this,"session");d(this,"repository");d(this,"logger");d(this,"subscriptionsList",{});d(this,"timedCache",new iA({ELEMENT_TTL_MS:1e4}));d(this,"subscriptionIdToLocalKeyMap",{});d(this,"nextSubLocalKey",0);d(this,"handleErrorSubscribing",e=>{const t=e._tag,n=t.subLocalKey,r=this.subscriptionsList[n];if(typeof r=="object"&&(r.trackedServers=r.trackedServers.filter(s=>s.serverId!==t.serverId),r.trackedServers.length<=0)){if(clearTimeout(r.timeoutId),r.status===gl){const s=typeof e.reason=="string"&&e.reason!==""?' Publisher said "'+e.reason+'".':" No reason given.",o=typeof r.params.arguments=="object"?JSON.stringify(r.params.arguments):"{}";r.error({message:rA+s+" Called with:"+o,called_with:r.params.arguments,method:r.method})}else r.status===Qd&&this.callOnClosedHandlers(r);delete this.subscriptionsList[n]}});d(this,"handleSubscribed",e=>{const t=e._tag.subLocalKey,n=this.subscriptionsList[t];if(typeof n!="object")return;const r=e._tag.serverId,s=n.trackedServers.filter(a=>a.serverId===r)[0];if(typeof s!="object")return;s.subscriptionId=e.subscription_id,this.subscriptionIdToLocalKeyMap[e.subscription_id]=t;const o=n.status===gl;if(n.status=Qd,o){let a=!1,c=n.subscription;c?(c.setNewSubscription(n),n.success(c),a=!0):(c=new nA(this.repository,n),n.subscription=c,n.success(c));for(const l of n.handlers.onConnected)try{l(c.serverInstance,a)}catch{}}});d(this,"handleEventData",e=>{const t=this.subscriptionIdToLocalKeyMap[e.subscription_id];if(typeof t>"u")return;const n=this.subscriptionsList[t];if(typeof n!="object")return;const r=n.trackedServers.filter(p=>p.subscriptionId===e.subscription_id);if(r.length!==1)return;const s=e.oob,o=r[0].serverId,a=this.repository.getServerById(o),c=()=>({data:e.data,server:(a==null?void 0:a.instance)??{},requestArguments:n.params.arguments,message:void 0,private:s}),l=n.handlers.onData,u=n.queued.data;l.length>0?l.forEach(p=>{typeof p=="function"&&p(c())}):u.push(c())});d(this,"handleSubscriptionCancelled",e=>{const t=this.subscriptionIdToLocalKeyMap[e.subscription_id];if(typeof t>"u")return;const n=this.subscriptionsList[t];if(typeof n!="object")return;const r=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter(s=>s.subscriptionId===e.subscription_id?(n.queued.closers.push(s.serverId),!1):!0),n.trackedServers.length===r&&(n.trackedServers.length<=0&&(this.timedCache.add(n),clearTimeout(n.timeoutId),this.callOnClosedHandlers(n),delete this.subscriptionsList[t]),delete this.subscriptionIdToLocalKeyMap[e.subscription_id])});this.session=e,this.repository=t,this.logger=n,e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}subscribe(e,t,n,r,s,o){if(n.length===0){s({method:e,called_with:t.arguments,message:Xd+" No available servers matched the target params."});return}const a=this.getNextSubscriptionLocalKey(),c=this.registerSubscription(a,e,t,r,s,t.methodResponseTimeout||1e4,o);if(typeof c!="object"){s({method:e,called_with:t.arguments,message:Xd+" Unable to register the user callbacks."});return}n.forEach(l=>{const u=l.server.id,p=l.methods.find(w=>w.name===e.name);if(!p){this.logger.error(`can not find method ${e.name} for target ${l.server.id}`);return}c.trackedServers.push({serverId:u,subscriptionId:void 0});const f={type:"subscribe",server_id:u,method_id:p.gatewayId,arguments_kv:t.arguments};this.session.send(f,{serverId:u,subLocalKey:a}).then(w=>this.handleSubscribed(w)).catch(w=>this.handleErrorSubscribing(w))})}drainSubscriptions(){const e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e}drainSubscriptionsCache(){return this.timedCache.flush()}getNextSubscriptionLocalKey(){const e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e}registerSubscription(e,t,n,r,s,o,a){const c={localKey:e,status:gl,method:t,params:n,success:r,error:s,trackedServers:[],handlers:{onData:(a==null?void 0:a.handlers.onData)||[],onClosed:(a==null?void 0:a.handlers.onClosed)||[],onConnected:(a==null?void 0:a.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:()=>this.closeSubscription(e),subscription:a==null?void 0:a.subscription};return a||(n.onData&&c.handlers.onData.push(n.onData),n.onClosed&&c.handlers.onClosed.push(n.onClosed),n.onConnected&&c.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=c,c.timeoutId=setTimeout(()=>{if(this.subscriptionsList[e]===void 0)return;const l=this.subscriptionsList[e];l.status===gl?(s({method:t,called_with:n.arguments,message:Xd+" Subscription attempt timed out after "+o+" ms."}),delete this.subscriptionsList[e]):l.status===Qd&&l.trackedServers.length>0&&(l.trackedServers=l.trackedServers.filter(u=>typeof u.subscriptionId<"u"),delete l.timeoutId,l.trackedServers.length<=0&&(this.callOnClosedHandlers(l),delete this.subscriptionsList[e]))},o),c}callOnClosedHandlers(e,t){var o;const n=e.queued.closers.length,r=n>0?e.queued.closers[n-1]:null;let s;r!==void 0&&typeof r=="string"&&(s=((o=this.repository.getServerById(r))==null?void 0:o.instance)??{}),e.handlers.onClosed.forEach(a=>{typeof a=="function"&&a({message:t||sA,requestArguments:e.params.arguments||{},server:s,stream:e.method})})}closeSubscription(e){const t=this.subscriptionsList[e];typeof t=="object"&&(t.trackedServers.forEach(n=>{typeof n.subscriptionId>"u"||(t.queued.closers.push(n.serverId),this.session.sendFireAndForget({type:"unsubscribe",subscription_id:n.subscriptionId,reason_uri:"",reason:zm}),delete this.subscriptionIdToLocalKeyMap[n.subscriptionId])}),t.trackedServers=[],this.callOnClosedHandlers(t,zm),delete this.subscriptionsList[e])}}class aA{constructor(e,t,n){d(this,"session");d(this,"repository");d(this,"logger");d(this,"streaming");this.session=e,this.repository=t,this.logger=n,e.on("peer-added",r=>this.handlePeerAdded(r)),e.on("peer-removed",r=>this.handlePeerRemoved(r)),e.on("methods-added",r=>this.handleMethodsAddedMessage(r)),e.on("methods-removed",r=>this.handleMethodsRemovedMessage(r)),this.streaming=new oA(e,t,n)}subscribe(e,t,n,r,s,o){this.streaming.subscribe(e,t,n,r,s,o)}invoke(e,t,n,r){const s=r.id,o=t.gatewayId,a={type:"call",server_id:s,method_id:o,arguments_kv:n};return this.session.send(a,{invocationId:e,serverId:s}).then(c=>this.handleResultMessage(c)).catch(c=>this.handleInvocationError(c))}drainSubscriptions(){return this.streaming.drainSubscriptions()}drainSubscriptionsCache(){return this.streaming.drainSubscriptionsCache()}handlePeerAdded(e){const t=e.new_peer_id,n=e.identity,r=e.meta?e.meta.local:!0,s=Number(n.process),o={machine:n.machine,pid:isNaN(s)?n.process:s,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:r};this.repository.addServer(o,t)}handlePeerRemoved(e){const t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)}handleMethodsAddedMessage(e){const t=e.server_id;e.methods.forEach(r=>{this.repository.addServerMethod(t,r)})}handleMethodsRemovedMessage(e){const t=e.server_id,n=e.methods,r=this.repository.getServerById(t);r&&Object.keys(r.methods).forEach(o=>{const a=r.methods[o];n.indexOf(a.gatewayId)>-1&&this.repository.removeServerMethod(t,o)})}handleResultMessage(e){const t=e._tag.invocationId,n=e.result,r=e._tag.serverId,s=this.repository.getServerById(r);return{invocationId:t,result:n,instance:s==null?void 0:s.instance,status:ji.Success,message:""}}handleInvocationError(e){if(this.logger.debug(`handle invocation error ${JSON.stringify(e)}`),"_tag"in e){const t=e._tag.invocationId,n=e._tag.serverId,r=this.repository.getServerById(n),s=e.reason,o=e.context;return{invocationId:t,result:o,instance:r==null?void 0:r.instance,status:ji.Error,message:s}}else return{invocationId:"",message:e.message,status:ji.Error,error:e}}}function cA(i,e,t,n,r,s){const o=r.logger.subLogger("gw3-protocol");let a;const c=new Promise(y=>{a=y}),l=e.domain("agm",["subscribed"]),u=new tA(l,t,n,o.subLogger("server")),p=new aA(l,t,o.subLogger("client"));async function f(){var _,v;o.info("reconnected - will replay registered methods and subscriptions"),p.drainSubscriptionsCache().forEach(C=>{const T=C.method,M=Object.assign({},C.params);o.info(`trying to soft-re-subscribe to method ${T.name}, with params: ${JSON.stringify(M)}`),s.client.subscribe(T,M,void 0,void 0,C).then(()=>o.info(`soft-subscribing to method ${T.name} DONE`)).catch($=>o.warn(`subscribing to method ${T.name} failed: ${JSON.stringify($)}}`))});const y=[],S=p.drainSubscriptions();for(const C of S){const T=C.method,M=Object.assign({},C.params);o.info(`trying to re-subscribe to method ${T.name}, with params: ${JSON.stringify(M)}`),y.push(s.client.subscribe(T,M,void 0,void 0,C).then(()=>o.info(`subscribing to method ${T.name} DONE`)))}const O=n.getList();n.reset();for(const C of O){const T=C.definition;C.stream?y.push(s.server.createStream(T,C.streamCallbacks,void 0,void 0,C.stream).then(()=>o.info(`subscribing to method ${T.name} DONE`)).catch(()=>o.warn(`subscribing to method ${T.name} FAILED`))):(_=C==null?void 0:C.theFunction)!=null&&_.userCallback?y.push(s.register(T,C.theFunction.userCallback).then(()=>o.info(`registering method ${T.name} DONE`)).catch(()=>o.warn(`registering method ${T.name} FAILED`))):(v=C==null?void 0:C.theFunction)!=null&&v.userCallbackAsync&&y.push(s.registerAsync(T,C.theFunction.userCallbackAsync).then(()=>o.info(`registering method ${T.name} DONE`)).catch(()=>o.warn(`registering method ${T.name} FAILED`)))}await Promise.all(y),o.info("Interop is re-announced")}function w(){a&&(a({client:p,server:u}),a=void 0)}return l.onJoined(y=>{t.addServer(i,e.peerId),y?f().then(()=>e.setLibReAnnounced({name:"interop"})).catch(S=>o.warn(`Error while re-announcing interop: ${JSON.stringify(S)}`)):w()}),l.onLeft(()=>{t.reset()}),l.join(),c}class lA{constructor(e){d(this,"instance");d(this,"readyPromise");d(this,"client");d(this,"server");d(this,"unwrappedInstance");d(this,"protocol");d(this,"clientRepository");d(this,"serverRepository");if(typeof e>"u")throw new Error("configuration is required");if(typeof e.connection>"u")throw new Error("configuration.connections is required");const t=e.connection;typeof e.methodResponseTimeout!="number"&&(e.methodResponseTimeout=30*1e3),typeof e.waitTimeoutMs!="number"&&(e.waitTimeoutMs=30*1e3),this.unwrappedInstance=new Vb(this,void 0,t),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new YT(e.logger.subLogger("cRep"),this),this.serverRepository=new ZT;let n;if(t.protocolVersion===3)n=cA(this.instance,t,this.clientRepository,this.serverRepository,e,this);else throw new Error(`protocol ${t.protocolVersion} not supported`);this.readyPromise=n.then(r=>(this.protocol=r,this.client=new VT(this.protocol,this.clientRepository,this.instance,e),this.server=new XT(this.protocol,this.serverRepository),this))}ready(){return this.readyPromise}serverRemoved(e){return this.client.serverRemoved(e)}serverAdded(e){return this.client.serverAdded(e)}serverMethodRemoved(e){return this.client.serverMethodRemoved(e)}serverMethodAdded(e){return this.client.serverMethodAdded(e)}methodRemoved(e){return this.client.methodRemoved(e)}methodAdded(e){return this.client.methodAdded(e)}methodsForInstance(e){return this.client.methodsForInstance(e)}methods(e){return this.client.methods(e)}servers(e){return this.client.servers(e)}subscribe(e,t,n,r){return this.client.subscribe(e,t,n,r)}createStream(e,t,n,r){return this.server.createStream(e,t,n,r)}unregister(e){return this.server.unregister(e)}registerAsync(e,t){return this.server.registerAsync(e,t)}register(e,t){return this.server.register(e,t)}invoke(e,t,n,r,s,o){return this.client.invoke(e,t,n,r,s,o)}waitForMethod(e){const t=new xu,n=this.client.methodAdded(r=>{r.name===e&&(n(),t.resolve(r))});return t.promise}}const uA=["subscribed","success"];class dA{constructor(e,t){d(this,"connection");d(this,"logger");d(this,"peerId");d(this,"session");d(this,"subscriptions");d(this,"readyPromise");d(this,"publish",(e,t,n)=>{const{routingKey:r,target:s}=n||{},o=this.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:this.peerId,routing_key:r,target_identity:s});this.session.send(o)});d(this,"subscribe",(e,t,n)=>new Promise((r,s)=>{const{routingKey:o,target:a}=n||{},c=this.removeEmptyValues({type:"subscribe",topic:e,peer_id:this.peerId,routing_key:o,source:a});this.session.send(c).then(l=>{const{subscription_id:u}=l;this.subscriptions.push({subscription_id:u,topic:e,callback:t,source:a}),r({unsubscribe:()=>(this.session.send({type:"unsubscribe",subscription_id:u,peer_id:this.peerId}),this.subscriptions=this.subscriptions.filter(p=>p.subscription_id!==u),Promise.resolve())})}).catch(l=>s(l))}));d(this,"watchOnEvent",()=>{this.session.on("event",e=>{const{data:t,subscription_id:n}=e,r=e["publisher-identity"],s=this.subscriptions.find(o=>o.subscription_id===n);s&&(s.source?this.keysMatch(s.source,r)&&s.callback(t,s.topic,r):s.callback(t,s.topic,r))})});this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",uA),this.readyPromise=this.session.join(),this.readyPromise.then(()=>{this.watchOnEvent()})}ready(){return this.readyPromise}removeEmptyValues(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==null&&(t[n]=e[n])}),t}keysMatch(e,t){const n=Object.keys(e);let r=!0;return n.forEach(s=>{e[s]!==t[s]&&(r=!1)}),r}}const cs=(i,e)=>{const t=typeof window=="object"?window.iodesktop??window.glue42gd:void 0,n=typeof window=="object"?window.gdPreloadPromise??Promise.resolve():Promise.resolve(),r=qn("glue");i=i||{},e=e||{};const s=LT(i,e,t);let o,a,c,l,u,p,f;const w={};function y(A,x,N){f=c.canPublish("trace"),f&&c.trace(`registering ${A} module`);const b=()=>{x.initTime=N.stop(),x.initEndTime=N.endTime,x.marks=N.marks,f&&c.trace(`${A} is ready - ${N.endTime-N.startTime}`)};x.initStartTime=N.startTime,x.ready?x.ready().then(()=>{b()}):b(),Array.isArray(A)||(A=[A]),A.forEach(R=>{w[R]=x,cs[R]=x})}function S(){const A=qn("connection");o=new FT(s.connection,c.subLogger("connection"));let x=Promise.resolve(s.auth);return s.connection&&!s.auth&&(t?x=t.getGWToken().then(N=>({gatewayToken:N})):typeof window<"u"&&(window!=null&&window.glue42electron)?typeof window.glue42electron.gwToken=="string"&&(x=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):x=Promise.reject("You need to provide auth information")),x.then(N=>{A.mark("auth-promise-resolved");let b;if(Object.prototype.toString.call(N)==="[object Object]")b=N;else throw new Error("Invalid auth object - "+JSON.stringify(N));return o.login(b)}).then(()=>(y("connection",o,A),s)).catch(N=>{throw o&&o.logout(),N})}function O(){var x;const A=qn("logger");return c=new Lm(`${(x=s.connection.identity)==null?void 0:x.application}`,void 0,s.customLogger),c.consoleLevel(s.logger.console),c.publishLevel(s.logger.publish),c.canPublish("debug")&&c.debug("initializing glue..."),y("logger",c,A),Promise.resolve(void 0)}function _(){const A=qn("metrics"),x=s.metrics,N=t==null?void 0:t.getMetricsPublishingEnabled,b=s.connection.identity,R=N||(()=>!0),z=(typeof x!="boolean"&&x.disableAutoAppSystem)??!1;return l=xT({connection:x?o:void 0,logger:c.subLogger("metrics"),canUpdateMetric:R,system:"Glue42",service:(b==null?void 0:b.service)??(t==null?void 0:t.applicationName)??s.application,instance:(b==null?void 0:b.instance)??(b==null?void 0:b.windowId)??ai(10),disableAutoAppSystem:z,pagePerformanceMetrics:typeof x!="boolean"?x==null?void 0:x.pagePerformanceMetrics:void 0}),y("metrics",l,A),Promise.resolve()}function v(){const A=qn("interop"),x={connection:o,logger:c.subLogger("interop")};return a=new lA(x),Lm.Interop=a,y(["interop","agm"],a,A),Promise.resolve()}function C(){const A=s.activities&&o.protocolVersion===3;if(s.contexts||A){const N=qn("contexts");return u=new UT({connection:o,logger:c.subLogger("contexts"),trackAllContexts:typeof s.contexts=="object"?s.contexts.trackAllContexts:!1,reAnnounceKnownContexts:typeof s.contexts=="object"?s.contexts.reAnnounceKnownContexts:!1}),y("contexts",u,N),u}else{const N=o.replayer;N&&N.drain(ku.name)}}async function T(){if(!s.bus)return Promise.resolve();const A=qn("bus");return p=new dA(o,c.subLogger("bus")),y("bus",p,A),Promise.resolve()}function M(A){try{return A.forEach(x=>{$(x.name,x.create)}),Promise.resolve()}catch(x){return Promise.reject(x)}}function $(A,x){const N=qn(A),b=x(w);b&&y(A,b,N)}function G(){const A=Object.keys(w).map(x=>{const N=w[x];return N.ready?N.ready():Promise.resolve()});return Promise.all(A)}function E(){const A=b=>{a&&a.invoke("T42.ACS.Feedback",b,"best")},x={coreVersion:Tu,version:s.version};r.stop();const N={feedback:A,info:x,logger:c,interop:a,agm:a,connection:o,metrics:l,contexts:u,bus:p,version:s.version,userConfig:i,done:()=>(c==null||c.info("done called by user..."),o.logout())};if(N.performance={get glueVer(){return s.version},get glueConfig(){return JSON.stringify(i)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){const b=NT();return Object.keys(b).map(R=>{const z=b[R];return{name:R,duration:z.endTime-z.startTime,marks:z.marks,startTime:z.startTime,endTime:z.endTime}})}},Object.keys(w).forEach(b=>{const R=w[b];N[b]=R}),N.config={},Object.keys(s).forEach(b=>{N.config[b]=s[b]}),e&&e.extOptions&&Object.keys(e.extOptions).forEach(b=>{N.config[b]=e==null?void 0:e.extOptions[b]}),e!=null&&e.enrichGlue&&e.enrichGlue(N),t&&t.updatePerfData&&t.updatePerfData(N.performance),N.agm){const b=(z,V,Q)=>function(){return N.logger.warn(`glue.js - 'glue.agm.${V}' method is deprecated, use 'glue.interop.${Q}' instead.`),z.apply(N.agm,arguments)},R=N.agm;R.method_added=b(N.agm.methodAdded,"method_added","methodAdded"),R.method_removed=b(N.agm.methodRemoved,"method_removed","methodRemoved"),R.server_added=b(N.agm.serverAdded,"server_added","serverAdded"),R.server_method_aded=b(N.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),R.server_method_removed=b(N.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return N}async function D(){const A="T42.ACS.RegisterInstance";if(Qr.isNode()&&typeof jb._GD_STARTING_CONTEXT_>"u"&&typeof(i==null?void 0:i.application)<"u"&&a.methods({name:A}).length>0)try{await a.invoke(A,{appName:i==null?void 0:i.application,pid:process.pid})}catch(N){const b=N;c.error(`Cannot register as an instance: ${JSON.stringify(b.message)}`)}}return n.then(O).then(S).then(()=>Promise.all([_(),v(),C(),T()])).then(()=>a.readyPromise).then(()=>D()).then(()=>M(s.libs||[])).then(G).then(E).catch(A=>Promise.reject({err:A,libs:w}))};typeof window<"u"&&(window.IOConnectCore=cs);cs.version=Tu;cs.default=cs;class nd{constructor(e){this._id=e}get id(){return this._id}_update(e){if(e._id!==this._id)throw Error("Can not update from entity with different id.");this._updateCore(e)}_updateCore(e){}_beforeDelete(e){}}function Jb(i){return typeof i=="number"}function bn(i){return typeof i=="string"}function id(i){return typeof i=="object"&&i!==null}function Kb(i){return Array.isArray?Array.isArray(i):toString.call(i)==="[object Array]"}function Ye(i){return typeof i>"u"}function K(i){return i===null||typeof i>"u"}function Ue(i){return typeof i!="string"||!i||i.length===0||/^\s*$/.test(i)}function Pu(i){return i===!0||i===!1||toString.call(i)==="[object Boolean]"}function ii(i){return!!(i&&i.constructor&&i.call&&i.apply)}function hA(i,e){for(let t=0;t<i.length;t++)if(e(i[t],t))return!0;return!1}function Kn(i,e){typeof i<"u"&&e(i)}function pA(i,e,t){if(typeof e!="function"&&typeof t!="function")return i;typeof e!="function"?e=()=>{}:typeof t!="function"&&(t=()=>{}),i.then(e,t)}class ql extends nd{constructor(e,t,n,r){super(e),this._name=e,this._description=r,this._ownerWindow=t,this._helperWindows=n||[]}get name(){return this._name}get description(){return this._description}get helperWindows(){return this._helperWindows.map(e=>this.covertToWindowDef(e))}get ownerWindow(){return this.covertToWindowDef(this._ownerWindow)}initiate(e,t,n){return this._manager.initiate(this._name,e,t,n)}_updateCore(e){super._updateCore(e),Kn(e._description,t=>this._description=t),Kn(e._ownerWindow,t=>this._ownerWindow=t),Kn(e._helperWindows,t=>this._helperWindows=t)}covertToWindowDef(e){var t,n;return{type:(t=e==null?void 0:e.id)===null||t===void 0?void 0:t.type,name:(n=e==null?void 0:e.id)===null||n===void 0?void 0:n.name}}}class rc extends nd{constructor(e,t){super(e),this._name=e,this._appByWindowTypeGetter=t}get name(){return this._name}get config(){return this._appByWindowTypeGetter(this._name)}get windows(){return this._manager.getWindows({type:this._name})}create(e,t){const n=Object.assign({type:this.name,name:this.name,isIndependent:!1},t);return this._manager.createWindow(e,n)}}class At{constructor(e,t){this.entity=e,this.context=t}}class vt{constructor(e){this.type=e}}class fA extends vt{constructor(e,t){super(de.StatusChange),this.newStatus=e,this.oldStatus=t}}class gA extends vt{constructor(e,t,n){super(de.ActivityContextChange),this.context=typeof e=="string"?JSON.parse(e):e,this.updated=t,this.removed=n}}class de{}de.Added="added";de.Removed="removed";de.Updated="updated";de.Closed="closed";de.StatusChange="statusChange";de.ActivityContextChange="activityContextUpdate";de.ActivityWindowEvent="activityWindowEvent";de.ActivityWindowJoinedActivity="joined";de.ActivityWindowLeftActivity="left";class Zs{}Zs.Created="created";Zs.Started="started";Zs.Destroyed="destroyed";class _n{constructor(e){this._activity=e}register(e,t){this._ensureHasAgm(),_n.AGM.register(e,t)}servers(){return this._ensureHasAgm(),K(this._activity)?[]:this._activity.windows.map(e=>e.instance)}methods(){if(this._ensureHasAgm(),K(this._activity))return[];const e=this._activity.windows,t=[],n=[];return e.forEach(r=>{this.methodsForWindow(r).forEach(o=>{t.indexOf(o.name)===-1&&(t.push(o.name),n.push(o))})}),n}methodsForWindow(e){return this._ensureHasAgm(),e.instance?_n.AGM.methodsForInstance(e.instance):[]}invoke(e,t,n,r,s,o){this._ensureHasAgm();const a=this.servers();if(K(n)&&(n="activity.all"),bn(n)){if(n!=="activity.all")if(n==="activity.best"){const c=a.filter(l=>_n.AGM.methodsForInstance(l).filter(p=>p.name===e).length>0);c.length>0&&c[0]}else{if(n==="all"||n==="best")return pA(_n.AGM.invoke(e,t,n,r),s,o);throw new Error("Invalid invoke target "+n)}}else if(Kb(n)){if(n.length>=0){const c=n[0];if(this._isInstance(c))n.map(l=>l);else if(this._isActivityWindow(c))n.map(l=>l.instance);else throw new Error("Unknown target object")}}else if(!this._isInstance(n))if(this._isActivityWindow(n))n.instance;else throw new Error("Unknown target object");throw new Error("Not implemented")}unregister(e){return this._ensureHasAgm(),_n.AGM.unregister(e)}createStream(e,t,n){this._ensureHasAgm(),_n.AGM.createStream(e,{subscriptionAddedHandler:t,subscriptionRemovedHandler:n,subscriptionRequestHandler:void 0})}subscribe(e,t,n){return this._ensureHasAgm(),_n.AGM.subscribe(e,t)}_ensureHasAgm(){if(K(_n.AGM))throw new Error("Agm should be configured to be used in activity")}_isInstance(e){return e.application!==void 0}_isActivityWindow(e){return e.instance!==void 0}}class mA{constructor(e,t,n){this._manager=e,this._ownerActivityId=t,this._state=n}get ownerId(){return this._state.ownerId}get windowIds(){return this._state.windowIds}get frameColor(){return this._state.frameColor}get context(){return this._state.context}get tag(){return this._state.tag}detach(e){e=e||{};const t={};return Object.keys(this._state).forEach(n=>{t[n]=this._state[n]}),t.context=e.context||t.context,t.frameColor=e.frameColor||t.frameColor,this._manager.detachActivities(this._ownerActivityId,t)}}const Um=i=>{setTimeout(i,0)};function et(i,e){if(!ii(e))return i;i.then(t=>{Um(()=>{e(null,t)})},t=>{Um(()=>{e(t,null)})})}class ml extends nd{constructor(e,t,n,r,s){super(e),this._id=e,this._actType=t,this._status=n,this._context=r,this._ownerId=s,this._agm=new _n(this)}get type(){if(this._manager)return this._manager.getActivityType(this._actType)}get context(){return this._context}get status(){return this._status}get owner(){return this._ownerId?this._manager.getWindows({id:this._ownerId})[0]:null}get windows(){return this._manager.getWindows({activityId:this._id})}get agm(){return this._agm}addWindow(e,t){return this._manager.addWindowToActivity(this,e,t)}createWindow(e,t){return this._manager.createWindow(this,e,t)}createStackedWindows(e,t,n){return this._manager.createStackedWindows(this,e,t,n)}leave(e,t){return this._manager.leaveWindowFromActivity(this,e,t)}getWindowsByType(e){const t={activityId:this._id,type:e};return this._manager.getWindows(t)}setContext(e,t){return this._manager.setActivityContext(this,e,t)}updateContext(e,t){return this._manager.updateActivityContext(this,e,t)}onStatusChange(e){return this._manager.subscribeActivityEvents((t,n,r)=>{t.id===this.id&&e(t,n,r)})}onWindowEvent(e){return this._manager.subscribeWindowEvents((t,n,r)=>{t.id===this.id&&e(t,n,r)})}onContextChanged(e){this._manager.subscribeActivityContextChanged((t,n,r,s)=>{t.id===this.id&&e(n,r,s,t)});try{e(this.context,this.context,[],this)}catch{return}}stop(){this._manager.stopActivity(this)}clone(e){return this._manager.clone(this,e)}attach(e,t){let n;return typeof e=="string"?n=e:n=e.id,this._manager.attachActivities(n,this.id,t)}onActivityAttached(e){this._manager.subscribeActivitiesAttached((t,n,r)=>{t===this._id&&e(r)})}onDetached(e){this._manager.subscribeActivitiesDetached((t,n,r)=>{n.id===this._id&&e(t,r)})}_updateCore(e){super._updateCore(e),Kn(e._actType,t=>this._actType=t),Kn(e._context,t=>this._context=t),Kn(e._ownerId,t=>this._ownerId=t),e._status&&(!this._status||this._status.state!==e._status.state)&&(this._status=e._status)}_updateDescriptors(e){this._attached=e.map(t=>new mA(this._manager,this._id,t))}get attached(){return this._attached}setFrameColor(e,t){const n=new Promise((r,s)=>{let o=this.windows.length;o===0&&r(this),this.windows.forEach(a=>{a.underlyingWindow.setFrameColor(e,()=>{o--,o<=0&&r(this)})}),setTimeout(()=>{o>0&&s(this.id+" - timed out waiting for setFrameColor with"+e)},5e3)});return et(n,t)}getFrameColor(){return!this.windows||this.windows.length===0?"":this.windows[0].underlyingWindow.frameColor}}class Xe{}Xe.Trace="trace";Xe.Debug="debug";Xe.Info="info";Xe.Warn="warn";Xe.Error="error";class We{static GetNamed(e){return new We(e)}static Get(e){return new We(We.GetTypeName(e))}constructor(e){this._name=e,K(We.GlueLogger)||(this._glueLogger=We.GlueLogger.subLogger(e))}trace(e){K(this._glueLogger)?We.Level===Xe.Trace&&console.info(this._getMessage(e,Xe.Trace)):this._glueLogger.trace(e)}debug(e){K(this._glueLogger)?(We.Level===Xe.Debug||We.Level===Xe.Trace)&&console.info(this._getMessage(e,Xe.Debug)):this._glueLogger.debug(e)}info(e){K(this._glueLogger)?(We.Level===Xe.Debug||We.Level===Xe.Trace||We.Level===Xe.Info)&&console.info(this._getMessage(e,Xe.Info)):this._glueLogger.info(e)}warn(e){K(this._glueLogger)?(We.Level===Xe.Debug||We.Level===Xe.Trace||We.Level===Xe.Info||We.Level===Xe.Warn)&&console.info(this._getMessage(e,Xe.Info)):this._glueLogger.warn(e)}error(e){K(this._glueLogger)?(console.error(this._getMessage(e,Xe.Error)),console.trace()):this._glueLogger.error(e)}_getMessage(e,t){return"["+t+"] "+this._name+" - "+e}static GetTypeName(e){const n=/function (.{1,})\(/.exec(e.constructor.toString());return n&&n.length>1?n[1]:""}}We.Level=Xe.Info;class Vr extends nd{constructor(e,t,n,r,s,o,a,c){super(e),this._logger=We.Get("window"),this._type=n,this._activityId=r,this._name=t,this._instance=s,this._isIndependent=o,this._windowGetter=a,this._hcWindowId=c}getBounds(){return this._manager.getWindowBounds(this.id)}get name(){return this._name}get isIndependent(){return this._isIndependent}get type(){if(this._manager)return this._manager.getWindowType(this._type)}get activity(){if(!Ye(this._activityId))return this._manager.getActivityById(this._activityId)}get isOwner(){const e=this.activity;return Ye(e)?!1:e.owner.id===this.id}setVisible(e,t){return this._manager.setWindowVisibility(this.id,e)}activate(e){return this._manager.activateWindow(this.id,e)}setBounds(e,t){return this._manager.setWindowBounds(this.id,e,t)}close(){return this._manager.closeWindow(this.id)}get instance(){return this._instance}get underlyingWindow(){const e=this._windowGetter();return e||{id:this._hcWindowId}}onActivityJoined(e){this._subscribeForActivityWindowEvent(de.ActivityWindowJoinedActivity,e)}onActivityRemoved(e){this._subscribeForActivityWindowEvent(de.ActivityWindowLeftActivity,e)}_updateCore(e){Kn(e._activityId,t=>this._activityId=t),Kn(e._isIndependent,t=>this._isIndependent=t),Kn(e._hcWindowId,t=>this._hcWindowId=t),Kn(e._type,t=>this._type=t),Kn(e._name,t=>this._name=t),K(e._instance)||(this._instance=e._instance)}_subscribeForActivityWindowEvent(e,t){this._manager.subscribeWindowEvents((n,r,s)=>{r.id===this.id&&s===e&&t(n)})}_beforeDelete(e){this._hcWindowId=e._hcWindowId}}class ys{constructor(e,t,n){this.state=e,this.message=t,this.time=n}getState(){return this.state}getMessage(){return this.message}getTime(){return this.time}}const yl="error",Yd="add-types",yA="types-added",wA="remove-types",vA="types-removed",wl="created",Zd="destroyed",qm="initiated",bA="join-activity",Ra="joined",vl="activity-joined",_A="leave-activity",Vm="left",CA="merge",SA="split",Jm="owner-changed",eh="add-peer-factories",Km="peer-factories-added",IA="remove-peer-factories",Qm="peer-factories-removed",xA="create",kA="create-peer",TA="peer-requested",AA="ready",Xm="peer-created",EA="destroy",PA="dispose-peer",NA="destroy-peer";class Yt{static activityTypeGwMessageEntityToActivityType(e,t){const n=r=>new rc(r,void 0);return new ql(e.name,e.owner_type&&n(e.owner_type),e.helper_types&&e.helper_types.map(n),t)}static peerFactoryGwMessageEntityToWindowType(e){return new rc(e.peer_type,t=>{})}static activityGwMessageToActivity(e,t){const n=e.owner!==void 0?e.owner.peer_id:e.owner_id;return new ml(e.activity_id,e.activity_type,t,e.context_snapshot,n)}static activityToActivityStatusChangeEvent(e){return new At(e,new fA(e.status,void 0))}constructor(e){if(this._activityChangeCallbacks=[],this._activityTypeStatusChangeCallbacks=[],this._activityWindowChangeCallbacks=[],this._windowTypeStatusChangeCallbacks=[],this._peerIdAndFactoryIdToPeerType={},this._peerFactoriesRegisteredByUs={},this._gw3Subscriptions=[],this._contextSubscriptions={},this._activityTypesInitiatedFromMe={},this._config=e,this._connection=e.connection,this._logger=e.logger,this._contexts=e.contexts,this._windows=e.windows,this._sessionJoinedPromise=new Promise(t=>{this._sessionJoinedPromiseResolve=t}),this._activityJoinedPromise=new Promise(t=>{this._activityJoinedPromiseResolve=t}),this._config.activityId||this._activityJoinedPromiseResolve({}),this._gw3Session=this._connection.domain("activity",["joined","initiated","peer-created","token"]),typeof window<"u"){const t=window.glue42gd;t&&t.activityInfo&&(typeof t.addRefreshHandler=="function"&&t.addRefreshHandler((n,r)=>{this._gw3Session.send({type:"reload"}).then(s=>{if(!s.token){r("Expected gateway token for refreshing.");return}try{t.setGWToken(s.token)}catch(o){r(o.message||o);return}n()},r)}),t&&typeof t.addWillNavigateHandler=="function"&&t.addWillNavigateHandler((n,r)=>{this._gw3Session.send({type:"reload"}).then(s=>{if(!s.token){r("Expected gateway token for refreshing.");return}try{t.setGWToken(s.token)}catch(o){r(o.message||o);return}n()},r)}))}}get bridgeType(){return"GW3"}init(){this.forwardActivityTypeMessagesToStatusEventHandlers(),this.subscribe(wl,this.handleActivityCreatedMessage),this.subscribe(Zd,this.handleActivityDestroyedMessage),this.forwardActivityMessagesToStatusEventHandlers(),this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers(),this.forwardPeerFactoryMessagesToStatusEventHandlers(),this.forwardPeerFactoryMessagesToPeerFactoryRequests(),this.subscribe(Km,this.handlePeerFactoriesAdded),this.subscribe(Qm,this.handlePeerFactoriesRemoved),this.forwardActivityWindowMessagesToEventHandlers(),this.subscribe(PA,()=>{if(this._config.disposeRequestHandling==="dispose"){this.dispose();return}if(this._config.disposeRequestHandling==="exit"){if(this._windows&&typeof this._windows.my()<"u"){this._windows.my().close();return}if(typeof window<"u"&&typeof window.close=="function"){window.close();return}if(typeof process<"u"&&typeof process.exit=="function"){process.exit();return}}}),this._gw3Session.onJoined(()=>{this._config.mode==="trackMyOnly"||this._config.mode==="trackMyTypeAndInitiatedFromMe"?this._sessionJoinedPromiseResolve(this):this._gw3Session.send({type:"subscribe",activity_types:this._config.mode==="trackAll"?[]:this._config.mode==="trackTypes"?this._config.typesToTrack:[]}).then(()=>{this._sessionJoinedPromiseResolve(this)})}),this._gw3Session.join()}dispose(){this._gw3Subscriptions.forEach(e=>e&&this._connection.off(e)),this._gw3Subscriptions.length=0}ready(){return Promise.all([this._sessionJoinedPromise,this._activityJoinedPromise])}initReady(){return this._sessionJoinedPromise}onActivityTypeStatusChange(e){this._activityTypeStatusChangeCallbacks.push(e)}registerActivityType(e,t,n,r,s){const o={};o.name=e;const a=c=>({type:c.type,name:c.name,configuration:c});return o.owner_type=a(t),o.helper_types=n.map(a),this._gw3Session.send({type:Yd,types:[o]}).then(()=>{const c=Yt.activityTypeGwMessageEntityToActivityType(o,s);return this.invokeCallbacks(this._activityTypeStatusChangeCallbacks,new At(c,new vt(de.Added)),Yd),c})}unregisterActivityType(e){return this._gw3Session.send({type:wA,types:[e]}).then(()=>{const t=new ql(e,void 0,void 0,void 0);this.invokeCallbacks(this._activityTypeStatusChangeCallbacks,new At(t,new vt(de.Removed)),Yd)})}onWindowTypeStatusChange(e){this._windowTypeStatusChangeCallbacks.push(e)}registerWindowFactory(e,t,n){if(this._peerFactoriesRegisteredByUs[e])return Promise.reject(new Error(`Factory for windowType ${e} already registered.`));this._peerFactoriesRegisteredByUs[e]=t;const r={id:e,peer_type:e,configuration:n};return this._gw3Session.send({type:eh,factories:[r]}).then(()=>{this.invokeCallbacks(this._windowTypeStatusChangeCallbacks,new At(Yt.peerFactoryGwMessageEntityToWindowType(r),new vt(de.Added)),eh)}).catch(()=>{delete this._peerFactoriesRegisteredByUs[e]})}unregisterWindowFactory(e){return this._peerFactoriesRegisteredByUs[e]?(delete this._peerFactoriesRegisteredByUs[e],this._gw3Session.send({type:IA,factory_ids:[e]}).then(()=>{this.invokeCallbacks(this._windowTypeStatusChangeCallbacks,new At(new rc(e,void 0),new vt(de.Removed)),eh)})):Promise.reject(new Error(`Factory for windowType ${e} not registered.`))}onActivityStatusChange(e){this._activityChangeCallbacks.push(e)}initiateActivity(e,t,n){const r={type:xA,activity_type:e,initial_context:t};return this.isOverrideTypeDefinition(n)?r.types_override={owner_type:{type:n.owner.type,name:n.owner.name,configuration:n.owner},helper_types:n.helpers&&n.helpers.map(s=>({type:s.type,name:s.name,configuration:s}))}:r.configuration=n&&n.map(s=>({type:s.type,name:s.name,configuration:s})),this.sendCreateAndMapResultingMessagesToPromise(r,qm,(s,o)=>s.request_id===o,wl,(s,o,a)=>s.activity_id===a.activity_id,Zd,(s,o,a)=>s.activity_id===a.activity_id,s=>s.activity_id,null).then(s=>this._config.mode==="trackMyTypeAndInitiatedFromMe"&&!this._activityTypesInitiatedFromMe[e]?(this._activityTypesInitiatedFromMe[e]=!0,this._gw3Session.send({type:"subscribe",activity_types:[e]}).then(()=>s)):s)}stopActivity(e){return this._gw3Session.send({type:EA,activity_id:e.id,reason_uri:"com.tick42.glue.activity.constants.destroyReason.general",reason:"Destroying activity"}).then(t=>!0)}updateActivityContext(e,t,n,r){if(n)return this._contexts.set(e.id,t);r=r||[];for(const s of r)t[s]=null;return this._contexts.update(e.id,t)}announceWindow(e,t){throw new Error("Invalid operation 'announceWindow' for GW3 protocol")}registerWindow(e,t,n){let r=typeof this._connection.gatewayToken<"u";const s=this._connection.peerId;if(typeof window<"u"){const o=window.glue42gd;o&&(r=typeof o.activityInfo<"u")}return r&&this._gw3Session.send({type:AA}),this.invokeCallbacks(this._activityWindowChangeCallbacks,new At(new Vr(s,t,e,void 0,this.getAgmInstance(s),n,this.generateWindowGetter(s),void 0),new vt(de.Added)),"register window"),Promise.resolve(s)}onActivityWindowChange(e){this._activityWindowChangeCallbacks.push(e)}createWindow(e,t){t.layout||(t.left||t.width||t.height||t.top)&&(t.layout={mode:"pixels",cellSize:1});const n=r=>{if(e)return this.joinActivity(e,r,t.name).then(()=>r)};return this.sendCreateAndMapResultingMessagesToPromise({type:kA,peer_type:t.type,peer_name:t.name||t.type,configuration:t,activity_id:e},void 0,void 0,Xm,(r,s)=>r.request_id===s,void 0,void 0,r=>r.created_id,n).then(n)}closeWindow(e){return this._gw3Session.send({type:NA,destroy_peer_id:e}).then(t=>{})}getAnnouncementInfo(){let e=this._config.activityId||this._config.announcementInfo&&this._config.announcementInfo.activityId,t=this._config.announcementInfo&&this._config.announcementInfo.activityWindowType,n=this._config.announcementInfo&&this._config.announcementInfo.activityWindowIndependent,r=this._config.announcementInfo&&this._config.announcementInfo.activityWindowName;if(typeof window<"u"&&typeof window.location<"u"&&window.location.search&&typeof URLSearchParams=="function"){const s=new URLSearchParams(location.search.slice(1));t=t||s.get("t42PeerType"),t=t||s.get("t42ActivityWindowType"),typeof n>"u"&&(n=s.get("t42ActivityWindowIndependent")),r=r||s.get("t42ActivityWindowName"),e=e||s.get("t42ActivityId")}return t=t||"unknown",n=n||!1,r=r||this._connection.peerId,{activityWindowId:void 0,activityId:e,activityWindowType:t,activityWindowIndependent:n,activityWindowName:r}}joinActivity(e,t,n){const r=n&&{name:n}||{};return this._gw3Session.send({type:bA,target_id:t,activity_id:e,...r}).then(()=>{this.invokeCallbacks(this._activityWindowChangeCallbacks,new At(new Vr(t,void 0,void 0,e,this.getAgmInstance(t),void 0,this.generateWindowGetter(t),void 0),new vt(de.ActivityWindowJoinedActivity)),"activity joined - ActivityWindow"),this.invokeCallbacks(this._activityChangeCallbacks,new At(new ml(e,void 0,new ys("created",void 0,void 0),void 0,void 0),new vt(de.Updated)),"activity joined - Activity")})}leaveActivity(e,t){return this._gw3Session.send({type:_A,target_id:t,activity_id:e}).then(()=>{this.invokeCallbacks(this._activityWindowChangeCallbacks,new At(new Vr(t,void 0,void 0,null,this.getAgmInstance(t),void 0,this.generateWindowGetter(t),void 0),new vt(de.ActivityWindowLeftActivity)),"activity left - ActivityWindow"),this.invokeCallbacks(this._activityChangeCallbacks,new At(new ml(e,void 0,new ys("created",void 0,void 0),void 0,void 0),new vt(de.Updated)),"activity left - Activity")})}getActivityTypes(){return Promise.resolve([])}getWindowTypes(){return Promise.resolve([])}getActivities(){return Promise.resolve([])}getActivityWindows(){return Promise.resolve([])}createStackedWindows(e,t,n){}getWindowBounds(e){}setWindowBounds(e,t){}activateWindow(e,t){}setWindowVisibility(e,t){}cloneActivity(e,t){}attachActivities(e,t,n){return this._gw3Session.send({type:CA,into:t,merge:e})}detachActivities(e,t){return this._gw3Session.send({type:SA,from:e}).then(()=>"")}onActivitiesAttached(e){}onActivitiesDetached(e){}onActivityAttachedDescriptorsRefreshed(e){}getAttachedDescriptors(){return Promise.resolve([])}getRandomRequestId(){return this._connection.peerId+":"+Math.floor(Math.random()*1e9)}forwardAddedAndRemovedMessagesToEventHandler(e,t,n,r){const s=c=>l=>new At(l,new vt(c?de.Added:de.Removed)),o=e&&this.forwardMessageToEventHandler(e,c=>n(c,!0),s(!0),r),a=t&&this.forwardMessageToEventHandler(t,c=>n(c,!1),s(!1),r);return[o,a].filter(c=>c)}forwardMessageToEventHandler(e,t,n,r){return this.subscribe(e,s=>{t(s).forEach(o=>r.forEach(a=>a(n(o,s))))})}sendCreateAndMapResultingMessagesToPromise(e,t,n,r,s,o,a,c,l){const u=this.getRandomRequestId();let p,f;const w=new Promise(($,G)=>{p=$,f=G});let y=null,S,O,_,v;const C=()=>{this.dropSubscription(S),l||this.dropSubscription(O),this.dropSubscription(_),this.dropSubscription(v)};S=t&&this.subscribe(t,$=>{n($,u)&&(y=$,this.dropSubscription(S))});let T=!1;O=this.subscribe(r,$=>{s($,u,y)&&(T?l&&l(c($)):(T=!0,p(c($))))}),_=o&&this.subscribe(o,$=>{a($,u,y)&&f($)}),v=o&&this.subscribe(yl,$=>{$.request_id===u&&f($)}),e.request_id=u;const M=this._gw3Session.send(e).then(()=>w);return M.then(C,C),M}peerFactoryIdAndOwnerIdToWindowType(e,t){const n=this._peerIdAndFactoryIdToPeerType[t+":"+e];return n?new rc(n,void 0):null}subscribe(e,t){const n=this._connection.on(e,r=>t.bind(this)(r));return this._gw3Subscriptions.push(n),n}dropSubscription(e){e&&(this._connection.off(e),delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(e)])}invokeCallbacks(e,t,n){e.forEach(r=>{try{r(t)}catch(s){this._logger.error(`Error in ${n||t.context.type} callback: `+JSON.stringify(s))}})}handleActivityCreatedMessage(e){e.context_id?this._contextSubscriptions[e.activity_id]||this.subscribeToContext(e):this._logger.error("Activity created with unknown context_id: "+e.activity_id)}async subscribeToContext(e){const t=e.activity_id;this._contextSubscriptions[t]=await this._contexts.subscribe(t,(n,r,s)=>{const o=new At(new ml(t,void 0,void 0,n,void 0),new gA(n,r,s));this.invokeCallbacks(this._activityChangeCallbacks,o,"context updated")})}handleActivityDestroyedMessage(e){const t=this._contextSubscriptions[e.activity_id];typeof t=="function"&&t(),delete this._contextSubscriptions[e.activity_id]}handlePeerFactoriesAdded(e){e.factories.forEach(t=>{this._peerIdAndFactoryIdToPeerType[e.owner_id+":"+t.id]=t.peer_type})}handlePeerFactoriesRemoved(e){e.factory_ids.forEach(t=>{delete this._peerIdAndFactoryIdToPeerType[e.owner_id+":"+t]})}forwardActivityTypeMessagesToStatusEventHandlers(){this.forwardAddedAndRemovedMessagesToEventHandler(yA,vA,(e,t)=>t?e.types.map(n=>Yt.activityTypeGwMessageEntityToActivityType(n,void 0)):e.types.map(n=>new ql(n.name,void 0,void 0,void 0)),this._activityTypeStatusChangeCallbacks)}forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers(){for(const e of[wl,Ra,Jm])this.forwardMessageToEventHandler(e,t=>[t.owner||{...t,type:t.peer_type,name:t.peer_name,peer_id:t.owner_id}].concat(t.participants||[]).map(n=>new Vr(n.peer_id,n.name,n.type,t.activity_id,this.getAgmInstance(n.peer_id),void 0,this.generateWindowGetter(n.peer_id),void 0)),(t,n)=>new At(t,new vt(de.ActivityWindowJoinedActivity)),this._activityWindowChangeCallbacks)}forwardActivityMessagesToStatusEventHandlers(){for(const e of[wl,Ra])this.forwardMessageToEventHandler(e,t=>[Yt.activityGwMessageToActivity(t,new ys("started","",new Date))],(t,n)=>Yt.activityToActivityStatusChangeEvent(t),this._activityChangeCallbacks);this.forwardMessageToEventHandler(Zd,e=>[Yt.activityGwMessageToActivity(e,new ys("destroyed",e.reason,new Date))],(e,t)=>Yt.activityToActivityStatusChangeEvent(e),this._activityChangeCallbacks),this.forwardMessageToEventHandler(qm,e=>[Yt.activityGwMessageToActivity(e,new ys("created","",new Date))],(e,t)=>Yt.activityToActivityStatusChangeEvent(e),this._activityChangeCallbacks),this.forwardMessageToEventHandler(Jm,e=>[Yt.activityGwMessageToActivity(e,new ys("created","",new Date))],(e,t)=>Yt.activityToActivityStatusChangeEvent(e),this._activityChangeCallbacks)}forwardPeerFactoryMessagesToStatusEventHandlers(){this.forwardAddedAndRemovedMessagesToEventHandler(Km,Qm,(e,t)=>t?e.factories.map(Yt.peerFactoryGwMessageEntityToWindowType):e.factory_ids.map(n=>this.peerFactoryIdAndOwnerIdToWindowType(n,e.owner_id)).filter(n=>n!=null),this._windowTypeStatusChangeCallbacks)}forwardPeerFactoryMessagesToPeerFactoryRequests(){this.subscribe(TA,e=>{const t=this._peerFactoriesRegisteredByUs[e.peer_factory];if(!t){this._gw3Session.send({type:yl,request_id:e.request_id,reason:`Unknown peer factory ${e.peer_factory}`});return}try{const n=e.configuration||{};n.gateway_token=n.gateway_token||e.gateway_token,n.peer_factory=n.peer_factory||e.peer_factory;const r=t({activityId:e.activity&&e.activity.id,activityType:e.activity&&e.activity.type,type:e.configuration&&e.configuration.type,gwToken:n.gateway_token,configuration:n});r&&r.then&&r.catch&&r.catch(s=>this._gw3Session.send({type:yl,request_id:e.request_id,reason:s&&(s.message||JSON.stringify(s))}))}catch(n){this._gw3Session.send({type:yl,request_id:e.request_id,reason:n&&(n.message||JSON.stringify(n))})}})}forwardActivityWindowMessagesToEventHandlers(){for(const e of[vl,Ra])this.subscribe(e,t=>{const n=e===vl?t.joined_id:t.peer_id,r=e===vl?t.joined_type:t.peer_type,s=e===vl?t.joined_name:t.peer_name,o=new Vr(n,s,r,t.activity_id,this.getAgmInstance(n),void 0,this.generateWindowGetter(n),void 0);this._contextSubscriptions[t.activity_id]?e===Ra&&this._activityJoinedPromiseResolve({}):this.subscribeToContext(t).then(()=>{e===Ra&&this._activityJoinedPromiseResolve({})}),this.invokeCallbacks(this._activityWindowChangeCallbacks,new At(o,new vt(de.ActivityWindowJoinedActivity)),e)});this.subscribe(Vm,e=>{const t=new Vr(e.left_id,void 0,void 0,null,this.getAgmInstance(e.left_id),void 0,this.generateWindowGetter(e.left_id),void 0);this.invokeCallbacks(this._activityWindowChangeCallbacks,new At(t,new vt(de.ActivityWindowLeftActivity)),Vm)}),this.forwardAddedAndRemovedMessagesToEventHandler(Xm,void 0,e=>[new Vr(e.created_id,void 0,void 0,void 0,void 0,void 0,this.generateWindowGetter(e.created_id),void 0)],this._activityWindowChangeCallbacks)}getAgmInstance(e){return this._config.agm.servers().find(t=>t.peerId===e||t.windowId===e)}generateWindowGetter(e){return()=>{const t=this.getAgmInstance(e);if(!t)return;const n=t.windowId;return this._config.windows.list().filter(r=>r.id===n)[0]}}isOverrideTypeDefinition(e){return typeof e>"u"?!1:!!e.owner}}class RA{constructor(e,t){this._myAttached=[],this._myDetached=[],this._myAttachedTo=[],this._myDetachedFrom=[],this._myActivityFrameColorChanged=[],this._myActivityJoinedCallbacks=[],this._myActivityRemovedCallbacks=[],this._myContextUpdateCallbacks=[],this._logger=We.Get(this),this._m=e,e.ready().then(n=>{n.subscribeActivityContextChanged(this._subscribeMyContextChanged.bind(this)),n.subscribeWindowEvents(this._subscribeMyWindowEvent.bind(this)),n.subscribeActivitiesAttached(this._subscribeActivitiesAttached.bind(this)),n.subscribeActivitiesDetached(this._subscribeActivitiesDetached.bind(this)),t&&t.onWindowFrameColorChanged(this._subscribeWindowFrameColorChanged.bind(this))})}get window(){if(K(this._w)){const e=this._m.announcedWindows;e.length>0&&(this._w=e[0])}return this._w}get activity(){const e=this.window;if(!K(e))return e.activity}createWindow(e){return this._m.createWindow(this.activity,e)}createStackedWindows(e,t){return this._m.createStackedWindows(this.activity,e,t)}get context(){const e=this.activity;return Ye(e)?{}:e.context}updateContext(e,t){const n=this.activity;return Ye(n)?new Promise((r,s)=>{s("Not in activity")}):n.updateContext(e,t)}setContext(e,t){const n=this.activity;return Ye(n)?new Promise((r,s)=>{s("Not in activity")}):n.setContext(e,t)}onActivityJoined(e){this._myActivityJoinedCallbacks.push(e);const t=this.window;!K(t)&&!K(t.activity)&&e(t.activity)}onActivityLeft(e){this._myActivityRemovedCallbacks.push(e)}onContextChanged(e){this._myContextUpdateCallbacks.push(e);const t=this.window;if(K(t))return;const n=t.activity;K(n)||e(n.context,n.context,[],n)}clone(e,t){const n=this.activity;return this._m.clone(n,e,t)}attach(e,t){let n;return typeof e=="string"?n=e:n=e.id,this._m.attachActivities(n,this.activity.id,t)}onActivityAttached(e){this._myAttached.push(e)}onActivityDetached(e){this._myDetached.push(e)}onAttachedToActivity(e){this._myAttachedTo.push(e)}onDetachedFromActivity(e){this._myDetachedFrom.push(e)}get attached(){return this.activity?this.activity.attached:[]}setFrameColor(e,t){return this.activity?this.activity.setFrameColor(e,t):Promise.resolve(null)}getFrameColor(){return this.activity?this.activity.getFrameColor():""}onFrameColorChanged(e){this._myActivityFrameColorChanged.push(e)}_subscribeMyContextChanged(e,t,n,r){const s=this.window;if(K(s))return;const o=s.activity;K(o)||e.id===o.id&&this._notifyMyContextChanged(e,t,n,r)}_subscribeMyWindowEvent(e,t,n){K(this.window)||this.window.id===t.id&&(n===de.ActivityWindowJoinedActivity?(this._notifyMyWindowEvent(e,this._myActivityJoinedCallbacks),this._notifyMyContextChanged(e,e.context,null,null)):n===de.ActivityWindowLeftActivity&&this._notifyMyWindowEvent(e,this._myActivityRemovedCallbacks))}_notifyMyWindowEvent(e,t){t.forEach(n=>{try{n(e,event)}catch(r){this._logger.warn("error in user callback "+r)}})}_notifyMyContextChanged(e,t,n,r){n=n||{},r=r||[],this._myContextUpdateCallbacks.forEach(s=>{try{s(t,n,r,e)}catch(o){this._logger.warn("error in user callback "+o)}})}_notifyAttached(e){this._myAttached.forEach(t=>{try{t(e)}catch(n){this._logger.warn("error in user callback "+n)}})}_notifyDetached(e){this._myDetached.forEach(t=>{try{t(e)}catch(n){this._logger.warn("error in user callback "+n)}})}_notifyAttachedTo(e){this._myAttachedTo.forEach(t=>{try{t(this.activity,e)}catch(n){this._logger.warn("error in user callback "+n)}})}_notifyDetachedFrom(e,t,n){this._myDetachedFrom.forEach(r=>{try{r(e,t,n)}catch(s){this._logger.warn("error in user callback "+s)}})}_subscribeActivitiesAttached(e,t){const n=this.window;if(K(n))return;const r=n.activity;if(!K(r)&&e.id===r.id){if(t.windowIds.indexOf(n.id)>=0){this._notifyAttachedTo(t);return}this._notifyAttached(t)}}_subscribeActivitiesDetached(e,t,n){const r=this.window;if(K(r))return;const s=r.activity;K(s)||(t.id===s.id&&this._notifyDetached(n),e.id===s.id&&this._notifyDetachedFrom(e,t,n))}_subscribeWindowFrameColorChanged(e){const t=this.activity;t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._myActivityFrameColorChanged.forEach(n=>{n(e.frameColor)})}}class th{constructor(e,t){if(this._logger=We.Get("ReadyMarker ["+e+"]"),this._logger.debug("Initializing ready marker for '"+e+"' with "+t+" signals to wait"),t<=0)throw new Error("Invalid signal number. Should be > 0");this._signals=t,this._callbacks=[],this._name=e}setCallback(e){if(this.isSet()){e(void 0);return}else if(this.isError()){e(this._error);return}this._callbacks.push(e)}signal(e){if(this._logger.debug("Signaled - "+e+" - signals left "+(this._signals-1)),this._signals--,this._signals<0)throw new Error("Error in ready marker '"+this._name+" - signals are "+this._signals);this.isSet()&&this._callbacks.forEach(t=>{t(void 0)})}error(e){this._error=e,this._callbacks.forEach(t=>{t(e)})}isSet(){return this.isError()?!1:this._signals===0}isError(){return!Ye(this._error)}getError(){return this._error}}class bl{constructor(e){this._items={},this._listeners=[],this._processNew=e}addOne(e){this.add([e])}add(e){e.forEach(t=>{this.process(new At(t,new vt(de.Added)))})}process(e){const t=e.context,n=t.type,r=e.entity;if(n===de.StatusChange&&!t.oldStatus){const o=this._items[r.id];o&&(t.oldStatus=o.status)}n===de.StatusChange&&t.oldStatus&&t.newStatus&&t.oldStatus.state===t.newStatus.state&&(t.type=de.Updated),typeof htmlContainer>"u"&&(n===de.ActivityWindowJoinedActivity&&this._items[r.id]&&this._items[r.id].activity&&(t.type=de.Updated),n===de.ActivityWindowLeftActivity&&this._items[r.id]&&!this._items[r.id].activity&&(t.type=de.Updated));const s=this._updateInternalCollections(r,n,t);return this._notifyListeners(s,t),s}get(){const e=[];for(const t in this._items)if(this._items.hasOwnProperty(t)){const n=this._items[t];e.push(n)}return e}getByName(e){for(const t in this._items)if(t===e)return this._items[t]}getOrWait(e){return new Promise(t=>{const n=s=>{s.id===e&&(t(s),this.unsubscribe(n))};this.subscribe(n);const r=this.getByName(e);if(r){this.unsubscribe(n),t(r);return}})}subscribe(e){return this._listeners.push(e),Object.keys(this._items).forEach(t=>{const n=this._items[t];e(n,new vt(de.Added.toString()))}),()=>{this.unsubscribe(e)}}unsubscribe(e){const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}_notifyListeners(e,t){this._listeners.forEach(n=>{try{n(e,t)}catch{return}})}_updateInternalCollections(e,t,n){const r=e,s=t===de.StatusChange&&r.status&&r.status.state===Zs.Destroyed||t===de.StatusChange&&n&&n.newStatus&&n.newStatus.state===Zs.Destroyed,o=t===de.Closed;if(t===de.Removed&&typeof r.isIndependent>"u"||o||s){const c=this._items[e.id];return delete this._items[e.id],this._processNew(e),c&&e._beforeDelete(c),e}else{const c=e.id;this._items.hasOwnProperty(c)?this._items[e.id]._update(e):(this._processNew(e),this._items[e.id]=e)}return this._items[e.id]}}class MA{get usingHc(){return this._bridge.bridgeType==="HC"}get announcedWindows(){return this._announcedWindows}set announcedWindows(e){throw new Error("not allowed")}constructor(e,t,n){this._logger=We.Get("activityManager"),this._announcedWindows=[],this._attachedCallbacks=[],this._detachedCallbacks=[],this._frameColorChangesCallbacks=[],this._windowHandlers=[],this._bridge=e,this._activityTypes=new bl(r=>this._grabEntity(r)),this._windowTypes=new bl(r=>this._grabEntity(r)),this._activities=new bl(r=>this._grabEntity(r)),this._windows=new bl(r=>this._grabEntity(r)),this._dataReadyMarker=new th("Activity Manager Data",["GetActivityTypes","GetWindowTypes","GetActivities","GetWindows"].length),this._descriptorsMarker=new th("Attached Activities Descriptors",["GetDescriptors"].length),t?(this._readyMarker=new th("Activity Manager Announce",["Announcement"].length),this._dataReadyMarker.setCallback(r=>{r&&this._readyMarker.error(r),this._descriptorsMarker.setCallback(s=>{s&&this._readyMarker.error(s),this._logger.debug("Auto announcing window"),this.announceWindow().then(o=>{this._announcedWindows.push(o),this._readyMarker.signal("Successfully announced window with id '"+o.id+"'")}).catch(o=>{this._logger.debug("Will not announce window - "+o),this._readyMarker.signal()})}),this.refreshDescriptors()})):this._readyMarker=this._dataReadyMarker,this._bridge.onActivitiesAttached(r=>{this._handleActivitiesAttached(r)}),this._bridge.onActivitiesDetached(r=>{this._handleActivitiesDetached(r)}),this._bridge.onActivityAttachedDescriptorsRefreshed(r=>{this._handleActivityDescriptorsRefreshed(r)}),n&&n.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this)),this._bridge.init(),this._subscribeForData(),this._bridge.initReady().then(r=>{this._getInitialData()}).catch(r=>{console.log(r)})}ready(e){const t=new Promise((n,r)=>{this._readyMarker.setCallback(s=>{s?r(this._readyMarker.getError()):n(this)})});return et(Promise.all([this._bridge.ready(),t]).then(()=>this),e)}getActivityTypes(){return this._activityTypes.get()}getActivityType(e){return this._activityTypes.getByName(e)}registerActivityType(e,t,n,r,s,o){const a=new Promise((c,l)=>{if(K(e)){l("activityTypeName argument can not be undefined");return}if(!bn(e)){l("activityTypeName should be string");return}const u=this.getActivityType(e);if(!K(u)){l("Activity type '"+e+"' already exists");return}let p;if(Ye(t)){l("Owner window type can not be undefined");return}bn(t)?p={type:t,name:"",isIndependent:!1,arguments:{}}:p=t;const f=[];if(!Ye(n)&&Kb(n))for(const w in n){const y=n[w];if(bn(y)){const S={type:y,name:"",isIndependent:!1,arguments:{},relativeTo:"",relativeDirection:"",windowStyleAttributes:{}};f.push(S)}else f.push(y)}this._bridge.registerActivityType(e,p,f,r,s).then(w=>{this._grabEntity(w),c(w)}).catch(w=>{l(w)})});return et(a,o)}unregisterActivityType(e,t){const n=new Promise((r,s)=>{const o=this.getActivityType(e);if(Ye(o)){s("Activity type '"+e+"' does not exists");return}this._bridge.unregisterActivityType(e).then(()=>r(o),s)});return et(n,t)}initiate(e,t,n,r){const s=new Promise((o,a)=>{const c=this.getActivityType(e);if(Ye(c)){a("Activity type '"+e+"' does not exists");return}this._bridge.initiateActivity(e,t,r).then(l=>{this._activities.getOrWait(l).then(u=>{o(u)}).catch(u=>a(u))}).catch(l=>{a(l)})});return et(s,n)}subscribeActivityTypeEvents(e){this._activityTypes.subscribe((t,n)=>{e(t,n.type)})}getWindowTypes(){return this._windowTypes.get()}getWindowType(e){return this._windowTypes.getByName(e)}registerWindowFactory(e,t,n){const r=new Promise((s,o)=>{if(K(e)){o("no windowType specified");return}if(id(e))e=e.getName();else if(!bn(e)){o("windowType should be string or object that has getName method");return}this._bridge.registerWindowFactory(e,t).then(a=>{s(a)}).catch(a=>{o(a)})});return et(r,n)}unregisterWindowFactory(e,t){const n=new Promise((r,s)=>{if(K(e)){s("no windowType specified");return}if(!bn(e)){s("windowType should be a string");return}this._bridge.unregisterWindowFactory(e).then(o=>{r(o)}).catch(o=>{s(o)})});return et(n,t)}getActivities(e){let t=this._activities.get();if(t=t.filter(r=>r._ownerId),!e)return t;let n=e;if(bn(e))n=[e];else if(e instanceof ql)n=[e.name];else if(!(e instanceof Array))throw new Error("Invalid input argument 'activityType' = "+e);return t.filter(r=>{const s=r.type;return hA(n,o=>s.id===o.id)})}getActivityById(e){return this._activities.getByName(e)}announceWindow(e,t){return new Promise((r,s)=>{const o=this._bridge.getAnnouncementInfo();if(Ye(e)&&(e=o.activityWindowId),Ye(t)&&(t=o.activityWindowType),K(t))throw new Error("Can not announce - unknown windowType");const a=o&&o.activityId;if(K(e))this._logger.debug("Registering window with type:'"+t+"', name:'"+o.activityWindowName+"', ind.:'"+o.activityWindowIndependent+"'"),this._bridge.registerWindow(t,o.activityWindowName,o.activityWindowIndependent).then(this._windows.getOrWait.bind(this._windows)).then(c=>a?this._activities.getOrWait(a).then(l=>c):c).then(c=>{r(c)}).catch(c=>{this._logger.error(c)});else{this._logger.debug("Announcing window with id '"+e+"' and type '"+t+"'");const c=this._windows.getByName(e);if(!K(c)){this._logger.debug("Window with id '"+e+"' already announced - reusing the window"),r(c);return}const l=(u,p,f)=>{if(e===p.id&&f===de.ActivityWindowJoinedActivity){const w=p.activity;Ye(w)&&s("UNDEFINED ACTIVITY"),this._logger.trace("Got joined event for id '"+e+"'"),r(p),this.unsubscribeWindowEvents(l)}};this.subscribeWindowEvents(l),this._logger.trace("Waiting for joined event for id '"+e+"'"),this._bridge.announceWindow(t,e)}})}subscribeWindowTypeEvents(e){this._windowTypes.subscribe((t,n)=>{e(t,n.type)})}subscribeActivityEvents(e){return this._activities.subscribe((t,n)=>{if(n.type===de.StatusChange){const r=n;e(t,r.newStatus,r.oldStatus)}if(n.type===de.Removed||n.type===de.StatusChange&&n.newStatus.getState()===Zs.Destroyed)for(const r of this._windows.get())r.activity&&r.activity.id===t.id&&this._windows.process(new At(r,new vt(de.ActivityWindowLeftActivity)))})}subscribeWindowEvents(e){const t=(n,r)=>{let s=r.type;s===de.Added&&(s="opened"),e(n.activity,n,s)};return this._windowHandlers.push([e,t]),this._windows.subscribe(t)}unsubscribeWindowEvents(e){const t=this._windowHandlers.find(n=>n[0]===e);t&&(this._windowHandlers.splice(this._windowHandlers.indexOf(t),1),this._windows.unsubscribe(t[1]))}createWindow(e,t,n){const r=new Promise((s,o)=>{K(t)&&o("windowType is undefined");let a;if(bn(t))a={type:t,name:"",isIndependent:!1,arguments:{}};else if(t instanceof rc)a={type:t.type||t.id,name:t.name||t.type||t.id,isIndependent:!1};else{const l=["url"],u={};Object.keys(t).forEach(p=>{l.indexOf(p)===-1&&(u[p]=t[p])}),a=u}let c;if(!K(a.relativeTo))if(c=a.relativeTo,typeof c=="string"){const l=this.getWindows({type:c});!K(l)&&l.length>0&&(a.relativeTo=l[0].id)}else if(K(c.type))K(c.windowId)||(a.relativeTo=c.windowId);else{const l=this.getWindows({type:c.type});!K(l)&&l.length>0&&(a.relativeTo=l[0].id)}this._bridge.createWindow(e&&e.id,a).then(l=>{this._logger.debug("Window created, waiting for window entity with id "+l);const u=(p,f)=>{p.id===l&&(!e||p.activity)&&(this._logger.debug("Got entity window with id "+l),s(p),this._windows.unsubscribe(u))};this._windows.subscribe(u)}).catch(l=>{o(l)})});return et(r,n)}createStackedWindows(e,t,n,r){const s=new Promise((o,a)=>{K(e)&&a("activity is undefined"),K(t)&&a("relativeWindowTypes is undefined"),Array.isArray(t)||a("relativeWindowTypes has to be an array"),K(n)&&(n=2e4);const c=[];t.forEach(u=>{let p;bn(u)?p={type:u,name:"",isIndependent:!1,arguments:{}}:p=u,p.stackedWindow=!0,p.timeout=n;let f;if(!K(p.relativeTo)){if(f=p.relativeTo,!K(f.type))p.relativeTo=f.type;else if(!K(f.windowId)){const w=this.getWindows({id:f.windowId});!K(w)&&w.length>0&&(p.relativeTo=w[0].type.name)}}c.push(p)});const l=[];c.forEach(u=>l.push(this.createWindow(e,u))),Promise.all(l).then(o).catch(a)});return et(s,r)}addWindowToActivity(e,t,n){const r=this._bridge.joinActivity(e.id,t.id).then(()=>t);return et(r,n),r}leaveWindowFromActivity(e,t,n){const r=this._bridge.leaveActivity(e.id,t.id).then(()=>t);return et(r,n),r}setActivityContext(e,t,n){const r=new Promise((s,o)=>{K(e)&&o("activity can not be null"),this._bridge.updateActivityContext(e,t,!0).then(a=>{s(e)}).catch(a=>{o(a)})});return et(r,n)}updateActivityContext(e,t,n){const r=new Promise((s,o)=>{K(e)&&o("activity can not be null");const a=[];for(const c in t)t.hasOwnProperty(c)&&t[c]===null&&a.push(c);for(const c of a)delete t[c];this._bridge.updateActivityContext(e,t,!1,a).then(c=>{s(e)}).catch(c=>{o(c)})});return et(r,n)}subscribeActivityContextChanged(e){this._activities.subscribe((t,n)=>{if(n.type===de.ActivityContextChange){const r=n;e(t,r.context,r.updated,r.removed)}})}stopActivity(e,t){const n=this._bridge.stopActivity(e);return et(n,t)}getWindows(e){return Ye(e)?this._windows.get():Ye(e.id)?this._windows.get().filter(n=>!(!Ye(e.type)&&n.type.id!==e.type||!Ye(e.name)&&n.name!==e.name||!Ye(e.activityId)&&(K(n.activity)||n.activity.id!==e.activityId))):[this._windows.getByName(e.id)]}getWindowBounds(e){return this._bridge.getWindowBounds(e)}setWindowBounds(e,t,n){const r=new Promise((s,o)=>{this._bridge.setWindowBounds(e,t).then(()=>s()).catch(a=>o(a))});return et(r,n)}closeWindow(e){return this._bridge.closeWindow(e)}activateWindow(e,t){return this._bridge.activateWindow(e,t)}setWindowVisibility(e,t){return this._bridge.setWindowVisibility(e,t)}clone(e,t,n){const r=new Promise((s,o)=>{e||o("activity can not be null"),this._bridge.cloneActivity(e.id,t).then(a=>{this._activities.getOrWait(a).then(c=>{s(c)}).catch(c=>o(c))}).catch(a=>o(a))});return et(r,n)}attachActivities(e,t,n,r){n=n||{};const s=new Promise((o,a)=>{if(!this._activities.getByName(e)){a("can not find activity with id "+e);return}if(!this._activities.getByName(t)){a("can not find activity with id "+t);return}return this._bridge.attachActivities(e,t,n).then(u=>{const p=u.to,f=u.descriptor,w=u.descriptors;this._activities.getOrWait(p).then(y=>{y._updateDescriptors(w);const S=y.attached.filter(O=>O.ownerId===f.ownerId)[0];o(S)})}).catch(u=>{a(u)})});return et(s,r)}detachActivities(e,t,n){const r=new Promise((s,o)=>this._bridge.detachActivities(e,t).then(()=>{this._activities.getOrWait(void 0).then(u=>{u._updateDescriptors(void 0),this._activities.getOrWait(void 0).then(p=>{s(p)})}).catch(u=>o(u))}).catch(a=>{o(a)}));return et(r,n)}subscribeActivitiesAttached(e){this._attachedCallbacks.push(e)}subscribeActivitiesDetached(e){this._detachedCallbacks.push(e)}subscribeActivityFrameColorChanged(e){this._frameColorChangesCallbacks.push(e)}_grabEntity(e){e._manager=this}_getInitialData(){this._logger.debug("Request initial data..."),this._bridge.getActivityTypes().then(e=>{this._activityTypes.add(e),this._dataReadyMarker.signal("Got act types")}).catch(e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity types -"+e)}),this._bridge.getWindowTypes().then(e=>{this._windowTypes.add(e),this._dataReadyMarker.signal("Got window types")}).catch(e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting window types  "+e)}),this._bridge.getActivities().then(e=>{this._activities.add(e),this._dataReadyMarker.signal("Got activities")}).catch(e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity instances -"+e)}),this._bridge.getActivityWindows().then(e=>{this._windows.add(e),this._dataReadyMarker.signal("Got windows")}).catch(e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity windows -"+e)})}_subscribeForData(){this._logger.debug("Subscribe for data..."),this._bridge.onActivityTypeStatusChange(e=>{this._activityTypes.process(e)}),this._bridge.onWindowTypeStatusChange(e=>{this._windowTypes.process(e)}),this._bridge.onActivityWindowChange(e=>{this._windows.process(e)}),this._bridge.onActivityStatusChange(e=>{this._activities.process(e)})}_handleActivitiesAttached(e){const t=e.to,n=e.descriptor,r=e.descriptors;this._activities.getOrWait(t).then(s=>{s._updateDescriptors(r);const o=s.attached.filter(a=>a.ownerId===n.ownerId)[0];this._attachedCallbacks.forEach(a=>{try{a(s,o)}catch{return}})})}_handleActivitiesDetached(e){const t=e.oldActivityId,n=e.newActivityId,r=e.descriptors,s=e.descriptor;this._activities.getOrWait(t).then(o=>{o._updateDescriptors(r),this._activities.getOrWait(n).then(a=>{this._detachedCallbacks.forEach(c=>{try{c(a,o,s)}catch{return}})})})}_handleActivityDescriptorsRefreshed(e){const t=e.id,n=e.descriptors,r=this._activities.getByName(t);r&&r._updateDescriptors(n)}refreshDescriptors(){this._bridge.getAttachedDescriptors().then(e=>{e&&Object.keys(e).forEach(t=>{const n=t,r=e[t],s=this._activities.getByName(n);s&&s._updateDescriptors(r)}),this._descriptorsMarker.signal("Successfully got descriptors")}).catch(e=>{this._descriptorsMarker.error("failed to get descriptors - "+e)})}_handleWindowFrameColorChanged(e){if(!e.activityId)return;const t=this._activities.getByName(e.activityId);t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._frameColorChangesCallbacks.forEach(n=>{try{n(t,e.frameColor)}catch{return}})}}class jA{constructor(e,t){this._m=e,this._my=t,this.activityTypes={get:this._getActivityTypesWrapper.bind(this),register:this._m.registerActivityType.bind(this._m),unregister:this._m.unregisterActivityType.bind(this._m),subscribe:this._m.subscribeActivityTypeEvents.bind(this._m),unsubscribe:void 0,initiate:this._m.initiate.bind(this._m)},this.windowTypes={get:this._getWindowTypesWrapper.bind(this),registerFactory:this._m.registerWindowFactory.bind(this._m),unregisterFactory:this._m.unregisterWindowFactory.bind(this._m),subscribe:this._m.subscribeWindowTypeEvents.bind(this._m),unsubscribe:void 0},this.windows={get:this._m.getWindows.bind(this._m),subscribe:this._m.subscribeWindowEvents.bind(this._m),announce:this._m.announceWindow.bind(this._m),unsubscribe:void 0,create:this._m.createWindow.bind(this._m)},this.instances={get:this._m.getActivities.bind(this._m),subscribe:this._m.subscribeActivityEvents.bind(this._m),unsubscribe:void 0}}onAttached(e){this._m.subscribeActivitiesAttached(e)}onDetached(e){this._m.subscribeActivitiesDetached(e)}onActivityFrameColorChanged(e){this._m.subscribeActivityFrameColorChanged(e)}_getActivityTypesWrapper(e){return Ye(e)?this._m.getActivityTypes():this._m.getActivityType(e)}_getWindowTypesWrapper(e){return Ye(e)?this._m.getWindowTypes():this._m.getWindowType(e)}}class OA{constructor(e,t){this._mgr=e,this._my=t,this.all=new jA(e,t)}ready(e){const t=new Promise((n,r)=>{this._mgr.ready().then(()=>{n(this)}).catch(s=>{r(s)})});return et(t,e)}get my(){return this._my}get aware(){return this._my.window!==void 0}get inActivity(){return this.aware&&this._my.activity!==void 0}get agm(){if(this.aware)return this.inActivity?this._my.activity.agm:new _n(null)}getAvailableFrameColors(){return[]}}class mc{static checkIsUsingGW3Implementation(e){return e.protocolVersion===3}get api(){return this._api}set api(e){this._api=e}constructor(e){if(!e)throw new Error("config can not be null");Ye(e.logLevel)||(We.Level=e.logLevel),K(e.logger)||(We.GlueLogger=e.logger);let t;if(this._isUsingHCImplementation=e.gdMajorVersion===2,this._isUsingGW3Implementation=mc.checkIsUsingGW3Implementation(e.connection),this._isUsingHCImplementation)throw new Error("GD2 not supported");if(this._isUsingGW3Implementation)t=new Yt(e);else throw new Error("Unable to instantiate activity bridge implementation");if(!t)throw new Error("A bridge to native activity is needed to create activity lib.");_n.AGM=e.agm;const n=new MA(t,!e.disableAutoAnnounce,e.windows),r=new RA(n,e.windows);this._api=new OA(n,r),this._readyPromise=n.ready().then(s=>this)}get isUsingHCImplementation(){return this._isUsingHCImplementation}get isUsingGW3Implementation(){return this._isUsingGW3Implementation}ready(e){return et(this._readyPromise,e)}}const DA="T42.ACS.Shutdown",$A="T42.ACS.OnGDShutdown",FA="T42.ACS.Restart",LA="T42.ACS.GetConfigurationRegion",WA="T42.ACS.SetConfigurationRegion",BA="T42.ACS.GetUser",HA="T42.ACS.GetBranches",GA="T42.ACS.GetCurrentBranch",zA="T42.ACS.SetCurrentBranch",Ym="T42.ACS.GetFunctionalEntitlement",Zm="T42.ACS.CanI",UA="T42.ACS.StartApplication",qA="T42.ACS.StopApplication",VA="T42.ACS.ActivateApplication",JA="T42.ACS.Execute",ey="T42.ACS.OnEvent",Bf="T42.ACS.GetApplications";function KA(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Sp(i){if(i&&i.errorHandling&&typeof i.errorHandling!="function"&&i.errorHandling!=="log"&&i.errorHandling!=="silent"&&i.errorHandling!=="throw")throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof i.errorHandling+" was passed");var e=i&&typeof i.errorHandling=="function"&&i.errorHandling,t={};function n(c,l,u){var p=t[c];return p||(p=[],t[c]=p),p.push(l),u&&setTimeout(function(){u.forEach(function(f){var w;if(!((w=t[c])===null||w===void 0)&&w.includes(l))try{Array.isArray(f)?l.apply(void 0,f):l.apply(void 0,[f])}catch(y){s(y,c)}})},0),function(){var f=t[c];f&&(f=f.reduce(function(w,y,S){return y===l&&w.length===S||w.push(y),w},[]),f.length===0?delete t[c]:t[c]=f)}}function r(c){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];var p=t[c];if(!p||p.length===0)return[];var f=[];return p.forEach(function(w){try{var y=w.apply(void 0,l);f.push(y)}catch(S){f.push(void 0),s(S,c)}}),f}function s(c,l){var u=c instanceof Error?c:new Error(c);if(e){e(u);return}var p='[ERROR] callback-registry: User callback for key "'+l+'" failed: '+u.stack;if(i)switch(i.errorHandling){case"log":return console.error(p);case"silent":return;case"throw":throw new Error(p)}console.error(p)}function o(){t={}}function a(c){var l=t[c];l&&delete t[c]}return{add:n,execute:r,clear:o,clearKey:a}}Sp.default=Sp;var QA=Sp,pt=KA(QA);function vn(i){return i?Object.keys(i).map(e=>i[e]):[]}function ty(i){let e;try{e=JSON.parse(JSON.stringify(i||{}))}catch{e={}}return e}function bt(i,e){if(e.throwErrors&&typeof i!="function")throw new Error("Please provide the callback as a function!")}class XA{constructor(e,t,n,r){this._appManager=e,this._name=t,this._agm=n,this._configuration=r,this._registry=pt(),e.onInstanceStarted(s=>{s.application&&s.application.name!==this._name||this._registry.execute("instanceStarted",s)}),e.onInstanceStopped(s=>{s.application&&s.application.name!==this._name||this._registry.execute("instanceStopped",s)}),e.onAppRemoved(s=>{s.name===this._name&&this._registry.execute("appRemoved",s)}),e.onAppChanged(s=>{s.name===this._name&&this._registry.execute("appChanged",s)}),e.onAppAvailable(s=>{s.name===this._name&&(this._props.IsReady=!0,this._registry.execute("appAvailable",s))}),e.onAppUnavailable(s=>{s.name===this._name&&(this._props.IsReady=!1,this._registry.execute("appUnavailable",s))})}get name(){return this._name}get title(){return this._props.Title}get version(){return this._props.Version}get autoStart(){return this._props.AutoStart}get isShell(){return this._props.IsShell}get caption(){return this._props.Caption}get hidden(){return this._props.IsHidden}get container(){return this._props.ApplicationName}get activityType(){return this._props.ActivityType}get activityWindowType(){return this._props.ActivityWindowType}get windowSettings(){return this._props.Arguments?ty(this._props.Arguments):{}}get allowMultiple(){return this._props.AllowMultiple}get available(){return this._props.IsReady||!0}get icon(){return this._props.Icon}get iconURL(){return this._props.IconUrl}get sortOrder(){return this._props.SortOrder}get userProperties(){return this._props.UserProperties?ty(this._props.UserProperties):{}}get keywords(){return this._props.Keywords?this._props.Keywords:[]}get isActivity(){return this._props.ActivityType!==void 0&&this._props.ActivityType!==""}get configuration(){return{autoStart:this._props.AutoStart,caption:this._props.Caption,hidden:this._props.IsHidden,container:this._props.ApplicationName,activityType:this._props.ActivityType,allowMultiple:this._props.AllowMultiple}}get instances(){return this._appManager.instances().filter(e=>e.application.name===this._name)}get type(){return this._props.Type}get mode(){if(!this._props)return"unknown";if(this._props.Mode&&typeof this._props.Mode=="string")return this._props.Mode.toLowerCase();if(this.isActivity)return"unknown";if(this._props.Arguments&&this._props.Arguments.mode&&typeof this._props.Arguments.mode=="string")return this._props.Arguments.mode.toLowerCase();let e=this._props.WindowStyleAttributes;if(e){e=e.split(" ").join("");const t='mode:"',n=e.indexOf(t);if(n!==-1){const r=n+t.length,s=e.indexOf('"',r),o=e.substr(r,s-r);if(o&&typeof o=="string")return o.toLowerCase()}}return"flat"}async getConfiguration(){return(await this._agm.invoke(Bf,{v2:{apps:[this._name]}})).returned.applications[0]}updateFromProps(e){this._props||(this._props={Name:e.Name}),Object.keys(e).forEach(t=>{this._props[t]=e[t]})}start(e,t){return new Promise(async(n,r)=>{var s,o,a,c,l;if(K(e))e={};else if(!((s=this._configuration())===null||s===void 0)&&s.throwErrors&&typeof e!="object"||Array.isArray(e))return r(new Error('Invalid "context" parameter - must be an object.'));if(K(t))t={};else if(!((o=this._configuration())===null||o===void 0)&&o.throwErrors&&typeof t!="object")return r(new Error('Invalid "options" parameter - must be an object.'));const u=this._name;let p=(c=(a=t.awaitInterop)!==null&&a!==void 0?a:t.waitForAGMReady)!==null&&c!==void 0?c:!0,f=6e4;typeof t.timeout=="number"&&(f=t.timeout*1e3);const w=y=>{let S;const O=setTimeout(()=>{S&&S(),r(`timed out while waiting for instance id ${y} for app ${this.name}`)},f),_=v=>{v.id===y&&(S&&(S(),S=void 0),clearTimeout(O),n(v))};p?S=this._appManager.onInstanceAgmServerReady(_):S=this._appManager.onInstanceStarted(_)};try{const S=(await this._agm.invoke(UA,{Name:u,Context:e,Options:t},"best",{methodResponseTimeoutMs:f})).returned;if(typeof S.timeout<"u"&&typeof t.timeout>"u"&&(f=S.timeout*1e3),typeof S.waitForInterop<"u"&&typeof t.waitForAGMReady>"u"&&typeof t.awaitInterop>"u"&&(p=S.waitForInterop),S&&S.Id)if(this._appManager.mode==="startOnly"){const O=this._appManager.handleInstanceStarted({ActivityId:void 0,IsActivityOwner:void 0,Context:void 0,Title:void 0,AgmServers:void 0,Id:S.Id,Name:S.Name});n(O)}else w(S.Id);else n(void 0)}catch(y){r((l=y.message)!==null&&l!==void 0?l:y)}})}onInstanceStarted(e){return bt(e,this._configuration()),this._registry.add("instanceStarted",e)}onInstanceStopped(e){return bt(e,this._configuration()),this._registry.add("instanceStopped",e)}onAvailable(e){return bt(e,this._configuration()),this._props.IsReady&&setTimeout(()=>{this._registry.execute("appAvailable",this)},0),this._registry.add("appAvailable",e)}onUnavailable(e){return bt(e,this._configuration()),this._props.IsReady===!1&&setTimeout(()=>{this._registry.execute("appUnavailable",this)},0),this._registry.add("appUnavailable",e)}onChanged(e){bt(e,this._configuration()),this._registry.add("appChanged",e)}onRemoved(e){bt(e,this._configuration()),this._registry.add("appRemoved",e)}}class ny{constructor(e,t,n,r,s,o,a,c){this._id=e,this._appName=t,this._appManager=n,this._agm=r,this._activities=s,this._windows=o,this._configuration=c,this._registry=pt(),!a&&(this._unsubscribeInstanceStopped=this._appManager.onInstanceStopped(l=>{l.id===this._id&&this._registry.execute("stopped",l)}),this._unsubscribeInstanceAgmServerReady=this._appManager.onInstanceAgmServerReady(l=>{l.id===this._id&&this._registry.execute("agmReady",l)}))}get id(){return this._id}get application(){return this._appManager.application(this._appName)}get activity(){if(!this._activities)throw new Error("This method requires glue.activities library to be enabled.");return this._activities.all.instances.get().filter(e=>e.id===this._activityId)[0]}get isActivityOwner(){return this._isActivityOwner}get activityInstances(){return this._appManager.instances().filter(e=>e.application.type!=="activity"&&e.activityId&&e.activityId===this._activityId)}get activityOwnerInstance(){if(this._activityId)return this.activityInstances.filter(e=>e==null?void 0:e.isActivityOwner)[0]}get window(){if(!this._windows)throw new Error("This method requires glue.windows library to be enabled.");let e=this._windows.list().filter(t=>t.id===this._id)[0];return!e&&this._activities&&this.activity&&this.activityOwnerInstance&&(e=this.activityOwnerInstance.window),e}get context(){var e,t,n;return(n=(e=this._startUpContext)!==null&&e!==void 0?e:(t=this.window)===null||t===void 0?void 0:t.context)!==null&&n!==void 0?n:{}}get title(){return this._title}get isActivityInstance(){return this._isActivityInstance}get activityId(){return this._activityId}get inActivity(){return this._inActivity}get isSingleWindowApp(){return!this._inActivity}get agm(){return this._agmInstance}get interopInstance(){return this._agmInstance}onInteropReady(e){return bt(e,this._configuration()),this._agmInstance&&setTimeout(()=>{this._registry.execute("agmReady",this)},0),this._registry.add("agmReady",e)}onAgmReady(e){return this.onInteropReady(e)}onStopped(e){return bt(e,this._configuration()),this._registry.add("stopped",e)}getWindow(){return new Promise((e,t)=>{const n=this.window;if(n){e(n);return}const r=(a,c)=>{a&&t(a),c&&e(c),setTimeout(()=>{clearTimeout(s),o()},0)},s=setTimeout(()=>{r(new Error(`can not find a window with id ${this._id}`))},3e4),o=this._windows.onWindowAdded(a=>{a.id===this._id&&r(void 0,a)})})}updateFromProps(e){this._startUpContext=e.Context,this._title=e.Title,this._isActivityInstance=!1,e.ActivityId&&e.ActivityId!==""&&(this._activityId=e.ActivityId,this._isActivityInstance=!0),this._isActivityOwner=e.IsActivityOwner,!this._activityId&&this._startUpContext&&this._startUpContext.activityId&&(this._activityId=this._startUpContext.activityId),this._inActivity=!!this._activityId,this.updateAgmInstanceFromProps(e)}updateAgmInstanceFromProps(e){if(!e.AgmServers)return;const t=e.AgmServers;t&&t.length>0&&!K(t[0])&&(this._agmInstance=t[0])}stop(){return new Promise((e,t)=>{let n=this._id;this.isActivityOwner&&(n=this.activityId);const r=this._appManager.onInstanceStopped(s=>{s.id===n&&(r(),e())});this._agm.invoke(qA,{Name:this._appName,Id:this._id}).then(()=>{this._appManager.mode==="startOnly"&&(this._appManager.handleInstanceStopped({Name:this._appName,Id:this.id}),e())}).catch(s=>t(s))})}activate(){return this._agm.invoke(VA,{Name:this._appName,Id:this._id})}done(){this._registry.clear(),this._unsubscribeInstanceAgmServerReady(),this._unsubscribeInstanceStopped()}getContext(){return Promise.resolve(this.context)}async startedBy(){return(await this._agm.invoke(JA,{command:"getStartedBy",Name:this._appName,Id:this._id})).returned}}class YA{constructor(e,t,n,r,s,o,a){this.mode=e,this._agm=t,this._activities=n,this._windows=r,this._logger=s,this._gdMajorVersion=o,this._configuration=a,this._apps={},this._instances=[],this._registry=pt(),this.getConfigurations=async c=>{const l={v2:{apps:void 0}};return Array.isArray(c)&&(l.v2={apps:c}),(await this._agm.invoke(Bf,l)).returned.applications},this.application=c=>{var l;if(!((l=this._configuration())===null||l===void 0)&&l.throwErrors&&typeof c!="string")throw new Error('"name" must be string');return this._apps[c]},this.applications=()=>Object.keys(this._apps).map(c=>this._apps[c]),this.instances=()=>this._instances.map(c=>c),this.getMyInstance=()=>{const c=typeof window<"u"&&window.glue42gd;if(c){if(this._gdMajorVersion>=3){const l=c.appInstanceId;return this._instances.find(u=>u.id===l)}}else{const l=this._agm.instance.instance;return this._instances.find(u=>u.id===l)}},this.getMyApplication=()=>{var c;if(this._agm.instance)return(c=this.application(this._agm.instance.applicationName))!==null&&c!==void 0?c:this.application(this._agm.instance.application)},this.handleSnapshotAppsAdded=c=>{const l=this.applications();l.length>0&&l.forEach(u=>{const p=u.name;c.find(w=>w.Name===u.name)||this.handleAppRemoved({Name:p})}),c.forEach(u=>{l.find(f=>f.name===u.Name)||this.handleAppAdded(u)})},this.handleSnapshotInstanceStarted=c=>{const l=this.instances();l.length>0&&l.forEach(u=>{const p=u.id;c.find(w=>w.Id===p)||this.handleInstanceStopped({Name:u.application.name,Id:p})}),c.forEach(u=>{l.find(f=>f.id===u.Id)||this.handleInstanceStarted(u)})},this.handleAppAdded=c=>{const l=this._getAppId(c);this._logger.trace(`adding app ${l}`),this._apps[l]=new XA(this,l,this._agm,this._configuration);const u=this._updateAppFromProps(c);this._registry.execute("appAdded",u),this._registry.execute("appAvailable",u)},this.handleAppUpdated=c=>{const l=this._updateAppFromProps(c);this._registry.execute("appChanged",l)},this.handleAppRemoved=c=>{const l=this._getAppId(c);this._logger.trace(`removing app ${l}`);const u=this.application(l);this._instances=this._instances.filter(p=>p.application.name!==u.name),delete this._apps[l],this._registry.execute("appRemoved",u)},this.handleAppReady=c=>{const l=this._getAppId(c),u=this._getAppOrThrow(l);u.updateFromProps(c),u.available?this._registry.execute("appAvailable",u):this._registry.execute("appUnavailable",u)},this.handleInstanceStarted=c=>{this._logger.trace(`started app ${c.Name} ${c.Id}`);const l=this._getInstanceId(c),u=this._getInstanceAppName(c),p=new ny(l,u,this,this._agm,this._activities,this._windows,!1,this._configuration);return this._updateInstanceFromProps(p,c),this._instances.push(p),this._registry.execute("instanceStarted",p),p},this.handleInstanceStopped=c=>{this._logger.trace(`failed to start app ${c.Name} ${c.Id}`);const l=this._getInstanceId(c),u=this._getInstanceAppName(c),p=this._getInstanceOrThrow(l,u);this._instances=this._instances.filter(f=>!this._matchInstance(f,l,u)),this._registry.execute("instanceStopped",p),p.done()},this.handleInstanceAgmServerReady=c=>{const l=this._getInstanceId(c),u=this._getInstanceAppName(c),p=this._getInstanceOrThrow(l,u);p.updateAgmInstanceFromProps(c),this._registry.execute("instanceAgmServerReady",p)},this.handleInstanceStartFailed=c=>{const l=this._getInstanceId(c),u=this._getInstanceAppName(c),p=!0,f=new ny(l,u,void 0,void 0,void 0,void 0,p,this._configuration);this._updateInstanceFromProps(f,c),this._registry.execute("instanceStartFailed",f)},this.handleInstanceUpdated=c=>{const l=this._getInstanceId(c),u=this._getInstanceAppName(c),p=this._getInstanceOrThrow(l,u);this._updateInstanceFromProps(p,c)},this.onInstanceStarted=c=>(bt(c,this._configuration()),this._registry.add("instanceStarted",c,this._instances)),this.onInstanceStartFailed=c=>(bt(c,this._configuration()),this._registry.add("instanceStartFailed",c)),this.onInstanceStopped=c=>(bt(c,this._configuration()),this._registry.add("instanceStopped",c)),this.onInstanceUpdated=c=>(bt(c,this._configuration()),this._registry.add("instanceChanged",c)),this.onInstanceAgmServerReady=c=>(bt(c,this._configuration()),this._registry.add("instanceAgmServerReady",c)),this.onAppAdded=c=>(bt(c,this._configuration()),this._registry.add("appAdded",c,Object.values(this._apps))),this.onAppRemoved=c=>(bt(c,this._configuration()),this._registry.add("appRemoved",c)),this.onAppAvailable=c=>(bt(c,this._configuration()),this._registry.add("appAvailable",c)),this.onAppUnavailable=c=>(bt(c,this._configuration()),this._registry.add("appUnavailable",c)),this.onAppChanged=c=>(bt(c,this._configuration()),this._registry.add("appChanged",c))}_getAppOrThrow(e){const t=this.application(e);if(!t)throw Error(`app with id ${e} not found`);return t}_getAppId(e){return e.Name}_matchInstance(e,t,n){return e.id===t&&e.application.name===n}_getInstanceByIdAndName(e,t){return this._instances.filter(n=>this._matchInstance(n,e,t))[0]}_getInstanceOrThrow(e,t){const n=this._getInstanceByIdAndName(e,t);if(!n)throw Error(`instance with id ${e} not found`);return n}_getInstanceId(e){return e.Id}_getInstanceAppName(e){return e.Name}_updateAppFromProps(e){const t=this._getAppId(e);this._logger.trace(`updating app with  + ${t}, ${JSON.stringify(e)}`);const n=this._getAppOrThrow(t);return n.updateFromProps(e),n}_updateInstanceFromProps(e,t){this._logger.trace("updating instance with "+this._getInstanceId(t)+" for app "+this._getInstanceAppName(t)),e.updateFromProps(t)}}function ti(i,e,t){const n=r=>!!(r&&r.constructor&&r.call&&r.apply);return!n(e)&&!n(t)?i:(n(e)?n(t)||(t=()=>{}):e=()=>{},i.then(e,t))}class ZA{constructor(e){this._agm=e,this._registry=pt(),this._isMethodRegistered=!1,this.handleBranchModified=t=>{this._registry.execute("branchChanged",t)},this.handleBranchesModified=t=>{this._registry.execute("branchesChanged",t)},this.getRegion=(t,n)=>ti(this._agmInvoke(LA,r=>r.returned.Region),t,n),this.getBranches=(t,n)=>{const r=this._agmInvoke(HA,s=>{const o=s.returned.Branches;return Object.keys(o).map(a=>o[a])});return ti(r,t,n)},this.getCurrentBranch=(t,n)=>{const r=this._agmInvoke(GA,s=>s.returned.Branch,void 0);return ti(r,t,n)},this.setRegion=(t,n,r)=>{const s=this._agmInvoke(WA,o=>o.returned.ResultMessage,{Region:t});return ti(s,n,r)},this.setCurrentBranch=(t,n,r)=>{const s=this._agmInvoke(zA,o=>o.returned.ResultMessage,{Branch:t});return ti(s,n,r)},this.currentUser=(t,n)=>{const r=this._agmInvoke(BA);return ti(r,t,n)},this.getFunctionalEntitlement=(t,n,r)=>{const s=this._agmInvoke(Ym,o=>o.returned.Entitlement,{Function:t});return ti(s,n,r)},this.getFunctionalEntitlementBranch=(t,n,r,s)=>{const o=this._agmInvoke(Ym,a=>a.returned.Entitlement,{Function:t,Branch:n});return ti(o,r,s)},this.canI=(t,n,r)=>{const s=this._agmInvoke(Zm,o=>o.returned.Result,{Function:t});return ti(s,n,r)},this.canIBranch=(t,n,r,s)=>{const o=this._agmInvoke(Zm,a=>a.returned.Result,{Function:t,Branch:n});return ti(o,r,s)},this.onBranchesChanged=t=>this._registry.add("branchesChanged",t),this.onBranchChanged=t=>this._registry.add("branchChanged",t),this.exit=t=>this._agmInvoke(DA,null,t),this.onShuttingDown=t=>(this.registerMethod(),this._registry.add("onShuttingDown",t)),this.restart=t=>this._agmInvoke(FA,null,t),this._agmInvoke=(t,n,r)=>(r=r||{},new Promise((s,o)=>{const a=c=>o(c);this._agm.invoke(t,r).then(c=>{n||(n=l=>l.returned),s(n(c))}).catch(a)}))}registerMethod(){this._isMethodRegistered||(this._agm.register($A,async e=>{try{return{prevent:(await Promise.all(this._registry.execute("onShuttingDown",e))).some(r=>r.prevent)}}catch{}}),this._isMethodRegistered=!0)}}function eE(i,e){return new Promise((t,n)=>{i.invoke(Bf,{skipIcon:!0}).then(r=>{var s;const o=r.returned,a=(s=r.returned.configuration)!==null&&s!==void 0?s:{};o||t(a);const c=o.applications;c||t(a),vn(c).map(l=>e.handleAppAdded(l)),t(a)}).catch(r=>n(`Error getting application snapshot: ${r.message}`))})}const tE="OnBranchChanged",nE="OnBranchesModified",iE="OnApplicationAdded",rE="OnApplicationRemoved",sE="OnApplicationChanged",oE="OnApplicationReady",aE="OnApplicationStarted",cE="OnApplicationAgmServerReady",lE="OnApplicationUpdated",uE="OnApplicationStopped",dE="OnApplicationStartFailed";function hE(i,e,t,n){let r,s=!1;return{start:()=>{let c,l;const u=new Promise((p,f)=>{c=p,l=f});return i.subscribe(ey,{arguments:{skipIcon:n},waitTimeoutMs:1e4}).then(p=>{r=p,r.onData(f=>{var w;const y=f.data,S=(w=y.configuration)!==null&&w!==void 0?w:{},O=vn(y[iE]);f.data.isSnapshot?e.handleSnapshotAppsAdded(O):O.forEach(v=>e.handleAppAdded(v)),vn(y[sE]).forEach(v=>e.handleAppUpdated(v)),vn(y[rE]).forEach(v=>e.handleAppRemoved(v)),vn(y[oE]).forEach(v=>e.handleAppReady(v));const _=vn(y[aE]);if(f.data.isSnapshot?e.handleSnapshotInstanceStarted(_):_.forEach(v=>e.handleInstanceStarted(v)),vn(y[dE]).forEach(v=>e.handleInstanceStartFailed(v)),vn(y[uE]).forEach(v=>e.handleInstanceStopped(v)),vn(y[lE]).forEach(v=>e.handleInstanceUpdated(v)),vn(y[cE]).forEach(v=>e.handleInstanceAgmServerReady(v)),vn(y[tE]).forEach(v=>t.handleBranchModified(v)),vn(y[nE]).forEach(v=>t.handleBranchesModified(v)),!s){s=!0;const v=O.some(T=>T.Name===i.instance.application),C=_.some(T=>T.Id===i.instance.instance);if(v)if(C)c(S);else{const T=e.onInstanceStarted(M=>{M.id===i.instance.instance&&(T(),c(S))})}else c(S)}}),r.onFailed(f=>l(f))}).catch(p=>{var f;return l(`Error subscribing for ${ey} stream. Err: ${(f=p.message)!==null&&f!==void 0?f:JSON.stringify(p)}`)}),u},stop:()=>{r&&r.close()}}}const _l="T42.ACS.InMemoryStoreCommand";class pE{constructor(e){this.interop=e}import(e,t){if(!e||!Array.isArray(e))return Promise.reject("invalid apps argument - should be an array of application definitions");if(t&&t!=="replace"&&t!=="merge")return Promise.reject("invalid mode argument - should be 'replace' or 'merge'");t=t??"replace";const n={command:"import",args:{apps:e,mode:t}};return this.interop.invoke(_l,n).then(r=>r.returned)}export(){return this.interop.invoke(_l,{command:"export"}).then(e=>e.returned.apps)}remove(e){if(!e||typeof e!="string")return Promise.reject("invalid app name, should be a string value");const t={command:"remove",args:{apps:[e]}};return this.interop.invoke(_l,t).then(n=>n.returned)}clear(){const e={command:"clear"};return this.interop.invoke(_l,e).then(t=>t.returned)}createAppDef(e,t){return t||(t="https://google.com"),{name:e,type:"window",title:e,details:{url:t}}}}var fE=i=>{if(!i)throw Error("config not set");if(!i.agm)throw Error("config.agm is missing");const e="startOnly",t="skipIcons",n="full",r=i.mode||e;if(r!==e&&r!==t&&r!==n)throw new Error(`Invalid mode for appManager lib - ${r} is not supported`);const s=i.activities,o=i.agm,a=i.logger,c=i.windows;let l={};const u=new YA(r,o,s,c,a.subLogger("applications"),i.gdMajorVersion,()=>l),p=new ZA(o);let f;return r===e?f=eE(o,u):f=hE(o,u,p,r===t).start(),{ready:()=>f.then(y=>{l=y}),applications:u.applications,application:u.application,getConfigurations:u.getConfigurations,onAppAdded:u.onAppAdded,onAppRemoved:u.onAppRemoved,onAppChanged:u.onAppChanged,onAppAvailable:u.onAppAvailable,onAppUnavailable:u.onAppUnavailable,instances:u.instances,get myInstance(){return u.getMyInstance()},get myApplication(){return u.getMyApplication()},onInstanceStarted:u.onInstanceStarted,onInstanceStopped:u.onInstanceStopped,onInstanceUpdated:u.onInstanceUpdated,onInstanceStartFailed:u.onInstanceStartFailed,getRegion:p.getRegion,getBranches:p.getBranches,getCurrentBranch:p.getCurrentBranch,getFunctionalEntitlement:p.getFunctionalEntitlement,getFunctionalEntitlementBranch:p.getFunctionalEntitlementBranch,setCurrentBranch:p.setCurrentBranch,setRegion:p.setRegion,currentUser:p.currentUser,canI:p.canI,canIBranch:p.canIBranch,onBranchesChanged:p.onBranchesChanged,exit:p.exit,restart:p.restart,onShuttingDown:p.onShuttingDown,inMemory:new pE(o)}};let gE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",mE=(i=21)=>{let e="",t=i;for(;t--;)e+=gE[Math.random()*64|0];return e};class ae{static getGDMajorVersion(){if(typeof window>"u"||!window.glueDesktop||!window.glueDesktop.version)return-1;const e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?-1:e}static callbackifyPromise(e,t,n){const r=s=>{let o=s;if(s instanceof Error&&(o=s.message),typeof n=="function"){n(o);return}return Promise.reject(o)};try{return e().then(s=>(typeof t=="function"&&t(s),s)).catch(s=>r(s))}catch(s){return r(s)}}static getMonitor(e,t){return t.map(r=>{const{left:s,top:o,workingAreaWidth:a,workingAreaHeight:c}=r,l=this.calculateTotalOverlap({left:s,top:o,width:a,height:c},e);return{monitor:r,totalOverlap:l}}).sort((r,s)=>s.totalOverlap-r.totalOverlap)[0].monitor}static getDisplayCenterOfScreen(e,t,n){const r=e.width/t.scaleFactor,s=e.height/t.scaleFactor,o=t.workArea.left/n.scaleFactor,a=t.workArea.top/n.scaleFactor,c=t.workArea.width/t.scaleFactor,l=t.workArea.height/t.scaleFactor,u=Math.max((c-r)/2,0),p=Math.max((l-s)/2,0),f=Math.floor(o+u),w=Math.floor(a+p),y=f*n.scaleFactor,S=w*n.scaleFactor;return{left:y,top:S,width:e.width,height:e.height}}static isNode(){if(typeof ae._isNode<"u")return ae._isNode;if(typeof window<"u")return ae._isNode=!1,!1;try{ae._isNode=Object.prototype.toString.call(global.process)==="[object process]"}catch{ae._isNode=!1}return ae._isNode}static generateId(){return mE(10)}static calculateTotalOverlap(e,t){const n=e.left,r=e.top,s=n+e.width,o=r+e.height,a=t.left,c=t.top,l=a+t.width,u=c+t.height,p=Math.max(0,Math.min(s,l)-Math.max(n,a)),f=Math.max(0,Math.min(o,u)-Math.max(r,c));return p*f}}const iy="T42.JumpList.Action";class yE{constructor(){this._groupActionCallbacks=new Map,this._registered=!1}init(e,t,n){this._executor=e,this._agm=t,this._logger=n,this.registerCallbackMethod()}setEnabled(e,t){const n={enabled:t};return this._executor.updateJumpList(e,n)}createCategory(e,t,n){this.validateActions(t,n);const r={category:{title:t,operation:"create",actions:this.toUpdateActions(e,"create",t,n)}};return this._executor.updateJumpList(e,r)}removeCategory(e,t){const n={category:{title:t,operation:"remove",actions:[]}};return this.manageActionCallback(e,n.category.operation,t),this._executor.updateJumpList(e,n)}createActions(e,t,n){this.validateActions(t,n);const r={category:{title:t,operation:"update",actions:this.toUpdateActions(e,"create",t,n)}};return this._executor.updateJumpList(e,r)}removeActions(e,t,n){const r={category:{title:t,operation:"update",actions:this.toUpdateActions(e,"remove",t,n)}};return this._executor.updateJumpList(e,r)}async getActions(e,t){const n=[],s=(await this.getJumpListSettings(e)).categories.find(o=>o.title===t);return s&&s.actions.forEach(o=>{const a=this.getActionCallback(o.callbackId);a&&(o.callback=a.callback),n.push({icon:o.icon,callback:o.callback,singleInstanceTitle:o.singleInstanceTitle,multiInstanceTitle:o.multiInstanceTitle})}),Promise.resolve(n)}getJumpListSettings(e){return this._executor.getJumpList(e)}toUpdateActions(e,t,n,r){return r.map(s=>{const o={icon:s.icon,callback:s.callback,callbackId:ae.generateId(),singleInstanceTitle:s.singleInstanceTitle,multiInstanceTitle:s.multiInstanceTitle,operation:t};return this.manageActionCallback(e,t,n,o),o})}manageActionCallback(e,t,n,r){var s;const o=`${n}-${e}`;if(t==="create")this._groupActionCallbacks.has(o)||this._groupActionCallbacks.set(o,[]),this._groupActionCallbacks.get(o).push({callbackId:r.callbackId,callback:r.callback});else if(t==="remove")if(r){let a=(s=this._groupActionCallbacks.get(o))!==null&&s!==void 0?s:[];a=a.filter(c=>c.callbackId!==r.callbackId),a.length===0?this._groupActionCallbacks.delete(o):this._groupActionCallbacks.set(o,a)}else this._groupActionCallbacks.delete(o)}registerCallbackMethod(){if(!this._registered){this._registered=!0;try{this._agm.register(iy,(e,t)=>{const n=this.getActionCallback(e.callbackId);if(n)try{n.callback()}catch(r){this._logger.error("Unable to execute user callback for jump list action!",r)}})}catch(e){return this._logger.error(`Unable to register method ${iy} for invoking jump list action callbacks!`,e),Promise.reject(e)}}}getActionCallback(e){let t;return[...this._groupActionCallbacks.values()].forEach(n=>{const r=n.find(s=>s.callbackId===e);r&&(t=r)}),t}validateActions(e,t){if(!(t&&t.length>0))throw new Error(`Category '${e}' doesn't contain any actions!`);t.forEach(n=>{if(!n.singleInstanceTitle)throw new Error(`Category '${e}' contains an action with undefined singleInstanceTitle!`);if(!n.multiInstanceTitle)throw new Error(`Category '${e}' contains an action with undefined multiInstanceTitle!`);if(!n.callback)throw new Error(`Category '${e}' contains an action with undefined callback function!`)})}}var Di=new yE;class wE{constructor(){this.waitForTimeoutInMilliseconds=6e4,this._windows={},this._pendingWindows={},this._pendingWindowsStates={},this._registry=pt()}init(e){this._logger=e}get(e){return this._windows[e]||this._pendingWindows[e]}getIfReady(e){return this._windows[e]}get list(){return this._windows}add(e){if(!!this._pendingWindows[e.API.id]){this._logger.error(`trying to add window with id ${e.API.id} from windowStore, which already exists`);return}const n=e.API.windowType==="remote";this._pendingWindows[e.API.id]=e,this._pendingWindowsStates[e.API.id]={ready:!1,urlChanged:n},this._registry.execute("on-added",e)}remove(e){delete this._windows[e.API.id],delete this._pendingWindows[e.API.id],delete this._pendingWindowsStates[e.API.id],this._registry.execute("on-removed",e)}setReadyState(e){const t=this._pendingWindowsStates[e];typeof t>"u"||(t.ready=!0,t.urlChanged&&this.markReadyToShow(e))}setUrlChangedState(e){const t=this._pendingWindowsStates[e];typeof t>"u"||(t.urlChanged=!0,t.ready&&this.markReadyToShow(e))}setCompositionChangedState(e,t){typeof this._pendingWindowsStates[e]>"u"||t===!1&&this.markReadyToShow(e)}waitFor(e){return new Promise((t,n)=>{let r,s;const o=setTimeout(()=>{r(),s(),n(`Window with id "${e}" was not ready within ${this.waitForTimeoutInMilliseconds} milliseconds.`)},this.waitForTimeoutInMilliseconds),a=this._windows[e];if(a)clearTimeout(o),t(a);else{const c=()=>{clearTimeout(o),r(),s()};r=this.onReadyWindow(l=>{l.API.id===e&&(c(),t(l))}),s=this.onRemoved(l=>{l.API.id===e&&(c(),n(`Window with id "${e}" was removed before it became ready.`))})}})}onReadyWindow(e){return this._registry.add("on-ready",e)}onAdded(e){return this._registry.add("on-added",e)}onRemoved(e){return this._registry.add("on-removed",e)}markReadyToShow(e){this._pendingWindows[e]&&(this._windows[e]=this._pendingWindows[e],delete this._pendingWindows[e],delete this._pendingWindowsStates[e]),this._registry.execute("on-ready",this._windows[e])}}var we=new wE;class vE{constructor(e,t){this.windowId=e,this._categoryTitle=t.title}list(){return Di.getActions(this.windowId,this._categoryTitle)}create(e){return Di.createActions(this.windowId,this._categoryTitle,e)}remove(e){return Di.removeActions(this.windowId,this._categoryTitle,e)}}class bE{constructor(e){this.windowId=e}list(){return this.getCategories()}create(e,t){return Di.createCategory(this.windowId,e,t)}remove(e){return Di.removeCategory(this.windowId,e)}async find(e){return(await this.getCategories()).find(n=>n.title===e)}async getCategories(){const e=[];return(await Di.getJumpListSettings(this.windowId)).categories.forEach(n=>{e.push({title:n.title,actions:new vE(this.windowId,n)})}),e}}class _E{constructor(e){this.windowId=e,this._categories=new bE(e)}get categories(){return this._categories}async isEnabled(){return(await Di.getJumpListSettings(this.windowId)).enabled}setEnabled(e){return Di.setEnabled(this.windowId,e)}}var CE=(i,e,t,n,r,s,o,a)=>{var c,l,u,p;const f=pt(),w=()=>{const m=o();if(!m)throw new Error("To use this method you need to enable channels API - set the channels property to true when initializing the Glue42 library");return m},y=i,S=e.name,O=e.mode;let _=e.bounds,v=e.url,C=e.title,T=(c=e.context)!==null&&c!==void 0?c:{},M=e.frameColor,$=e.focus,G=(l=e.neighbours)!==null&&l!==void 0?l:{},E=e.groupId,D=e.isGroupHeaderVisible,A=e.isTabHeaderVisible,x=e.isGroupHibernated,N=e.isGroupVisible,b=(u=e.isTabSelected)!==null&&u!==void 0?u:!1,R=e.settings;const z=e.applicationName;let V=e.isVisible,Q=e.isSticky,H=e.isCollapsed,ne=e.state,J=e.tabGroupId,me=e.tabIndex,ge=e.frameId,ye=e.isLocked,Ee=e.allowWorkspaceDrop,It,gt=(p=e.frameButtons)!==null&&p!==void 0?p:[],yn=e.zoomFactor,_r=e.placementSettings;const io=new _E(i);function ro(m,L){return typeof m>"u"||typeof m=="function"?ae.callbackifyPromise(()=>{if(!i)throw new Error("The window is already closed.");return t.close(U)},m,L):t.close(U,m)}function Cr(m,L,Y){if(typeof L=="function")return ae.callbackifyPromise(()=>{if(Ue(m))throw new Error("The new URL must be a non-empty string.");return t.navigate(U,m)},L,Y);if(Ue(m))throw new Error("The new URL must be a non-empty string.");return t.navigate(U,m,L)}function so(m,L,Y){return ae.callbackifyPromise(()=>{if(!m||Object.keys(m).length===0||Object.keys(m).every(se=>!se))throw new Error("Invalid style arguments: "+JSON.stringify(m));if(m&&m.focus!==void 0){if(typeof m.focus!="boolean")throw new Error("Focus must be a boolean value. Currently, only `focus: true` is supported.");m.focus===!1&&console.warn("`focus: false` is not supported!")}if(m&&m.hidden!==void 0&&typeof m.hidden!="boolean")throw new Error("The `hidden` property must hold a boolean value.");for(const se of["minHeight","maxHeight","minWidth","maxWidth"]){const Ce=m,$e=Ce[se];if(se in m){if(K($e)){delete Ce[se];continue}if(!Jb(Ce[se]))throw new Error(`"${se}" must be a number`)}}return t.setStyle(U,m)},L,Y)}function oo(m,L,Y){return ae.callbackifyPromise(()=>t.resetButtons(U,m),L,Y)}function Sr(){return t.getButtons(U)}function Ir(m,L,Y){return ae.callbackifyPromise(()=>{if(typeof m=="string"){if(m!=="always")throw new Error("`onTop` must hold a `always` value.")}else if(typeof m!="boolean")throw new Error("`onTop` must hold a boolean or `always` value.");return t.setOnTop(U,m)},L,Y)}function hi(m,L,Y){return ae.callbackifyPromise(()=>{if(!m||Object.keys(m).every(se=>se===void 0))throw new Error("The properties of `constraints` cannot be null or undefined.");return t.setSizeConstraints(U,m)},L,Y)}function xr(){return t.getSizeConstraints(U)}function ao(m,L,Y){return ae.callbackifyPromise(()=>{if(K(m))throw new Error("`newTitle` must not be null or undefined.");return m===C?Promise.resolve(U):t.setTitle(U,m)},L,Y)}function co(m,L,Y){return ae.callbackifyPromise(()=>{if(typeof m!="boolean")throw new Error("`isSticky` must hold a boolean value.");return t.setSticky(U,m)},L,Y)}function Mn(m){if(typeof m!="boolean")throw new Error("`allowWorkspaceDrop` must hold a boolean value.");return t.setAllowWorkspaceDrop(U,m)}function jn(m,L,Y){return ae.callbackifyPromise(()=>{if(K(m))throw new Error("The properties of `bounds` cannot be null or undefined.");return t.moveResize(U,m)},L,Y)}function kr(m,L,Y){return ae.callbackifyPromise(()=>{if(typeof m>"u"||Object.keys(m).length===0)throw new Error("Button info is not available.");if(Ue(m.buttonId))throw new Error("`buttonId` must not be null or undefined.");if(Ue(m.imageBase64))throw new Error("`imageBase64` must not be null or undefined.");return t.addFrameButton(U,m)},L,Y)}function Tr(m,L,Y){return ae.callbackifyPromise(()=>{if(Ue(m))throw new Error("`buttonId` must not be null or undefined.");return t.removeFrameButton(U,m)},L,Y)}function st(m,L){return ae.callbackifyPromise(()=>$?Promise.resolve(U):t.activate(U),m,L)}function On(m,L){return ae.callbackifyPromise(()=>$?Promise.resolve(U):t.focus(U),m,L)}function lo(m,L){return ae.callbackifyPromise(()=>t.maximizeRestore(U),m,L)}function Ar(m,L){return ae.callbackifyPromise(()=>ne==="maximized"?Promise.resolve(U):t.maximize(U),m,L)}function Er(m,L){return ae.callbackifyPromise(()=>ne==="normal"?Promise.resolve(U):t.restore(U),m,L)}function Pr(m,L){return ae.callbackifyPromise(()=>ne==="minimized"?Promise.resolve(U):t.minimize(U),m,L)}function uo(m,L){return ae.callbackifyPromise(()=>H?Promise.resolve(U):t.collapse(U),m,L)}function ho(m,L){return ae.callbackifyPromise(()=>H?t.expand(U):Promise.resolve(U),m,L)}function po(m,L){return ae.callbackifyPromise(()=>t.toggleCollapse(U),m,L)}function fo(m,L,Y,se){return ae.callbackifyPromise(()=>{if(K(m))throw new Error(`A target window is not specified - ${typeof m=="string"?m:JSON.stringify(m)}`);if(typeof m=="string"){const Ce=we.get(m);if(!Ce)throw new Error(`Invalid "target" parameter or no such window. Invoked with: ${m}`);m=Ce.API}return typeof L=="string"&&(L={direction:L,autoAlign:!0}),t.snap(U,m,L)},Y,se)}function Nr(m,L,Y,se){return ae.callbackifyPromise(()=>{var Ce;const $e='Invalid "tab" parameter - must be an object with an "id" property or a string. Invoked for source window with ID:';if(K(m)){const ma=`${$e} ${typeof m=="string"?m:JSON.stringify(m)}`;throw new Error(ma)}let zt;if(typeof m=="string"){if(zt=(Ce=we.get(m))===null||Ce===void 0?void 0:Ce.API,K(zt)){const ma=`${$e} ${typeof zt=="string"?zt:JSON.stringify(zt)}`;throw new Error(ma)}}else if(!K(m.id))zt=m;else throw new Error($e);const fs={};return K(L)||(typeof L=="number"?fs.index=L:(fs.selected=L.selected,fs.index=L.index)),t.attachTab(U,zt,fs)},Y,se)}function go(m={},L,Y){return ae.callbackifyPromise(()=>{const se={};function Ce($e){return $e.relativeTo!==void 0}return Ce(m)?(typeof m.relativeTo=="string"?se.relativeTo=m.relativeTo:K(m.relativeTo.id)||(se.relativeTo=m.relativeTo.id),K(m.relativeDirection)||(se.relativeDirection=m.relativeDirection),K(m.width)||(se.width=m.width),K(m.height)||(se.height=m.height)):K(m.bounds)||(se.bounds=m.bounds),K(m.hideTabHeader)||(se.hideTabHeader=m.hideTabHeader),t.detachTab(U,se)},L,Y)}function Rr(m,L,Y){return ae.callbackifyPromise(()=>t.setVisible(U,m),L,Y)}async function pi(m){return m&&an(m),t.center(U,m)}function an(m){if(typeof m!="object")throw Error("display argument must be a valid display object");if(!m.workArea||!m.scaleFactor)throw Error("display argument is not a valid display object")}function fi(m){return t.showLoader(U,m)}function gi(){return t.hideLoader(U)}function mi(m,L,Y){return ae.callbackifyPromise(()=>{if(K(m))throw new Error('"context" must not be null or undefined.');return t.updateContext(U,m,!1)},L,Y)}function cn(m,L){return ae.callbackifyPromise(()=>t.lock(U),m,L)}function mo(m,L){return ae.callbackifyPromise(()=>t.unlock(U),m,L)}function yo(m,L){return ae.callbackifyPromise(()=>t.getIcon(U),m,L)}function wo(m,L,Y){return ae.callbackifyPromise(()=>{if(Ue(m))throw new Error('"base64Image" must be a non-empty string.');return t.setIcon(U,m)},L,Y)}function vo(m,L,Y){return ae.callbackifyPromise(()=>{if(Ue(m))throw new Error('"frameColor" must be a non-empty string');return t.setFrameColor(U,m)},L,Y)}function bo(m,L,Y){return ae.callbackifyPromise(()=>{if(typeof m!="boolean")throw new Error('"toBeTabHeaderVisible" must hold a boolean value.');return t.setTabHeaderVisible(U,m)},L,Y)}async function Mr(m){if(Ue(m))throw new Error(`"${m}" must not be null or undefined`);return t.setTabTooltip(U,m)}async function jr(){return t.getTabTooltip(U)}function xt(m){return t.showPopup(U,m)}function _o(m){return t.createFlydown(U.id,m)}function Co(m){return t.setModalState(U.id,m||!1)}function So(m,L){return ae.callbackifyPromise(()=>t.zoomIn(U),m,L)}function Io(m,L){return ae.callbackifyPromise(()=>t.zoomOut(U),m,L)}function xo(m,L,Y){return ae.callbackifyPromise(()=>{if(isNaN(m))throw new Error("zoomFactor is not a number");return t.setZoomFactor(U,m)},L,Y)}function Je(){return t.showDevTools(U)}function ko(m){return t.capture(U,m)}function To(m,L){const Y={shouldFlash:!0,mode:"auto"};return typeof m=="boolean"&&(Y.shouldFlash=m),typeof L<"u"&&(Y.mode=L),t.flash(U,Y)}function Ao(m){const L={shouldFlash:!0};return typeof m=="boolean"&&(L.shouldFlash=m),t.flashTab(U,L)}function Eo(m){return t.print(U,m)}function Po(m){return t.printToPDF(U,m)}function Wt(m){return new Promise((L,Y)=>{const se=ps((Ce,$e,zt)=>{i===Ce.id&&(se(),L(U))});t.ungroup(U,m).catch(Ce=>{se(),Y(Ce)})})}function No(m){return t.place(U,m)}function Ro(m){return t.refresh(U,m)}function Mo(m,L){return t.download(U,m,L)}function jo(m){return t.configureWindow(U,m)}function Oo(){return t.getWindowConfiguration(U)}function Bt(){return t.getDockingPlacement(U)}function Do(m){return t.dock(U,m)}async function $o(m){return t.clone(U,m)}function Fo(m){if(!ii(m))throw new Error("callback should be a function");return m(U.title,U),Se("onTitleChanged",m)}function Lo(m){if(!ii(m))throw new Error("callback should be a function");return i===void 0&&m(U),f.add("onClose",m)}function Wo(m){return Se("onUrlChanged",m)}function Bo(m){return Se("onFrameButtonAdded",m)}function Or(m){return Se("onFrameButtonRemoved",m)}function Dn(m){return Se("onFrameButtonClicked",m)}function Ho(m){if(!ii(m))throw new Error("callback should be a function");return H&&m(U),f.add("collapsed",m)}function yi(m){if(!ii(m))throw new Error("callback should be a function");return H||m(U),f.add("expanded",m)}function Go(m){return ne==="maximized"?Se("maximized",m,[U]):Se("maximized",m)}function zo(m){return ne==="minimized"?Se("minimized",m,[U]):Se("minimized",m)}function Uo(m){return ne==="normal"?Se("normal",m,[U]):Se("normal",m)}function qo(m){return Se("attached",m)}function Vo(m){return Se("detached",m)}function Jo(m){return Se("visibility-changed",m)}function wi(m){return Se("context-updated",m)}function Ko(m){return Se("lock-changed",m)}function Qo(m){return Se("bounds-changed",m)}function Xo(m){return Se("focus-changed",m)}function Yo(m){return Se("sticky-changed",m)}function Zo(m){return Se("frame-color-changed",m)}function ea(m){return Se("tab-header-visibility-changed",m)}function ta(m){return Se("window-attached",m)}function Dr(m){return Se("window-detached",m)}function ps(m){return Se("group-changed",m)}function na(m){return Se("tab-selection-changed",m)}function $n(m){if(!ii(m))throw new Error("callback must be a function");const L=(Y,se,Ce)=>{const $e=m(Ce);$e!=null&&$e.then?$e.then(Y).catch(se):Y()};return t.onClosing(L,U)}function Ht(m){if(!ii(m))throw new Error("callback must be a function");const L=(Y,se,Ce)=>{const $e=m(Ce);$e!=null&&$e.then?$e.then(Y).catch(se):Y()};return t.onRefreshing(L,U)}function $r(m){if(!ii(m))throw new Error("callback must be a function");const L=(Y,se,Ce,$e)=>{const zt=m($e);zt!=null&&zt.then?zt.then(Y).catch(se):Y()};return t.onNavigating(L,U)}function kt(m){return Se("zoom-factor-changed",m)}function ia(m){return Se("placementSettingsChanged",m)}function ra(m){return Se("neighbours-changed",m)}function sa(m){return Se("docking-changed",m)}function Se(m,L,Y){if(!ii(L))throw new Error("callback must be a function");return f.add(m,L,Y)}function oa(){return t.goBack(U)}function aa(){return t.goForward(U)}function Fr(m){return t.startDrag(U,m)}function Tt(m){if(m!=null&&m.timerDuration&&isNaN(m==null?void 0:m.timerDuration))throw new Error("timerDuration must be a number");if(m!=null&&m.showTimer&&typeof(m==null?void 0:m.showTimer)!="boolean")throw new Error("showTimer must be a boolean");return t.showDialog(U,m)}function ca(m){v=m.url,C=m.title,T=m.context||{},_=m.bounds,M=m.frameColor,$=m.focus,G=m.neighbours||{},E=m.groupId,D=m.isGroupHeaderVisible,A=m.isTabHeaderVisible,x=m.isGroupHibernated,N=m.isGroupVisible,b=m.isTabSelected,R=m.settings,V=m.isVisible,Q=m.isSticky,H=m.isCollapsed,ne=m.state,J=m.tabGroupId,ge=m.frameId,ye=m.isLocked,Ee=m.allowWorkspaceDrop,yn=m.zoomFactor,_r=m.placementSettings}function Lr(m){C=m,t.finished.finally(()=>{f.execute("onTitleChanged",m,U)})}function la(m){v=m,f.execute("onUrlChanged",m,U)}function vi(m){m!==V&&(V=m,f.execute("visibility-changed",U))}function Wr(m){R=m,f.execute("settings-changed",U)}function ua(m){T=m,f.execute("context-updated",T,U)}function da(){i!==void 0&&(f.execute("onClose",U),i=void 0)}function Br(m){const L=["buttonId","imageBase64","order","tooltip"].reduce((se,Ce)=>(se[Ce]=m[Ce],se),{});gt.map(se=>se.buttonId).indexOf(m.buttonId)===-1&&gt.push(L),f.execute("onFrameButtonAdded",L,U)}function ha(m){let L;gt=gt.reduce((Y,se)=>(se.buttonId===m?L=se:Y.push(se),Y),[]),L!==void 0&&f.execute("onFrameButtonRemoved",L,U)}function Fn(m){const L=gt.filter(Y=>Y.buttonId===m.buttonId);L.length>0&&f.execute("onFrameButtonClicked",L[0],U)}async function pa(m){m==="collapsed"?H=!0:m==="expanded"?H=!1:ne=m,await t.finished,f.execute(m,U)}function bi(m){ye=m,f.execute("lock-changed",U)}function fa(m){_.top===m.top&&_.left===m.left&&_.width===m.width&&_.height===m.height||(_=m,f.execute("bounds-changed",U))}function ga(m){$=m,f.execute("focus-changed",U)}function h(m){Q=m,f.execute("sticky-changed",m,U)}function I(m){M=m,f.execute("frame-color-changed",U)}function P(m,L,Y){J=m,ge=L,A=Y,f.execute("frame-attached",U)}function q(m){G=m.neighbors||{},me=m.index,f.execute("neighbours-changed",G,U)}function ve(m){Ee=m,f.execute("allow-workspace-drop-changed",U)}function ke(m){D=m}function Ke(m){A!==m&&(A=m,f.execute("tab-header-visibility-changed",U))}async function Te(m,L){let Y;m===i?(b=!0,Y=U):(b=!1,Y=we.get(m)?we.get(m).API:void 0);const se=we.get(L)?we.get(L).API:void 0;await t.finished,f.execute("tab-selection-changed",Y,se,U)}async function Hr(m,L,Y,se,Ce){J=m,A=Y,ge=L,typeof se<"u"&&(ye=se),await t.finished,Ce.forEach($e=>{$e.Events.handleWindowAttached(U)}),f.execute("attached",U)}function Gt(m){f.execute("window-attached",m)}async function Gr(m,L){J=void 0,b=!1,typeof m<"u"&&(ye=m),await t.finished,L.forEach(Y=>{Y.Events.handleWindowDetached(U)}),f.execute("detached",U)}function zr(m){f.execute("window-detached",m)}function Ur(m){yn=m,f.execute("zoom-factor-changed",U)}function _i(m){let L;const Y=m;if(!Y.display)L=Promise.resolve(void 0);else{const se=s();if(!se)L=Promise.resolve(void 0);else{const Ce=Y.display-1;L=new Promise(($e,zt)=>{se.all().then(fs=>{const ma=fs.find(N_=>N_.index===Ce);$e(ma)}).catch(zt)})}}L.then(se=>{Y.display=se,_r=Y,f.execute("placementSettingsChanged",U)})}function Ln(m){f.execute("docking-changed",U,{docked:m.docked,position:m.position,claimScreenArea:m.claimScreenArea})}function A_(m,L){It=m,E=m==null?void 0:m.id,!K(m)&&!K(L)&&f.execute("group-changed",U,m,L)}function E_(){const m=we.list;return O.toLowerCase()!=="tab"?[]:Object.keys(m).reduce((Y,se)=>{const Ce=m[se];return Ce&&Ce.API.tabGroupId&&typeof Ce.API.tabGroupId<"u"&&typeof U.tabGroupId<"u"&&Ce.API.tabGroupId===U.tabGroupId&&Y.push(Ce.API),Y},[]).sort((Y,se)=>{if(Y.tabIndex!==se.tabIndex){if(Y.tabIndex===-1)return Number.MAX_SAFE_INTEGER;if(se.tabIndex===-1)return Number.MIN_SAFE_INTEGER}return Y.tabIndex-se.tabIndex})}function P_(m){return m.reduce((L,Y)=>{const se=we.get(Y);return se&&L.push(se.API),L},[])}function Gc(m){const L=G[m];if(typeof L<"u")return P_(L)}function Uf(){var m;if(z)return z;if(T._APPLICATION_NAME)return T._APPLICATION_NAME;if(T&&T._t42&&T._t42.application)return T._t42.application;const L=hd();if(L&&L.applicationName)return L.applicationName;const Y=r();if(Y){const se=Y.instances().find(Ce=>i===Ce.id);if(se)return(m=se.application)===null||m===void 0?void 0:m.name}}function hd(){if(typeof window<"u"&&window.glue42gd&&window.glue42gd.getWindowInfo){const m=window.glue42gd.getWindowInfo(i);return m||void 0}}const U={get id(){return y},get name(){return S},get application(){const m=r(),L=Uf();if(L&&m)return m.application(L)},get hostInstance(){return t.hostInstance},get interopInstance(){const m=a.servers().find(L=>L.windowId===this.id);if(m)return m;{const L=Uf();if(L)return{application:L}}},get agmInstance(){return U.interopInstance},get url(){return v},get title(){return C},get windowStyleAttributes(){return R},get settings(){return R},get tabGroupId(){return O.toLowerCase()==="tab"?J:void 0},get tabIndex(){return O.toLowerCase()==="tab"?me:void 0},get frameId(){return ge},get frameButtons(){return gt.sort((m,L)=>m.order-L.order)},get mode(){return O},get state(){return ne},get isCollapsed(){return H},get isVisible(){return V},get isLocked(){return ye},get context(){return T},get bounds(){return _},get minHeight(){return R.minHeight},get maxHeight(){return R.maxHeight},get minWidth(){return R.minWidth},get maxWidth(){return R.maxWidth},get isFocused(){return $},get frameColor(){return M},get opened(){return U.id!==void 0},get group(){return It},get groupId(){return E},get isSticky(){return Q},get topNeighbours(){return Gc("top")},get leftNeighbours(){return Gc("left")},get rightNeighbours(){return Gc("right")},get bottomNeighbours(){return Gc("bottom")},get isGroupHeaderVisible(){return D},get activityId(){if(T._t42)return T._t42.activityId;const m=hd();if(m)return m.activityId},get activityWindowId(){if(T._t42)return T._t42.activityWindowId;const m=hd();if(m)return m.activityWindowId},get windowType(){return e.windowType||"electron"},get zoomFactor(){return yn},get screen(){if(typeof window<"u"&&window.glue42gd)return ae.getMonitor(U.bounds,window.glue42gd.monitors)},get placementSettings(){return Object.assign({},_r)},get jumpList(){return io},get allowWorkspaceDrop(){return Ee},maximize:Ar,restore:Er,minimize:Pr,maximizeRestore:lo,collapse:uo,expand:ho,toggleCollapse:po,focus:On,activate:st,moveResize:jn,setTitle:ao,setStyle:so,setOnTop:Ir,resetButtons:oo,getButtons:Sr,setSizeConstraints:hi,getSizeConstraints:xr,navigate:Cr,addFrameButton:kr,removeFrameButton:Tr,setVisible:Rr,show:()=>Rr(!0),hide:()=>Rr(!1),center:pi,close:ro,snap:fo,showLoader:fi,hideLoader:gi,updateContext:mi,lock:cn,unlock:mo,getIcon:yo,setIcon:wo,setFrameColor:vo,setTabTooltip:Mr,getTabTooltip:jr,attachTab:Nr,detachTab:go,setTabHeaderVisible:bo,showPopup:xt,createFlydown:_o,setModalState:Co,setZoomFactor:xo,zoomIn:So,zoomOut:Io,showDevTools:Je,capture:ko,flash:To,flashTab:Ao,setSticky:co,setAllowWorkspaceDrop:Mn,print:Eo,printToPDF:Po,place:No,ungroup:Wt,refresh:Ro,goBack:oa,goForward:aa,download:Mo,configure:jo,getConfiguration:Oo,getDockingPlacement:Bt,dock:Do,clone:$o,getChannel:async()=>{var m;return(m=(await w().getWindowsWithChannels({windowIds:[y]}))[0])===null||m===void 0?void 0:m.channel},startDrag:Fr,showDialog:Tt,onClose:Lo,onUrlChanged:Wo,onTitleChanged:Fo,onFrameButtonAdded:Bo,onFrameButtonRemoved:Or,onFrameButtonClicked:Dn,onCollapsed:Ho,onExpanded:yi,onMinimized:zo,onMaximized:Go,onNormal:Uo,onAttached:qo,onDetached:Vo,onVisibilityChanged:Jo,onContextUpdated:wi,onLockingChanged:Ko,onBoundsChanged:Qo,onFrameColorChanged:Zo,onFocusChanged:Xo,onStickyChanged:Yo,onGroupChanged:ps,onWindowAttached:ta,onWindowDetached:Dr,onTabSelectionChanged:na,onTabHeaderVisibilityChanged:ea,onClosing:$n,onRefreshing:Ht,onZoomFactorChanged:kt,onPlacementSettingsChanged:ia,onNeighboursChanged:ra,onDockingChanged:sa,onNavigating:$r,get tabs(){return E_()},get isTabHeaderVisible(){return A},get isTabSelected(){return b},getURL(){return Promise.resolve(v)},getTitle(){return Promise.resolve(C)},getBounds(){return Promise.resolve(_)},getContext(){return Promise.resolve(T)},setContext(m){if(K(m))throw new Error('"context" must not be null or undefined, set to empty object if you want to clear it out.');return t.updateContext(U,m,!0)},getDisplay(){return s().getByWindowId(i)},resizeTo(m,L){return jn({width:m,height:L})},moveTo(m,L){return jn({top:m,left:L})},async getParentWindow(){var m;const L=R.parentInstanceId;if(L)return(m=we.list[L])===null||m===void 0?void 0:m.API},async getChildWindows(){return Object.keys(we.list).map(m=>we.list[m].API).filter(m=>m.settings.parentInstanceId===i)},joinChannel:m=>w().join(m,i),leaveChannel:()=>w().leave(i)};return{API:U,Events:{handleUpdate:ca,handleWindowClose:da,handleWindowChangeState:pa,handleTitleChanged:Lr,handleVisibilityChanged:vi,handleUrlChanged:la,handleWindowSettingsChanged:Wr,handleContextUpdated:ua,handleFrameIsLockedChanged:bi,handleBoundsChanged:fa,handleFocusChanged:ga,handleFrameButtonAdded:Br,handleFrameButtonRemoved:ha,handleFrameButtonClicked:Fn,handleFrameColorChanged:I,handleFrameAttached:P,handleFrameSelectionChanged:Te,handleCompositionChanged:q,handleAllowWorkspaceDropChanged:ve,handleGroupHeaderVisibilityChanged:ke,handleTabHeaderVisibilityChanged:Ke,handleGroupChanged:A_,handleAttached:Hr,handleDetached:Gr,handleWindowAttached:Gt,handleWindowDetached:zr,handleZoomFactorChanged:Ur,handleIsStickyChanged:h,handlePlacementSettingsChanged:_i,handleDockingChanged:Ln},GroupCreationArgs:{get isGroupHibernated(){return x},get isGroupVisible(){return N}}}};function ry(i,e){const t=we.list;return Object.keys(t).reduce((n,r)=>{const s=t[r];return s.API.tabGroupId===e&&s.API.id!==i&&n.push(s),n},[])}function sy(i){return!!(!i||Object.keys(i).every(e=>i[e]===void 0))}class SE{constructor(){this.GroupMethodName="T42.Group.Execute",this.WndMethodName="T42.Wnd.Execute",this._registry=pt(),this._finished=Promise.resolve(),this.unsubCallbacks={}}get hostInstance(){return this.agmTarget}get finished(){return this._finished}get configuration(){return this._configuration}init(e,t){this.agm=e,this.agmTarget=t,this._registry.add("event",n=>{n.type==="Closed"&&Object.keys(this.unsubCallbacks).forEach(s=>{s.startsWith(n.windowId)&&delete this.unsubCallbacks[s]})})}setConfiguration(e){this._configuration=e}handleEvent(e){this._registry.execute("event",e)}async open(e){let t;this._finished=new Promise(n=>{t=n});try{const n=await this.agm.invoke("T42.Wnd.Create",e,this.agmTarget);if(n.returned===void 0)throw new Error("failed to execute T42.Wnd.Create - unknown reason");const r=n.returned.id,s=await we.waitFor(r);return(!this.configuration||this.configuration.windowAvailableOnURLChanged)&&setTimeout(()=>{s.API.windowType==="electron"&&s.Events.handleUrlChanged(s.API.url)},0),s.API}finally{t()}}async close(e,t){const n=await this.execute("close",{windowId:e.id,options:t},"Closed");return t?n.closed:e}async navigate(e,t,n){return await this.execute("navigate",{windowId:e.id,options:{url:t,urlLoadOptions:n}},"UrlChanged"),e}async setStyle(e,t){var n;const r=[],s=u=>r.push(u);if(!K(t.focus)&&!e.isFocused&&s(e.focus()),!K(t.hidden)){const u=!t.hidden;s(e.setVisible(u))}if(K(t.onTop)||s(e.setOnTop(t.onTop)),!Ue(t.tabTooltip)||!Ue(t.tabToolTip)){const u=(n=t.tabTooltip)!==null&&n!==void 0?n:t.tabToolTip;s(e.setTabTooltip(u))}Ue(t.tabTitle)||s(this.execute("setTabTitle",{windowId:e.id,options:{tabTitle:t.tabTitle}}));const o={minHeight:t.minHeight,minWidth:t.minWidth,maxHeight:t.maxHeight,maxWidth:t.maxWidth};!sy(o)&&s(e.setSizeConstraints(o));const c={allowClose:t.allowClose,allowCollapse:t.allowCollapse,allowLockUnlock:t.allowLockUnlock,allowMaximize:t.allowMaximize,allowMinimize:t.allowMinimize};return!sy(c)&&s(e.resetButtons(c)),await Promise.all(r),e}async setSizeConstraints(e,t){return await this.execute("setSizeConstraints",{windowId:e.id,options:t}),e}async getSizeConstraints(e){return await this.execute("getSizeConstraints",{windowId:e.id})}async setTabTooltip(e,t){return await this.execute("setTabTooltip",{windowId:e.id,options:{tabTooltip:t}}),e}async getTabTooltip(e){return(await this.execute("getTabTooltip",{windowId:e.id})).tabTooltip}async resetButtons(e,t){return await this.execute("resetButtons",{windowId:e.id,options:t}),e}async getButtons(e){return await this.execute("getButtons",{windowId:e.id})}async setOnTop(e,t){return await this.execute("setOnTop",{windowId:e.id,options:{onTop:t}}),e}async setTitle(e,t){const n={windowId:e.id,options:{title:t}};return await this.execute("setTitle",n,"TitleChanged"),e}async setSticky(e,t){const n={windowId:e.id,options:{isSticky:t}};return await this.execute("setSticky",n),e}async setAllowWorkspaceDrop(e,t){const n={windowId:e.id,options:{allowWorkspaceDrop:t}};return await this.execute("setAllowWorkspaceDrop",n),e}async moveResize(e,t){return typeof window<"u"&&window.glueDesktop.versionNum<31200?new Promise(async(n,r)=>{const s=this.areBoundsEqual(t,e);let o=!1;const a=()=>{o||(o=!0,l&&(l(),l=void 0),n(e),c&&(clearTimeout(c),c=void 0))};let c,l;s||(l=e.onBoundsChanged(u=>{this.areBoundsEqual(t,u)&&a()}));try{await this.execute("moveResize",{windowId:e.id,options:{bounds:t}})}catch(u){r(u);return}if(s){a();return}c=setTimeout(()=>{a()},1e3)}):(await this.execute("moveResize",{windowId:e.id,options:{bounds:t}}),e)}async addFrameButton(e,t){return await this.execute("addButton",{windowId:e.id,options:t},"ButtonAdded"),e}async removeFrameButton(e,t){return await this.execute("removeButton",{windowId:e.id,options:t},"ButtonRemoved"),e}async activate(e){let t,n;try{const r=new Promise((s,o)=>{t=e.onFocusChanged(()=>{s()}),n=e.onClose(()=>{o(new Error("Window was closed"))})});return await Promise.all([this.execute("activate",{windowId:e.id},"FocusChanged"),r]),e}finally{t&&t(),n&&n()}}async focus(e){let t,n;try{const r=new Promise((s,o)=>{t=e.onFocusChanged(()=>{s()}),n=e.onClose(()=>{o(new Error("Window was closed"))})});return await Promise.all([this.execute("focus",{windowId:e.id},"FocusChanged"),r]),e}finally{t&&t(),n&&n()}}async maximizeRestore(e){return await this.execute("maximizeRestore",{windowId:e.id},"StateChanged"),e}async maximize(e){return await this.execute("maximize",{windowId:e.id},"StateChanged"),e}async restore(e){return await this.execute("restore",{windowId:e.id},"StateChanged"),e}async minimize(e){return await this.execute("minimize",{windowId:e.id},"StateChanged"),e}async collapse(e){return await this.execute("collapse",{windowId:e.id},"StateChanged"),e}async expand(e){return await this.execute("expand",{windowId:e.id},"StateChanged"),e}async toggleCollapse(e){return await this.execute("toggleCollapse",{windowId:e.id},"StateChanged"),e}async snap(e,t,n){const r={targetWindowId:t.id};return r.snappingEdge=n.direction,r.autoAlign=n.autoAlign,await this.execute("snap",{windowId:e.id,options:r},"CompositionChanged",`CompositionChanged-${t.id}`),e}async attachTab(e,t,n){return await this.execute("attachTab",{windowId:e.id,options:{index:n,sourceWindowId:t.id,targetWindowId:e.id}},`WindowFrameAdded-${t.id}`,`WindowFrameRemoved-${t.id}`),e}async detachTab(e,t){const n=["WindowFrameRemoved","WindowFrameAdded"];return K(t==null?void 0:t.relativeTo)?n.push("BoundsChanged"):(n.push("CompositionChanged"),n.push(`CompositionChanged-${t.relativeTo}`)),await this.execute("detachTab",{windowId:e.id,options:t},...n),e}async setVisible(e,t=!0){let n;return t?n="show":n="hide",await this.execute(n,{windowId:e.id},"VisibilityChanged"),e}async center(e,t){return await this.execute("center",{windowId:e.id,options:t}),e}async showLoader(e,t){return await this.execute("showLoadingAnimation",{windowId:e.id,options:t}),e}async hideLoader(e){return await this.execute("hideLoadingAnimation",{windowId:e.id}),e}async updateContext(e,t,n){let r;try{const s=this.swapUndefinedToNull(t),o=new Promise((a,c)=>{r=e.onContextUpdated(()=>{a()})});return await Promise.all([this.execute("updateContext",{windowId:e.id,context:s,replace:n}),o]),e}finally{r&&r()}}async lock(e){return await this.execute("lockUnlock",{windowId:e.id,options:{lock:!0}},"FrameIsLockedChanged"),e}async unlock(e){return await this.execute("lockUnlock",{windowId:e.id,options:{lock:!1}},"FrameIsLockedChanged"),e}async getIcon(e){return(await this.execute("getIcon",{windowId:e.id,options:{}})).icon}async setIcon(e,t){return await this.execute("setIcon",{windowId:e.id,options:{dataURL:t}}),e}async setFrameColor(e,t){return await this.execute("setFrameColor",{windowId:e.id,options:{frameColor:t}},"FrameColorChanged"),e}async setTabHeaderVisible(e,t){return await this.execute("setTabHeaderVisible",{windowId:e.id,options:{toShow:t}},"TabHeaderVisibilityChanged"),e}async showGroupPopup(e,t){const n=this.showPopupCore(e,t);await this.executeGroup("showGroupPopup",{groupId:e,options:n})}async showPopup(e,t){const n=this.showPopupCore(e.id,t);return await this.execute("showPopupWindow",{windowId:e.id,options:n}),e}async createFlydown(e,t){if(!t)throw new Error("The options object is not valid!");const n={...t};n.horizontalOffset||(n.horizontalOffset=0),n.verticalOffset||(n.verticalOffset=0);const r=this.reformatFlydownOptions(e,n);return this.execute("setFlydownArea",{windowId:e,options:r}).then(()=>{const s=r.zones.map(o=>o.id);return r.zones.forEach(o=>{let a=typeof o.flydownSize=="function"?o.flydownSize:()=>o.flydownSize;t.size instanceof Function&&o.flydownSize&&(a=async(c,l)=>{let u;return t.size instanceof Function&&(u=await t.size(c,l)),o.flydownSize instanceof Function&&o.flydownSize!==t.size?await o.flydownSize(c,l)||u:u||o.flydownSize}),this._registry.clearKey(`${r.targetId}_${o.id}`),this._registry.add(`${r.targetId}_${o.id}`,a)}),{destroy:()=>this.clearFlydownArea(r.targetId,s),options:n}})}async setModalState(e,t){return this.execute("setModalState",{windowId:e,options:{isModal:t}})}async autoArrange(e){return this.execute("autoArrange",{options:{displayId:e}})}async handleFlydownBoundsRequested(e,t){const n=()=>t.cancel=!0,r={zoneId:t.flydownId,flydownWindowBounds:t.flydownWindowBounds,flydownWindowId:t.flydownWindowId},s=await Promise.all(this._registry.execute(`${e}_${t.flydownId}`,r,n));if(s.length===1){const o={height:0,width:0,top:0,left:0},a=typeof s[0]=="object"&&!Array.isArray(s[0])?s[0]:o;return{...t,flydownWindowBounds:a}}}async handleOnEventRequested(e,t){var n;const r=(n=this.unsubCallbacks[e])!==null&&n!==void 0?n:[];let s=!1;const o=[];return await Promise.all(r.map(a=>new Promise((c,l)=>{a(()=>{c()},()=>{l()},u=>{s=!0,o.push(u)},t)}))),{prevented:s,preventArgs:o}}async zoomIn(e){return await this.execute("zoomIn",{windowId:e.id}),e}async zoomOut(e){return await this.execute("zoomOut",{windowId:e.id}),e}async setZoomFactor(e,t){return await this.execute("setZoomFactor",{windowId:e.id,options:{zoomFactor:t}}),e}async showDevTools(e){return await this.execute("showDevTools",{windowId:e.id}),e}async capture(e,t){return(await this.execute("captureScreenshot",{windowId:e.id,options:{...t}})).data}async captureGroup(e,t){return(await this.execute("captureGroupScreenshot",{windowId:e[0],options:{groupWindowIds:e,...t}})).data}async flash(e,t){return await this.execute("flash",{windowId:e.id,options:{...t}}),e}async flashTab(e,t){return await this.execute("flashTab",{windowId:e.id,options:{...t}}),e}async configure(e,t){return this.execute("configure",{windowId:e,options:{...t}})}async print(e,t){return await this.execute("print",{windowId:e.id,options:{...t}}),e}async printToPDF(e,t){return(await this.execute("printToPDF",{windowId:e.id,options:{...t}})).filePath}async place(e,t){const n={...t};return(!t.display||t.display==="current")&&(n.display=await e.getDisplay()),n.display&&typeof n.display!="string"&&typeof n.display!="number"&&(n.display=n.display.index+1),this.execute("place",{windowId:e.id,options:{...n}})}async refresh(e,t){return await this.execute("refresh",{windowId:e.id,options:{ignoreCache:t}}),e}async download(e,t,n={}){n.enableDownloadBar=!n.silent;const r=await this.execute("downloadURL",{windowId:e.id,options:{url:t,options:n}});return{url:t,path:r.fullPath,size:r.fileSize}}async configureWindow(e,t){return await this.execute("configureWindow",{windowId:e.id,options:t}),e}async getWindowConfiguration(e){return await this.execute("getWindowConfiguration",{windowId:e.id})}async startDrag(e,t){return await this.execute("startDrag",{windowId:e.id,options:t}),e}showDialog(e,t){return new Promise((n,r)=>{const s=ae.generateId(),o=this._registry.add("event",a=>{if(a.type==="DialogResult"&&a.windowId===e.id&&a.data.token===s){o();const c=a.data;"status"in c&&(c.status==="failed"?r(c.message):c.status==="successful"&&n(c.result))}});this.execute("showDialog",{windowId:e.id,options:Object.assign({},{...t},{token:s})})})}async execute(e,t,...n){return this.executeCore(this.WndMethodName,e,t,...n)}async executeGroup(e,t,...n){return this.executeCore(this.GroupMethodName,e,t,...n)}async ungroup(e,t){const n={windowId:e.id,options:t};return await this.execute("ungroup",n),e}async updateJumpList(e,t){const n={windowId:e,options:t};await this.execute("updateJumplist",n)}async getJumpList(e){const t={windowId:e};return await this.execute("getJumplist",t)}onClosing(e,t){const n=typeof window<"u"&&window.glue42gd;return n&&t.windowType==="electron"?n.addCloseHandler(e,t.id):this.nonWindowHandlers(e,t.id,"OnClosing")}onGroupClosing(e,t){return this.nonWindowHandlersCore(t.id,"OnClosing",!0,e)}onRefreshing(e,t){const n=typeof window<"u"&&window.glue42gd;return n&&t.windowType==="electron"?n.addRefreshHandler(e,t.id):this.nonWindowHandlers(e,t.id,"OnRefreshing")}onNavigating(e,t){const n=typeof window<"u"&&window.glue42gd;return n&&t.windowType==="electron"?n.addWillNavigateHandler(e,t.id):this.nonWindowHandlers(e,t.id,"OnNavigating")}async clone(e,t){const n={windowId:e.id,options:t},r=await this.execute("clone",n);return(await we.waitFor(r.id)).API}async goBack(e){await this.execute("goBack",{windowId:e.id})}async goForward(e){await this.execute("goForward",{windowId:e.id})}async getDockingPlacement(e){return this.execute("getDockingPlacement",{windowId:e.id})}dock(e,t){return this.execute("dock",{windowId:e.id,options:t})}clearCallbacks(e){Object.keys(this.unsubCallbacks).forEach(n=>{n.startsWith(e)&&delete this.unsubCallbacks[n]})}nonWindowHandlers(e,t,n){return this.nonWindowHandlersCore(t,n,!1,e)}nonWindowHandlersCore(e,t,n,r){const s=`${e}-${t}`,o=()=>{var a;if(this.unsubCallbacks[s]){const l=this.unsubCallbacks[s];this.unsubCallbacks[s]=l.filter(u=>u!==r),this.unsubCallbacks[s].length===0&&delete this.unsubCallbacks[s]}if(((a=this.unsubCallbacks[s])!==null&&a!==void 0?a:[]).length===0){const l={unsubscribe:!0};n?this.executeGroup(t,{groupId:e,options:l}):this.execute(t,{windowId:e,options:l})}};return this.unsubCallbacks[s]?(this.unsubCallbacks[s].push(r),o):(this.unsubCallbacks[s]=[r],n?this.executeGroup(t,{groupId:e}):this.execute(t,{windowId:e}),o)}reformatFlydownOptions(e,t){const n=(s,o)=>{if(t[o]&&(s[o]===void 0||s[o]===null)){const a=t[o];s[o]=a}},r=t.zones.map(s=>(n(s,"windowId"),n(s,"targetLocation"),t.size&&(s.flydownSize===void 0||s.flydownSize===null)&&(s.flydownSize=t.size),s.flydownBounds=s.flydownSize,s.flydownId=s.windowId,s.targetLocation||(s.targetLocation="bottom"),s));return{...t,zones:r,targetId:e,flydownBounds:t.size,flydownActiveArea:t.activeArea}}clearFlydownArea(e,t){return this.execute("clearFlydownWindowArea",{windowId:e,options:{}}).then(()=>{t.forEach(n=>{this._registry.clearKey(`${e}_${n}`)})})}executeWithoutToken(e,...t){const n=[],r=t==null?void 0:t.filter(o=>!K(o)).map(o=>new Promise(a=>{const[c,l=e.windowId]=o.split("-");n.push(this._registry.add("event",u=>{u.type===c&&u.windowId===l&&a()}))})),s=new Promise((o,a)=>{this.agm.invoke("T42.Wnd.Execute",e,this.agmTarget).then(c=>{c.returned&&c.returned.errorMsg?a(c):o(c.returned)}).catch(c=>a(c))});return Promise.all([s,...r]).then(o=>o[0]).finally(()=>{n.forEach(o=>o())})}async executeCore(e,t,n,...r){const s={...n,command:t};let o;this._finished=new Promise(a=>{o=a});try{return typeof window<"u"&&window.glueDesktop.versionNum<31200?await this.executeWithoutToken(s,...r):await this.executeWithToken(e,s)}finally{o()}}async executeWithToken(e,t){let n;try{const r=ae.generateId(),s=new Promise(c=>{n=this._registry.add("event",l=>{l.token===r&&c()})}),o=new Promise((c,l)=>{t.token=r,this.agm.invoke(e,t,this.agmTarget).then(u=>{u.returned&&u.returned.errorMsg?l(u):c(u.returned)}).catch(u=>{l(u)})});return(await Promise.all([o,s]))[0]}finally{n&&n()}}areBoundsEqual(e,t){const n=t.bounds,r=t.settings;let s=e.height,o=e.width;e.height<r.minHeight&&(s=r.minHeight),e.height>r.maxHeight&&(s=r.maxHeight),e.width<r.minWidth&&(o=r.minWidth),e.width>r.maxWidth&&(o=r.maxWidth);const a=s?n.height===s:!0,c=o?n.width===o:!0,l=e.left?n.left===e.left:!0,u=e.top?n.top===e.top:!0;return a&&c&&l&&u}swapUndefinedToNull(e){try{const t={};for(const n of Object.keys(e)){let r=e[n];typeof r>"u"&&(r=null),t[n]=r}return t}catch{return e}}showPopupCore(e,t){if(!t)throw new Error("The options object is not valid!");const n={...t};return n.targetLocation||(n.targetLocation="bottom"),{...n,popupBounds:n.size,targetId:e,popupId:n.windowId}}}var Zt=new SE;class oy{constructor(e,t,n,r,s,o,a){this._registry=pt(),this._waitTimeout=1e4,this._agm=e,this._logger=t.subLogger("gd-env"),this._windowId=o,this._groupId=a,this._appManagerGetter=n,this._displayAPIGetter=r,this._channelsAPIGetter=s}init(){return new Promise((e,t)=>{this._agm.register("T42.Wnd.OnEventWithResponse",(n,r)=>this.respondToEvent(n)),new Promise((n,r)=>{this._agm.subscribe("T42.Wnd.OnEvent",{waitTimeoutMs:this._waitTimeout,target:"best",arguments:{withConfig:!0},onData:s=>{if(s.data.type==="Configuration"){this._configuration=s.data,Zt.setConfiguration(this._configuration);return}this.updateWindow(s.data,e),Zt.handleEvent(s.data)},onConnected:s=>{this._agmInstance=s,Zt.init(this._agm,this._agmInstance)}}).catch(s=>{var o;const a=`${(o=s==null?void 0:s.method)===null||o===void 0?void 0:o.name} - ${JSON.stringify(s==null?void 0:s.called_with)} - ${s==null?void 0:s.message}`;t(new Error(a))})})})}get executor(){return Zt}open(e,t,n){n=n||{};const r={...n};return r.relativeTo!==void 0&&typeof r.relativeTo!="string"&&(r.relativeTo=r.relativeTo.id||""),r.name=e,r.url=t,r.windowState=n.windowState||n.state,delete r.state,this.executor.open(r)}createFlydown(e,t){return this.executor.createFlydown(e,t)}async showPopup(e,t){const n=we.get(e);await this.executor.showPopup(n.API,t)}tabAttached(e){return this._registry.add("tab-attached",e)}tabDetached(e){return this._registry.add("tab-detached",e)}onWindowFrameColorChanged(e){return this._registry.add("frame-color-changed",e)}onEvent(e){return this._registry.add("window-event",e)}my(){return this._windowId}myGroup(){return this._groupId}execute(e,t,n){return this._agm.invoke("T42.Wnd.Execute",{command:e,options:n,windowId:t})}onCompositionChanged(e){return this._registry.add("composition-changed",e)}onGroupHeaderVisibilityChanged(e){return this._registry.add("group-header-changed",e)}onGroupVisibilityChanged(e){return this._registry.add("group-visibility-changed",e)}onGroupStateChanged(e){return this._registry.add("group-state-changed",e)}onWindowGotFocus(e){return this._registry.add("got-focus",e)}onWindowLostFocus(e){return this._registry.add("lost-focus",e)}onWindowsAutoArrangeChanged(e){return this._registry.add("windows-auto-arranged-changed",e)}respondToEvent(e){return e.type==="ShowFlydownBoundsRequested"?this.executor.handleFlydownBoundsRequested(e.data.windowId,e.data):e.type==="OnClosing"||e.type==="OnRefreshing"||e.type==="OnNavigating"?this.executor.handleOnEventRequested(e.data.callbackId,e.data.args):Promise.reject(`There isn't a handler for ${e.type}`)}updateWindow(e,t){var n;const r=this.getExtendedStreamEvent(e);if(e.type==="Snapshot"){e.windows.forEach(l=>{const u=we.get(l.id);if(u)u.Events.handleUpdate(this.mapToWindowConstructorOptions(l)),u.GroupCreationArgs=this.mapToGroupCreationArgs(l);else{const p=this.createWindow(l.id,l);we.markReadyToShow(p.API.id)}this._registry.execute("window-event",r)}),t(this);return}if(e.type==="CommandExecuted"){this._registry.execute("window-event",r);return}if(e.type==="Created"){const c=e,l=this.createWindow(c.windowId,c.data||{});we.setReadyState(l.API.id),this._registry.execute("window-event",r);return}if(e.type==="OnGroupVisibilityChanged"){const c=e;this._registry.execute("group-visibility-changed",c.data),this._registry.execute("window-event",e);return}if(e.type==="OnGroupStateChanged"){const c=e;this._registry.execute("group-state-changed",c.data),this._registry.execute("window-event",e);return}if(e.type==="OnWindowsAutoArrangeChanged"){const c=e;this._registry.execute("windows-auto-arranged-changed",c.data),this._registry.execute("window-event",e);return}const s=we.get(e.windowId);if(!s){this._logger.error(`received update for unknown window. Stream:', ${JSON.stringify(e,null,4)}`);return}const o=s.API,a=s.Events;if(e.type==="BoundsChanged"){const c=e;a.handleBoundsChanged(c.data)}if(e.type==="UrlChanged"){const c=e;we.setUrlChangedState(c.windowId),a.handleUrlChanged(c.data)}if(e.type==="TitleChanged"){const c=e;a.handleTitleChanged(c.data)}if(e.type==="IsStickyChanged"){const c=e;a.handleIsStickyChanged(c.data)}if(e.type==="VisibilityChanged"&&a.handleVisibilityChanged(e.data),e.type==="ContextChanged"&&a.handleContextUpdated(e.data),e.type==="StateChanged"&&a.handleWindowChangeState(e.data),e.type==="FrameColorChanged"&&(a.handleFrameColorChanged(e.data),this._registry.execute("frame-color-changed",o)),e.type==="CompositionChanged"){const c=e;a.handleCompositionChanged(c.data),we.setCompositionChangedState(c.data.windowId,(n=this._configuration)===null||n===void 0?void 0:n.windowAvailableOnURLChanged),this._registry.execute("composition-changed",c.data)}if(e.type==="GroupHeaderVisibilityChanged"){const c=e;a.handleGroupHeaderVisibilityChanged(c.data.groupHeaderVisible),this._registry.execute("group-header-changed",c.data)}if(e.type==="FocusChanged"){const c=e;this.focusChanged(a,o,c.data)}if(e.type==="WindowFrameChanged"&&(a.handleFrameAttached(e.data.frameId,e.data.frameId,e.data.isTabHeaderVisible),this._registry.execute("frame-changed")),e.type==="WindowFrameAdded"){const c=ry(o.id,e.data.frameId),l=e.data;a.handleAttached(l.frameId,l.frameId,l.isTabHeaderVisible,l.isLocked,c).then(async()=>{c.length>0&&(await Zt.finished,this._registry.execute("tab-attached",o,e.data.frameId,e.data.isTabHeaderVisible))})}if(e.type==="WindowFrameRemoved"){const c=o.tabGroupId,l=ry(o.id,c);a.handleDetached(e.data.isLocked,l).then(async()=>{l.length>0&&(await Zt.finished,this._registry.execute("tab-detached",o,e.data.frameId,o.tabGroupId))})}e.type==="TabHeaderVisibilityChanged"&&a.handleTabHeaderVisibilityChanged(e.data.isTabHeaderVisible),e.type==="FrameSelectionChanged"&&a.handleFrameSelectionChanged(e.data.newWindowId,e.data.prevWindowId),e.type==="ButtonClicked"&&a.handleFrameButtonClicked(e.data),e.type==="ButtonAdded"&&a.handleFrameButtonAdded(e.data),e.type==="ButtonRemoved"&&a.handleFrameButtonRemoved(e.data),e.type==="WindowZoomFactorChanged"&&a.handleZoomFactorChanged(e.data),e.type==="Closed"&&(we.remove(s),a.handleWindowClose()),e.type==="FrameIsLockedChanged"&&a.handleFrameIsLockedChanged(e.data),e.type==="PlacementSettingsChanged"&&a.handlePlacementSettingsChanged(e.data),e.type==="DockingChanged"&&a.handleDockingChanged(e.data),e.type==="AllowWorkspaceDropChanged"&&a.handleAllowWorkspaceDropChanged(e.data),this._registry.execute("window-event",r)}createWindow(e,t){const n=CE(e,this.mapToWindowConstructorOptions(t),Zt,this._logger,this._appManagerGetter,this._displayAPIGetter,this._channelsAPIGetter,this._agm);return n.GroupCreationArgs=this.mapToGroupCreationArgs(t),we.add(n),n}async focusChanged(e,t,n){e.handleFocusChanged(n);try{this._configuration.windowAvailableOnURLChanged||await we.waitFor(t.id)}catch{return}n?this._registry.execute("got-focus",t):this._registry.execute("lost-focus",t)}mapToWindowConstructorOptions(e){return{name:e.name,context:e.context,bounds:e.bounds,url:e.url,title:e.title,isVisible:e.isVisible,focus:e.isFocused,state:e.state,frameColor:e.frameColor,groupId:e.groupId,neighbours:e.neighbors,isFocused:e.isFocused,isGroupHeaderVisible:e.groupHeaderVisible,isCollapsed:e.isCollapsed,tabGroupId:e.frameId,frameId:e.frameId,mode:e.mode,isTabHeaderVisible:e.isTabHeaderVisible,isTabSelected:e.isActiveTab,settings:e.settings,windowType:e.windowType,zoomFactor:e.zoomFactor,isLocked:e.isLocked,placementSettings:e.placementSettings,isSticky:e.isSticky,tabIndex:e.tabIndex,frameButtons:e.frameButtons,jumpListOptions:e.jumpList,applicationName:e.applicationName,allowWorkspaceDrop:e.allowWorkspaceDrop}}mapToGroupCreationArgs(e){return{isGroupHibernated:e.isGroupHibernated,isGroupVisible:e.isGroupVisible}}getExtendedStreamEvent(e){try{if(!e.windowId)return e;const t=we.get(e.windowId);if(!t)return e;const n={state:e.type,windowName:t.API.name,...e};return n.state==="WindowFrameAdded"&&(n.state="TabAttached"),n.state==="StateChanged"&&(n.state=n.data.charAt(0).toUpperCase()+n.data.slice(1)),n.state==="ButtonAdded"&&(n.state="FrameButtonAdded"),n.state==="ButtonRemoved"&&(n.state="FrameButtonRemoved"),n}catch{return e}}}var IE=(i,e,t,n,r,s)=>{var o;const a=e;if(s===2)throw a.trace("running in HC"),new Error("GD2 not supported");return s>=3?(a.trace("running in GD 3"),new oy(i,a,t,n,r,window.glue42gd.windowId,(o=window.webGroupsManager)===null||o===void 0?void 0:o.id).init()):new oy(i,a,t,n,r).init()},xE=(i,e)=>{const t=pt(),n=[];let r,s;async function o(D){var A,x,N,b;if(n.indexOf(D)===-1){n.push(D);const R=we.get(D);R.Events.handleGroupChanged(G,void 0),r=(x=(A=R.GroupCreationArgs.isGroupHibernated)!==null&&A!==void 0?A:r)!==null&&x!==void 0?x:!1,s=(b=(N=R.GroupCreationArgs.isGroupVisible)!==null&&N!==void 0?N:s)!==null&&b!==void 0?b:!0,await e.finished,t.execute("window-added",G,R.API)}}async function a(D){const A=n.indexOf(D.API.id);A!==-1&&(n.splice(A,1),D.Events.handleGroupChanged(void 0,G),await e.finished,t.execute("window-removed",G,D.API))}function c(D,A,x){let N;typeof D=="string"?N=D:K(D)||(N=D.id);const b=S(N);if(b)return typeof A=="function"&&A(b),b;typeof x=="function"&&x(`No window with ID: ${N}`)}function l(D){return y()}async function u(D,A,...x){return await e.execute(D,A,...x),G}function p(D){t.execute("header-visibility-changed",G)}function f(D){s=D,t.execute("group-visibility-changed",G)}function w(D){r=D}function y(){const D=[];return n.forEach(A=>{const x=S(A);typeof x<"u"&&D.push(x)}),D}function S(D){return we.get(D)?we.get(D).API:void 0}function O(){return y().find(x=>!x.isGroupHeaderVisible)===void 0}function _(){return r}function v(D){return t.add("header-visibility-changed",D)}function C(D){return t.add("window-added",D)}function T(D){return t.add("window-removed",D)}function M(D){if(!D)throw new Error("Callback argument is required");if(D&&typeof D!="function")throw new Error("Callback argument must be a function");return t.add("group-visibility-changed",D)}function $(D){if(typeof D!="function")throw new Error("callback must be a function");const A=(x,N,b)=>{const R=D(b);R!=null&&R.then?R.then(x).catch(N):x()};return e.onGroupClosing(A,G)}const G={id:i,get windows(){return l()},find:c,get isHeaderVisible(){return O()},get isHibernated(){return _()},get isVisible(){return s},showHeader:(D,A)=>ae.callbackifyPromise(()=>u("setGroupHeaderVisibility",{windowId:n[0],options:{toShow:!0}},...n.map(x=>`GroupHeaderVisibilityChanged-${x}`)),D,A),hideHeader:(D,A)=>ae.callbackifyPromise(()=>u("setGroupHeaderVisibility",{windowId:n[0],options:{toShow:!1}},...n.map(x=>`GroupHeaderVisibilityChanged-${x}`)),D,A),getTitle:async()=>(await e.execute("getGroupTitle",{windowId:n[0]})).title,setTitle:async D=>{if(Ue(D))throw new Error("`title` must not be null or undefined.");return u("setGroupTitle",{windowId:n[0],options:{title:D}})},capture:D=>e.captureGroup(n,D),maximize:(D,A)=>ae.callbackifyPromise(()=>u("maximizeGroup",{windowId:n[0]},...n.map(x=>`StateChanged-${x}`)),D,A),restore:(D,A)=>ae.callbackifyPromise(()=>u("restoreGroup",{windowId:n[0]},...n.map(x=>`StateChanged-${x}`)),D,A),show:D=>{if(!K(D)&&!Pu(D))throw new Error("Activate flag must be a boolean!");return D=K(D)?!0:D,e.executeGroup("showGroup",{groupId:i,options:{activate:D}})},hide:()=>e.executeGroup("hideGroup",{groupId:i}),close:()=>e.executeGroup("closeGroup",{groupId:i}),showPopup:D=>e.showGroupPopup(i,D),onHeaderVisibilityChanged:v,onWindowAdded:C,onWindowRemoved:T,onVisibilityChanged:M,onClosing:$};return{groupAPI:G,groupInternal:{get windows(){return n},addWindow:o,removeWindow:a,handleGroupHeaderVisibilityChanged:p,handleGroupVisibilityChanged:f,handleGroupHibernateChanged:w}}},kE=(i,e)=>{const t=pt(),n={};let r=-1;const s=we.list;Object.keys(s).forEach(b=>{const R=s[b],z=R.API.groupId,V=R.API.id;Ue(z)||$(z,V)}),we.onRemoved(b=>{const R=A(b.API);G(R,b)}),i.onCompositionChanged(b=>{E(b)}),i.onGroupHeaderVisibilityChanged(b=>{const R=b.windowId,z=u(R);if(typeof z<"u"){const V=n[z.id];r===-1&&(r=z.windows.length),r--,r===0&&(r=-1,V.groupInternal.handleGroupHeaderVisibilityChanged(b))}}),i.onGroupVisibilityChanged(b=>{const R=n[b.groupId];R&&R.groupInternal.handleGroupVisibilityChanged(b.visible)}),i.onGroupStateChanged(b=>{const R=n[b.groupId];b.state==="hibernated"?(R!=null&&R.groupAPI&&R.groupInternal.handleGroupHibernateChanged(!0),t.execute("group-hibernated",b.groupId)):b.state==="resumed"&&(R!=null&&R.groupAPI&&R.groupInternal.handleGroupHibernateChanged(!1),t.execute("group-resumed",R.groupAPI))});function o(){var b;return u((b=i.myGroup())!==null&&b!==void 0?b:i.my())}async function a(b){if(K(b))throw new Error("options must be defined");if(K(b.groups)||!Array.isArray(b.groups)||b.groups.length===0)throw new Error("options.groups must be defined");const{groupIds:R}=await Zt.executeGroup("createGroups",{options:b}),z=R.map(V=>p(V));return Promise.all(z)}async function c(b,R){if(K(b))throw new Error("group must be defined");let z="";if(typeof b=="string"?z=b:z=b.id,K(R))throw new Error("options must be defined");await Zt.executeGroup("closeGroup",{groupId:z,options:R})}function l(b){const R=Object.keys(n).map(z=>{if(n[z])return n[z].groupAPI});return typeof b=="function"&&b(R),R}function u(b,R,z){let V;typeof b=="string"?V=b:K(b)||(V=b.id);const Q=Object.values(n).find(H=>H.groupAPI.windows.filter(me=>me.id===V).length);if(Q)return typeof R=="function"&&R(Q.groupAPI),Q.groupAPI;typeof z=="function"&&z("Cannot find the group of the window.")}function p(b){return b?new Promise((R,z)=>{const V=n[b];if(V)R(V.groupAPI);else{const Q=S(H=>{H.id===b&&(Q(),R(H))})}}):Promise.reject(new Error("groupId must be defined"))}function f(){var b;return p((b=i.myGroup())!==null&&b!==void 0?b:i.my())}async function w(b,R){if(!K(R)&&!Pu(R))throw new Error("Activate flag must be a boolean!");R=K(R)?!0:R,await Zt.executeGroup("resumeGroup",{groupId:b,options:{activate:R}})}async function y(b){return await Zt.executeGroup("hibernateGroup",{groupId:b}),b}function S(b){return t.add("group-added",b)}function O(b){return t.add("group-removed",b)}function _(b){return t.add("window-moved",b)}function v(b){if(!b)throw new Error("Callback argument is required");if(b&&typeof b!="function")throw new Error("Callback argument must be a function");return t.add("group-hibernated",b)}function C(b){if(!b)throw new Error("Callback argument is required");if(b&&typeof b!="function")throw new Error("Callback argument must be a function");return t.add("group-resumed",b)}function T(b){if(n.hasOwnProperty(b))return n[b];{const R=xE(b,i.executor);n[b]=R;const z=R.groupAPI;return t.execute("group-added",z),R}}function M(b){const R=b.groupAPI;R.windows.length===0&&(delete n[R.id],Zt.clearCallbacks(R.id),t.execute("group-removed",R))}function $(b,R){const z=T(b);return z.groupInternal.addWindow(R),z}function G(b,R){b&&(b.groupInternal.removeWindow(R),M(b))}function E(b){const R=b.groupId,z=b.windowId,V=we.get(z);if(!V)return;const Q=A(V.API);if(K(R)){G(Q,V);return}if(K(Q)&&!K(R)){$(R,V.API.id);return}Q.groupAPI.id!==R&&D(V,Q.groupAPI.id,R)}function D(b,R,z){const V=b.API.id,Q=n[R];G(Q,b);const H=$(z,V);b.Events.handleGroupChanged(H.groupAPI,Q.groupAPI),t.execute("window-moved",V,R,z)}function A(b){let R;return typeof b=="string"?R=b:K(b)||(R=b.id),Object.values(n).find(z=>z.groupInternal.windows.filter(H=>H===R).length)}return{groupsAPI:{get my(){return o()},create:a,close:c,list:l,findGroupByWindow:u,waitForGroup:p,getMyGroup:f,onGroupAdded:S,onGroupRemoved:O,hibernate:y,resume:w,onHibernated:v,onResumed:C},groupsEvents:{onWindowMoved:_}}},TE=(i,e,t,n,r,s)=>{const o=pt(),a=e;let c,l;we.init(a);const u=new Promise((V,Q)=>{IE(i,a,t,n,r,s).then(H=>{l=H,c=kE(H),Di.init(H.executor,i,a),V()}).catch(H=>{const ne=`Timed out waiting for connection to Glue42 Enterprise: Error: ${H.message}`;a.error(ne,H),Q(new Error(ne))})});function p(){return u}function f(){const V=we.getIfReady(l.my());return V?V.API:void 0}function w(V,Q,H,ne,J){return ae.callbackifyPromise(()=>{if(Ue(V))throw new Error("The window name is missing.");if(Ue(Q))throw new Error("The window URL is missing.");if(!K(H)){const me=H;for(const ge of["minHeight","maxHeight","minWidth","maxWidth","width","height","top","left"])if(ge in me){const ye=me[ge];if(K(ye)){delete me[ge];continue}if(!Jb(ye)){const Ee=`${ge} must be a number`;throw new Error(Ee)}if((me[ge]==="width"||me[ge]==="height")&&ye<=0){const Ee=`${ge} must be a positive number`;throw new Error(Ee)}}}return l.open(V,Q,H)},ne,J)}function y(V,Q,H){const ne=we.list,J=Object.keys(ne).reduce((ge,ye)=>{var Ee;const It=ne[ye];return((Ee=It==null?void 0:It.API)===null||Ee===void 0?void 0:Ee.name)===V&&ge.push(It.API),ge},[]);if(J[0])return typeof Q=="function"&&Q(J[0]),J[0];typeof H=="function"&&H("There is no window with name:"+V)}function S(V,Q,H){const ne=we.list,J=Object.keys(ne).reduce((ge,ye)=>{const Ee=ne[ye];return typeof Ee<"u"&&Ee.API.id===V&&ge.push(Ee.API),ge},[]);if(J[0])return typeof Q=="function"&&Q(J[0]),J[0];typeof H=="function"&&H("There is no window with such id:"+V)}function O(V){const Q=we.list,H=Object.keys(Q).map(ne=>Q[ne].API);if(typeof V!="function")return H;V(H)}function _(V){const Q=f(),H=Q?Q.id:"";return Zt.configure(H,V)}function v(V){return Zt.autoArrange(V)}function C(V){return o.add("window-added",V)}function T(V){return o.add("window-removed",V)}function M(V){let Q,H=!1;return u.then(()=>{H||(Q=l.tabAttached(V))}),()=>{H=!0,Q&&Q()}}function $(V){let Q,H=!1;return u.then(()=>{H||(Q=l.tabDetached(V))}),()=>{H=!0,Q&&Q()}}function G(V){let Q,H=!1;return u.then(()=>{H||(Q=l.onWindowFrameColorChanged(V))}),()=>{H=!0,Q&&Q()}}function E(V){let Q,H=!1;return u.then(()=>{H||(Q=l.onWindowGotFocus(V))}),()=>{H=!0,Q&&Q()}}function D(V){let Q,H=!1;return u.then(()=>{H||(Q=l.onWindowLostFocus(V))}),()=>{H=!0,Q&&Q()}}function A(V){return l.onWindowsAutoArrangeChanged(V)}function x(V){let Q,H=!1;return u.then(()=>{H||(Q=l.onEvent(V))}),()=>{H=!0,Q&&Q()}}function N(V,Q){return l.createFlydown(V,Q)}function b(V,Q){return l.showPopup(V,Q)}function R(V){o.execute("window-added",V.API)}function z(V){o.execute("window-removed",V.API)}return we.onReadyWindow(R),we.onRemoved(z),{my:f,open:w,find:y,findById:S,list:O,ready:p,onWindowAdded:C,windowAdded:C,onWindowRemoved:T,windowRemoved:T,onTabAttached:M,onTabDetached:$,onWindowFrameColorChanged:G,onArrangementChanged:A,get groups(){return c.groupsAPI},onWindowGotFocus:E,onWindowLostFocus:D,onEvent:x,createFlydown:N,showPopup:b,configure:_,autoArrange:v}};class AE{constructor(){this.layouts=[]}removeWhere(e){this.layouts=this.layouts.filter(e)}removeAll(){this.layouts=[]}add(e){this.layouts.push(e)}get all(){return this.layouts}where(e){return this.layouts.filter(e)}first(e){return this.where(e)[0]}}var ri=new AE;const EE="T42.HC.GetSaveContext";class PE{constructor(e,t,n,r){this.config=e,this.activitiesGetter=t,this.callbacks=n,this.logger=r,this.interop=e.agm,this.registerRequestMethods()}onSaveRequested(e){return this.callbacks.add("saveRequested",e)}isActivityOwner(){if(typeof htmlContainer<"u"){const r=htmlContainer.getContext();return r&&r._t42&&r._t42.activityIsOwner}const e=this.activitiesGetter();if(!e||!e.inActivity)return!1;const t=e.my.window,n=e.my.activity;return!n&&!t?!1:n.owner.id===t.id}registerRequestMethods(){this.interop.register(EE,e=>{const t=this.callbacks.execute("saveRequested",e);(t==null?void 0:t.length)>1&&this.logger.warn('Multiple subscriptions for "glue.layouts.onSaveRequested" - only the first one will be used');const n=t[0],r=this.config.autoSaveWindowContext;if(typeof r=="boolean"&&r)return{autoSaveWindowContext:r};if(Array.isArray(r)&&r.length>0)return{autoSaveWindowContext:r};const s={windowContext:n==null?void 0:n.windowContext,activityContext:void 0};return this.isActivityOwner()&&(s.activityContext=n==null?void 0:n.activityContext),s})}}function Nu(i){if(!i)return i;if(Array.isArray(i))return i.map(t=>Nu(t));if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")return i;const e={};return Object.keys(i).reduce((t,n)=>{var r;const s=i[n],o=Nu(s);let a=n;return((r=n[0])===null||r===void 0?void 0:r.toLowerCase())!==n[0]&&(a=n[0].toLowerCase()+n.substr(1)),t[a]=o,t},e)}class Ip{constructor(e){this.name=e.name,this.type=e.type,this.components=e.components,this.context=e.context,this.metadata=e.metadata,this.version=e.version,this.displays=e.displays}}const ay="T42.ACS.Command";class NE{constructor(e,t,n,r){this.config=e,this.stream=t,this.callbacks=n,this.isRegisterMethodForLayoutModified=!1,this.appManager=e.appManager,this.provider=new PE(e,e.activityGetter,n,r),t.subscribe()}async setDefaultGlobal(e){await this.invokeMethodCore("SelectDefaultLayout",{name:e})}async clearDefaultGlobal(){this.invokeMethodCore("DeselectDefaultLayout")}async getDefaultGlobal(){const n=(await this.invokeMethodCore("GetDefaultLayout")).returned;if(n)return this.isSlimMode()?n:this.list().find(r=>r.name===n.name&&r.type==="Global")}ready(){return this.config.mode==="fullWaitSnapshot"?this.stream.gotSnapshot:this.stream.ready}save(e){return new Promise((t,n)=>{var r,s;if(this.verifyNotSlimMode(),K(e))return n(new Error("layout is required"));if(Ue(e.name))return n(new Error("layout.name argument is required"));Ue(e.type)&&(e.type="Global"),Ue(e.activityId)||(e.type="Activity");const o={name:e.name,type:e.type,context:(r=e.context)!==null&&r!==void 0?r:{},metadata:(s=e.metadata)!==null&&s!==void 0?s:{},options:{}};if(e.type==="Activity"){let a=e.activityId;if(!a){if(!this.appManager.myInstance.inActivity)return n(new Error("Current application is not in activity. Cannot save activity layout for it."));a=this.appManager.myInstance.activityId}o.activityId=a}else if(e.type==="Global")Array.isArray(e.ignoreInstances)&&(o.options.ignoreInstances=e.ignoreInstances),Array.isArray(e.instances)&&(o.options.instances=e.instances),typeof e.setAsCurrent=="boolean"&&(o.options.setAsCurrent=e.setAsCurrent);else return n(new Error(`layout type ${e.type} is not supported`));this.invokeMethodAndTrack("SaveLayout",o,t,n)})}restore(e){return new Promise((t,n)=>{var r,s,o;if(this.verifyNotSlimMode(),K(e))return n(new Error("options argument is required"));if(Ue(e.name))return n(new Error("options.name argument is required"));if(Ue(e.type)&&(e.type="Global"),Ue(e.activityIdToJoin)||(e.type="Activity"),e.type==="Activity"){if(K(e.setActivityContext)&&(e.setActivityContext=!0),typeof e.setActivityContext!="boolean")return n(new Error("`setActivityContext` must hold a boolean value."));e.activityIdToJoin=(r=e.activityIdToJoin)!==null&&r!==void 0?r:this.appManager.myInstance.activityId}if(K(e.closeRunningInstance)||(e.closeRunningInstances=e.closeRunningInstance),K(e.closeRunningInstances)&&(e.closeRunningInstances=!0),!Pu(e.closeRunningInstances))return n(new Error("`closeRunningInstances` must hold a boolean value."));if(K(e.closeMe)&&(e.closeMe=e.closeRunningInstances),!Pu(e.closeMe))return n(new Error("`closeMe` must hold a boolean value."));if(!K(e.context)&&!id(e.context))return n(new Error("`context` must hold an object value."));if(!K(e.timeout)&&typeof e.timeout!="number")return n(new Error("`timeout` must hold an number value."));e.context=(s=e.context)!==null&&s!==void 0?s:{};const a={activityToJoin:e.activityIdToJoin,setActivityContext:e.setActivityContext,ignoreActivityWindowTypes:e.ignoreActivityWindowTypes,reuseExistingWindows:e.reuseWindows,closeRunningInstances:e.closeRunningInstances,excludeFromClosing:e.closeMe?[]:[(o=this.appManager.myInstance)===null||o===void 0?void 0:o.id]},c={type:e.type,name:e.name,context:e.context,options:a};e.timeout&&(c.timeout=e.timeout),this.invokeMethodAndTrack("RestoreLayout",c,t,n,!0)})}reset(e){return new Promise((t,n)=>{if(this.verifyNotSlimMode(),typeof e!="object")return n(new Error("options argument is required"));if(Ue(e.layoutId))return n(new Error("options.layoutId argument is required"));const r={...e};this.invokeMethodAndTrack("ResetLayout",r,t,n,!0)})}remove(e,t){return new Promise((n,r)=>{if(this.verifyNotSlimMode(),!t)return r(new Error("name argument is required"));if(!e)return r(new Error("type argument is required"));const s={type:e,name:t};this.invokeMethodAndTrack("RemoveLayout",s,n,r)})}list(){return this.verifyNotSlimMode(),ri.all}import(e,t){return new Promise((n,r)=>{if(this.verifyNotSlimMode(),!K(t)&&t!=="merge"&&t!=="replace")return r(new Error(`${t} is not supported - only "merge" and "replace"`));if(!Array.isArray(e))return r(new Error("layouts arguments is not an array"));const s={mode:t||"replace",layouts:e};this.invokeMethodAndTrack("ImportLayouts",s,n,r,!0)})}export(e){return new Promise((t,n)=>{const r=s=>{let o=this.getObjectValues(s.Layouts).map(a=>new Ip(Nu(a)));e&&(o=o.filter(a=>a.type===e)),t(o)};this.invokeMethodAndTrack("ExportLayouts",{},r,n,!0)})}rename(e,t){return new Promise((n,r)=>{if(this.verifyNotSlimMode(),!e)return r(new Error("layout argument is required"));if(!e.name)return r(new Error("name argument is required"));if(!e.type)return r(new Error("type argument is required"));const s={type:e.type,oldName:e.name,newName:t};this.invokeMethodAndTrack("RenameLayout",s,n,r)})}updateMetadata(e){return new Promise((t,n)=>{if(!e)return n(new Error("layout argument is required"));if(!e.name)return n(new Error("name argument is required"));if(!e.type)return n(new Error("type argument is required"));if(!e.metadata)return n(new Error("metadata argument is required"));const r={name:e.name,type:e.type,metadata:e.metadata};this.invokeMethodAndTrack("UpdateMetadata",r,t,n,!0)})}hibernate(e,t){return new Promise((n,r)=>{if(!e)return r(new Error("name cannot be empty"));t=t||{};const s={name:e,type:"Global",context:t.context||{},metadata:t.metadata||{}};this.invokeMethodAndTrack("HibernateLayout",s,n,r,!0)})}resume(e,t,n){return new Promise((r,s)=>{if(!e)return s(new Error("name cannot be empty"));const o={name:e,type:"Global",context:t,...n};this.invokeMethodAndTrack("ResumeLayout",o,r,s,!0)})}async getCurrentLayout(){let n=(await this.invokeMethodCore("GetCurrentLayout")).returned.layout;if(n)return this.isSlimMode()||(n=this.list().find(r=>r.name===n.name&&r.type===n.type)),n}getRestoredLayoutsInfo(){return new Promise((e,t)=>{this.invokeMethodCore("GetRestoredLayoutsInfo").then(r=>{const s=r.returned;e(s)}).catch(t)})}onAdded(e){const t=this.callbacks.add("added",e);return ri.all.length>0&&ri.all.forEach(n=>{try{e(n)}catch{}}),t}onRemoved(e){return this.callbacks.add("removed",e)}onChanged(e){return this.callbacks.add("changed",e)}onRestored(e){return this.callbacks.add("restored",e)}onRenamed(e){return this.callbacks.add("renamed",e)}onEvent(e){return this.stream.onEvent(e)}onSaveRequested(e){return this.provider.onSaveRequested(e)}onLayoutModified(e){return this.isRegisterMethodForLayoutModified===!1&&(this.isRegisterMethodForLayoutModified=!0,this.registerMethodForLayoutModified()),this.callbacks.add("layout-modified",e)}updateAppContextInCurrent(e){return new Promise((t,n)=>{if(e&&typeof e!="object")return n(new Error("context must be an object"));e=e??{};const r={context:e};this.invokeMethodAndTrack("UpdateLayoutComponentContext",r,t,n,!0)})}updateDefaultContext(e){return new Promise((t,n)=>{if(e&&typeof e!="object")return n(new Error("context must be an object"));e=e??{};const r={context:e};this.invokeMethodAndTrack("UpdateDefaultContext",r,t,n,!0)})}async get(e,t){const n=this.list().find(r=>r.name===e&&r.type===t);if(!n)throw new Error(`cannot find layout with name=${e} and type=${t}`);return n}async getAll(e){return this.list().filter(n=>e===n.type)}async forceRefresh(){await this.invokeMethodCore("RefreshLayouts")}isSlimMode(){return this.config.mode==="slim"}verifyNotSlimMode(){if(this.isSlimMode())throw Error("Operation not allowed in slim mode. Run in full mode.")}async registerMethodForLayoutModified(){await this.config.agm.register("T42.ACS.LayoutModified",(e,t)=>{this.callbacks.execute("layout-modified",e)})}invokeMethodAndTrack(e,t,n,r,s){let o=s,a;const c=ae.generateId();t.token=c;const l=()=>{o&&a&&n(a)},u=120*1e3;s||this.stream.waitFor(c,u).then(()=>{o=!0,l()}).catch(f=>{r(f)});const p=f=>{if(!f.returned)return r(new Error("No result from method "+e));if(f.returned.status&&f.returned.status!=="Success"&&f.returned.status!=="PartialSuccess"){if(typeof f.returned=="string")return r(new Error(f.returned));if(typeof f.returned=="object")return f.returned.status&&f.returned.failed?r(new Error(`${f.returned.status}: ${JSON.stringify(f.returned.failed)}`)):r(new Error(f.returned))}a=f.returned,l()};this.invokeMethodCore(e,t,"best",{methodResponseTimeoutMs:u}).then(p).catch(f=>r(f))}async invokeMethodCore(e,t,n,r){return this.isCommandMethodPresent()?await this.config.agm.invoke(ay,{command:e,data:t},n,r):await this.config.agm.invoke(`T42.ACS.${e}`,t,n,r)}getObjectValues(e){return e?Object.keys(e).map(t=>e[t]):[]}isCommandMethodPresent(){return this.config.agm.methods().some(e=>e.name===ay)}}class RE{constructor(e,t){this.agm=e,this.callbacks=t,this.StreamName="T42.ACS.OnLayoutEvent",this.ready=new Promise((n,r)=>{this.resolveReady=n,this.rejectReady=r}),this.gotSnapshot=new Promise((n,r)=>{this.resolveGotSnapshot=n,this.rejectGotSnapshot=r})}subscribe(e){const t=n=>this.getObjectValues(n).map(r=>Nu(r));this.checkForLayoutEventMethod()?this.agm.subscribe(this.StreamName,{waitTimeoutMs:1e4}).then(n=>{n.onData(r=>{const s=r.data;s.IsSnapshot&&this.resolveGotSnapshot(),this.addLayouts(t(s.OnLayoutAdded),s.IsSnapshot),this.removeLayouts(t(s.OnLayoutRemoved)),this.changeLayouts(t(s.OnLayoutChanged)),this.renameLayouts(t(s.OnLayoutRenamed)),this.restoredLayout(t(s.OnLayoutRestored)),this.callbacks.execute("streamEvent",s)}),n.onFailed(r=>{const s=`Can not subscribe to "${this.StreamName}" stream - ${JSON.stringify(r)}`;this.rejectReady(s),this.rejectGotSnapshot(s)}),this.resolveReady()}).catch(n=>{const r=`Error subscribing to "${this.StreamName}" stream - ${JSON.stringify(n)}`;this.rejectReady(r),this.rejectGotSnapshot(r)}):(e&&this.resolveReady(),setTimeout(()=>{this.subscribe(!0)},500))}onEvent(e){return this.callbacks.add("streamEvent",e)}waitFor(e,t){return t||(t=3e4),new Promise((n,r)=>{let s=!1;const o=this.onEvent(a=>{a.Token===e&&(s=!0,o(),n())});setTimeout(()=>{s||r("timed out")},t)})}checkForLayoutEventMethod(){try{return this.agm.methods().map(e=>e.name).indexOf(this.StreamName)!==-1}catch{return!1}}addLayouts(e,t){if(!e)return;const n=r=>{const s=new Ip(r);ri.add(s),this.callbacks.execute("added",s)};e.forEach(r=>{t&&ri.first(o=>this.compareLayouts(o,r))||n(r)})}removeLayouts(e){e&&e.forEach(t=>{ri.removeWhere(n=>!this.compareLayouts(n,t)),this.callbacks.execute("removed",t)})}changeLayouts(e){e&&e.forEach(t=>{ri.removeWhere(n=>!this.compareLayouts(n,t)),ri.add(new Ip(t)),this.callbacks.execute("changed",t)})}renameLayouts(e){e&&e.forEach(t=>{const n=ri.first(r=>this.compareLayouts(r,{type:t.type,name:t.oldName}));if(!n)throw Error(`received rename event for unknown layout with type ${t.type} and name ${t.oldName}`);n.name=t.newName,this.callbacks.execute("renamed",n)})}compareLayouts(e,t){return e.name===t.name&&e.type===t.type}getObjectValues(e){return e?Object.keys(e).map(t=>e[t]):[]}restoredLayout(e){e&&e.forEach(t=>{const n=ri.first(r=>this.compareLayouts(r,{type:t.type,name:t.name}));this.callbacks.execute("restored",n)})}}function ME(i){if(!i.agm)throw Error("config.agm is required");if(!i.logger)throw Error("config.logger is required");i.mode=i.mode||"slim";const e=i.logger,t=pt();let n;return i.mode,n=new RE(i.agm,t),new NE(i,n,t,e)}const jE="T42.Displays.Command",OE="T42.Displays.OnEvent";class DE{constructor(e,t){this._agm=e,this._logger=t,this._registry=pt(),this._registered=!1,this.all=async()=>(await this.callGD(Yi.GetAll,{})).map(this.decorateDisplay),this.get=async n=>{const r=await this.callGD(Yi.Get,{id:n});return this.decorateDisplay(r)},this.getPrimary=async()=>(await this.all()).find(r=>r.isPrimary),this.capture=async n=>await this.callGD(Yi.Capture,{...n}),this.captureAll=async n=>await this.callGD(Yi.CaptureAll,{...n}),this.getMousePosition=async()=>await this.callGD(Yi.GetMousePosition),this.callGD=async(n,r)=>(await this._agm.invoke(jE,{options:{...r},command:n})).returned.data,this.decorateDisplay=n=>{const r={...n,capture:o=>this.capture({id:n.id,size:o})},s=r.workArea;return s.x=s.left,s.y=r.workArea.top,r}}getByWindowId(e){return this.callGD(Yi.GetByWindowId,{id:e})}onDisplayChanged(e){return this.register(),this._registry.add("on-display-changed",e)}register(){this._registered||(this._registered=!0,this._agm.register(OE,(e,t)=>{const n=e.event,r=e.data;switch(n){case"display-changed":this._registry.execute("on-display-changed",r.displays.map(this.decorateDisplay));break;default:this._logger.warn(`unknown event - ${n}`);break}}))}}var Yi;(function(i){i.Capture="capture",i.CaptureAll="captureAll",i.GetAll="getAll",i.Get="get",i.GetByWindowId="getByWindowId",i.GetMousePosition="getMousePosition"})(Yi||(Yi={}));let ci,rr;const Hc="T42.Channels.Announce";async function $E(i,e){var t,n;if(ci=i,typeof window<"u"&&window.glue42gd&&(rr=window.glue42gd.windowId),!rr)return;await ci.register("T42.Channels.Command",s=>{const o=s.command;if(!o)throw new Error("missing command argument");if(o==="join"){const a=s.channel;if(!a)throw new Error("missing argument id");e.joinNoSelectorSwitch(a);return}if(o==="leave"){e.leaveNoSelectorSwitch();return}if(o==="get")return{id:e.current()};if(o==="restrictions-changed"){const a=s.restrictions,c=s.swId;e.handleRestrictionsChanged(a,c);return}if(o==="isFdc3DataWrappingSupported")return{isSupported:!0};throw new Error(`unknown command ${o}`)});const r=await ci.invoke("T42.Channels.Announce",{swId:rr,instance:ci.instance.instance});!((t=r.returned)===null||t===void 0)&&t.restrictions&&e.handleRestrictionsChanged((n=r.returned)===null||n===void 0?void 0:n.restrictions,rr)}async function Cl(i,e){ci.invoke("T42.Channels.Announce",{swId:e??rr,command:"switchChannel",data:{newChannel:i}})}async function FE(i){var e;await ci.invoke(Hc,{swId:(e=i.windowId)!==null&&e!==void 0?e:rr,command:"restrict",data:i})}async function cy(i){try{return(await ci.invoke(Hc,{swId:i??rr,command:"getRestrictions"})).returned}catch{return}}async function LE(i){var e;await ci.invoke(Hc,{swId:(e=i.windowId)!==null&&e!==void 0?e:rr,command:"restrictAll",data:i})}async function WE(i){return(await ci.invoke(Hc,{command:"getChannelsInfo",data:{filter:i}})).returned}async function ly(i,e,t){await ci.invoke(Hc,{command:i,data:{id:e,color:t}})}const nh="___channel___",Sl="latest_fdc3_type";class BE{constructor(e){this.contexts=e}subscribe(e){this.callback=e}subscribeFor(e,t){if(!this.isChannel(e))return Promise.reject(new Error(`Channel with name: ${e} doesn't exist!`));const n=this.createContextName(e);return this.contexts.subscribe(n,(r,s,o,a,c)=>{t(r.data,r,c==null?void 0:c.updaterId)})}async switchChannel(e){this.unsubscribe();const t=this.createContextName(e);this.unsubscribeFunc=await this.contexts.subscribe(t,(n,r,s,o,a)=>{this.callback&&this.callback(n.data,n,a==null?void 0:a.updaterId)})}leave(){this.callback&&this.callback({},void 0),this.unsubscribe()}all(){return this.contexts.all().filter(r=>r.startsWith(nh)).map(r=>r.substr(nh.length))}async getContextData(e){if(!this.isChannel(e))throw new Error(`A channel with name: ${e} doesn't exist!`);const t=this.createContextName(e),n=await this.contexts.get(t);return n[Sl]?this.getContextWithFdc3Data(n):n}updateChannel(e,t){const n=this.createContextName(e);return this.contexts.update(n,t)}updateData(e,t){const n=this.createContextName(e),r=this.getFDC3Type(t);if(this.contexts.setPathSupported){const s=Object.keys(t).map(o=>({path:"data."+o,value:t[o]}));return r&&s.push({path:Sl,value:r}),this.contexts.setPaths(n,s)}else return r&&(t[Sl]=r),this.contexts.update(n,{data:t})}setPaths(e,t){const n=this.createContextName(e);if(this.contexts.setPathSupported){const r=t.map(s=>({path:"data."+s.path,value:s.value}));return r.map(s=>{const o=this.getFDC3Type(s.value);o&&r.push({path:Sl,value:o})}),this.contexts.setPaths(n,r)}else throw new Error("setPaths is not supported!")}isChannel(e){return this.all().some(t=>t===e)}async remove(e){if(!this.isChannel(e))throw new Error(`A channel with name: ${e} doesn't exist!`);const t=this.createContextName(e);await this.contexts.destroy(t)}unsubscribe(){this.unsubscribeFunc&&this.unsubscribeFunc()}createContextName(e){return nh+e}getFDC3Type(e){const t=Object.keys(e).filter(n=>n.indexOf("fdc3_")===0);if(t.length!==0){if(t.length>1)throw new Error("FDC3 does not support updating of multiple context keys");return t[0].split("_").slice(1).join("_")}}getContextWithFdc3Data(e){const{latest_fdc3_type:t,...n}=e,s={type:t.split("&").join("."),...n.data[`fdc3_${t}`]};return delete n.data[`fdc3_${t}`],{name:e.name,meta:e.meta,data:{...n.data,fdc3:s}}}}class HE{constructor(e,t,n,r){this.shared=e,this.interop=t,this.getWindows=n,this.logger=r,this.subsKey="subs",this.changedKey="changed",this.isInitialJoin=!0,this.registry=pt(),this.pendingReplays={},this.pendingRestrictionCallbacks=new Map,this.shared.subscribe(this.handler.bind(this)),this.subscribeForChannelRestrictionsChange(),typeof window<"u"&&typeof window.glue42gd<"u"&&(this.currentContext=window.glue42gd.initialChannel,this.currentContext&&this.joinNoSelectorSwitch(this.currentContext))}subscribe(e){if(typeof e!="function")throw new Error("Please provide the callback as a function!");const t=ae.generateId();this.pendingReplays[t]=!0;const n=this.getWrappedSubscribeCallback(e,t);if(this.lastUpdate){let s=Object.assign({},this.lastUpdate);setTimeout(async()=>{this.pendingReplays[t]&&(this.lastUpdate&&(s=this.lastUpdate),n(s.context.data,s.context,s.updaterId)),delete this.pendingReplays[t]},0)}const r=this.registry.add(this.subsKey,n);return()=>{this.pendingReplays[t]=!1,this.pendingRestrictionCallbacks.delete(t),r()}}async subscribeFor(e,t){if(typeof e!="string")throw new Error("Please provide the name as a string!");if(typeof t!="function")throw new Error("Please provide the callback as a function!");const n=ae.generateId(),r=this.getWrappedSubscribeCallback(t,n),s=await this.shared.subscribeFor(e,r);return()=>{this.pendingRestrictionCallbacks.delete(n),s()}}async publish(e,t){if(typeof e!="object")throw new Error("Please provide the data as an object!");if(t&&this.validatePublishOptions(t),typeof t=="object")return this.publishWithOptions(e,t);const n=typeof t=="string"?t:this.currentContext;if(!n)throw new Error("Not joined to any channel!");if(!this.shared.isChannel(n))return Promise.reject(new Error(`A channel with name: ${n} doesn't exist!`));if(!(await this.getRestrictionsByChannel(n)).write)throw new Error(`Window does not have permission to write to channel ${this.currentContext}`);return this.shared.updateData(n,e)}async setPaths(e,t){if(t){if(typeof t!="string")throw new Error("Please provide the name as a string!");if(!this.shared.isChannel(t))return Promise.reject(new Error(`A channel with name: ${t} doesn't exist!`));if(!(await this.getRestrictionsByChannel(t)).write)throw new Error(`Window does not have permission to write to channel ${t}`);return this.shared.setPaths(t,e)}if(!this.currentContext)throw new Error("Not joined to any channel!");if(!(await this.getRestrictionsByChannel(this.currentContext)).write)throw new Error(`Window does not have permission to write to channel ${this.currentContext}`);if(!Array.isArray(e))throw new Error("Path Values argument is not a valid array");return e.forEach(n=>{this.validatePathArgs(n)}),this.shared.setPaths(this.currentContext,e)}async setPath(e,t){if(t){if(typeof t!="string")throw new Error("Please provide the name as a string!");if(!this.shared.isChannel(t))return Promise.reject(new Error(`A channel with name: ${t} doesn't exist!`));if(!(await this.getRestrictionsByChannel(t)).write)throw new Error(`Window does not have permission to write to channel ${t}`);return this.shared.setPaths(t,[e])}if(!this.currentContext)throw new Error("Not joined to any channel!");if(!(await this.getRestrictionsByChannel(this.currentContext)).write)throw new Error(`Window does not have permission to write to channel ${this.currentContext}`);return this.validatePathArgs(e),this.shared.setPaths(this.currentContext,[e])}all(){const e=this.shared.all();return Promise.resolve(e)}async list(){const e=await this.all();return await Promise.all(e.map(n=>this.get(n)))}get(e){return typeof e!="string"?Promise.reject(new Error("Please provide the channel name as a string!")):this.shared.getContextData(e)}getMy(){return this.currentContext?this.get(this.currentContext):Promise.resolve(void 0)}async join(e,t){return t?Cl(e,t):this.joinCore(e)}async joinNoSelectorSwitch(e){return this.joinCore(e,!1)}leave(e){return e?Cl(void 0,e):this.leaveCore()}leaveNoSelectorSwitch(){return this.leaveCore(!1)}current(){return this.currentContext}my(){return this.current()}changed(e){if(typeof e!="function")throw new Error("Please provide the callback as a function!");return this.current()&&setTimeout(()=>{e(this.current())},0),this.registry.add(this.changedKey,e)}onChanged(e){return this.changed(e)}async add(e){if(typeof e!="object")throw new Error("Please provide the info as an object!");if(typeof e.name>"u")throw new Error("info.name is missing!");if(typeof e.name!="string")throw new Error("Please provide the info.name as a string!");if(typeof e.meta>"u")throw new Error("info.meta is missing!");if(typeof e.meta!="object")throw new Error("Please provide the info.meta as an object!");if(typeof e.meta.color>"u")throw new Error("info.meta.color is missing!");if(typeof e.meta.color!="string")throw new Error("Please provide the info.meta.color as a string!");const t={name:e.name,meta:e.meta||{},data:e.data||{}};return await this.shared.updateChannel(e.name,t),await ly("addChannel",e.name,e.meta.color),t}async remove(e){if(typeof e!="string")throw new Error("Please provide the channel name as a string!");await this.shared.remove(e),await ly("removeChannel",e)}async getWindowsOnChannel(e){if(typeof e!="string")throw new Error("Please provide the channel name as a string!");return(await this.getWindowsWithChannels({channels:[e]})).map(n=>n.window)}async getWindowsWithChannels(e){try{const t=await WE(e),n=this.getWindows();if(t!=null&&t.windows)return t.windows.map(r=>({window:n.findById(r.windowId),channel:r.channel,application:r.application}))}catch(t){this.logger.error("Error getting all channel enabled windows. This method is available since Glue42 3.12",t)}return[]}async restrict(e){return FE(e)}async getRestrictions(e){return cy(e)}async restrictAll(e){return LE(e)}handleRestrictionsChanged(e,t){this.registry.execute("restrictions-changed",{restrictions:e,windowId:t})}handler(e,t,n){if(!t&&!n){this.lastUpdate=void 0;return}this.lastUpdate={context:t,updaterId:n},this.pendingReplays={},this.registry.execute(this.subsKey,e,t,n)}async joinCore(e,t=!0){if(typeof e!="string")throw new Error("Please provide the channel name as a string!");if(!this.isInitialJoin&&e===this.currentContext)return;this.isInitialJoin=!1;const n=r=>this.shared.all().includes(r);n(e)||await new Promise((s,o)=>{const a=setInterval(()=>{n(e)&&(clearTimeout(c),clearInterval(a),s())},100),c=setTimeout(()=>(clearInterval(a),o(new Error(`A channel with name: ${e} doesn't exist!`))),3e3)}),this.currentContext=e,this.lastUpdate=void 0,await this.shared.switchChannel(e),t&&Cl(e),this.registry.execute(this.changedKey,e)}leaveCore(e=!0){return this.currentContext=void 0,this.registry.execute(this.changedKey,void 0),this.shared.leave(),e&&Cl(),Promise.resolve()}async getRestrictionsByChannel(e){var t;const n=(t=this.channelRestrictions)!==null&&t!==void 0?t:await cy();return!n||!Array.isArray(n.channels)||!n.channels.find(s=>s.name===e)?{read:!0,write:!0}:n.channels.find(s=>s.name===e)}onRestrictionsChanged(e,t,n){this.pendingRestrictionCallbacks.set(t,{cb:e,channelName:n}),!this.onRestrictionsChangedSub&&(this.onRestrictionsChangedSub=this.registry.add("restrictions-changed",({restrictions:r})=>{this.pendingRestrictionCallbacks.forEach(({cb:s,channelName:o},a)=>{const c=r.channels.find(l=>l.name===o);c&&c.read&&(this.pendingRestrictionCallbacks.delete(a),this.pendingRestrictionCallbacks.values.length===0&&this.onRestrictionsChangedSub&&(this.onRestrictionsChangedSub(),this.onRestrictionsChangedSub=null),s())})}))}subscribeForChannelRestrictionsChange(){this.registry.add("restrictions-changed",e=>{this.channelRestrictions=e.restrictions})}validatePathArgs(e){if(!e)throw new Error("Please provide a valid path value argument");if(typeof e!="object")throw new Error(`Path Value argument is not a valid object: ${JSON.stringify(e)}`);if(!e.path)throw new Error(`path property is missing from Path Value argument: ${JSON.stringify(e)}`);if(!e.value)throw new Error(`value property is missing from Path Value argument: ${JSON.stringify(e)}`);if(typeof e.path!="string")throw new Error(`path property is not a valid string from the Path Value argument: ${JSON.stringify(e)}`)}validatePublishOptions(e){if(typeof e!="string"&&typeof e!="object"||Array.isArray(e))throw new Error("Provide options as a string or an object");if(typeof e=="object"){this.validatePublishOptionsObject(e);return}if(e==="string"&&!e.length)throw new Error("Provide options as a non-empty string")}validatePublishOptionsObject(e){if(typeof e!="object"||Array.isArray(e))throw new Error("Provide options as an object");if(e.name&&(typeof e.name!="string"||!e.name.length))throw new Error("Provide options.name as a non-empty string");if(Object.keys(e).includes("fdc3")&&typeof e.fdc3!="boolean")throw new Error("Provide options.fdc3 as a boolean")}async publishWithOptions(e,t){const n=t.name||this.currentContext;if(!this.shared.isChannel(n))throw new Error(`A channel with name: ${t.name} doesn't exist!`);if(!n)throw new Error("Cannot publish to channel, because not joined to a channel!");if(!(await this.getRestrictionsByChannel(n)).write)throw new Error(`Window does not have permission to write to channel ${this.currentContext}`);return t.fdc3?this.publishFdc3Data(n,e):this.shared.updateData(n,e)}async publishFdc3Data(e,t){var n;if(typeof t.type!="string"||!(!((n=t.type)===null||n===void 0)&&n.length))throw new Error("Expected a valid FDC3 Context with compulsory 'type' field");const{type:r,...s}=t,a={[`fdc3_${r.split(".").join("&")}`]:s};return this.shared.updateData(e,a)}getWrappedSubscribeCallback(e,t){return async(r,s,o)=>{const a=await this.getRestrictionsByChannel(s.name),c=this.getDataWithFdc3Encoding(s);a.read?e(c,s,o):this.onRestrictionsChanged(()=>{e(c,s,o)},t,s.name)}}getDataWithFdc3Encoding(e){const{data:t,latest_fdc3_type:n}=e;if(!n)return t;const r=n.split("&").join("."),s=`fdc3_${n}`,o={type:r,...t[s]},{[s]:a,...c}=t;return{...c,fdc3:o}}}function GE(i,e,t,n){const r=new BE(i),s=new HE(r,e,t,n),o=$E(e,s);return{subscribe:s.subscribe.bind(s),subscribeFor:s.subscribeFor.bind(s),publish:s.publish.bind(s),setPath:s.setPath.bind(s),setPaths:s.setPaths.bind(s),all:s.all.bind(s),list:s.list.bind(s),get:s.get.bind(s),join:s.join.bind(s),leave:s.leave.bind(s),restrict:s.restrict.bind(s),getRestrictions:s.getRestrictions.bind(s),restrictAll:s.restrictAll.bind(s),current:s.current.bind(s),my:s.my.bind(s),changed:s.changed.bind(s),onChanged:s.onChanged.bind(s),add:s.add.bind(s),remove:s.remove.bind(s),getWindowsOnChannel:s.getWindowsOnChannel.bind(s),getWindowsWithChannels:s.getWindowsWithChannels.bind(s),getMy:s.getMy.bind(s),ready:async()=>{await Promise.all([i.ready(),o])}}}const ih="T42.Hotkeys.Command",zE="T42.Hotkeys.Invoke",UE="register",qE="unregister",VE="unregisterAll";class JE{constructor(e){this.agm=e,this.registry=pt(),this.firstHotkey=!0,this.hotkeys=new Map}async register(e,t){if(typeof e>"u")throw new Error("Hotkey parameter missing");if(typeof e=="string")e={hotkey:e};else{if(!e.hotkey)throw new Error("Info's hotkey parameter missing");e={hotkey:e.hotkey,description:e.description}}const n=this.formatHotkey(e.hotkey);if(this.hotkeys.has(n))throw new Error(`Shortcut for ${n} already registered`);this.firstHotkey&&(this.firstHotkey=!1,await this.registerInvokeAGMMethod()),this.registry.add(n,t),await this.agm.invoke(ih,{command:UE,hotkey:n,description:e.description}),this.hotkeys.set(n,e)}async unregister(e){if(typeof e>"u")throw new Error("hotkey parameter missing");if(typeof e!="string")throw new Error("hotkey parameter must be string");const t=this.formatHotkey(e);await this.agm.invoke(ih,{command:qE,hotkey:t}),this.hotkeys.delete(t),this.registry.clearKey(t)}async unregisterAll(){await this.agm.invoke(ih,{command:VE}),this.hotkeys.clear(),this.registry.clear()}isRegistered(e){const t=this.formatHotkey(e);return this.hotkeys.has(t)}registerInvokeAGMMethod(){return this.agm.register(zE,e=>{const t=e.key.toLowerCase(),n=this.hotkeys.get(t);this.registry.execute(t,n)})}formatHotkey(e){if(e)return e.replace(/\s/g,"").toLowerCase()}}function KE(i){const e=new JE(i);return{register:e.register.bind(e),unregister:e.unregister.bind(e),unregisterAll:e.unregisterAll.bind(e),isRegistered:e.isRegistered.bind(e),ready:()=>Promise.resolve()}}var Qb="6.6.0",QE=i=>{function e(u,p,f){if(typeof u=="boolean"&&!u)return;const w=t(u,p,f);if(!(typeof w>"u"))return typeof u=="object"?(u.mode=w,u):{mode:w}}function t(u,p,f){return typeof u=="object"?t(u.mode,p,f).toString():typeof u>"u"?typeof p=="boolean"&&!p?void 0:typeof p=="boolean"&&p?typeof f>"u"?p:f:typeof p>"u"?void 0:p:typeof u=="boolean"?u?typeof f>"u"?p:f:void 0:u}const n=!0,r="startOnly",s=ae.isNode()?!1:"trackMyTypeAndInitiatedFromMe",o="trackMyTypeAndInitiatedFromMe",a="slim",c=a,l=typeof i.exposeAPI=="boolean"||typeof i.exposeGlue=="boolean";return{layouts:e(i.layouts,a,c),activities:e(i.activities,s,o),appManager:e(i.appManager,n,r),windows:e(i.windows,!0,!0),channels:e(i.channels,!1,!0),displays:e(i.displays,!0,!0),exposeAPI:l||!0}};class XE{constructor(e){this.options=e,this.callbacks=pt(),this.actions=e.actions,this.body=e.body,this.badge=e.badge,this.data=e.data,this.dir=e.dir,this.icon=e.icon,this.image=e.image,this.lang=e.lang,this.renotify=e.renotify,this.requireInteraction=e.requireInteraction,this.silent=e.silent,this.tag=e.tag,this.timestamp=e.timestamp,this.title=e.title}close(){throw new Error("Method not implemented.")}addEventListener(e,t,n){this.callbacks.add(e,t)}removeEventListener(e,t,n){}dispatchEvent(e){return this.callbacks.execute(e.type,e),!0}}class YE{constructor(e,t){this.interop=e,this.onStreamEvent=t}onVisibilityChanged(e){return this.onStreamEvent("on-panel-visibility-changed",e)}toggle(){return this.interop.invoke("T42.Notifications.Show")}show(){return this.interop.invoke("T42.Notifications.Show",{show:!0})}hide(){return this.interop.invoke("T42.Notifications.Hide")}async isVisible(){return(await this.interop.invoke("T42.Notifications.Execute",{command:"isPanelVisible"})).returned.panelVisible}toAPI(){return{onVisibilityChanged:this.onVisibilityChanged.bind(this),toggle:this.toggle.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),isVisible:this.isVisible.bind(this)}}}const rh=0;class ZE{constructor(e,t){this.interop=e,this.NotificationsSubscribeStream="T42.GNS.Subscribe.Notifications",this.NotificationsCounterStream="T42.Notifications.Counter",this.RaiseNotificationMethodName="T42.GNS.Publish.RaiseNotification",this.NotificationsExecuteMethod="T42.Notifications.Execute",this.methodsRegistered=!1,this.NOTIFICATIONS_CONFIGURE_METHOD_NAME="T42.Notifications.Configure",this.methodNameRoot="T42.Notifications.Handler-"+ae.generateId(),this.nextId=0,this.notifications={},this.registry=pt(),this.subscribedForNotifications=!1,this.subscribedCounterStream=!1,this.subscriptionsCountForNotifications=0,this.subscriptionsCountForCounter=0,this.logger=t.subLogger("notifications"),this._panel=new YE(e,this.onStreamEventCore.bind(this)),this._panelAPI=this._panel.toAPI(),this.subscribeInternalEvents()}get maxActions(){return 2}get panel(){return this._panelAPI}async raise(e){var t,n,r,s;if(this.validate(e),!this.methodsRegistered){const u=[];for(let p=rh;p<this.maxActions;p++)u.push(this.interop.register(`${this.methodNameRoot}_${p}`,this.handleNotificationEvent.bind(this)));this.methodsRegistered=!0,await Promise.all(u)}const o=String(this.nextId++),a=(t=e.type)!==null&&t!==void 0?t:"Notification",c={id:e.id,state:(n=e.state)!==null&&n!==void 0?n:"Active",title:e.title,type:a,severity:(r=e.severity)!==null&&r!==void 0?r:"None",description:e.body,glueRoutingDetailMethodName:`${this.methodNameRoot}_${rh}`,actions:[],sourceId:o,source:e.source,publishExtraEvents:!0,clickInterop:e.clickInterop};e.actions&&this.handleActions(e,o,c),this.handleOptions(e,c);const l=new XE(e);this.notifications[o]=l;try{const u=await this.interop.invoke(this.RaiseNotificationMethodName,{notification:c});l.id=(s=u.returned)===null||s===void 0?void 0:s.id}catch(u){const p=u.message;setTimeout(()=>{this.handleNotificationErrorEvent(l,p)},1)}return l}async setFilter(e){return(await this.interop.invoke("T42.Notifications.Filter",e)).returned}async getFilter(){return(await this.interop.invoke("T42.Notifications.Filter")).returned}async configure(e){var t,n,r,s,o,a,c,l;if(!e||Array.isArray(e))throw new Error("Invalid options - should be an object.");if(Object.values(e).length===0)throw new Error("The argument must be a non-empty object.");if(typeof e.enable<"u"&&typeof e.enable!="boolean")throw new Error("Expected type of enabled - boolean.");if(typeof e.enableToasts<"u"&&typeof e.enableToasts!="boolean")throw new Error("Expected type of enableToasts - boolean.");if(typeof e.toastExpiry<"u"&&typeof e.toastExpiry!="number")throw new Error("Expected type of toastExpiry - number.");if(e.sourceFilter&&typeof e.sourceFilter!="object")throw new Error("Expected type of sourceFilter - object.");if(!((t=e.sourceFilter)===null||t===void 0)&&t.allowed&&!Array.isArray((n=e.sourceFilter)===null||n===void 0?void 0:n.allowed))throw new Error("Expected type of sourceFilter.allowed - array.");if(!((r=e.sourceFilter)===null||r===void 0)&&r.blocked&&!Array.isArray((s=e.sourceFilter)===null||s===void 0?void 0:s.blocked))throw new Error("Expected type of sourceFilter.blocked - array.");if(e.toasts&&typeof e.toasts!="object")throw new Error("Expected type of (options.toasts - object.");if(!((o=e.toasts)===null||o===void 0)&&o.mode&&typeof e.toasts.mode!="string")throw new Error("Expected type of (options.toasts.mode - string.");if(!((a=e.toasts)===null||a===void 0)&&a.stackBy&&typeof e.toasts.stackBy!="string")throw new Error("Expected type of (options.toasts.stackBy - string.");if(e.placement&&typeof e.placement!="object")throw new Error("Expected type of (options.placement - object.");if(!((c=e.placement)===null||c===void 0)&&c.toasts&&typeof e.placement.toasts!="string")throw new Error("Expected type of (options.placement.toasts - string.");if(!((l=e.placement)===null||l===void 0)&&l.panel&&typeof e.placement.panel!="string")throw new Error("Expected type of (options.placement.panel - string.");return(await this.interop.invoke(this.NOTIFICATIONS_CONFIGURE_METHOD_NAME,e)).returned}async getConfiguration(){return(await this.interop.invoke(this.NotificationsExecuteMethod,{command:"getConfiguration"})).returned}async list(){return(await this.interop.invoke(this.NotificationsExecuteMethod,{command:"list",data:{statesVersion2:!0}})).returned.notifications}async updateData(e,t){const r={key:"data",value:{stringValue:JSON.stringify(t,(o,a)=>typeof a>"u"?null:a)}};return(await this.interop.invoke(this.NotificationsExecuteMethod,{command:"create-or-update-attribute",data:{id:e,attribute:r}})).returned}onRaised(e){return this.onStreamEventCore("on-notification-raised",e)}onStateChanged(e){return this.onStreamEventCore("on-state-changed",e)}onClosed(e){return this.onStreamEventCore("on-notification-closed",e)}onConfigurationChanged(e){if(typeof e!="function")throw new Error("Please provide the callback as a function!");this.subscribe();const t=this.registry.add("on-configuration-changed",e);return()=>{t(),this.closeStreamSubscriptionIfNoNeeded()}}onCounterChanged(e){if(typeof e!="function")throw new Error("Please provide the callback as a function!");this.subscribeForCounterStream();const t=this.registry.add("on-counter-changed",e);return()=>{t(),this.closeStreamCounterSubscriptionIfNoNeeded()}}onDataChanged(e){if(typeof e!="function")throw new Error("Please provide the callback as a function!");this.subscribe();const t=this.registry.add("on-notification-data-changed",e);return()=>{t(),this.closeStreamSubscriptionIfNoNeeded()}}async clearAll(){await this.interop.invoke(this.NotificationsExecuteMethod,{command:"clearAll"})}async clearOld(){await this.interop.invoke(this.NotificationsExecuteMethod,{command:"clearAllOld",data:{statesVersion2:!0}})}async clear(e){if(!e)throw new Error("The 'id' argument cannot be null or undefined");if(typeof e!="string")throw new Error("The 'id' argument must be a string");await this.interop.invoke(this.NotificationsExecuteMethod,{command:"clear",data:{id:e}})}async click(e,t,n){await this.interop.invoke(this.NotificationsExecuteMethod,{command:"click",data:{id:e,action:t,options:n}})}async snooze(e,t){await this.interop.invoke(this.NotificationsExecuteMethod,{command:"snooze",data:{id:e,duration:t}})}async setState(e,t){if(!e)throw new Error("The 'id' argument cannot be null or undefined");if(typeof e!="string")throw new Error("The 'id' argument must be a string");if(!t)throw new Error("The 'state' argument cannot be null or undefined");this.validateState(t),await this.interop.invoke(this.NotificationsExecuteMethod,{command:"updateState",data:{id:e,state:t}})}toAPI(){return{maxActions:this.maxActions,panel:this._panel.toAPI(),raise:this.raise.bind(this),setFilter:this.setFilter.bind(this),getFilter:this.getFilter.bind(this),configure:this.configure.bind(this),getConfiguration:this.getConfiguration.bind(this),list:this.list.bind(this),onRaised:this.onRaised.bind(this),onStateChanged:this.onStateChanged.bind(this),onClosed:this.onClosed.bind(this),onConfigurationChanged:this.onConfigurationChanged.bind(this),onCounterChanged:this.onCounterChanged.bind(this),onDataChanged:this.onDataChanged.bind(this),clearAll:this.clearAll.bind(this),clearOld:this.clearOld.bind(this),clear:this.clear.bind(this),click:this.click.bind(this),setState:this.setState.bind(this),updateData:this.updateData.bind(this),snooze:this.snooze.bind(this)}}onStreamEventCore(e,t){if(typeof t!="function")throw new Error("Please provide the callback as a function!");this.subscribe();const n=this.registry.add(e,t);return()=>{n(),this.closeStreamSubscriptionIfNoNeeded()}}handleOptions(e,t){if(e.icon&&(t.attributes=t.attributes||[],t.attributes.push({key:"icon",value:{stringValue:e.icon}})),e.data){t.attributes=t.attributes||[];const n=JSON.stringify(e.data);t.attributes.push({key:"data",value:{stringValue:n}})}typeof e.panelExpiry=="number"&&(t.attributes=t.attributes||[],t.attributes.push({key:"panelExpiry",value:{stringValue:e.panelExpiry.toString()}})),typeof e.toastExpiry=="number"&&(t.attributes=t.attributes||[],t.attributes.push({key:"toastExpiry",value:{stringValue:e.toastExpiry.toString()}}))}handleActions(e,t,n){var r,s,o;const a=e.actions.slice(0,this.maxActions);let c=rh;for(const l of a){const u={g42notificationId:t,g42action:l.action,g42interopMethod:(r=l.interop)===null||r===void 0?void 0:r.method,g42interopTarget:(s=l.interop)===null||s===void 0?void 0:s.target,g42interopArguments:JSON.stringify((o=l.interop)===null||o===void 0?void 0:o.arguments)},p=Object.keys(u).map(w=>{const y=u[w];return{name:w,value:{stringValue:y}}}),f={name:`${this.methodNameRoot}_${c}`,description:l.title,displayName:l.title,parameters:p};n.actions.push(f),c++}}validate(e){if(!e)throw new Error("invalid options - should be an object");if(typeof e!="object")throw new Error("invalid options - should be an object");if(!e.title)throw new Error("invalid options - should have a title");if(typeof e.title!="string")throw new Error("invalid options - title should be a string");if(e.severity&&typeof e.severity!="string")throw new Error("invalid options - severity should be a string");if(e.panelExpiry&&typeof e.panelExpiry!="number")throw new Error("invalid options - panelExpiry should be a number");if(e.toastExpiry&&typeof e.toastExpiry!="number")throw new Error("invalid options - toastExpiry should be a number");e.state&&this.validateState(e.state)}validateState(e){if(typeof e!="string")throw new Error("The 'state' argument must be a string");if(!["Active","Acknowledged","Stale"].includes(e))throw new Error(`The state argument: ${e} is not valid!`)}subscribe(){this.subscriptionsCountForNotifications++,this.subscribedForNotifications||(this.subscribedForNotifications=!0,this.logger.info(`Attempting to subscribe to "${this.NotificationsSubscribeStream}".`),this.interop.subscribe(this.NotificationsSubscribeStream,{arguments:{sendDeltaOnly:!0,statesVersion2:!0}}).then(e=>{this.subscriptionForNotifications=e,this.logger.info(`Successfully subscribed to "${this.NotificationsSubscribeStream}".`),e.onData(({data:t})=>{this.handleData(t)}),e.onClosed((...t)=>{this.subscribedForNotifications=!1,this.logger.info(`Stream subscription Closed - ${JSON.stringify(t)}`)}),e.onFailed((...t)=>{this.subscribedForNotifications=!1,this.logger.warn(`Stream subscription Failed - ${JSON.stringify(t)}`)})}).catch(e=>{this.subscribedForNotifications=!1,this.logger.error(`Unable to subscribe to "${this.NotificationsSubscribeStream}"`,e)}))}subscribeForCounterStream(){this.subscriptionsCountForCounter++,this.subscribedCounterStream||(this.subscribedCounterStream=!0,this.logger.info(`Attempting to subscribe to "${this.NotificationsCounterStream}".`),this.interop.subscribe(this.NotificationsCounterStream,{arguments:{sendDeltaOnly:!0}}).then(e=>{this.subscriptionForCounter=e,this.logger.info(`Successfully subscribed to "${this.NotificationsCounterStream}".`),e.onData(({data:t})=>{this.registry.execute("on-counter-changed",{count:t.count})}),e.onClosed((...t)=>{this.subscribedCounterStream=!1,this.logger.info(`Stream subscription Closed - ${JSON.stringify(t)}`)}),e.onFailed((...t)=>{this.subscribedCounterStream=!1,this.logger.warn(`Stream subscription Failed - ${JSON.stringify(t)}`)})}).catch(e=>{this.subscribedCounterStream=!1,this.logger.error(`Unable to subscribe to "${this.NotificationsCounterStream}"`,e)}))}subscribeInternalEvents(){this.registry.add("on-notification-closed",e=>{this.handleOnClosed(e)}),this.registry.add("on-notification-raised",e=>{this.handleOnShow(e.id)})}handleData(e){var t;try{"items"in e&&Array.isArray(e.items)?this.handleItemsData(e):"deltas"in e&&Array.isArray(e.deltas)&&this.handleDeltas(e),"configuration"in e&&typeof e.configuration=="object"&&(this.logger.info(`Received configuration ${JSON.stringify(e.configuration)} from the stream`),this.registry.execute("on-configuration-changed",e.configuration,e.configuration.allApplications)),"command"in e&&typeof e.command=="string"&&(this.logger.info(`Received command "${(t=e.command)!==null&&t!==void 0?t:JSON.stringify(e)}" from the stream`),(e.command==="showPanel"||e.command==="hidePanel")&&this.registry.execute("on-panel-visibility-changed",e.command==="showPanel"))}catch(n){this.logger.error("Failed to parse data from the stream",n)}}handleItemsData(e){const t=e.items;this.logger.info(`Received ${t.length} notifications from the stream`);const n=t;if(e.isSnapshot)n.forEach(r=>{this.registry.execute("on-notification-raised",r)});else{const r=n[0];r.state==="Closed"?this.registry.execute("on-notification-closed",{id:r.id}):this.registry.execute("on-notification-raised",r)}}handleDeltas(e){e.deltas.forEach(n=>{var r;const s=n.id,o=(r=n.delta)!==null&&r!==void 0?r:{};if(o.state==="Closed")this.registry.execute("on-notification-closed",{id:s,...o});else if(o.state)this.registry.execute("on-state-changed",{id:s},o.state);else if(o.attributes){const c=o.attributes.find(l=>l.key==="data");c&&this.registry.execute("on-notification-data-changed",{id:s},JSON.parse(c.value.stringValue))}})}handleOnClosed(e){const{notification:t,key:n}=this.getNotification(e);t&&(this.handleEvent(t,"close"),delete this.notifications[n])}handleOnShow(e){const{notification:t}=this.getNotification(e);t&&this.handleEvent(t,"show")}getNotification(e){let t,n;for(const r in this.notifications)if(this.notifications[r].id===e){t=this.notifications[r],n=r;break}return{notification:t,key:n}}handleNotificationEvent(e){const t=this.getGnsNotificationArgs(e);if(t.event==="unknown")return;const n=this.notifications[t.notificationId];n&&this.handleNotificationEventCore(n,t)}handleNotificationEventCore(e,t){switch(t.event){case"action":return this.handleNotificationActionEvent(e,t.notificationActionPayload);case"click":return this.handleNotificationClickEvent(e);case"close":return this.handleEvent(e,"close");case"error":return this.handleNotificationErrorEvent(e,t.error);case"show":return this.handleEvent(e,"show")}}handleNotificationActionEvent(e,t){const n={type:"onaction",action:t.g42action};e.onaction&&e.onaction(n),e.dispatchEvent(n)}handleNotificationClickEvent(e){const t={type:"onclick"};e.onclick&&e.onclick(t),e.dispatchEvent(t)}handleEvent(e,t){var n;const r={type:t},s=`on${t}`;(n=e[s])===null||n===void 0||n.call(e,r),e.dispatchEvent(r)}handleNotificationErrorEvent(e,t){const n={type:"onerror",error:t};e.onerror&&e.onerror(n),e.dispatchEvent(n)}getGnsNotificationArgs(e){var t;let n;const r=(t=e.notification)===null||t===void 0?void 0:t.event;return r?n={event:r,notificationId:e.notification.sourceNotificationId,notificationActionPayload:e}:n=this.getBackwardGnsNotificationArgs(e),n}getBackwardGnsNotificationArgs(e){var t;let n;return e.g42notificationId?n={event:"action",notificationId:e.g42notificationId,notificationActionPayload:e}:!((t=e.notification)===null||t===void 0)&&t.sourceNotificationId?n={event:"click",notificationId:e.notification.sourceNotificationId,notificationActionPayload:e}:n={event:"unknown",notificationId:void 0,notificationActionPayload:e},n}closeStreamSubscriptionIfNoNeeded(){this.subscriptionsCountForNotifications--,this.subscriptionForNotifications&&this.subscriptionsCountForNotifications===0&&(this.subscriptionForNotifications.close(),this.subscriptionForNotifications=void 0)}closeStreamCounterSubscriptionIfNoNeeded(){this.subscriptionsCountForCounter--,this.subscriptionForCounter&&this.subscriptionsCountForCounter===0&&(this.subscriptionForCounter.close(),this.subscriptionForCounter=void 0)}}const eP="T42.Themes.Configuration";class tP{constructor(e,t){this.contexts=e,this.interop=t,this.registry=pt(),this.isSubscribed=!1,this.getConfiguration()}async list(){if(await this.getConfiguration(),!this.getMethodName)throw new Error("not supported");return(await this.getAll()).returned.all}async getCurrent(){if(await this.getConfiguration(),!this.getMethodName)throw new Error("not supported");const e=await this.getAll();return e.returned.all.find(t=>t.name===e.returned.selected)}async select(e){if(await this.getConfiguration(),!this.setMethodName)throw new Error("not supported");await this.interop.invoke(this.setMethodName,{theme:e})}onChanged(e){return this.subscribe(),this.registry.add("changed",e)}async getConfiguration(){try{if(this.sharedContextName)return;const e=await this.interop.invoke(eP);this.sharedContextName=e.returned.sharedContextName,this.getMethodName=e.returned.getThemesMethodName,this.setMethodName=e.returned.setThemesMethodName}catch{return}}async getAll(){return await this.getConfiguration(),await this.interop.invoke(this.getMethodName)}async subscribe(){await this.getConfiguration(),!this.isSubscribed&&(this.isSubscribed=!0,this.contexts.subscribe(this.sharedContextName,e=>{e&&e.all&&e.selected&&this.registry.execute("changed",e.all.find(t=>t.name===e.selected))}))}}function nP(i,e){const t=new tP(i,e);return{list:t.list.bind(t),getCurrent:t.getCurrent.bind(t),select:t.select.bind(t),onChanged:t.onChanged.bind(t),ready:()=>Promise.resolve()}}const Ma="Tick42.FDC3.Intents.",iP="T42.Intents.Resolver.Control",uy=400,dy=440,rP=60*1e3,sP=["applicationName","type"],oP="intentsResolver",aP=2147483647,hy=60*1e3,py=90*1e3,fy=90*1e3,cP=(i,e,t)=>new Promise((n,r)=>{const s=setTimeout(()=>{const a=t||`Promise timeout hit: ${e}`;r(a)},e);new Promise(i).then(a=>{clearTimeout(s),n(a)}).catch(a=>{clearTimeout(s),r(a)})}),Il=(i,e,t)=>new Promise((n,r)=>{let s=!0;const o=setTimeout(()=>{if(!s)return;s=!1;const a=t||`Promise timeout hit: ${e}`;r(a)},e);i().then(a=>{s&&(s=!1,clearTimeout(o),n(a))}).catch(a=>{s&&(s=!1,clearTimeout(o),r(a))})}),lP=i=>{if(typeof i!="object")return{isValid:!1,error:`Response object has invalid 'handler' key. Expected an object, got ${typeof i}`};const e=sP.filter(t=>!(t in i));return e.length?{isValid:!1,error:`Handler in Response object does not provide compulsory keys: ${e.join(", ")}`}:{isValid:!0,ok:i}},uP=i=>{if(i&&typeof i!="string"&&typeof i!="object")throw new Error('Please provide the intent target as one of the valid values: "reuse", "startNew", { app: string }, { instance: string } ')},dP=i=>{if(i){if(typeof i!="object")throw new Error("Please provide the intent context as an object");if(i.type&&typeof i.type!="string")throw new Error("Please provide the intent context as an object with 'type' property as string");if(i.data&&typeof i.data!="object")throw new Error("Please provide the intent context as an object with 'data' property as object")}},hP=i=>{if(!i.applicationName)throw new Error(`Please provide applicationName for handler ${JSON.stringify(i)}`);if(!i.type)throw new Error(`Please provide type for handler ${JSON.stringify(i)}`);if(i.type==="instance"&&!i.instanceId)throw new Error(`Please provide instanceId for handler ${JSON.stringify(i)}`)},pP=i=>{if(i){if(typeof i!="number")throw new Error("Please provide the timeout as a number");if(i<=0)throw new Error("Please provide the timeout as a positive number")}},fP=i=>{if(i&&typeof i!="boolean")throw new Error("Please provide waitUserResponseIndefinitely as a boolean")},gP=i=>{if(!i)throw new Error("Provide 'handlerFilter' with at least one filter criteria of the following: 'intent' | 'contextTypes' | 'resultType' | 'applicationNames'");const{title:e,openResolver:t,timeout:n,intent:r,contextTypes:s,resultType:o,applicationNames:a}=i;if(typeof e<"u"&&(typeof e!="string"||!e.length))throw new Error("Provide 'title' as a non empty string");if(typeof t<"u"&&typeof t!="boolean")throw new Error("Provide 'openResolver' prop as a boolean");if(typeof n<"u"&&(typeof n!="number"||n<=0))throw new Error("Provide 'timeout' prop as a positive number");if(typeof r<"u"&&(typeof r!="string"||!r.length))throw new Error("Provide 'intent' as a non empty string");if(typeof s<"u"&&(!Array.isArray(s)||s.some(l=>typeof l!="string")))throw new Error("Provide 'contextTypes' as an array of non empty strings");if(typeof o<"u"&&(typeof o!="string"||!o.length))throw new Error("Provide 'resultType' as a non empty string");if(typeof a<"u"&&(!Array.isArray(a)||a.some(l=>typeof l!="string")))throw new Error("Provide 'applicationNames' as an array of non empty strings");const c="Provide at least one filter criteria of the following: 'intent' | 'contextTypes' | 'resultType' | 'applicationNames'";if(!Object.keys(i).length)throw new Error(c);if(!r&&!o&&(!s||!s.length)&&(!a||!a.length))throw new Error(c)},mP=i=>{var e,t;if(typeof i.intent!="string")return{isValid:!1,error:`Response object has invalid 'intent' key. Expected a string, got ${typeof i.intent}`};if(!((e=i.userSettings)===null||e===void 0)&&e.preserveChoice&&typeof((t=i.userSettings)===null||t===void 0?void 0:t.preserveChoice)!="boolean")return{isValid:!1,error:`Response object has invalid 'userSettings.preserveChoice' key. Expected a boolean, got ${typeof i.userSettings.preserveChoice}`};const{isValid:n,error:r}=lP(i.handler);return n?{isValid:!0,ok:i}:{isValid:n,error:r}},yP=i=>{if(dP(i.context),uP(i.target),pP(i.timeout),fP(i.waitUserResponseIndefinitely),typeof i.clearSavedHandler<"u"&&typeof i.clearSavedHandler!="boolean")throw new Error("Please provide 'clearSavedHandler' as a boolean");i.handlers&&i.handlers.forEach(e=>hP(e))},wP=i=>{if(typeof i!="object")throw new Error("IntentHandler must be an object");if(typeof i.applicationName!="string"||!i.applicationName.length)throw new Error("Please provide 'applicationName' as a non-empty string");if(typeof i.type!="string"||!["app","instance"].includes(i.type))throw new Error(`Invalid 'type' property. Expected 'app' | 'instance' got ${i.type}`);if(typeof i.applicationTitle<"u"&&typeof i.applicationTitle!="string")throw new Error("Provide 'applicationTitle' as a string");if(typeof i.applicationDescription<"u"&&typeof i.applicationDescription!="string")throw new Error("Provide 'applicationDescription' as a string");if(typeof i.applicationIcon<"u"&&typeof i.applicationIcon!="string")throw new Error("Provide 'applicationIcon' as a string");if(typeof i.displayName<"u"&&typeof i.displayName!="string")throw new Error("Provide 'displayName' as a string");if(typeof i.contextTypes<"u"&&(!Array.isArray(i.contextTypes)||i.contextTypes.some(e=>typeof e!="string")))throw new Error("Provide 'contextTypes' as an array of non empty strings");if(typeof i.instanceId<"u"&&typeof i.instanceId!="string")throw new Error("Provide 'instanceId' as a string");if(typeof i.instanceTitle<"u"&&typeof i.instanceTitle!="string")throw new Error("Provide 'instanceTitle' as a string");if(typeof i.resultType<"u"&&typeof i.resultType!="string")throw new Error("Provide 'resultType' as a string")},vP=i=>{Object.keys(i).forEach(e=>{(i[e]===null||i[e]===void 0)&&delete i[e]})};class bP{constructor(e,t,n,r,s,o){this.interop=e,this.windows=t,this.logger=n,this.prefsController=s,this.appManager=o,this.myIntents=new Set,this.intentsResolverResponsePromises={},this.useIntentsResolverUI=!0,this.unregisterIntentPromises=[],this.checkIfIntentsResolverIsEnabled(r,o)}async find(e){await Promise.all(this.unregisterIntentPromises);let t=await this.all();if(typeof e>"u")return t;if(typeof e=="string")return t.filter(n=>n.name===e);if(typeof e!="object")throw new Error("Please provide the intentFilter as a string or an object!");if(e.contextType){const n=e.contextType.toLowerCase();t=t.filter(r=>r.handlers.some(s=>{var o;return(o=s.contextTypes)===null||o===void 0?void 0:o.some(a=>a.toLowerCase()===n)}))}if(e.resultType){const n=e.resultType.toLowerCase();t=t.filter(r=>r.handlers.some(s=>{var o;return((o=s.resultType)===null||o===void 0?void 0:o.toLowerCase())===n}))}return e.name&&(t=t.filter(n=>n.name===e.name)),t}async raise(e){if(typeof e!="string"&&typeof e!="object"||typeof e=="object"&&typeof e.intent!="string")throw new Error("Please provide the intent as a string or an object with an intent property!");typeof e=="string"&&(e={intent:e}),yP(e),await Promise.all(this.unregisterIntentPromises),e.clearSavedHandler&&(this.logger.trace(`User removes saved handler for intent ${e.intent}`),await this.removeRememberedHandler(e.intent));const t={},n=e.waitUserResponseIndefinitely?aP:e.timeout||py,r=await this.checkHandleRaiseWithRememberedHandler(e,t,n);if(r)return r;const s=this.coreRaiseIntent.bind(this,{request:e,resolverInstance:t,timeout:n});if(e.waitUserResponseIndefinitely)return s();const o=Il(s,n,`Timeout of ${n}ms hit for intent request ${JSON.stringify(e)}`);return o.catch(()=>this.handleRaiseOnError(t.instanceId)),o}async all(){await Promise.all(this.unregisterIntentPromises);let e;try{e=(await this.interop.invoke("T42.ACS.GetApplications",{withIntentsInfo:!0})).returned.applications}catch(l){return this.logger.error("Failed to get the applications!",l),[]}const t={},n=e.filter(l=>l.intents&&l.intents.length>0);for(const l of n)for(const u of l.intents){let p=t[u.name];p||(p={name:u.name,handlers:[]},t[u.name]=p);const f={applicationName:l.name,applicationTitle:l.title||"",applicationDescription:l.caption,displayName:u.displayName,contextTypes:u.contexts,applicationIcon:l.icon,type:"app",resultType:u.resultType};p.handlers.push(f)}const r=this.interop.servers(),s=r.map(l=>l.windowId).filter(l=>typeof l<"u"),o="T42.Wnd.GetInfo",a=this.interop.methods().some(l=>l.name===o);let c;if(a)try{c=(await this.interop.invoke(o,{ids:s})).returned.windows}catch{}for(const l of r)await Promise.all(l.getMethods().filter(u=>u.name.startsWith(Ma)).map(async u=>{const p=u.name.replace(Ma,"");let f=t[p];f||(f={name:p,handlers:[]},t[p]=f);const w=u.flags.intent,y=e.find(v=>v.name===l.application);let S;y&&y.intents&&(S=y.intents.find(v=>v.name===p));const O=await this.windowsIdToTitle(l.windowId,c),_={instanceId:l.instance,applicationName:l.application,applicationIcon:w.icon||(y==null?void 0:y.icon),applicationTitle:(y==null?void 0:y.title)||"",applicationDescription:w.description||(y==null?void 0:y.caption),displayName:w.displayName||(S==null?void 0:S.displayName),contextTypes:w.contextTypes||(S==null?void 0:S.contexts),instanceTitle:O,type:"instance",resultType:(S==null?void 0:S.resultType)||w.resultType};f.handlers.push(_)}));return Object.values(t)}addIntentListener(e,t){if(typeof e!="string"&&typeof e!="object"||typeof e=="object"&&typeof e.intent!="string")throw new Error("Please provide the intent as a string or an object with an intent property!");if(typeof t!="function")throw new Error("Please provide the handler as a function!");const n=typeof e=="string"?e:e.intent,r=`${Ma}${n}`;let s={},o;if(this.myIntents.has(n))throw new Error(`Intent listener for intent ${n} already registered!`);this.myIntents.add(n);const c={unsubscribe:()=>{this.myIntents.delete(n),o.then(()=>this.interop.unregister(r)).catch(l=>this.logger.trace(`Unregistration of a method with name ${r} failed with reason: ${JSON.stringify(l)}`))}};if(typeof e=="object"){const{intent:l,...u}=e;s=u}return o=this.interop.register({name:r,flags:{intent:s}},l=>{if(this.myIntents.has(n))return t(l)}),o.catch(l=>{this.myIntents.delete(n),this.logger.warn(`Registration of a method with name ${r} failed with reason: ${JSON.stringify(l)}`)}),c}async register(e,t){if(typeof e!="string"&&typeof e!="object"||typeof e=="object"&&typeof e.intent!="string")throw new Error("Please provide the intent as a string or an object with an intent property!");if(typeof t!="function")throw new Error("Please provide the handler as a function!");await Promise.all(this.unregisterIntentPromises);const n=typeof e=="string"?e:e.intent,r=this.buildInteropMethodName(n);let s={};if(this.myIntents.has(n))throw new Error(`Intent listener for intent ${n} already registered!`);if(this.myIntents.add(n),typeof e=="object"){const{intent:a,...c}=e;s=c}try{await this.interop.register({name:r,flags:{intent:s}},(a,c)=>{if(this.myIntents.has(n))return t(a,c)})}catch(a){throw this.myIntents.delete(n),new Error(`Registration of a method with name ${r} failed with reason: ${JSON.stringify(a)}`)}return{unsubscribe:()=>this.unsubscribeIntent(n)}}async filterHandlers(e){var t,n;if(gP(e),e.openResolver&&!this.useIntentsResolverUI)throw new Error("Cannot resolve 'filterHandlers' request using Intents Resolver UI because it's globally disabled");(t=this.logger)===null||t===void 0||t.trace(`Received 'filterHandlers' command with request: ${JSON.stringify(e)}`);const r=this.filterHandlersBy(await this.all(),e);if(!r||!r.length)return{handlers:[]};const{open:s,reason:o}=this.checkIfResolverShouldBeOpenedForFilterHandlers(r,e);if(!s)return(n=this.logger)===null||n===void 0||n.trace(`Intent Resolver UI won't be used. Reason: ${o}`),{handlers:r};const a={instanceId:void 0},c=e.timeout||fy;return{handlers:[await Il(()=>this.startResolverApp({request:e,resolverInstance:a,method:"filterHandlers"}),c,`Timeout of ${c}ms hit for 'filterHandlers' request with filter: ${JSON.stringify(e)}`)]}}async getIntents(e){var t;this.logger.trace(`Received 'getIntents' command with handler ${JSON.stringify(e)}`),wP(e);const n=await this.all();vP(e),(t=this.logger)===null||t===void 0||t.trace("Extracting valid intents for the passed handler");const r=this.extractIntentsWithInfoByHandler(n,e);return this.logger.trace(`Returning intents for handler ${JSON.stringify(e)}`),{intents:r}}async clearSavedHandlers(){this.logger.trace("Removing all saved handlers from prefs storage for current app"),await this.prefsController.update({intents:void 0})}filterHandlersBy(e,t){return e.filter(r=>{if(!(t.intent&&t.intent!==r.name)){if(t.resultType){const s=r.handlers.filter(o=>o.resultType&&o.resultType===t.resultType);if(!s.length)return;r.handlers=s}if(t.contextTypes){const s=r.handlers.filter(o=>{var a;return(a=t.contextTypes)===null||a===void 0?void 0:a.every(c=>{var l;return(l=o.contextTypes)===null||l===void 0?void 0:l.includes(c)})});if(!s.length)return;r.handlers=s}if(t.applicationNames){const s=r.handlers.filter(o=>{var a;return(a=t.applicationNames)===null||a===void 0?void 0:a.includes(o.applicationName)});if(!s.length)return;r.handlers=s}return r}}).map(r=>r.handlers).flat(1)}async coreRaiseIntent({request:e,resolverInstance:t,timeout:n}){var r,s;const o=await this.get(e.intent);if(typeof o>"u")throw new Error(`Intent ${e.intent} not found.`);const{open:a,reason:c}=this.checkIfResolverShouldBeOpenedForRaise(o,e);if(!a)return this.logger.trace(`Intent Resolver UI won't be used. Reason: ${c}`),e.waitUserResponseIndefinitely?Il(()=>this.raiseIntent(e,n),n,`Timeout of ${n}ms hit for raise to resolve`):this.raiseIntent(e,n);const l=await this.startResolverApp({request:e,method:"raise",resolverInstance:t});if((r=this.logger)===null||r===void 0||r.trace(`Raising intent to target handler: ${JSON.stringify(l)} with timeout of ${n}`),e.waitUserResponseIndefinitely)return Il(()=>this.raiseIntentToTargetHandler(e,l,n),n,`Timeout of ${n}ms hit for raise to resolve`);const u=await this.raiseIntentToTargetHandler(e,l,n);return(s=this.logger)===null||s===void 0||s.trace(`Result from raise() method for intent ${JSON.stringify(e.intent)}: ${JSON.stringify(u)}`),u}async get(e){return(await this.all()).find(t=>t.name===e)}async raiseIntent(e,t){const n=e.intent,r=await this.get(n);if(typeof r>"u")throw new Error(`Intent ${n} not found.`);const s=e.handlers?this.findHandlerByFilter(e.handlers,{type:"app"}):this.findHandlerByFilter(r.handlers,{type:"app"}),o=e.handlers?this.findHandlerByFilter(e.handlers,{type:"instance"}):this.findHandlerByFilter(r.handlers,{type:"instance"});let a;if((!e.target||e.target==="reuse")&&(a=o||s),e.target==="startNew"&&(a=s),typeof e.target=="object"&&e.target.app&&(a=this.findHandlerByFilter(r.handlers,{app:e.target.app})),typeof e.target=="object"&&e.target.instance&&(a=this.findHandlerByFilter(r.handlers,{instance:e.target.instance,app:e.target.app})),!a)throw new Error(`Can not raise intent for request ${JSON.stringify(e)} - can not find intent handler!`);return await this.raiseIntentToTargetHandler(e,a,t)}async raiseIntentToTargetHandler(e,t,n){var r,s;(r=this.logger)===null||r===void 0||r.trace(`Raising intent to target handler:${JSON.stringify(t)}`),t.instanceId||(t.instanceId=await this.invokeStartApp(t.applicationName,e.context,e.options));const o=`${Ma}${e.intent}`,a={methodResponseTimeoutMs:n?n+1e3:hy,waitTimeoutMs:n?n+1e3:hy},c=await this.interop.invoke(o,e.context,{instance:t.instanceId},a);return(s=this.logger)===null||s===void 0||s.trace(`raiseIntent command completed. Returning result: ${JSON.stringify(c)}`),{request:e,handler:{...t,type:"instance"},result:c.returned}}async startResolverApp({request:e,method:t,resolverInstance:n}){var r,s,o,a;(r=this.logger)===null||r===void 0||r.trace(`Intents Resolver UI with app name ${this.intentsResolverAppName} will be used for request: ${JSON.stringify(e)}`);const c=await this.registerIntentResolverMethod();(s=this.logger)===null||s===void 0||s.trace(`Registered interop method ${c}`);const l=this.buildStartContext(t,e,c),u=await this.buildStartOptions();(o=this.logger)===null||o===void 0||o.trace(`Starting Intents Resolver UI with context: ${JSON.stringify(l)} and options: ${JSON.stringify(u)}`);const p=await this.appManager.application(this.intentsResolverAppName).start(l,u);n.instanceId=p.id,(a=this.logger)===null||a===void 0||a.trace(`Intents Resolver instance with id ${p.id} opened`),this.subscribeOnInstanceStopped(p,t);const f=e.timeout||t==="raise"?py:fy;return this.createResponsePromise({intent:t==="raise"?e.intent:void 0,instanceId:p.id,responseMethodName:c,timeout:f,errorMsg:`Timeout of ${f}ms hit waiting for the user to choose a handler ${t==="raise"?`for intent ${e.intent}`:`for '${t}' method with filter ${JSON.stringify(e)}`}`}),await this.handleInstanceResponse({instanceId:p.id,caller:l.initialCaller,method:t,request:e})}async windowsIdToTitle(e,t){var n,r;if(typeof t<"u")return(n=t.find(a=>a.id===e))===null||n===void 0?void 0:n.title;const s=(r=this.windows)===null||r===void 0?void 0:r.findById(e);return await(s==null?void 0:s.getTitle())}async handleInstanceResponse({instanceId:e,method:t,request:n,caller:r}){var s,o,a;try{const c=await this.intentsResolverResponsePromises[e].promise,l=t==="raise"?`for intent ${c.intent} `:"";return(s=this.logger)===null||s===void 0||s.trace(`Intent handler chosen ${l}: ${JSON.stringify(c.handler)}. Stopping resolver instance with id ${e}`),this.stopResolverInstance(e),(o=this.logger)===null||o===void 0||o.trace(`Instance with id ${e} successfully stopped`),!((a=c.userSettings)===null||a===void 0)&&a.preserveChoice&&await this.saveUserChoice({intent:c.intent,handler:c.handler,filter:t==="filterHandlers"?{applicationNames:n.applicationNames,contextTypes:n.contextTypes,resultType:n.resultType}:void 0,caller:r}),c.handler}catch(c){throw this.stopResolverInstance(e),new Error(c)}}async registerIntentResolverMethod(){const e=iP+ae.generateId();return await this.interop.register(e,(t,n)=>this.resolverResponseHandler(t,n)),e}resolverResponseHandler(e,t){const{instance:n}=t,r=mP(e);if(!r){this.logger.trace(`Intent Resolver instance with id ${t.instance} sent invalid response. Error: ${r.error}`),this.intentsResolverResponsePromises[n].reject(r.error),this.stopResolverInstance(n);return}const s=r.ok;this.intentsResolverResponsePromises[n].resolve(s),this.cleanUpIntentResolverPromise(n)}buildStartContext(e,t,n){var r;const s=this.interop.instance.application||this.interop.instance.applicationName,o=((r=this.appManager.application(s))===null||r===void 0?void 0:r.title)||"",a={callerId:this.interop.instance.instance,methodName:n,initialCaller:{id:this.interop.instance.instance,applicationName:s,applicationTitle:o},resolverApi:"1.0"};return e==="raise"?{...a,intent:t}:{...a,handlerFilter:t}}async buildStartOptions(){const e=this.windows.my();if(!e)return;const t=await e.getBounds();return{top:(t.height-dy)/2+t.top,left:(t.width-uy)/2+t.left,width:uy,height:dy}}createResponsePromise({instanceId:e,intent:t,responseMethodName:n,timeout:r,errorMsg:s}){let o=()=>{},a=()=>{};const c=cP((l,u)=>{o=l,a=u},r,s);this.intentsResolverResponsePromises[e]={intent:t,resolve:o,reject:a,promise:c,methodName:n}}async invokeStartApp(e,t,n){return(await this.interop.invoke("T42.ACS.StartApplication",{Name:e,options:{...n,startedByIntentAPI:!0}})).returned.Id}subscribeOnInstanceStopped(e,t){const{application:n}=e,r=n.onInstanceStopped(s=>{if(s.id!==e.id)return;const o=this.intentsResolverResponsePromises[s.id];if(!o)return r();const a=`Cannot resolve ${t==="raise"?`raised intent ${o.intent}`:`'${t}' method`} - User closed ${e.application.name} app without choosing a handler`;o.reject(a),this.cleanUpIntentResolverPromise(s.id),r()})}async cleanUpIntentResolverPromise(e){const t=this.intentsResolverResponsePromises[e];if(!t)return;this.interop.unregister(t.methodName).catch(r=>this.logger.warn(r)),delete this.intentsResolverResponsePromises[e]}handleRaiseOnError(e){e&&this.stopResolverInstance(e)}stopResolverInstance(e){const t=this.windows.findById(e);t==null||t.close().catch(n=>this.logger.error(n))}checkIfIntentsResolverIsEnabled(e,t){var n,r,s,o,a;if(!t){this.useIntentsResolverUI=!1;return}this.useIntentsResolverUI=typeof((n=e.intents)===null||n===void 0?void 0:n.enableIntentsResolverUI)=="boolean"?e.intents.enableIntentsResolverUI:!0,this.intentsResolverAppName=(s=(r=e.intents)===null||r===void 0?void 0:r.intentsResolverAppName)!==null&&s!==void 0?s:oP,this.intentsResolverResponseTimeout=(a=(o=e.intents)===null||o===void 0?void 0:o.methodResponseTimeoutMs)!==null&&a!==void 0?a:rP}checkIfResolverShouldBeOpenedForRaise(e,t){const n=this.checkIfIntentsResolverShouldBeOpened();return n.open?this.checkIfIntentHasMoreThanOneHandler(e,t)?{open:!0}:{open:!1,reason:`Raised intent ${e.name} has only one handler`}:n}checkIfResolverShouldBeOpenedForFilterHandlers(e,t){return e.length===1?{open:!1,reason:`There's only one valid intent handler for filter ${JSON.stringify(t)}`}:typeof(t==null?void 0:t.openResolver)=="boolean"&&!t.openResolver?{open:!1,reason:"Intents resolver is disabled by IntentHandler filter"}:this.checkIfIntentsResolverShouldBeOpened()}checkIfIntentsResolverShouldBeOpened(){return this.useIntentsResolverUI?this.appManager.application(this.intentsResolverAppName)?{open:!0}:{open:!1,reason:`Intent Resolver Application with name ${this.intentsResolverAppName} not found.`}:{open:!1,reason:"Intent Resolver is disabled. Resolving to first found handler"}}checkIfIntentHasMoreThanOneHandler(e,t){return t.target?t.target==="reuse"?t.handlers?t.handlers.filter(n=>n.type==="instance"&&n.instanceId).length>1||t.handlers.filter(n=>n.type==="app").length>1:e.handlers.filter(n=>n.type==="instance"&&n.instanceId).length>1||e.handlers.filter(n=>n.type==="app").length>1:t.target==="startNew"?t.handlers?t.handlers.filter(n=>n.type==="app").length>1:e.handlers.filter(n=>n.type==="app").length>1:(typeof t.target=="object",!1):t.handlers?t.handlers.length>1:e.handlers.length>1}buildInteropMethodName(e){return`${Ma}${e}`}clearUnregistrationPromise(e){this.unregisterIntentPromises=this.unregisterIntentPromises.filter(t=>t!==e)}unsubscribeIntent(e){this.myIntents.delete(e);const t=this.buildInteropMethodName(e),n=this.interop.unregister(t);this.unregisterIntentPromises.push(n),n.then(()=>{this.clearUnregistrationPromise(n)}).catch(r=>{this.logger.error(`Unregistration of a method with name ${t} failed with reason: `,r),this.clearUnregistrationPromise(n)})}findHandlerByFilter(e,t){if(t.type)return e.find(n=>n.type===t.type);if(t.instance)return e.find(n=>t.app?n.applicationName===t.app&&n.instanceId===t.instance:n.instanceId===t.instance);if(t.app)return e.find(n=>n.applicationName===t.app)}extractIntentsWithInfoByHandler(e,t){return e.reduce((r,s)=>(s.handlers.forEach(o=>{if(!Object.keys(t).every(l=>{var u;return l==="contextTypes"?(u=t.contextTypes)===null||u===void 0?void 0:u.every(p=>{var f;return(f=o.contextTypes)===null||f===void 0?void 0:f.includes(p)}):o[l]===t[l]}))return;const c={intent:s.name,contextTypes:o.contextTypes,description:o.applicationDescription,displayName:o.displayName,icon:o.applicationIcon,resultType:o.resultType};r.push(c)}),r),[])}async removeRememberedHandler(e){var t;this.logger.trace(`Removing saved handler from prefs storage for intent ${e}`);const n=await this.prefsController.get(),r=(t=n.data)===null||t===void 0?void 0:t.intents;if(!r){this.logger.trace("No app prefs found for current app");return}delete r[e];const s={...n.data,intents:r};await this.prefsController.update(s),this.logger.trace(`Handler saved choice for intent ${e} removed successfully`)}async checkForRememberedHandler(e){var t,n;const s=(n=(t=(await this.prefsController.get()).data)===null||t===void 0?void 0:t.intents)===null||n===void 0?void 0:n[e.intent];return s==null?void 0:s.handler}async checkHandleRaiseWithRememberedHandler(e,t,n){const r=await this.checkForRememberedHandler(e);if(!r)return;const s={...e,target:{app:r.applicationName,instance:r.instanceId}};try{return await this.coreRaiseIntent({request:s,resolverInstance:t,timeout:n})}catch{this.logger.trace("Could not raise intent to remembered handler. Removing it from Prefs store"),await this.removeRememberedHandler(e.intent)}}async saveUserChoice({intent:e,handler:t,filter:n,caller:r}){var s,o;const a=await this.prefsController.get(r.applicationName),c=((s=a==null?void 0:a.data)===null||s===void 0?void 0:s.intents)||{},l={...a.data,intents:{...c,[e]:{handler:t,filter:n}}};await this.prefsController.update(l,{app:r.applicationName}),(o=this.logger)===null||o===void 0||o.info(`Saved user's choice of handler for '${r.applicationName}' app`)}}class _P{constructor(){this.initialized=!1,this.details=[],this.reject=()=>{},this.resolve=()=>{}}init(e){this.initialized=!0,this.addCall(e),this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}addCall(e){this.details.push({date:new Date,config:e})}done(e){this.resolve(e)}error(e){this.reject(e)}}class CP{constructor(e,t){this.appName=e,this.interop=t,this.registry=pt(),this.interopMethodRegistered=!1}async get(e){return(await this.interop.invoke("T42.Prefs.Get",{app:e??this.appName})).returned}async set(e,t){var n;this.verifyDataObject(e),await this.interop.invoke("T42.Prefs.Set",{app:(n=t==null?void 0:t.app)!==null&&n!==void 0?n:this.appName,data:e,merge:!1})}async setFor(e,t){return this.verifyApp(e),this.verifyDataObject(t),this.set(t,{app:e})}async update(e,t){var n;this.verifyDataObject(e),await this.interop.invoke("T42.Prefs.Set",{app:(n=t==null?void 0:t.app)!==null&&n!==void 0?n:this.appName,data:e,merge:!0})}async updateFor(e,t){return this.verifyApp(e),this.verifyDataObject(t),this.update(t,{app:e})}async clear(e){await this.interop.invoke("T42.Prefs.Set",{app:e??this.appName,clear:!0})}async clearFor(e){this.verifyApp(e),await this.interop.invoke("T42.Prefs.Set",{app:e,clear:!0})}async getAll(){return(await this.interop.invoke("T42.Prefs.Get")).returned}async clearAll(){await this.interop.invoke("T42.Prefs.Set",{clear:!0})}subscribe(e){return this.verifyCallback(e),this.subscribeFor(this.appName,e)}subscribeFor(e,t){this.verifyApp(e),this.verifyCallback(t);const n=this.registry.add(e,t);return this.registerInteropIfNeeded().then(()=>{this.interop.invoke("T42.Prefs.Get",{app:e,subscribe:!0})}),()=>{n()}}async registerInteropIfNeeded(){this.interopMethodRegistered||(this.interopMethodRegistered=!0,await this.interop.register("T42.Prefs.Update",e=>{this.registry.execute(e.app,e)}))}verifyApp(e){if(!e)throw new Error("app should be defined");if(!bn(e))throw new Error("app should be a string")}verifyDataObject(e){if(!e)throw new Error("data should be defined");if(!id(e))throw new Error("data should be an object")}verifyCallback(e){if(!ii(e))throw new Error("callback should be defined")}}class SP{constructor(e,t){this.methodName=e,this.interop=t}async get(e){return(await this.invoke("get-cookies",{filter:e})).returned.cookies}async set(e){this.verifyCookieObject(e),await this.invoke("set-cookie",e)}async remove(e,t){if(!bn(e))throw new Error("url should be a string");if(!bn(t))throw new Error("name should be a string");await this.invoke("remove-cookie",{url:e,name:t})}invoke(e,t){return this.interop.invoke(this.methodName,{command:e,args:t})}verifyCookieObject(e){if(!e)throw new Error("cookie should be defined");if(!id(e))throw new Error("cookie should be an object")}}function IP(i,e){const t=new SP(e,i);return{get:t.get.bind(t),remove:t.remove.bind(t),set:t.set.bind(t),ready:()=>Promise.resolve()}}class xP{constructor(e){this.config=e,this.glue42EventName="Glue42",this.events={notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)}}}start(e){ae.isNode()||(this.glue=e,this.wireCustomEventListener(),this.announceStarted())}wireCustomEventListener(){window.addEventListener(this.glue42EventName,e=>{const t=e.detail;if(!t||!t.glue42)return;const n=t.glue42.event,r=this.events[n];r&&r.handle(t.glue42.message)})}announceStarted(){this.send("start")}handleRequestGlue(){if(!this.config.exposeAPI){this.send("requestGlueResponse",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."});return}this.send("requestGlueResponse",{glue:this.glue})}handleNotifyStarted(){this.announceStarted()}send(e,t){const n={glue42:{event:e,message:t}},r=new CustomEvent(this.glue42EventName,{detail:n});window.dispatchEvent(r)}}const Ss=new _P,rd=async i=>{let e=!1;Ss.initialized||(e=!0,Ss.init(i));const t=typeof window<"u"&&window.glue42gd;if(t&&!e)return Ss.addCall(i),Ss.promise;const n=await kP(i,t);return Ss.resolve(n),n},kP=async(i,e)=>{const t="T42.GD.Execute",n=ae.getGDMajorVersion();i=i||{};const r=QE(i);i.gateway=i.gateway||{};let s,o,a,c,l,u;const p=new xP(r);function f(b){if(r.windows){const R=E("windows",b.logger,r.windows);return a=TE(b.agm,R,()=>s,()=>c,()=>l,n),x(a),a}}function w(b){var R;if(r.activities&&mc.checkIsUsingGW3Implementation&&mc.checkIsUsingGW3Implementation(b.connection)){const z=E("activity",b.logger,r.activities);return o=new mc({connection:b.connection,contexts:b.contexts,agm:b.agm,logger:z,logLevel:"info",disableAutoAnnounce:!1,disposeRequestHandling:"exit",announcementInfo:null,windows:a,appManagerGetter:()=>s,mode:r.activities.mode,typesToTrack:r.activities.typesToTrack,activityId:(R=e==null?void 0:e.activityInfo)===null||R===void 0?void 0:R.activityId,gdMajorVersion:n}).api,x(o),o}}function y(b){if(!r.appManager)return;const R=E("appManager",b.logger,r.appManager);return s=fE({agm:b.agm,windows:a,logger:R,activities:o,mode:r.appManager.mode,gdMajorVersion:n}),x(s),s}function S(b){var R;if(!r.layouts)return;const z=E("layouts",b.logger,r.layouts),V=r.layouts,Q=ME({agm:b.agm,appManager:s,activityGetter:()=>o,logger:z,mode:V.mode,autoSaveWindowContext:(R=V.autoSaveWindowContext)!==null&&R!==void 0?R:!1,gdMajorVersion:n});return x(Q),Q}function O(b){if(!r.channels||!b.contexts)return;const R=E("channels",b.logger,r.channels);return l=GE(b.contexts,b.agm,()=>a,R),x(l),l}function _(b){const R=KE(b.agm);return x(R),R}function v(b){const R=new bP(b.agm,a,b.logger.subLogger("intents"),i,u,s);return x(R),R}function C(b){const R=new ZE(b.interop,b.logger).toAPI();return x(R),R}function T(b){if(r.displays){const R=E("displays",b.logger,r.displays);return c=new DE(b.agm,R),x(c),c}}function M(b){if(!b.contexts)return;const R=nP(b.contexts,b.interop);return x(R),R}function $(b){var R,z;const V=(z=(R=i.application)!==null&&R!==void 0?R:e==null?void 0:e.applicationName)!==null&&z!==void 0?z:b.interop.instance.application;return u=new CP(V,b.interop),x(u),u}function G(b){const R=IP(b.interop,t);return x(R),R}function E(b,R,z){const V=R.subLogger(b);if(z&&z.logger){const Q=z.logger;Q.console&&V.consoleLevel(Q.console),Q.publish&&V.publishLevel(Q.publish)}return V}const D={libs:[{name:"windows",create:f},{name:"activities",create:w},{name:"appManager",create:y},{name:"layouts",create:S},{name:"channels",create:O},{name:"hotkeys",create:_},{name:"displays",create:T},{name:"prefs",create:$},{name:"intents",create:v},{name:"notifications",create:C},{name:"themes",create:M},{name:"cookies",create:G}],version:Qb,enrichGlue:b=>{b.config.activities=r.activities,b.config.windows=r.windows,b.config.appManager=r.appManager,b.config.layouts=r.layouts,b.config.channels=r.channels,b.config.displays=r.displays}},A=[];typeof window<"u"&&(window.glueFactoryLog||(window.glueFactoryLog=[]),window.glueFactoryLog.push(A));function x(b){A.push(b)}const N=await cs(i,D);return Array.isArray(i==null?void 0:i.libraries)&&i.libraries.length&&await Promise.all(i.libraries.map(b=>b(N,i))),p.start(N),N};rd.coreVersion=cs.version;rd.version=Qb;rd.calls=Ss;var sh,oh;let zs=rd,gy=!0;if(typeof window<"u"){const i=window,e=(sh=i.iodesktop)!==null&&sh!==void 0?sh:i.glue42gd;e&&e.autoInjected&&(zs=(oh=i.IODesktop)!==null&&oh!==void 0?oh:i.Glue,gy=!1),gy&&(i.Glue=zs,i.IODesktop=zs),delete i.IOBrowser,delete i.GlueCore}zs.default=zs;var TP=zs;const my="Tick42.FDC3.Intents.",AP="no-app-window",EP=["interop","appManager","intents"],PP=["myInstance","applications","application","instances","onInstanceStarted","onInstanceStopped","onAppAdded","onAppRemoved"];var wt=function(i){return{ok:!0,result:i}},ct=function(i){return{ok:!1,error:i}},NP=function(i){return i.ok===!0?Promise.resolve(i.result):Promise.reject(i.error)},RP=function(i,e){return e.ok===!0?e.result:i},MP=function(i){if(i.ok===!0)return i.result;throw i.error},jP=function(i,e){return e.ok===!0?wt(i(e.result)):e},yy=function(i,e,t){return e.ok===!1?e:t.ok===!1?t:wt(i(e.result,t.result))},ah=function(i,e){return e.ok===!0?e:ct(i(e.error))},OP=function(i,e){return e.ok===!0?i(e.result):e};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xp=function(){return xp=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},xp.apply(this,arguments)};function DP(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(i);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(i,n[r])&&(t[n[r]]=i[n[r]]);return t}function kp(i,e){if(i===e||i===null&&e===null)return!0;if(typeof i!=typeof e)return!1;if(typeof i=="object"){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(var t=0;t<i.length;t++)if(!kp(i[t],e[t]))return!1;return!0}var n=Object.keys(i);if(n.length!==Object.keys(e).length)return!1;for(var t=0;t<n.length;t++)if(!e.hasOwnProperty(n[t])||!kp(i[n[t]],e[n[t]]))return!1;return!0}}var sc=function(i){return Array.isArray(i)},xl=function(i){return typeof i=="object"&&i!==null&&!sc(i)},$P=function(i){switch(typeof i){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return i instanceof Array?"an array":i===null?"null":"an object";default:return JSON.stringify(i)}},xi=function(i,e){return"expected "+i+", got "+$P(e)},ja=function(i){return i.map(function(e){return typeof e=="string"?"."+e:"["+e+"]"}).join("")},Oa=function(i,e){var t=e.at,n=DP(e,["at"]);return xp({at:i+(t||"")},n)},ft=function(){function i(e){var t=this;this.decode=e,this.run=function(n){return ah(function(r){return{kind:"DecoderError",input:n,at:"input"+(r.at||""),message:r.message||""}},t.decode(n))},this.runPromise=function(n){return NP(t.run(n))},this.runWithException=function(n){return MP(t.run(n))},this.map=function(n){return new i(function(r){return jP(n,t.decode(r))})},this.andThen=function(n){return new i(function(r){return OP(function(s){return n(s).decode(r)},t.decode(r))})},this.where=function(n,r){return t.andThen(function(s){return n(s)?i.succeed(s):i.fail(r)})}}return i.string=function(){return new i(function(e){return typeof e=="string"?wt(e):ct({message:xi("a string",e)})})},i.number=function(){return new i(function(e){return typeof e=="number"?wt(e):ct({message:xi("a number",e)})})},i.boolean=function(){return new i(function(e){return typeof e=="boolean"?wt(e):ct({message:xi("a boolean",e)})})},i.constant=function(e){return new i(function(t){return kp(t,e)?wt(e):ct({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(t)})})},i.object=function(e){return new i(function(t){if(xl(t)&&e){var n={};for(var r in e)if(e.hasOwnProperty(r)){var s=e[r].decode(t[r]);if(s.ok===!0)s.result!==void 0&&(n[r]=s.result);else return t[r]===void 0?ct({message:"the key '"+r+"' is required but was not present"}):ct(Oa("."+r,s.error))}return wt(n)}else return xl(t)?wt(t):ct({message:xi("an object",t)})})},i.array=function(e){return new i(function(t){if(sc(t)&&e){var n=function(r,s){return ah(function(o){return Oa("["+s+"]",o)},e.decode(r))};return t.reduce(function(r,s,o){return yy(function(a,c){return a.concat([c])},r,n(s,o))},wt([]))}else return sc(t)?wt(t):ct({message:xi("an array",t)})})},i.tuple=function(e){return new i(function(t){if(sc(t)){if(t.length!==e.length)return ct({message:"expected a tuple of length "+e.length+", got one of length "+t.length});for(var n=[],r=0;r<e.length;r++){var s=e[r].decode(t[r]);if(s.ok)n[r]=s.result;else return ct(Oa("["+r+"]",s.error))}return wt(n)}else return ct({message:xi("a tuple of length "+e.length,t)})})},i.union=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return i.oneOf.apply(i,[e,t].concat(n))},i.intersection=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return new i(function(s){return[e,t].concat(n).reduce(function(o,a){return yy(Object.assign,o,a.decode(s))},wt({}))})},i.anyJson=function(){return new i(function(e){return wt(e)})},i.unknownJson=function(){return new i(function(e){return wt(e)})},i.dict=function(e){return new i(function(t){if(xl(t)){var n={};for(var r in t)if(t.hasOwnProperty(r)){var s=e.decode(t[r]);if(s.ok===!0)n[r]=s.result;else return ct(Oa("."+r,s.error))}return wt(n)}else return ct({message:xi("an object",t)})})},i.optional=function(e){return new i(function(t){return t==null?wt(void 0):e.decode(t)})},i.oneOf=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new i(function(n){for(var r=[],s=0;s<e.length;s++){var o=e[s].decode(n);if(o.ok===!0)return o;r[s]=o.error}var a=r.map(function(c){return"at error"+(c.at||"")+": "+c.message}).join('", "');return ct({message:'expected a value matching one of the decoders, got the errors ["'+a+'"]'})})},i.withDefault=function(e,t){return new i(function(n){return wt(RP(e,t.decode(n)))})},i.valueAt=function(e,t){return new i(function(n){for(var r=n,s=0;s<e.length;s++){if(r===void 0)return ct({at:ja(e.slice(0,s+1)),message:"path does not exist"});if(typeof e[s]=="string"&&!xl(r))return ct({at:ja(e.slice(0,s+1)),message:xi("an object",r)});if(typeof e[s]=="number"&&!sc(r))return ct({at:ja(e.slice(0,s+1)),message:xi("an array",r)});r=r[e[s]]}return ah(function(o){return r===void 0?{at:ja(e),message:"path does not exist"}:Oa(ja(e),o)},t.decode(r))})},i.succeed=function(e){return new i(function(t){return wt(e)})},i.fail=function(e){return new i(function(t){return ct({message:e})})},i.lazy=function(e){return new i(function(t){return e().decode(t)})},i}(),Pt=ft.string,Ru=ft.number,FP=ft.boolean,LP=ft.anyJson;ft.unknownJson;var sr=ft.constant,di=ft.object,Mu=ft.array;ft.tuple;ft.dict;var pe=ft.optional,sd=ft.oneOf;ft.union;ft.intersection;ft.withDefault;ft.valueAt;ft.succeed;ft.fail;ft.lazy;const $t=Pt().where(i=>i.length>0,"Expected a non-empty string"),wy=Ru().where(i=>i>=0,"Expected a non-negative number"),WP=sd(sr("top"),sr("left"),sr("right"),sr("bottom")),BP=pe(di({top:pe(Ru()),left:pe(Ru()),width:pe(wy),height:pe(wy),context:pe(LP()),relativeTo:pe($t),relativeDirection:pe(WP),windowId:pe($t)})),HP=sd(sr("startNew"),sr("reuse"),di({app:pe($t),instance:pe($t)})),GP=di({type:pe($t),data:pe(di())}),zP=di({applicationName:$t,applicationTitle:pe(Pt()),applicationDescription:pe(Pt()),applicationIcon:pe(Pt()),type:sd(sr("app"),sr("instance")),displayName:pe(Pt()),contextTypes:pe(Mu($t)),instanceId:pe(Pt()),instanceTitle:pe(Pt()),resultType:pe(Pt())}),UP=di({intent:$t,target:pe(HP),context:pe(GP),options:pe(BP),handlers:pe(Mu(zP))}),qP=sd($t,UP),VP=di({title:pe($t),openResolver:pe(FP()),timeout:pe(Ru()),intent:pe($t),contextTypes:pe(Mu($t)),resultType:pe($t),applicationNames:pe(Mu($t))}),JP=di({id:$t,applicationName:pe(Pt()),applicationTitle:pe(Pt())}),KP=di({methodName:$t,callerId:pe(Pt()),intent:pe(qP),handlerFilter:pe(VP),initialCaller:pe(JP),correlationId:pe(Pt()),resolverApi:pe(Pt())}),QP=di({applicationName:Pt(),applicationIcon:pe(Pt()),instanceId:pe(Pt()),applicationTitle:pe(Pt())}),XP=i=>{const e=Object.keys(i),t=EP.filter(s=>!e.includes(s));if(t.length)return{ok:!1,error:`Glue is missing the following API${t.length>1?"s":""}: ${t.join(", ")}`};const n=Object.keys(i.appManager),r=PP.filter(s=>!n.includes(s));return r.length?{ok:!1,error:`Glue is not initialized with { "appManager: "full" }. Missing props: ${r.join(", ")}`}:{ok:!0}},YP=i=>`${i.message} at ${i.at} for input: ${JSON.stringify(i.input)}`,vy=i=>{Object.keys(i).forEach(e=>{(i[e]===null||i[e]===void 0)&&delete i[e]})};class ZP{constructor(){d(this,"glue");d(this,"_intent");d(this,"_handlerFilter");d(this,"_callerId");d(this,"_methodName");d(this,"_resolvingMethod");d(this,"_initialCaller");d(this,"_correlationId");d(this,"_resolverApi")}async initialize(e){var s;const{ok:t,error:n}=XP(e);if(!t&&n)return this.announceInitFailure(n);this.glue=e;const r=await((s=this.glue.windows.my())==null?void 0:s.getContext());await this.validateStartupContext(r),this._intent=r.intent,this._callerId=r.callerId,this._methodName=r.methodName,this._handlerFilter=r.handlerFilter,this._initialCaller=r.initialCaller,this._correlationId=r.correlationId,this._resolverApi=r.resolverApi,this._resolvingMethod=r.handlerFilter?"filterHandlers":"raise"}get intent(){return this._intent}get callerId(){return this._callerId}get initialCaller(){return this._initialCaller}get resolvingMethod(){return this._resolvingMethod}get handlerFilter(){return this._handlerFilter}getTitle(){return this.resolvingMethod==="filterHandlers"&&this.handlerFilter?this.handlerFilter.title:`Choose an app to ${this.getIntentName()}`}async sendInteropMethodResponse(e,t){var a,c;const n=this.resolvingMethod==="raise"?await this.getIntentHandlerForRaise(e):await this.getIntentHandlerForFilterHandlers(e);if(!n)throw new Error(`There's no such existing intent handler: ${JSON.stringify(e)}`);const r=this.isMethodRegistered();if(!this.isInstanceStillRunning()){(a=this.glue.windows.my())==null||a.close();return}const s=this.intent?this.getIntentName():(t==null?void 0:t.intent)||((c=this.handlerFilter)==null?void 0:c.intent);if(t!=null&&t.saveHandler&&!s)throw new Error("Intent is ambiguous. Provide it in 'options' argument");const o=this._resolverApi?{intent:s,handler:n,correlationId:this._correlationId,userSettings:{preserveChoice:t==null?void 0:t.saveHandler}}:{intent:s,handler:n};return r?this.glue.interop.invoke(this._methodName,o,{instance:this.callerId}):this.waitForResponseMethodAdded(o)}subscribeForServerMethodAdded(e){return this.glue.interop.serverMethodAdded(({server:t,method:n})=>{this.checkIfInstanceIntentHandler(t,n)&&this.buildAddedIntentHandler(t.application||t.applicationName,t.instance).then(s=>{if(!s)return;const o=this.buildIntentInfoFromInstanceMethod(n);e(s,o)})})}subscribeForServerMethodRemoved(e){return this.glue.interop.serverMethodRemoved(({server:t,method:n})=>{if(!this.checkIfInstanceIntentHandler(t,n))return;const s=this.buildRemovedIntentHandler({instance:t}),o=this.buildIntentInfoFromInstanceMethod(n);e(s,o)})}subscribeOnAppAdded(e){return this.glue.appManager.onAppAdded(t=>{let n;this.checkIfAppIntentHandler(t,"added").then(r=>{if(r)return this.buildAddedIntentHandler(t.name)}).then(r=>{if(r)return n=r,this.getValidAppIntentsByFilter(t)}).then(r=>(r||[]).map(s=>{const o=this.buildIntentInfoFromAppIntent(s);e(n,o)}))})}subscribeOnAppRemoved(e){return this.glue.appManager.onAppRemoved(t=>{let n;this.checkIfAppIntentHandler(t,"removed").then(r=>{if(r)return this.buildRemovedIntentHandler({app:t})}).then(r=>{if(r)return n=r,this.getValidAppIntentsByFilter(t)}).then(r=>(r||[]).map(s=>{const o=this.buildIntentInfoFromAppIntent(s);e(n,o)}))})}getIntentName(){return typeof this.intent=="object"?this.intent.intent:this.intent}waitForResponseMethodAdded(e){return new Promise((n,r)=>{const s=this.glue.interop.serverMethodAdded(({server:o,method:a})=>{o.instance!==this.callerId||a.name!==this._methodName||this.glue.interop.invoke(this._methodName,e,{instance:this.callerId}).then(c=>{n(c)}).catch(c=>{r(c)}).finally(()=>{s&&s()})})})}async checkIfAppIntentHandler(e,t){if(this.resolvingMethod==="raise"&&typeof this.intent=="object"&&this.intent.handlers)return this.checkIfAppInPassedHandlers(e);const n=window.glue42core||window.iobrowser,r=window.glue42gd||window.iodesktop;return n&&n.webStarted?this.checkInBrowserIfAppShouldShow(e,t):r?this.checkInDesktopIfAppShouldShow(e):!1}checkIfInstanceIntentHandler(e,t){return this.resolvingMethod==="filterHandlers"?this.checkIfValidIntentServerMethodWithHandlerFilter(e,t):!(!this.isMethodIsForPassedIntent(t.name,this.getIntentName())||typeof this.intent=="object"&&this.intent.handlers&&!this.checkIfInstanceInPassedHandlers(e))}async getValidAppIntentsByFilter(e){const n=window.glue42gd||window.iodesktop?(await e.getConfiguration()).intents:e.userProperties.intents;return n?this.filterValidAppIntentsByFilter(n,e.name):[]}buildIntentInfoFromAppIntent(e){const t={intent:e.name,contextTypes:e.contexts||e.contextTypes,description:e.description,displayName:e.displayName,icon:e.icon,resultType:e.resultType};return vy(t),t}buildIntentInfoFromInstanceMethod(e){const t=e.flags.intent,n={intent:e.name.replace(my,""),contextTypes:t.contextTypes||t.contexts,description:t.description,displayName:t.displayName,icon:t.icon,resultType:t.resultType};return vy(n),n}filterValidAppIntentsByFilter(e,t){const n=this.resolvingMethod==="filterHandlers"?this.handlerFilter:{intent:this.getIntentName()};return e.filter(r=>{if(!(n.intent&&n.intent!==r.name)&&!(n.resultType&&n.resultType!==r.resultType)&&!(n.contextTypes&&(!r.contexts||!n.contextTypes.every(s=>{var o;return(o=r.contexts)==null?void 0:o.includes(s)})))&&!(n.applicationNames&&!n.applicationNames.includes(t)))return r})}checkIfValidIntentServerMethodWithHandlerFilter(e,t){var r,s,o,a,c,l;if((r=this.handlerFilter)!=null&&r.intent&&!this.isMethodIsForPassedIntent(t.name,this.handlerFilter.intent))return!1;const n=t.flags.intent;return!((s=this.handlerFilter)!=null&&s.resultType&&(!(n!=null&&n.resultType)||n.resultType!==this.handlerFilter.resultType)||(o=this.handlerFilter)!=null&&o.contextTypes&&(!((a=n==null?void 0:n.contextTypes)!=null&&a.length)||!this.handlerFilter.contextTypes.every(u=>n.contextTypes.includes(u)))||(c=this.handlerFilter)!=null&&c.applicationNames&&!((l=this.handlerFilter)!=null&&l.applicationNames.includes(e.application||e.applicationName)))}checkIfAppInPassedHandlers(e){var n;const t=(n=this.intent.handlers)==null?void 0:n.filter(r=>r.applicationName===e.name);return t!=null&&t.length?this.intent.target==="startNew"?!!t.find(r=>r.type==="app"):this.intent.target==="reuse"?!t.find(s=>s.type==="instance"):!!t.find(r=>r.type==="app"):!1}async checkInBrowserIfAppShouldShow(e,t){var r,s,o;if(this.resolvingMethod==="filterHandlers")return e.userProperties.intents?!!this.filterValidAppIntentsByFilter(e.userProperties.intents,e.name).length:!1;const n=this.getIntentName();if(t==="removed")return!!((r=e.userProperties.intents)!=null&&r.find(a=>a.name===n));if(typeof this.intent=="object"&&this.intent.target==="reuse"){if(!((s=e.userProperties.intents)==null?void 0:s.find(l=>l.name===n)))return!1;const c=(await this.glue.intents.find(n)).find(l=>l.name===n);return c?!c.handlers.find(l=>l.applicationName===e.name&&l.type==="instance"&&l.instanceId):!1}return!!((o=e.userProperties.intents)!=null&&o.find(a=>a.name===n))}async checkInDesktopIfAppShouldShow(e){const t=await e.getConfiguration();if(!(t!=null&&t.intents)||t.allowMultiple===!1&&this.glue.interop.servers().find(o=>o.application===e.name))return!1;if(this.resolvingMethod==="filterHandlers")return!!this.filterValidAppIntentsByFilter(t.intents,e.name).length;const r=this.getIntentName(),s=(await this.glue.intents.find(r)).find(o=>o.name===r);if(!s)return!1;if(typeof this.intent=="object"&&this.intent.target==="reuse"){const o=s.handlers.filter(c=>c.applicationName===e.name);return o.length?!o.some(c=>c.instanceId):!1}return!!s.handlers.find(o=>o.applicationName===e.name)}checkIfInstanceInPassedHandlers(e){var t;return!!((t=this.intent.handlers)!=null&&t.find(n=>n.applicationName===e.application&&e.instance===n.instanceId))}async buildAddedIntentHandler(e,t){const n=this.glue.appManager.application(e),r=this.glue.interop.servers().find(s=>s.instance===t);if(!(!n&&!r))return n?{applicationName:n.name!==AP?n.name:(r==null?void 0:r.applicationName)||(r==null?void 0:r.application)||"",applicationTitle:r?await this.getHandlerTitle(r):n.title||t,applicationIcon:n==null?void 0:n.icon,instanceId:t}:{applicationName:r.applicationName||r.application||r.instance||"",applicationTitle:await this.getHandlerTitle(r),applicationIcon:"",instanceId:t}}buildRemovedIntentHandler({instance:e,app:t}){if(e)return{applicationName:e.applicationName||e.application||"",instanceId:e.instance||e.windowId};if(t)return{applicationName:t.name,applicationTitle:t.title,applicationIcon:t.icon};throw new Error("Invalid arguments passed to buildRemovedIntentHandler")}async getHandlerTitle(e){if(!e.windowId)return e.applicationName||e.application||e.instance||"";const t=this.glue.windows.findById(e.windowId),n=e.applicationName||e.application||e.instance||"";return t&&await t.getTitle()||n}async getIntentHandlerForRaise(e){const t=this.getIntentName(),n=(await this.glue.intents.find(t)).find(s=>s.name===t);if(!n)throw new Error(`Intent with name ${t} does not exist`);return this.findHandlerByFilter({instanceId:e.instanceId,applicationName:e.applicationName},n.handlers)}async getIntentHandlerForFilterHandlers(e){const n=(await this.glue.intents.all()).map(s=>s.handlers).flat(1);return this.findHandlerByFilter({instanceId:e.instanceId,applicationName:e.applicationName},n)}findHandlerByFilter(e,t){if(e.instanceId)return t.find(n=>n.instanceId===e.instanceId);if(e.applicationName)return t.find(n=>n.applicationName===e.applicationName)}isMethodRegistered(){return!!this.glue.interop.methods(this._methodName).length}isInstanceStillRunning(){return!!this.glue.interop.servers().find(e=>e.instance===this.callerId)}isMethodIsForPassedIntent(e,t){return`${my}${t}`===e}async validateStartupContext(e){const t=KP.run(e);if(!t.ok){const c=YP(t.error);return this.announceInitFailure(c,e)}const n=`Invalid startup context: ${JSON.stringify(e)}`;if(!e.intent&&!e.handlerFilter)return this.announceInitFailure(`${n}. Either 'intent' or 'handlerFilter' should be present.`,e);if(!e.handlerFilter)return;const{intent:r,resultType:s,contextTypes:o,applicationNames:a}=e.handlerFilter;if(!Object.keys(e.handlerFilter).length||!r&&!s&&!(o!=null&&o.length)&&!(a!=null&&a.length))return this.announceInitFailure(`Invalid startup context: ${JSON.stringify(e)}. Provide at least one filter criteria of the following:  'intent' | 'contextTypes' | 'resultType' | 'applicationName'`,e)}announceInitFailure(e,t){return new Promise((n,r)=>{var s;if(!((s=this.glue)!=null&&s.interop)||!(t!=null&&t.methodName)||typeof t.methodName!="string"||typeof t.callerId!="string")return r(e);this.glue.interop.invoke(t.methodName,{error:e},{instance:t.callerId}).then(()=>n()).catch(r)})}}var eN="2.4.0";class tN{constructor(e){d(this,"glueController");this.glueController=e}toApi(){const e={intent:this.glueController.intent,caller:this.glueController.initialCaller,handlerFilter:this.glueController.handlerFilter,version:eN,getTitle:this.getTitle.bind(this),sendResponse:this.sendResponse.bind(this),onHandlerAdded:this.onHandlerAdded.bind(this),onHandlerRemoved:this.onHandlerRemoved.bind(this)};return Object.freeze(e)}getTitle(){return this.glueController.getTitle()}async sendResponse(e,t){const n=QP.runWithException(e);if(!n.applicationName&&!n.instanceId)throw new Error("Handler must have either applicationName or instanceId property");return this.glueController.sendInteropMethodResponse(n,t)}onHandlerAdded(e){if(this.glueController.resolvingMethod==="raise"&&this.glueController.intent.target==="startNew")return this.glueController.subscribeOnAppAdded(e);const t=this.glueController.subscribeOnAppAdded(e),n=this.glueController.subscribeForServerMethodAdded(e);return()=>{t(),n()}}onHandlerRemoved(e){if(this.glueController.resolvingMethod==="raise"&&typeof this.glueController.intent=="object"&&this.glueController.intent.target==="startNew")return this.glueController.subscribeOnAppRemoved(e);const t=this.glueController.subscribeOnAppRemoved(e),n=this.glueController.subscribeForServerMethodRemoved(e);return()=>{t(),n()}}}class nN{constructor(){d(this,"_intentsResolver");d(this,"_glueController")}get intentsResolver(){return this._intentsResolver||(this._intentsResolver=new tN(this.glueController).toApi()),this._intentsResolver}get glueController(){return this._glueController||(this._glueController=new ZP),this._glueController}}const Tp=async i=>{const e=new nN;try{await e.glueController.initialize(i)}catch(t){throw new Error(`The Intents Resolver API did not initialized successfully. Error: ${JSON.stringify(t)}`)}i.intents.resolver=e.intentsResolver,Object.freeze(i.intents)};typeof window<"u"&&(window.IOConnectIntentsResolver=Tp);var iN="0.0.0";const Xb=i=>{if(!i.intents.resolver)throw new Error("IO must be configured with IOConnectIntentsResolver factory passed in `config.libraries' ")},Yb=i=>{var e;window.ioResolver||(window.ioResolver={apiVersion:(e=i.intents.resolver)==null?void 0:e.version,uiVersion:iN})},rN=({intent:i,callerName:e})=>e?`"${i}" action from "${e}" is unassigned. Choose an app to perform this action.`:`"${i}" action is unassigned. Choose an app to perform this action.`,sN=({contextTypes:i,resultType:e})=>{const t=i!=null&&i.length?`'${i.join(", ")}' context types`:"";return t&&e?`Choose action for ${t} and '${e}' result type.`:t&&!e?`Choose action for ${t}`:!t&&e?`Choose action for '${e}' result type.`:"Choose action"};var Zb={exports:{}},Da={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var by;function oN(){if(by)return Da;by=1;var i=ce,e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,c,l){var u,p={},f=null,w=null;l!==void 0&&(f=""+l),c.key!==void 0&&(f=""+c.key),c.ref!==void 0&&(w=c.ref);for(u in c)n.call(c,u)&&!s.hasOwnProperty(u)&&(p[u]=c[u]);if(a&&a.defaultProps)for(u in c=a.defaultProps,c)p[u]===void 0&&(p[u]=c[u]);return{$$typeof:e,type:a,key:f,ref:w,props:p,_owner:r.current}}return Da.Fragment=t,Da.jsx=o,Da.jsxs=o,Da}Zb.exports=oN();var g=Zb.exports;function e_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ch,t_={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/ch=t_,function(){var i={}.hasOwnProperty;function e(){for(var r="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(r=n(r,t(o)))}return r}function t(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return e.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var s="";for(var o in r)i.call(r,o)&&r[o]&&(s=n(s,o));return s}function n(r,s){return s?r?r+" "+s:r+s:r}ch.exports?(e.default=e,ch.exports=e):window.classNames=e}();var Ve=e_(t_.exports);function fn({className:i,size:e="16",variant:t="workspace",...n}){const r=Ve(i,"icon",{[`icon-size-${e}`]:e});return g.jsx("span",{className:r,...n,children:g.jsx("i",{className:`icon-${t}`})})}function qe({className:i="io-btn-icon",variant:e="default",icon:t="workspace",size:n="16",iconSize:r="16",onClick:s,disabled:o,children:a,...c}){const l=Ve(i,{[`${i}-${e}`]:e!=="default",[`${i}-size-${n}`]:n==="24"||n==="32"}),u=B.useCallback(p=>{if(!o)return s?s(p):void 0;p.preventDefault()},[s,o]);return g.jsx("button",{type:"button",className:l,"aria-label":"button",onClick:u,disabled:o,...c,children:a??(t&&g.jsx(fn,{variant:t,size:r}))})}function lh({className:i="io-alert",variant:e="info",text:t,close:n=!1,...r}){const s=Ve(i,`io-alert-${e}`);return g.jsxs("div",{className:s,...r,children:[g.jsx(fn,{variant:{info:"info",success:"check",warning:"exclamation-mark",critical:"exclamation-mark"}[e],className:"icon-severity"}),g.jsx("p",{className:"io-text-smaller",children:t}),n&&g.jsx(qe,{size:"16",iconSize:"10",icon:"close",className:"io-btn-icon ms-auto"})]})}function n_({className:i="io-badge",variant:e="default",children:t,...n}){const r=Ve(i,{[`${i}-${e}`]:e!=="default"});return g.jsx("div",{className:r,...n,children:t})}function ls({className:i="io-title",tag:e="h2",size:t="normal",text:n="Title",...r}){const s=e,o=Ve({[`${i}-semibold`]:t==="small",[i]:t==="normal",[`${i}-${t}`]:t==="large"});return g.jsx(s,{className:o,...r,children:n})}function Vt({className:i="io-block",title:e,titleSize:t="normal",tag:n,hint:r,children:s,...o}){return g.jsxs("div",{className:i,...o,children:[e&&g.jsx(ls,{tag:n,text:e,size:t}),s,r&&g.jsx("p",{className:"io-text-smaller",children:r})]})}function it({className:i="io-btn",variant:e="default",size:t="normal",icon:n,iconRight:r=!1,text:s,onClick:o,disabled:a,children:c,...l}){const u=Ve(i,{[`${i}-${e}`]:e==="primary"||e==="outline"||e==="link",[`${i}-lg`]:t==="large"}),p=B.useCallback(f=>{if(!a)return o?o(f):void 0;f.preventDefault()},[o,a]);return g.jsxs("button",{type:"button",className:u,"aria-label":"button",onClick:p,disabled:a,tabIndex:0,...l,children:[n&&!r&&g.jsx(fn,{variant:n,size:"12"}),c??s,n&&r&&g.jsx(fn,{variant:n,size:"12"})]})}const ju=B.createContext({});function i_({className:i="io-dropdown-content",...e}){const{handleOpen:t}=B.useContext(ju),n=B.useCallback(r=>{r.stopPropagation(),t&&t()},[t]);return g.jsx("div",{className:i,role:"button",onClick:n,...e})}const r_=B.createContext({});function Ap({className:i="io-list",prepend:e,append:t,isSelected:n,onClick:r,disabled:s=!1,children:o,...a}){const{variant:c,selected:l,checkIcon:u,handleItemClick:p}=B.useContext(r_),f=n??(l==null?void 0:l.some(S=>S.children===o)),w=Ve(`${i}-item`,{selected:c!=="default"&&f,[`${i}-item-disabled`]:s}),y=B.useCallback((S,O)=>{s?S.preventDefault():(p&&p(S,O),r&&r(S))},[r,p,s]);return g.jsxs("li",{className:w,role:"menuitem","aria-roledescription":"menuitem",tabIndex:0,onClick:S=>y(S,{children:o}),...a,children:[(u&&u!=="none"||e)&&g.jsxs("div",{className:`${i}-left-column`,children:[c!=="default"&&u!=="none"&&g.jsx(fn,{variant:u}),e]}),g.jsx("span",{className:`${i}-text`,children:o}),t&&g.jsx("div",{className:`${i}-right-column`,children:t})]})}function _y({className:i="io-list-item io-list-item-title",prepend:e,append:t,children:n,...r}){return g.jsxs("li",{className:i,...r,children:[e,g.jsx("span",{className:"io-list-text",children:n}),t]})}function Cy({className:i="io-list-item io-list-item-section",prepend:e,append:t,children:n,...r}){return g.jsxs("li",{className:i,...r,children:[e,g.jsx("span",{className:"io-list-text",children:n}),t]})}function Ft({className:i="io-list",variant:e="default",checkIcon:t="none",children:n,...r}){const[s,o]=B.useState([]),a=Ve(i,{[`${i}-selectable`]:e!=="default"}),c=B.useCallback((u,p)=>{if(e==="single")o([p]);else{const f=s.some(y=>{var S,O;return((S=y.children)==null?void 0:S.toString())===((O=p.children)==null?void 0:O.toString())}),w=s.filter(y=>y.children!==p.children);o(f?w:[...s,p])}},[s,e]),l=B.useMemo(()=>({variant:e,selected:s,checkIcon:t,handleItemClick:c}),[e,s,t,c]);return g.jsx(r_.Provider,{value:l,children:g.jsx("ul",{className:a,...r,children:n})})}function aN(i,e){B.useEffect(()=>{const t=n=>{i.current&&!i.current.contains(n.target)&&e()};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[i,e])}function te({className:i="io-dropdown",variant:e="default",align:t="down",disabled:n,children:r,...s}){const[o,a]=B.useState(!1),c=B.useRef(null),l=Ve(i,{[`${i}-open`]:o,[`${i}-${e}`]:e!=="default"}),u=B.useCallback(()=>{a(!o)},[o]);aN(c,B.useCallback(()=>{a(!1)},[]));const p=B.useMemo(()=>({isOpen:o,handleOpen:u,variant:e,align:t,disabled:n}),[o,u,e,t,n]);return g.jsx(ju.Provider,{value:p,children:g.jsx("div",{className:l,ref:c,...s,children:r})})}function Ae({className:i="io-btn-group",variant:e="default",align:t="left",children:n,...r}){const s=Ve(i,{[`${i}-sticky`]:e==="sticky",[`${i}-append`]:e==="append",[`${i}-fullwidth`]:e==="fullwidth",[`${i}-right`]:t==="right"});return g.jsx("div",{className:s,...r,children:n})}function kn({className:i="io-header",draggable:e=!1,children:t,...n}){const r=Ve(i,{draggable:e});return g.jsx("header",{className:r,style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"var(--spacing-8)"},...n,children:t})}function $s({className:i="io-footer",children:e,...t}){return g.jsx("footer",{className:i,...t,children:e})}function s_({className:i="io-image-icon",size:e="16",variant:t="default",src:n,alt:r,...s}){const o=Ve(i,{[`${i}-${e}`]:e,[`${i}-${t}`]:t==="grayscale"});return g.jsx("img",{className:o,style:{width:`${e}px`,filter:t==="grayscale"?"grayscale(100%)":"none"},src:n,alt:r,...s})}function cN({className:i="io-loader",size:e="large",variant:t="default",align:n="up",text:r,...s}){const o=Ve(i,{[`${i}-${t}`]:t!=="default",[`${i}-md`]:e==="normal",[`${i}-sm`]:e==="small",[`direction-${n}`]:n});return g.jsxs("div",{className:o,...s,children:[g.jsx("div",{className:`${i}-icon`}),r&&g.jsx("div",{className:`${i}-text`,children:r})]})}function Xr({className:i="io-panel-header",children:e,...t}){return g.jsx(kn,{className:i,...t,children:e})}Ft.Item=Ap,Ft.ItemTitle=_y,Ft.ItemSection=Cy,te.Button=function({icon:i="chevron-down",...e}){const{handleOpen:t,disabled:n}=B.useContext(ju),r=B.useCallback(s=>{s.stopPropagation(),t&&t()},[t]);return g.jsx(it,{icon:i,iconRight:!0,onClick:r,disabled:n,...e})},te.ButtonIcon=function({size:i="32",...e}){const{handleOpen:t,disabled:n}=B.useContext(ju),r=B.useCallback(()=>{t&&t()},[t]);return g.jsx(qe,{size:i,onClick:r,disabled:n,...e})},te.Content=i_,te.List=Ft,te.Item=Ap,te.ItemTitle=_y,te.ItemSection=Cy,Ae.Button=it,Ae.ButtonIcon=qe,Ae.Dropdown=te,kn.Title=ls,kn.ButtonGroup=Ae,kn.Button=it,kn.ButtonIcon=qe,kn.Dropdown=te,$s.ButtonGroup=Ae,$s.Button=it,$s.ButtonIcon=qe,$s.Dropdown=te,Xr.Title=ls,Xr.ButtonGroup=Ae,Xr.Button=it,Xr.ButtonIcon=qe,Xr.Dropdown=te;const Ep=B.forwardRef(({className:i="io-panel-body",children:e,...t},n)=>g.jsx("div",{className:i,ref:n,...t,children:e}));function Is({className:i="io-panel-footer",...e}){return g.jsx($s,{className:i,...e})}function Nt({className:i="io-panel",children:e,...t}){return g.jsx("div",{className:i,...t,children:e})}function lN({className:i="io-progress",variant:e="active",value:t=0,...n}){return g.jsx("div",{className:`${i} ${e}`,...n,children:g.jsx("div",{className:`${i}-bar`,style:{width:`${t<0?0:t>100?100:t}%`}})})}function od({text:i="Label",...e}){return g.jsx("label",{...e,children:i})}Ep.displayName="PanelBody",Is.ButtonGroup=Ae,Is.Button=it,Is.ButtonIcon=qe,Is.Dropdown=te,Nt.Header=Xr,Nt.Body=Ep,Nt.Footer=Is;const ad=B.forwardRef(function({id:i="input",className:e="io",type:t="text",name:n="input",align:r="up",label:s,iconPrepend:o,iconPrependOnClick:a,iconAppend:c,iconAppendOnClick:l,placeholder:u,disabled:p,readOnly:f,...w},y){const S=Ve(`${e}-control-input`,{[`${e}-control-leading-icon`]:o,[`${e}-control-trailing-icon`]:c,[`${e}-control-disabled`]:p,[`${e}-control-readonly`]:f,[`direction-${r}`]:r}),O=B.useCallback(v=>{p?v.preventDefault():a&&a(v)},[a,p]),_=B.useCallback(v=>{p?v.preventDefault():l&&l(v)},[l,p]);return g.jsxs("div",{className:S,children:[s&&g.jsx(od,{htmlFor:i,text:s}),o&&g.jsx(fn,{variant:o,onClick:v=>O(v)}),g.jsx("input",{id:i,className:`${e}-input`,ref:y,type:t,name:n,tabIndex:0,placeholder:u??(()=>{switch(t){case"email":return"Enter your email here...";case"number":return"Enter number here...";case"password":return"Enter your password here...";case"tel":return"Enter your phone number here...";case"file":return"Select a file...";default:return"Enter text here..."}})(),disabled:p,readOnly:f,...w}),c&&g.jsx(fn,{variant:c,onClick:v=>_(v)})]})}),Hf=B.forwardRef(function({id:i="textarea",className:e="io",name:t="textarea",align:n="up",label:r,rows:s=4,placeholder:o="Enter text here...",disabled:a,readOnly:c,...l},u){const p=Ve(`${e}-control-textarea`,{[`${e}-control-disabled`]:a,[`${e}-control-readonly`]:c,[`direction-${n}`]:n});return g.jsxs("div",{className:p,children:[r&&g.jsx(od,{htmlFor:i,text:r}),g.jsx("textarea",{id:i,className:`${e}-textarea`,ref:u,name:t,tabIndex:0,placeholder:o,disabled:a,readOnly:c,rows:s,...l})]})}),cd=B.forwardRef(function({id:i="checkbox",className:e="io",name:t="checkbox",align:n="left",label:r,checked:s,disabled:o,...a},c){const l=Ve(`${e}-control-checkbox`,{[`${e}-control-checked`]:s,[`${e}-control-disabled`]:o,[`direction-${n}`]:n});return g.jsxs("div",{className:l,children:[g.jsx("input",{type:"checkbox",id:i,className:`${e}-checkbox`,ref:c,name:t,tabIndex:0,checked:s,disabled:o,...a}),r&&g.jsx(od,{htmlFor:i,text:r})]})});B.forwardRef(function({id:i="radio",className:e="io",name:t="radio",align:n="left",label:r,checked:s,disabled:o,...a},c){const l=Ve(`${e}-control-radio`,{[`${e}-control-checked`]:s,[`${e}-control-disabled`]:o,[`direction-${n}`]:n});return g.jsxs("div",{className:l,children:[g.jsx("input",{type:"radio",id:i,className:`${e}-radio`,ref:c,name:t,tabIndex:0,checked:s,disabled:o,...a}),r&&g.jsx(od,{htmlFor:i,text:r})]})});const Jt=B.forwardRef(function({id:i="toggle",className:e="io",name:t="toggle",align:n="left",label:r="Toggle",checked:s,disabled:o,...a},c){const l=Ve(`${e}-control-toggle`,{[`${e}-control-checked`]:s,[`${e}-control-disabled`]:o,[`direction-${n}`]:n});return g.jsx("div",{className:l,children:g.jsxs("label",{className:`${e}-toggle`,tabIndex:0,children:[g.jsx("input",{type:"checkbox",id:i,className:`${e}-checkbox`,ref:c,name:t,checked:s,disabled:o,...a}),g.jsx("span",{className:"slider"}),r]})})});function o_(i,e=500){const[t,n]=B.useState(i);return B.useEffect(()=>{const r=setTimeout(()=>{n(i)},e);return()=>clearTimeout(r)},[i,e]),t}B.createContext({theme:"dark"});function Sy(i,e,t){return Math.min(Math.max(i,t),e)}class uN extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var $a=uN;function dN(i){if(typeof i!="string")throw new $a(i);if(i.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=i.trim();e=yN.test(i)?function(o){const a=o.toLowerCase().trim(),c=hN[function(l){let u=5381,p=l.length;for(;p;)u=33*u^l.charCodeAt(--p);return(u>>>0)%2341}(a)];if(!c)throw new $a(o);return`#${c}`}(i):i;const t=pN.exec(e);if(t){const o=Array.from(t).slice(1);return[...o.slice(0,3).map(a=>parseInt(Dc(a,2),16)),parseInt(Dc(o[3]||"f",2),16)/255]}const n=fN.exec(e);if(n){const o=Array.from(n).slice(1);return[...o.slice(0,3).map(a=>parseInt(a,16)),parseInt(o[3]||"ff",16)/255]}const r=gN.exec(e);if(r){const o=Array.from(r).slice(1);return[...o.slice(0,3).map(a=>parseInt(a,10)),parseFloat(o[3]||"1")]}const s=mN.exec(e);if(s){const[o,a,c,l]=Array.from(s).slice(1).map(parseFloat);if(Sy(0,100,a)!==a)throw new $a(i);if(Sy(0,100,c)!==c)throw new $a(i);return[...wN(o,a,c),Number.isNaN(l)?1:l]}throw new $a(i)}const Iy=i=>parseInt(i.replace(/_/g,""),36),hN="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((i,e)=>{const t=Iy(e.substring(0,3)),n=Iy(e.substring(3)).toString(16);let r="";for(let s=0;s<6-n.length;s++)r+="0";return i[t]=`${r}${n}`,i},{}),Dc=(i,e)=>Array.from(Array(e)).map(()=>i).join(""),pN=new RegExp(`^#${Dc("([a-f0-9])",3)}([a-f0-9])?$`,"i"),fN=new RegExp(`^#${Dc("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),gN=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Dc(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),mN=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,yN=/^[a-z]+$/i,xy=i=>Math.round(255*i),wN=(i,e,t)=>{let n=t/100;if(e===0)return[n,n,n].map(xy);const r=(i%360+360)%360/60,s=(1-Math.abs(2*n-1))*(e/100),o=s*(1-Math.abs(r%2-1));let a=0,c=0,l=0;r>=0&&r<1?(a=s,c=o):r>=1&&r<2?(a=o,c=s):r>=2&&r<3?(c=s,l=o):r>=3&&r<4?(c=o,l=s):r>=4&&r<5?(a=o,l=s):r>=5&&r<6&&(a=s,l=o);const u=n-s/2;return[a+u,c+u,l+u].map(xy)};function vN(i){return function(e){if(e==="transparent")return 0;function t(o){const a=o/255;return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}const[n,r,s]=dN(e);return .2126*t(n)+.7152*t(r)+.0722*t(s)}(i)>.179}function bN({className:i="io-channel-badge",channel:e,...t}){return g.jsx("div",{className:i,style:{color:(n=e.color,vN(n)?"#000":"#fff"),backgroundColor:e.color},...t,children:g.jsx("span",{className:`${i}-label`,children:e.label})});var n}const a_=B.createContext({});function _N({channel:i,isSelected:e,onChannelSelect:t,...n}){const{variant:r,selectedChannels:s}=B.useContext(a_),o=e||i.isSelected||(s==null?void 0:s.includes(i)),a=B.useCallback(c=>{t&&t(c)},[t]);return g.jsx(Ap,{prepend:g.jsx(bN,{channel:i}),append:g.jsx(r==="single"?()=>o&&g.jsx(fn,{variant:"check"})||null:()=>g.jsxs(g.Fragment,{children:[g.jsx("div",{onClick:c=>c.stopPropagation(),children:g.jsx(Jt,{label:"Publish",checked:i.write,onChange:()=>a({...i,isSelected:!(!i.read&&(i.write||i.read)),write:!i.write})})}),g.jsx("div",{onClick:c=>c.stopPropagation(),children:g.jsx(Jt,{label:"Subscribe",checked:i.read,onChange:()=>a({...i,isSelected:!(!i.write&&(i.write||i.read)),read:!i.read})})})]}),{}),isSelected:o,onClick:()=>{a(r==="single"?{...i,isSelected:!o}:{...i,isSelected:!o,read:!o,write:!o})},...n,children:i.name},i.name)}const CN=B.forwardRef(({className:i="io-list-channels",variant:e="single",variantToggle:t=!1,channels:n=[],onVariantChange:r,onChannelSelect:s,...o},a)=>{const c=Ve(i,{"io-bi-direction":e==="directionalSingle"}),l=n.filter(p=>p.isSelected),u=B.useMemo(()=>({variant:e,selectedChannels:l,onVariantChange:r,onChannelSelect:s}),[e,l,r,s]);return g.jsx(a_.Provider,{value:u,children:g.jsx("div",{className:c,ref:a,children:g.jsxs(Ft,{variant:"single",...o,children:[g.jsx(Ft.ItemTitle,{append:t&&g.jsx(Jt,{label:"Directional",align:"right",onChange:p=>r&&r(p.target.checked),checked:e==="directionalSingle"}),children:e==="single"?"Select Channel":"Select Directional Channel"}),n==null?void 0:n.map(p=>g.jsx(_N,{channel:p,onChannelSelect:s},p.name))]})})})});CN.displayName="ChannelSelector";B.createContext({config:{message:""},theme:"dark",setResult:()=>{}});function SN({title:i="Downloads"}){const{ItemSearch:e,HeaderButtons:t}=ld();return g.jsxs("div",{className:"io-dm-header",children:[g.jsxs(kn,{children:[g.jsx(kn.Title,{tag:"h1",text:i,size:"large"}),g.jsx(t,{})]}),g.jsx(e,{})]})}const IN=B.createContext({configuration:{},items:[],removeItem:()=>{},pauseResumeItem:()=>{},cancelItem:()=>{},clearItems:()=>{},showItemInFolder:()=>{},isSettingsVisible:!1,showSettings:()=>{},hideSettings:()=>{},isSearchVisible:!1,showSearch:()=>{},hideSearch:()=>{},searchQuery:"",setSearch:()=>{},itemsCount:0,setCount:()=>{},setDownloadLocation:()=>{},setDownloadLocationWithDialog:()=>{},sortItems:()=>[],downloadLocationList:[],isDownloadLocationDialogVisible:!1}),br=()=>B.useContext(IN);function xN({className:i="io-header-search",icon:e="search",placeholder:t="Search",...n}){const r=B.useRef(null),{isSearchVisible:s,searchQuery:o,setSearch:a,itemsCount:c}=br();return B.useEffect(()=>{var l,u;s?(l=r.current)==null||l.focus():((u=r.current)==null||u.blur(),a(""))},[s,a]),s?g.jsxs("div",{className:i,children:[g.jsx(ad,{ref:r,value:o,iconPrepend:e,placeholder:t,onChange:l=>a(l.target.value),...n}),s&&o.length>0&&g.jsx("p",{className:`${i}-count`,children:`${c} results`})]}):null}function kN({className:i,...e}){const{SearchButton:t,SettingsButton:n,MoreButton:r}=ld();return g.jsxs(Ae,{className:i,align:"right",...e,children:[g.jsx(t,{}),g.jsx(n,{}),g.jsx(r,{})]})}function TN({...i}){const{isSearchVisible:e,showSearch:t,hideSearch:n,items:r}=br();return g.jsx(qe,{icon:e?"search-filled":"search",variant:"circle",size:"32",onClick:e?n:t,disabled:r.length===0,...i})}function AN({icon:i="cog",...e}){const{showSettings:t}=br();return g.jsx(qe,{icon:i,variant:"circle",size:"32",onClick:t,...e})}function EN({icon:i="ellipsis",...e}){const{items:t,clearItems:n}=br(),r=t.length===0;return g.jsxs(te,{variant:"light",...e,children:[g.jsx(te.ButtonIcon,{icon:i,variant:"circle",size:"32"}),g.jsx(te.Content,{children:g.jsx(te.List,{children:g.jsx(te.Item,{disabled:r,onClick:s=>(o=>{r?o.stopPropagation():n()})(s),children:"Clear All"})})})]})}function ws(i,e=!1,t=!1,n=!1){const r=i.getDate(),s=["January","February","March","April","May","June","July","August","September","October","November","December"][i.getMonth()],o=i.getFullYear(),a=i.getHours(),c=i.getMinutes();let l="";return l=c<10?`0${c}`:`${c}`,e?e==="Today"?t?"Today":`Today at ${a}:${l}`:e==="Yesterday"?t?"Yesterday":`Yesterday at ${a}:${l}`:`${a}:${l}`:n?t?`${s} ${r}`:`${s} ${r} at ${a}:${l}`:t?`${s} ${r}, ${o}`:`${s} ${r}, ${o} at ${a}:${l}`}function c_(i,e={showTime:!0}){const t=new Date(1e3*i),n=new Date,r=Math.round((n-t)/1e3),s=Math.round(r/60),o=n.toDateString()===t.toDateString(),a=new Date(n.setDate(n.getDate()-1)).toDateString()===t.toDateString(),c=n.getFullYear()===t.getFullYear();return e.showTime?r<5?"Just Now":r<60?`${r} seconds ago`:r<90?"about a minute ago":s<60?`${s} minutes ago`:o?ws(t,"Today",!1,!0):a?ws(t,"Yesterday",!1,!0):c?ws(t,!1,!1,!0):ws(t):o?"Today":a?"Yesterday":c?ws(t,!1,!0,!0):ws(t,!1,!0)}function PN({className:i="io-dm-body",...e}){const{DownloadListEmpty:t,ItemGroup:n,Item:r}=ld(),{items:s,searchQuery:o,setCount:a,sortItems:c}=br(),l=c(s),u=o_(o),p=B.useMemo(()=>l.filter(y=>y.displayInfo.filename.toLowerCase().includes(u.toLowerCase())||y.displayInfo.url.toLowerCase().includes(u.toLowerCase())),[l,u]),f=B.useMemo(()=>p.map(y=>({...y,displayInfo:{...y.displayInfo,startTime:c_(y.displayInfo.startTime,{showTime:!1})}})),[p]),w=B.useMemo(()=>Object.values(f.reduce((y={},S)=>{var O;return y[S.displayInfo.startTime]=((O=y[S.displayInfo.startTime])==null?void 0:O.concat([]))??[],y[S.displayInfo.startTime].push(S),y},{})),[f]);return B.useEffect(()=>{a(p.length)},[p,a]),g.jsx("div",{className:i,...e,children:w&&w.length!==0?w.map(y=>g.jsx(n,{title:String(y[0].displayInfo.startTime)??null,children:y.map(S=>g.jsx(r,{item:S},S.id))},y[0].id??"")):g.jsx(t,{})})}function NN({className:i="io-dm-no-items",icon:e="download",text:t="No downloads to display.",...n}){return g.jsxs("div",{className:i,...n,children:[g.jsx(fn,{variant:e}),g.jsx("p",{children:t})]})}function RN({className:i="io-dm-item-group",title:e,children:t,...n}){return g.jsxs("div",{className:i,...n,children:[e&&g.jsx("p",{children:e}),t]})}function MN({className:i="io-dm-item",item:e,...t}){const{ItemHeader:n,ItemBody:r,ItemFooter:s}=ld(),{state:o,url:a,filename:c,receivedBytes:l,totalBytes:u,speed:p,timeRemaining:f}=e.displayInfo;if(!e)return g.jsx(g.Fragment,{});const w=Ve(i,{[o]:e.displayInfo.state});return g.jsxs("div",{className:w,...t,children:[g.jsx(n,{itemID:e.id,filename:c,state:o}),g.jsx(r,{state:o,url:a,bytesReceived:l,bytesTotal:u,speed:p,timeRemaining:f}),g.jsx(s,{itemID:e.id,state:o})]})}function l_({bytesReceived:i=0,bytesTotal:e=0,...t}){const n=B.useCallback(()=>i&&e?Math.round(i/e*100):0,[i,e]);return g.jsx(lN,{value:n(),...t})}function jN({className:i="io-dm-item-header",itemID:e,filename:t,state:n,cancel:r,remove:s,...o}){const{cancelItem:a,removeItem:c}=br(),l=B.useCallback(p=>{r?r(p):a(p)},[r,a]),u=B.useCallback(p=>{s?s(p):c(p)},[s,c]);return g.jsxs("div",{className:i,...o,children:[g.jsx(ls,{text:t,style:{textDecoration:n==="interrupted"||n==="cancelled"?"line-through":"none"}}),g.jsx(qe,{icon:"close",onClick:()=>{n==="progressing"||n==="paused"?l(e):u(e)}})]})}function ON({className:i="io-dm-item-body",state:e,url:t,bytesReceived:n=0,bytesTotal:r=0,speed:s=0,timeRemaining:o=0,...a}){const c=p=>{const f=["Bytes","KB","MB","GB","TB"];if(p===0)return"0";const w=Math.floor(Math.log(p)/Math.log(1024));return w===0?`${p}${f[w]}`:`${(p/1024**w).toFixed(1)}${f[w]}`};return g.jsxs("div",{className:i,...a,children:[g.jsx("p",{className:"io-text-small",children:t}),(u=e,u==="cancelled"||u==="interrupted"||u==="completed"?null:g.jsx(l_,{variant:u==="paused"?"paused":"active",bytesReceived:n,bytesTotal:r})),g.jsx("p",{className:"io-text-default-lh16",children:e==="completed"?`${c(n??0)} - Done`:e==="cancelled"||e==="interrupted"?`${c(n??0)}/${c(r??0)} - Failed`:`${c(n??0)}/${c(r??0)} (${l=s,(l?`${(l/1e6/8).toFixed(2)}MB/s`:0)??0}) - ${(p=>{const f=Math.floor(p/3600),w=Math.floor(p%3600/60);let y="";return f>0&&(y+=`${f} hour${f>1?"s":""}, `),w>0&&(y+=`${w} min${w>1?"s":""}, `),((p=Math.floor(p%60))>0||y==="")&&(y+=`${p} sec${p!==1?"s":""}`),`${y.trim()} left`})(o)??0}`})]});var l,u}function DN({className:i="io-dm-item-footer",itemID:e,state:t,pauseResume:n,showInFolder:r,cancel:s,...o}){const{pauseResumeItem:a,showItemInFolder:c,cancelItem:l}=br(),u=B.useCallback(w=>{n?n(w):a(w)},[n,a]),p=B.useCallback(w=>{r?r(w):c(w)},[r,c]),f=B.useCallback(w=>{s?s(w):l(w)},[s,l]);return g.jsx("div",{className:i,...o,children:(()=>{switch(t){case"progressing":return g.jsxs(Ae,{align:"right",children:[g.jsx(Ae.Button,{variant:"primary",text:"Pause",onClick:()=>u(e)}),g.jsx(Ae.Button,{variant:"link",text:"Cancel",onClick:()=>f(e)})]});case"paused":return g.jsx(Ae,{align:"right",children:g.jsx(Ae.Button,{variant:"primary",text:"Resume",onClick:()=>u(e)})});case"completed":return g.jsxs(g.Fragment,{children:[g.jsx(lh,{variant:"success",text:"Complete"}),g.jsx(Ae,{align:"right",children:g.jsx(Ae.Button,{variant:"primary",text:"Show in Folder",onClick:()=>p(e)})})]});case"cancelled":return g.jsx(g.Fragment,{children:g.jsx(lh,{variant:"warning",text:"Cancelled"})});case"interrupted":return g.jsxs(g.Fragment,{children:[g.jsx(lh,{variant:"critical",text:"Failed"}),g.jsx(Ae,{align:"right",children:g.jsx(Ae.Button,{variant:"primary",text:"Retry",onClick:()=>u(e)})})]});default:return null}})()})}function $N({className:i="io-panel io-settings",title:e="Settings",...t}){const{configuration:{downloadFolder:n},hideSettings:r,setDownloadLocation:s,setDownloadLocationWithDialog:o,isDownloadLocationDialogVisible:a,downloadLocationList:c}=br();return g.jsxs(Nt,{className:i,...t,children:[g.jsxs(Nt.Header,{children:[g.jsx(Nt.Header.Title,{size:"large",text:e,tag:"h1"}),g.jsx(Nt.Header.ButtonGroup,{children:g.jsx(qe,{variant:"circle",icon:"close",size:"32",onClick:()=>{r()},disabled:a})})]}),g.jsx(Nt.Body,{children:g.jsxs(Ae,{children:[g.jsxs(te,{variant:"outline",disabled:a,children:[g.jsx(te.Button,{children:g.jsx("span",{className:"io-settings-download-location",children:n??c[0]})}),c.length>1&&g.jsx(te.Content,{children:g.jsx(te.List,{children:c.map((l,u)=>!l||u===0||u>3?null:g.jsx(te.Item,{onClick:()=>{s(l)},children:l},l))})})]}),g.jsx(it,{className:"io-btn io-settings-download-location-btn",text:"Browse",onClick:()=>{o()},disabled:a})]})})]})}const u_={Header:SN,ItemSearch:xN,HeaderButtons:kN,SearchButton:TN,SettingsButton:AN,MoreButton:EN,Body:PN,DownloadListEmpty:NN,ItemGroup:RN,Item:MN,ItemProgress:l_,ItemHeader:jN,ItemBody:ON,ItemFooter:DN,Settings:$N},d_=B.createContext(u_),FN=B.memo(({children:i,components:e})=>{const t=B.useMemo(()=>({...u_,...e}),[e]);return g.jsx(d_.Provider,{value:t,children:i})});FN.displayName="ComponentsStore";const ld=()=>B.useContext(d_);function Pp(i){if(i&&i.errorHandling&&typeof i.errorHandling!="function"&&i.errorHandling!=="log"&&i.errorHandling!=="silent"&&i.errorHandling!=="throw")throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof i.errorHandling+" was passed");var e=i&&typeof i.errorHandling=="function"&&i.errorHandling,t={};function n(r,s){var o=r instanceof Error?r:new Error(r);if(e)e(o);else{var a='[ERROR] callback-registry: User callback for key "'+s+'" failed: '+o.stack;if(i)switch(i.errorHandling){case"log":return console.error(a);case"silent":return;case"throw":throw new Error(a)}console.error(a)}}return{add:function(r,s,o){var a=t[r];return a||(a=[],t[r]=a),a.push(s),o&&setTimeout(function(){o.forEach(function(c){var l;if(!((l=t[r])===null||l===void 0)&&l.includes(s))try{Array.isArray(c)?s.apply(void 0,c):s.apply(void 0,[c])}catch(u){n(u,r)}})},0),function(){var c=t[r];c&&(c=c.reduce(function(l,u,p){return u===s&&l.length===p||l.push(u),l},[]),c.length===0?delete t[r]:t[r]=c)}},execute:function(r){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];var a=t[r];if(!a||a.length===0)return[];var c=[];return a.forEach(function(l){try{var u=l.apply(void 0,s);c.push(u)}catch(p){c.push(void 0),n(p,r)}}),c},clear:function(){t={}},clearKey:function(r){t[r]&&delete t[r]}}}Pp.default=Pp;e_(Pp);const LN=B.createContext({config:{env:"",region:"",version:"",buildVersion:"",theme:"",isError:!1,mailingList:"",createJiraTicket:!0,sendEmail:!1,attachments:[],applicationTitle:"",allowEditRecipients:!0,attachmentsViewMode:"category",environmentInfo:"",selectedCategories:[],errorMessage:"",showEnvironmentInfo:!1,context:{},technicalInfo:"",sendEmailClient:"Outlook"},onThemeChanged:i=>{},openUrl:()=>{},submit:()=>Promise.resolve({}),setBounds:()=>{},close:i=>{},showMailingList:!0,setShowMailingList:()=>{},attachmentCategories:[],submitInProgress:!1,setSubmitInProgress:()=>{},submitStatus:{type:"success",title:"",text:""},setSubmitStatus:()=>{},submitCompleted:!1,setSubmitCompleted:()=>{},jiraTicketURL:"",setJiraTicketURL:()=>{},submitFeedback:()=>{}}),Zn=()=>B.useContext(LN);function WN({...i}){const{config:e,close:t}=Zn(),{applicationTitle:n}=e;return g.jsxs(kn,{draggable:!0,...i,children:[g.jsx(kn.Title,{tag:"h1",text:n?`Feedback Form - ${n}`:"Feedback Form",size:"large"}),g.jsx(kn.ButtonGroup,{className:"non-draggable",children:g.jsx(kn.ButtonIcon,{variant:"circle",icon:"close",size:"32",onClick:()=>t()})})]})}function BN({className:i="io-panel-body",handleSubmit:e,...t}){const{config:n,submitFeedback:r}=Zn(),{IntroField:s,DescriptionField:o,TechInfoField:a,EnvInfoField:c,FileAttachmentsField:l,CategoryAttachmentsField:u,SettingsField:p,MailListField:f}=ud(),w=e??r,y=`Your feedback will be submitted to the ${n.buildVersion} team and some additional information will be automatically included to help us examine your issue.`;return g.jsxs("form",{className:i,id:"feedback",onSubmit:S=>w(S),...t,children:[g.jsx(s,{children:g.jsx("p",{children:y})}),g.jsx(p,{}),g.jsx(f,{}),g.jsx(o,{}),g.jsx(a,{readOnly:!0}),g.jsx(c,{readOnly:!0}),n.attachmentsViewMode==="file"?g.jsx(l,{}):g.jsx(u,{})]})}function HN({...i}){const{FooterButtons:e}=ud(),{openUrl:t,submitInProgress:n,submitStatus:r,jiraTicketURL:s}=Zn();return g.jsx($s,{...i,children:g.jsxs("div",n?{className:"flex ai-center jc-between",children:[g.jsx(Vt,{children:g.jsx("p",{children:r.title})}),g.jsx(cN,{align:"right",size:"small"})]}:{className:"flex ai-center jc-between",children:[g.jsxs(Vt,{children:[g.jsx("p",{className:r.type==="error"?"io-text-error":"",children:r.title}),s&&g.jsx("a",{href:s,onClick:o=>{o.preventDefault(),t(s)},children:s})]}),g.jsx(e,{})]})})}function GN({className:i,...e}){const{CloseButton:t}=ud(),{close:n}=Zn();return g.jsx(Ae,{className:i,...e,children:g.jsx(t,{onClick:()=>n()})})}function zN({className:i,...e}){const{SubmitButton:t,CancelButton:n,CloseButton:r}=ud(),{close:s,submitCompleted:o}=Zn();return o?g.jsx(Ae,{className:i,...e,children:g.jsx(r,{text:"Close",onClick:()=>s()})}):g.jsxs(Ae,{className:i,...e,children:[g.jsx(t,{}),g.jsx(n,{onClick:()=>s()})]})}function UN({text:i="Submit",...e}){return g.jsx(it,{form:"feedback",type:"submit",variant:"primary",text:i,...e})}function qN({text:i="Cancel",...e}){return g.jsx(it,{variant:"outline",text:i,...e})}function VN({...i}){return g.jsx(it,{variant:"primary",...i})}function JN({showField:i=!0,className:e,title:t,hint:n,children:r,...s}){return i?g.jsx(Vt,{className:e,title:t,hint:n,...s,children:r}):null}function KN({showField:i=!0,className:e,title:t="Description",hint:n,readOnly:r=!1,disabled:s,...o}){return i?g.jsx(Vt,{className:e,hint:n,title:"",...o,children:g.jsx(Hf,{id:"description",name:"description",label:t,readOnly:r,disabled:s})}):null}function QN({showField:i,className:e,title:t="Technical Information",hint:n,fieldValue:r,readOnly:s=!1,disabled:o,...a}){const{config:c}=Zn(),l=i??c.errorMessage,u=r??c.errorMessage;return l&&u?g.jsx(Vt,{className:e,hint:n,...a,children:g.jsx(Hf,{id:"errorMessage",name:"errorMessage",label:t,value:u,readOnly:s,disabled:o})}):null}function XN({showField:i,className:e,title:t="Environment Information",hint:n,fieldValue:r,readOnly:s=!1,disabled:o,...a}){const{config:c}=Zn(),l=i??c.showEnvironmentInfo,u=r??c.environmentInfo;return l&&u?g.jsx(Vt,{className:e,hint:n,...a,children:g.jsx(Hf,{id:"environmentInfo",name:"environmentInfo",label:t,value:u,readOnly:s,disabled:o})}):null}function YN({showField:i=!0,className:e="io-block io-block-list-gap",title:t="Attachments",hint:n,readOnly:r=!1,disabled:s,attachments:o,selectedCategories:a,...c}){const{config:l}=Zn(),u=o??l.attachments,p=a??l.selectedCategories,f=B.useCallback(w=>!!p&&p.indexOf(w)!==-1,[p]);return i?!u||u.length<=0?g.jsxs("div",{children:[g.jsx("h2",{className:"io-title",children:"Attachments"}),g.jsx("p",{children:"No Attachments"})]}):g.jsx(Vt,{className:e,title:t,hint:n,...c,children:g.jsx("div",{className:"file-attachments",children:u.map(w=>g.jsx(cd,{id:w.id,name:w.id,label:w.name,readOnly:r,disabled:s,defaultChecked:f(w.category)},w.id))})}):null}function ZN({showField:i=!0,className:e,title:t="Attachments",hint:n,readOnly:r=!1,disabled:s,categories:o,selectedCategories:a,...c}){const{config:l,attachmentCategories:u}=Zn(),p=o??u,f=a??l.selectedCategories,w=B.useCallback(y=>!!f&&f.indexOf(y)!==-1,[f]);return i?!p||p.length<=0?g.jsx("p",{children:"No Attachments"}):g.jsx(Vt,{className:e,title:t,hint:n,...c,children:g.jsx("div",{className:"category-attachments",children:p.map(y=>g.jsx(Jt,{id:y,name:y,align:"right",label:y,readOnly:r,disabled:s,defaultChecked:w(y)},y))})}):null}function eR({className:i="io-block io-block-list-gap",title:e,hint:t,showField:n=!0,showJiraTicketField:r,jiraTicketLabel:s="Create Jira Ticket",showSendEmailField:o,sendEmailLabel:a="Send Email",readOnly:c=!1,disabled:l,...u}){const{config:p,showMailingList:f,setShowMailingList:w}=Zn();if(!n)return null;const y=r??p.createJiraTicket,S=o??p.sendEmail;return g.jsxs(Vt,{className:i,hint:t,title:e,...u,children:[y&&g.jsx(Jt,{id:"createJiraTicket",name:"createJiraTicket",label:s,align:"right",readOnly:c,disabled:l,defaultChecked:y}),S&&g.jsx(Jt,{onChange:()=>{w(!f)},id:"sendEmail",name:"sendEmail",label:a,align:"right",readOnly:c,disabled:l,defaultChecked:S})]})}function tR({showField:i=!0,className:e,title:t="Email List",hint:n="Separate with commas or semicolons.",placehodler:r="john.doe@somedomain.com; jane.doe@otherdomain.com",readOnly:s=!1,disabled:o,...a}){const{config:c,showMailingList:l}=Zn();return(i??c.sendEmail)&&l?g.jsx(Vt,{className:e,hint:n,...a,children:g.jsx(ad,{id:"mailingList",name:"mailingList",label:t,placeholder:r,readOnly:s,disabled:o,defaultValue:c.mailingList??""})}):null}const h_={Header:WN,Body:BN,Footer:HN,HeaderButtons:GN,FooterButtons:zN,SubmitButton:UN,CancelButton:qN,CloseButton:VN,IntroField:JN,DescriptionField:KN,TechInfoField:QN,EnvInfoField:XN,FileAttachmentsField:YN,CategoryAttachmentsField:ZN,SettingsField:eR,MailListField:tR},p_=B.createContext(h_),nR=B.memo(({children:i,components:e})=>{const t=B.useMemo(()=>({...h_,...e}),[e]);return g.jsx(p_.Provider,{value:t,children:i})});function ud(i){return{...B.useContext(p_),...i}}nR.displayName="ComponentsStore";function iR(i){const e=B.useContext(kf),t=e==null?void 0:e.appManager,[n,r]=B.useState([]),[s,o]=B.useState(0),a=B.useCallback(c=>[...c].sort((l,u)=>{const p=(l.title??l.name).toLowerCase(),f=(u.title??u.name).toLowerCase();return p<f?-1:p>f?1:0}),[]);return B.useEffect(()=>{if(!t)return;const c=t.onAppAdded(l=>{r(u=>[...u,{title:l.title,name:l.name,hidden:l.hidden}])});return()=>{c()}},[t]),B.useEffect(()=>{if(!t)return;const c=t.onAppRemoved(l=>{r(u=>u.filter(p=>p.name!==l.name))});return()=>{c()}},[t,n]),B.useEffect(()=>{if(!t)return;const c=t.onAppChanged(l=>{r(u=>{const p=u.find(f=>f.name===l.name);return[...u.filter(f=>f.name!==l.name),{title:l.title,name:p==null?void 0:p.name,hidden:p==null?void 0:p.hidden,allowed:p==null?void 0:p.allowed}]})});return()=>{c()}},[t]),B.useEffect(()=>{e.appManager.applications().length,[...n]},[i]),{apps:n,allowedApps:s,sortAppsAlphabetically:a}}const rR=B.createContext({allApps:[],settings:{},configuration:{},notifications:[],onClose:()=>{},allApplications:0,clearAll:()=>{},showPanel:()=>{},hidePanel:()=>{},saveFilter:()=>{},clearAllOld:()=>{},notificationStacks:[],isPanelVisible:!1,saveSetting:()=>{},allowedApplications:0,saveAllFilter:()=>{},isBulkActionsSupported:!1,selectedNotifications:[],selectNotification:()=>{},selectAllNotifications:()=>{},clearMany:()=>{},snooze:()=>{},snoozeMany:()=>{},setState:()=>{},setStates:()=>{}}),he=()=>B.useContext(rR),sR=B.createContext({isSearchVisible:!1,showSearch:()=>{},hideSearch:()=>{},searchQuery:"",setSearch:()=>{},isSettingsVisible:!1,showSettings:()=>{},hideSettings:()=>{},sortNotificationsBy:"newest",setSortBy:()=>{},viewNotificationsBy:"all",setViewBy:()=>{},notificationsCount:0,setCount:()=>{},isBulkActionsVisible:!1,showBulkActions:()=>{},hideBulkActions:()=>{}}),tt=()=>B.useContext(sR);function oR({...i}){const{HeaderCaption:e,HeaderActions:t,HeaderBulkActions:n,HeaderSearch:r}=on(),{isBulkActionsSupported:s}=he(),{isBulkActionsVisible:o}=tt();return g.jsxs(Xr,{...i,children:[g.jsx(e,{}),s?g.jsxs("div",{className:`io-panel-header-actions-wrapper ${o?"io-panel-header-bulk-actions-opened":""} `,children:[g.jsx(t,{}),g.jsx(n,{})]}):g.jsx(t,{}),g.jsx(r,{})]})}function aR({className:i="io-panel-header-caption",...e}){const{HeaderCaptionTitle:t,HeaderCaptionCount:n,HeaderCaptionButtons:r}=on();return g.jsxs("div",{className:i,...e,children:[g.jsx(t,{}),g.jsx(n,{}),g.jsx(r,{})]})}function cR({className:i="io-panel-header-caption-filter",...e}){const{allApplications:t,allowedApplications:n}=he();return g.jsxs("div",{className:i,...e,children:[g.jsx(fn,{variant:"filter"}),g.jsx("span",{className:`${i}-allowed`,children:n}),"of ",g.jsx("span",{className:`${i}-all`,children:t}),"apps"]})}function lR({text:i="Notifications",counter:e,...t}){const{notificationsCount:n}=tt();return g.jsx(ls,{text:i,size:"large",...t,children:(e??!0)&&g.jsxs("span",{children:["(",n,")"]})})}function uR({...i}){const{HeaderCaptionButtonSearch:e,HeaderCaptionButtonSettings:t,HeaderCaptionButtonClose:n}=on();return g.jsxs(Ae,{...i,children:[g.jsx(e,{}),g.jsx(t,{}),g.jsx(n,{})]})}const f_="newest",dR="oldest",hR="severity",uh=["None","Low","Medium","High","Critical"],ky={key:f_,descending:!0},g_=i=>[...i].sort((e,t)=>(t.timestamp||0)-(e.timestamp||0)),m_=i=>[...i].sort((e,t)=>(e.timestamp||0)-(t.timestamp||0)),y_=(i,e)=>{const t=uh[0];return[...i].sort((n,r)=>{const s=uh.indexOf(n.severity||t),o=uh.indexOf(r.severity||t);return(e?-1:1)*(s-o)})},pR={[f_]:g_,[dR]:m_,[hR]:y_};function fR({...i}){const[e,t]=B.useState([]),{NotificationsList:n,Notification:r}=on(),{sortNotificationsBy:s,viewNotificationsBy:o,setCount:a,searchQuery:c,notificationsCount:l}=tt(),{notifications:u}=he(),p=B.useRef(null),f=o_(c),w=B.useMemo(()=>((S,O)=>{if(!S)return[];switch(O){case"all":default:return S;case"unread":return S.filter(_=>_.state==="Active"||_.state==="Stale");case"read":return S.filter(_=>_.state==="Acknowledged"||_.state==="Seen");case"snoozed":return S.filter(_=>_.state==="Snoozed")}})(u,o),[u,o]),y=B.useMemo(()=>w.filter(S=>{var O;return S.title.toLowerCase().includes(f.toLowerCase())||((O=S.body)==null?void 0:O.toLowerCase().includes(f.toLowerCase()))}),[w,f]);return B.useEffect(()=>{switch(s){case"newest":t(g_(y));break;case"oldest":t(m_(y));break;case"severity":t(y_(y,!0));break;default:t(y)}a(y.length)},[y,s,a]),B.useEffect(()=>{var S;p.current&&((S=p.current)==null||S.scrollTo({top:0,behavior:"smooth"}))},[f,l,s,o]),g.jsx(Ep,{ref:p,...i,children:g.jsx(n,{notifications:e,Notification:r})})}function gR({...i}){const{FooterButtons:e}=on();return g.jsx(Is,{...i,children:g.jsx(e,{})})}function mR({className:i,...e}){const{FooterButtonClearAll:t,FooterButtonClearAllOld:n}=on(),{notifications:r}=he(),[s,o]=B.useState(!1);return B.useEffect(()=>{r.filter(a=>a.state==="Stale"||a.state==="Acknowledged").length>0?o(!0):o(!1)},[r]),g.jsxs(Ae,{className:i,align:"right",...e,children:[g.jsx(n,{disabled:!s}),g.jsx(t,{disabled:r.length<=0})]})}function yR({text:i="Clear All",...e}){const{clearAll:t}=he();return g.jsx(it,{text:i,onClick:()=>{t()},...e})}function wR({text:i="Clear Old",...e}){const{clearAllOld:t}=he();return g.jsx(it,{text:i,onClick:()=>{t()},...e})}function vR({className:i="io-panel io-settings",title:e="Settings",...t}){const{SettingsGeneral:n,SettingsPlacement:r,SettingsStacking:s,SettingsSnooze:o,SettingsSubscriptions:a}=on(),{hideSettings:c}=tt();return g.jsxs(Nt,{className:i,...t,children:[g.jsxs(Nt.Header,{children:[g.jsx(Nt.Header.Title,{size:"large",text:e,tag:"h1"}),g.jsx(Nt.Header.ButtonGroup,{children:g.jsx(Nt.Header.ButtonIcon,{variant:"circle",icon:"close",size:"32",onClick:c})})]}),g.jsxs(Nt.Body,{children:[g.jsx(n,{}),g.jsx(s,{}),g.jsx(r,{}),g.jsx(o,{}),g.jsx(a,{})]})]})}function bR({className:i="io-panel-settings-general",title:e="General",...t}){const{SettingsAllowNotifications:n,SettingsShowNotificationBadge:r,SettingsPanelAutoHide:s,SettingsHideToastsAfter:o}=on();return g.jsx("div",{className:i,...t,children:g.jsxs(Vt,{title:e,children:[g.jsx(n,{}),g.jsx(r,{}),g.jsx(s,{}),g.jsx(o,{})]})})}function _R({label:i="Allow notifications",align:e="right",...t}){const{settings:n,saveSetting:r}=he(),s=B.useCallback(o=>{r({enabledNotifications:o})},[r]);return g.jsx(Jt,{label:i,align:e,onChange:o=>s(o.target.checked),checked:n.enabledNotifications,...t})}function CR({label:i="Show notification badge",align:e="right",...t}){const{settings:n,saveSetting:r}=he(),s=B.useCallback(o=>{r({showNotificationBadge:o})},[r]);return g.jsx(Jt,{label:i,align:e,onChange:o=>s(o.target.checked),checked:n.showNotificationBadge,...t})}function SR({label:i="Auto hide panel",align:e="right",...t}){const{settings:n,saveSetting:r}=he(),s=B.useCallback(o=>{r({autoHidePanel:o})},[r]);return g.jsx(Jt,{label:i,align:e,onChange:o=>s(o.target.checked),checked:n.autoHidePanel,...t})}function IR({label:i="Panel always on top",align:e="right",...t}){const{settings:n,saveSetting:r}=he(),s=B.useCallback(o=>{r({alwaysOnTop:o})},[r]);return g.jsx(Jt,{label:i,align:e,onChange:o=>s(o.target.checked),checked:n.alwaysOnTop,...t})}function xR({className:i="flex jc-between ai-center",title:e="Hide toasts after",items:t=[15,30,45,60],...n}){const{settings:r,saveSetting:s}=he(),o=B.useCallback(c=>{c||(c=15e3),r.toastExpiry!==c&&s({toastExpiry:1e3*c})},[r.toastExpiry,s]),a=c=>c<60?`${c} seconds`:c===60?"1 minute":c/60+" minutes";return g.jsxs("div",{className:i,...n,children:[g.jsx("div",{className:"io-text-clipper "+(r.enabledNotifications?"":"io-text-disabled"),children:g.jsx("span",{children:e})}),g.jsxs(te,{variant:"light",disabled:!r.enabledNotifications,children:[g.jsx(te.Button,{text:a(r.toastExpiry/1e3)}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",children:t.map(c=>g.jsx(te.Item,{onClick:()=>{o(c)},children:a(c)},c))})})]})]})}function kR({className:i="flex jc-between ai-center",title:e="Highlight new for",...t}){const{settings:n,saveSetting:r}=he(),s=["30 seconds","1 minute","5 minutes","Never"];return g.jsxs("div",{className:i,...t,children:[g.jsx("div",{className:"io-text-clipper "+(n.enabledNotifications?"":"io-text-disabled"),children:g.jsx("span",{children:e})}),g.jsxs(te,{variant:"outline",disabled:!n.enabledNotifications,children:[g.jsx(te.Button,{text:s[0]}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",children:s.map(o=>g.jsx(te.Item,{children:o},o))})})]})]})}function TR({className:i="flex jc-between ai-center",title:e="Mark as read after",...t}){const{settings:n,saveSetting:r}=he(),s=["1 minute","5 minutes","Never"];return g.jsxs("div",{className:i,...t,children:[g.jsx("div",{className:"io-text-clipper "+(n.enabledNotifications?"":"io-text-disabled"),children:g.jsx("span",{children:e})}),g.jsxs(te,{variant:"outline",disabled:!n.enabledNotifications,children:[g.jsx(te.Button,{text:s[0]}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",children:s.map(o=>g.jsx(te.Item,{children:o},o))})})]})]})}function AR({className:i="io-panel-settings-stacking",title:e="Stacking",...t}){const{SettingsToastStacking:n,SettingsToastStackBy:r}=on();return g.jsx("div",{className:i,...t,children:g.jsxs(Vt,{title:e,children:[g.jsx(n,{}),g.jsx(r,{})]})})}function ER({label:i="Allow toast stacking",align:e="right",...t}){const{settings:n,saveSetting:r}=he(),s=B.useCallback(o=>{r({toastStacking:o})},[r]);return g.jsx(Jt,{label:i,align:e,onChange:o=>s(o.target.checked),checked:n.toastStacking,disabled:!n.enabledNotifications,...t})}const Gf=i=>i.replace(/(^|-)\w/g,e=>e.toUpperCase().replace("-"," "));function PR({className:i="flex jc-between ai-center",title:e="Group by",...t}){const{settings:n,saveSetting:r}=he(),s=B.useCallback(o=>{o||(o="severity"),n.stackBy!==o&&r({stackBy:o.toLowerCase()})},[n.stackBy,r]);return g.jsxs("div",{className:i,...t,children:[g.jsx("div",{className:"io-text-clipper "+(n.enabledNotifications?"":"io-text-disabled"),children:g.jsx("span",{children:e})}),g.jsxs(te,{variant:"light",disabled:!n.enabledNotifications,children:[g.jsx(te.Button,{text:n.stackBy?Gf(n.stackBy):"Severity"}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",children:["Severity","Application"].map(o=>g.jsx(te.Item,{onClick:()=>{s(o)},children:o},o))})})]})]})}function NR({className:i="io-panel-settings-placement",title:e="Placement",...t}){const{SettingsPlacementPanel:n,SettingsPlacementToasts:r}=on();return g.jsx("div",{className:i,...t,children:g.jsxs(Vt,{title:e,children:[g.jsx(n,{}),g.jsx(r,{})]})})}function RR({className:i="flex jc-between ai-center",title:e="Panel position",...t}){var o,a;const{settings:n,saveSetting:r}=he(),s=B.useCallback(c=>{var l;c||(c="right"),((l=n.placement)==null?void 0:l.panel)!==c&&r({placement:{...n.placement,panel:c.toLowerCase()}})},[n.placement,r]);return g.jsxs("div",{className:i,...t,children:[g.jsx("div",{className:"io-text-clipper",children:g.jsx("span",{children:e})}),g.jsxs(te,{variant:"light",children:[g.jsx(te.Button,{text:(o=n.placement)!=null&&o.panel?Gf((a=n.placement)==null?void 0:a.panel):"Right"}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",children:["Right","Left"].map(c=>g.jsx(te.Item,{onClick:()=>{s(c)},children:c},c))})})]})]})}function MR({className:i="flex jc-between ai-center",title:e="Toasts position",...t}){var o,a;const{settings:n,saveSetting:r}=he(),s=B.useCallback(c=>{var u;if(c||(c="bottom-right"),((u=n.placement)==null?void 0:u.toasts)===c)return;const l=c.replace(/\s+/g,"-").toLowerCase();r({placement:{...n.placement,toasts:l}})},[n.placement,r]);return g.jsxs("div",{className:i,...t,children:[g.jsx("div",{className:"io-text-clipper",children:g.jsx("span",{children:e})}),g.jsxs(te,{variant:"light",children:[g.jsx(te.Button,{text:(o=n.placement)!=null&&o.toasts?Gf((a=n.placement)==null?void 0:a.toasts):"Bottom Right"}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",children:["Top Right","Top Left","Bottom Right","Bottom Left"].map(c=>g.jsx(te.Item,{onClick:()=>{s(c)},children:c},c))})})]})]})}function jR({className:i="io-panel-settings-snooze",title:e="Snooze",...t}){var s;const{SettingsSnoozeDuration:n}=on(),{settings:r}=he();return(s=r.snooze)!=null&&s.enabled?g.jsx("div",{className:i,...t,children:g.jsx(Vt,{title:e,children:g.jsx(n,{})})}):null}function OR({className:i="flex jc-between ai-center",title:e="Default duration",items:t=[60,120,180,300],...n}){var c,l;const{settings:r,saveSetting:s}=he(),o=B.useCallback(u=>{var p;u||(u=6e4),r.snooze&&((p=r.snooze)==null?void 0:p.duration)!==u&&s({snooze:{...r.snooze,duration:1e3*u}})},[r.snooze,s]),a=u=>u<60?`${u} seconds`:u===60?"1 minute":u/60+" minutes";return(c=r.snooze)!=null&&c.enabled?g.jsxs("div",{className:i,...n,children:[g.jsx("div",{className:"io-text-clipper "+(r.enabledNotifications?"":"io-text-disabled"),children:g.jsx("span",{children:e})}),g.jsxs(te,{variant:"outline",disabled:!r.enabledNotifications,children:[g.jsx(te.Button,{text:a(((l=r.snooze)==null?void 0:l.duration)/1e3)}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",children:t.map(u=>g.jsx(te.Item,{onClick:()=>{o(u)},children:a(u)},u))})})]})]}):null}function DR({className:i="io-panel-settings-subscriptions",title:e="Subscribe and Mute",...t}){const{SettingsSubscribeAll:n,SettingsSubscribeApp:r,SettingsSubscribeMuteAll:s,SettingsSubscribeMuteApp:o}=on(),{allApps:a}=he(),{sortAppsAlphabetically:c}=iR(),l=c(a);return g.jsx("div",{className:i,...t,children:g.jsxs(Vt,{title:e,children:[g.jsxs("div",{className:`${i}-grid`,children:[g.jsx("p",{className:"io-text-section",children:"Sources"}),g.jsx("p",{className:"io-text-section",children:"Subscribe"}),g.jsx("p",{className:"io-text-section",children:"Mute"})]}),g.jsxs("div",{className:`${i}-grid`,children:[g.jsx("p",{children:"All Sources"}),g.jsx(n,{label:""}),g.jsx(s,{label:""})]}),l.map(u=>!u||u.hidden?null:g.jsxs("div",{className:`${i}-grid`,children:[g.jsx("p",{children:u.title??u.name}),g.jsx(r,{app:u,label:""}),g.jsx(o,{app:u,label:""})]},u.name))]})})}function $R({label:i="All apps",align:e="right",...t}){var a,c;const{settings:n,configuration:r,saveAllFilter:s}=he(),o=B.useCallback(l=>{s({subscribe:l})},[s]);return g.jsx(Jt,{align:e,label:i,onChange:l=>o(l.target.checked),checked:(c=(a=r.sourceFilter)==null?void 0:a.allowed)==null?void 0:c.includes("*"),disabled:!n.enabledNotifications,...t})}function FR({label:i="App",align:e="right",app:t,...n}){var l,u,p,f;const{allApps:r,settings:s,configuration:o,saveFilter:a}=he(),c=B.useCallback((w,y)=>{var _,v,C,T,M,$,G,E,D;const S={...o.sourceFilter},O=(_=S.allowed)==null?void 0:_.indexOf("*");typeof O=="number"&&O>-1&&((v=S.allowed)==null||v.splice(O,1),r.forEach(A=>{var x;A.name!==y.name&&((x=S.allowed)==null||x.push(A.name))})),w?((C=S.allowed)==null||C.push(y.name),S.blocked=(T=S.blocked)==null?void 0:T.filter(A=>A!==y.name)):(S.allowed=(M=S.allowed)==null?void 0:M.filter(A=>A!==y.name),($=S.blocked)==null||$.push(y.name)),(G=S.allowed)!=null&&G.length&&((E=S.allowed)==null?void 0:E.length)>0&&((D=S.blocked)!=null&&D.includes("*"))&&S.blocked.splice(S.blocked.indexOf("*"),1),a(S)},[r,o.sourceFilter,a]);return g.jsx(Jt,{id:t.name,label:i,align:e,onChange:w=>c(w.target.checked,t),checked:((u=(l=o.sourceFilter)==null?void 0:l.allowed)==null?void 0:u.includes("*"))||((f=(p=o.sourceFilter)==null?void 0:p.allowed)==null?void 0:f.includes(t.name)),disabled:!s.enabledNotifications,...n})}function LR({label:i="Mute all",align:e="right",...t}){var a,c,l,u;const{settings:n,configuration:r,saveAllFilter:s}=he(),o=B.useCallback(p=>{s({mute:p})},[s]);return g.jsx(Jt,{align:e,label:i,onChange:p=>o(p.target.checked),checked:(c=(a=r.sourceFilter)==null?void 0:a.muted)==null?void 0:c.includes("*"),disabled:!n.enabledNotifications||((u=(l=r.sourceFilter)==null?void 0:l.allowed)==null?void 0:u.indexOf("*"))===-1,...t})}function WR({label:i="App",align:e="right",app:t,...n}){var l,u,p,f,w,y,S,O,_,v,C,T,M,$,G,E;const{allApps:r,settings:s,configuration:o,saveFilter:a}=he(),c=B.useCallback((D,A)=>{var b,R,z,V;const x={...o.sourceFilter},N=(b=x==null?void 0:x.muted)==null?void 0:b.indexOf("*");typeof N=="number"&&N>-1&&((R=x.muted)==null||R.splice(N,1),r.forEach(Q=>{var H;Q.name===A.name||Q.hidden||((H=x.muted)==null||H.push(Q.name))})),D?(z=x.muted)==null||z.push(A.name):x.muted=(V=x.muted)==null?void 0:V.filter(Q=>Q!==A.name),a(x)},[r,o.sourceFilter,a]);return g.jsx(Jt,{id:t.name,label:i,align:e,onChange:D=>c(D.target.checked,t),checked:((u=(l=o.sourceFilter)==null?void 0:l.muted)==null?void 0:u.includes("*"))||((f=(p=o.sourceFilter)==null?void 0:p.muted)==null?void 0:f.includes(t.name)),disabled:!s.enabledNotifications||((y=(w=o.sourceFilter)==null?void 0:w.blocked)==null?void 0:y.includes("*"))||((O=(S=o.sourceFilter)==null?void 0:S.blocked)==null?void 0:O.includes(t.name))||((v=(_=o.sourceFilter)==null?void 0:_.allowed)==null?void 0:v.length)===0||((T=(C=o.sourceFilter)==null?void 0:C.allowed)==null?void 0:T.indexOf(t.name))===-1&&(($=(M=o.sourceFilter)==null?void 0:M.allowed)==null?void 0:$.indexOf("*"))===-1&&((E=(G=o.sourceFilter)==null?void 0:G.blocked)==null?void 0:E.length)===0,...n})}function BR({className:i="io-notification-header",notification:e,...t}){const{HeaderCount:n,HeaderBadge:r,HeaderTitle:s,HeaderTimestamp:o,HeaderButtonSnooze:a,HeaderButtonClose:c}=dd();return g.jsxs("div",{className:i,...t,children:[g.jsx(r,{notification:e}),g.jsx(n,{notification:e}),g.jsx(s,{notification:e}),g.jsx(o,{notification:e}),g.jsxs(Ae,{children:[g.jsx(a,{notification:e}),g.jsx(c,{notification:e})]})]})}function HR({notification:i,...e}){const{settings:t,isPanelVisible:n,notificationStacks:r}=he(),{toastStacking:s,stackBy:o}=t,a=o==="application"?"source":o??"source";let c;if(s){const l=r.find(u=>u.key===i[a]);c=(l==null?void 0:l.items.length)??0}return s&&!n&&c&&c>1?g.jsx(n_,{...e,children:c<10?c:"9+"}):null}function GR({className:i="io-notification-header-badge",notification:e,...t}){return e&&e.severity&&e.severity!=="None"?g.jsxs("div",{className:i,...t,children:[g.jsx(fn,{variant:(n=>{if(!n)return"circle-info";switch(n.toLowerCase()){case"info":case"low":case"medium":default:return"circle-info";case"high":return"triangle-exclamation";case"critical":return"ban"}})(e.severity),size:"12"}),e.severity]}):null}function zR({className:i="io-notification-header-icon",state:e,severity:t="None",icon:n,...r}){const{isPanelVisible:s}=he();return g.jsxs("div",{className:i,...r,children:[n&&g.jsx("span",{className:`${i}-image`,children:g.jsx("img",{src:n,alt:`${i}-${n}`})}),g.jsx("span",{className:`${i}-badge color-${t.toLowerCase()}`,children:s&&e!=="Acknowledged"&&"New"})]})}function UR({className:i="io-notification-header-title",notification:{appTitle:e},...t}){return g.jsx("div",{className:i,...t,children:e})}function qR({className:i="io-notification-timestamp",notification:{timestamp:e,state:t,snooze:n},...r}){return g.jsx("small",n&&t==="Snoozed"?{className:i,...r,children:"Snoozed"}:{className:i,...r,children:c_(e??0)??"Just Now"})}function VR({notification:{id:i,state:e},...t}){var o,a;const{settings:n,snooze:r}=he(),s=B.useCallback(c=>{var l;c.stopPropagation(),r&&r(i,((l=n.snooze)==null?void 0:l.duration)??0)},[i,r,(o=n.snooze)==null?void 0:o.duration]);return r&&e!=="Snoozed"&&((a=n.snooze)!=null&&a.enabled)?g.jsx(it,{icon:"snooze",variant:"link",text:"Snooze",tabIndex:-1,onClick:s,...t}):null}function JR({notification:{updateState:i,close:e},...t}){const{isPanelVisible:n}=he();return g.jsx(qe,{icon:"close",size:"24",tabIndex:-1,onClick:r=>{n?e().catch(console.error):(r.stopPropagation(),i("Acknowledged").catch(console.error))},...t})}function KR({className:i="io-notification-body",notification:e,...t}){const{BodyIcon:n,BodyTitle:r,BodyDescription:s}=dd(),{onClick:o}=e,{settings:a}=he();return g.jsxs("div",{className:i,role:"button",tabIndex:0,onKeyDown:c=>{c.key!=="Enter"&&c.key!==" "||o({close:!1})},onClick:()=>{a.toastStacking?o({close:!1}):o()},...t,children:[g.jsx(n,{icon:e.icon}),g.jsxs("div",{className:`${i}-content`,children:[g.jsx(r,{text:e.title}),g.jsx(s,{text:e.body})]})]})}function QR({className:i="io-notification-body-icon",icon:e,...t}){return e?g.jsx("div",{className:i,...t,children:g.jsx("img",{src:e,alt:"notification-icon"})}):null}function XR({text:i,...e}){return g.jsx(ls,{text:i,...e})}function YR({className:i="io-notification-body-description",text:e,...t}){return g.jsx("p",{className:i,...t,children:e})}function ZR({className:i="io-notification-footer",notification:e}){var n;const{FooterButton:t}=dd();return g.jsx("div",{className:i,children:g.jsx(Ae,{align:"right",children:(n=e.actions)==null?void 0:n.map((r,s)=>g.jsx(t,{notificationAction:r,variant:s===0?"primary":"link"},`${r.title+s.toString()}`))})})}function e1({notificationAction:i,...e}){return g.jsx(it,{text:i.title,onClick:t=>{t.stopPropagation(),i.onClick()},...e})}const w_={Header:BR,HeaderCount:HR,HeaderBadge:GR,HeaderIcon:zR,HeaderTitle:UR,HeaderTimestamp:qR,HeaderButtonSnooze:VR,HeaderButtonClose:JR,Body:KR,BodyIcon:QR,BodyTitle:XR,BodyDescription:YR,Footer:ZR,FooterButton:e1},v_=B.createContext(w_),b_=B.memo(({children:i,components:e})=>{const t=B.useMemo(()=>({...w_,...e}),[e]);return g.jsx(v_.Provider,{value:t,children:i})});function dd(i){return{...B.useContext(v_),...i}}function t1({className:i="io-notification",notification:e,...t}){const{Header:n,Body:r,Footer:s}=dd(),{severity:o}=e,a=Ve(i,`severity-${(o==null?void 0:o.toLowerCase())??"none"}`,{"state-new":e.state!=="Acknowledged"});return g.jsxs("div",{className:a,...t,children:[g.jsx(n,{notification:e}),g.jsx(r,{notification:e}),g.jsx(s,{notification:e})]})}function zf({components:i,notification:e,...t}){return g.jsx(b_,{components:i,children:g.jsx(t1,{notification:e,...t})})}function n1({className:i="io-notification-stack",notifications:e,...t}){const[n,r]=B.useState(!1),s=e.length===2?"small":e.length>=3?"large":"normal",o=e[0].severity,a=Ve(i,{[`${i}-open`]:n,[`${i}-${s}`]:s!=="normal",[`${i}-${o}`]:o&&o!=="None"}),c=B.useCallback(()=>{r(!n)},[n]),l=B.useCallback(u=>{u.stopPropagation(),e.forEach(p=>{p.close()})},[e]);return g.jsxs("div",{className:a,onClick:c,...t,children:[s!=="normal"&&g.jsx("div",{className:`${i}-btn`,children:g.jsx(it,{icon:"close",onClick:u=>l(u),children:g.jsx("span",{className:"io-btn-text",children:"Clear All"})})}),e.map(u=>g.jsx(zf,{notification:u},u.id))]})}function __({className:i="io-notification-list",Notification:e,notifications:t,noNotificationText:n="No notifications to display",...r}){const{notifications:s,notificationStacks:o,settings:a,configuration:c,isPanelVisible:l,selectedNotifications:u,selectNotification:p,isBulkActionsSupported:f}=he(),{isBulkActionsVisible:w}=tt(),{toastStacking:y}=a,S=t??s;return g.jsx("div",{className:i,...r,children:y&&!l?o.length>0?o.map(O=>g.jsx(n1,{notifications:O.items},O.key)):g.jsx("div",{className:"flex jc-center mt-8",children:n??""}):S.length>0?S.map(O=>{var v,C,T,M;const _=((C=(v=c.sourceFilter)==null?void 0:v.muted)==null?void 0:C.includes(O.source))||((M=(T=c.sourceFilter)==null?void 0:T.muted)==null?void 0:M.includes("*"));return!l&&_?null:l&&f&&w?g.jsxs("div",{className:`${i}-bulk-action-item ${u.includes(O.id)?"selected":""}`,children:[g.jsx(cd,{checked:u.includes(O.id),onChange:$=>p(O.id,$.target.checked)}),g.jsx(e,{notification:O})]},O.id):g.jsx(e,{notification:O},O.id)}):g.jsx("div",{className:"flex jc-center mt-8",children:n??""})})}b_.displayName="ComponentsStoreProvider";const C_={Header:oR,HeaderCaption:aR,HeaderCaptionFilter:cR,HeaderCaptionTitle:lR,HeaderCaptionCount:function({...i}){const{notificationsCount:e}=tt();return g.jsx(n_,{...i,children:(e||0).toString()})},HeaderCaptionButtons:uR,HeaderCaptionButtonSearch:function({...i}){const{isSearchVisible:e,showSearch:t,hideSearch:n,notificationsCount:r}=tt();return g.jsx(qe,{icon:e?"search-filled":"search",variant:"circle",size:"32",onClick:e?n:t,disabled:r===0,...i})},HeaderCaptionButtonSettings:function({icon:i="cog",size:e="32",variant:t="circle",...n}){const{showSettings:r}=tt();return g.jsx(qe,{icon:i,size:e,variant:t,onClick:r,...n})},HeaderCaptionButtonClose:function({icon:i="close",size:e="32",variant:t="circle",...n}){const{hidePanel:r}=he();return g.jsx(qe,{icon:i,size:e,variant:t,onClick:r,...n})},HeaderActions:function({className:i="io-panel-header-actions",...e}){const{HeaderActionSort:t,HeaderActionView:n,HeaderActionClear:r,HeaderActionEdit:s}=on();return g.jsxs("div",{className:i,...e,children:[g.jsxs(Ae,{children:[g.jsx(t,{}),g.jsx(n,{})]}),g.jsxs(Ae,{children:[g.jsx(r,{}),g.jsx(s,{})]})]})},HeaderActionSort:function({text:i="Sort by",...e}){const{sortNotificationsBy:t,setSortBy:n}=tt(),{onNotificationsSort:r}=(()=>{const{notifications:s}=he(),[o,a]=B.useState(ky),{key:c,descending:l}=o,u=B.useMemo(()=>pR[c](s,l),[s,c,l]);return{onNotificationsSort:B.useCallback(f=>{a(w=>({key:f,descending:w.key!==f?ky.descending:!w.descending}))},[]),sortedNotifications:u}})();return g.jsxs(te,{variant:"light",...e,children:[g.jsxs(te.Button,{variant:"link",children:[i," ",g.jsx("strong",{children:t})]}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",checkIcon:"check",children:["Newest","Oldest","Severity"].map(s=>g.jsx(te.Item,{isSelected:t===s.toLowerCase(),onClick:()=>{n(s.toLowerCase()),r(s.toLowerCase())},children:s},s))})})]})},HeaderActionView:function({text:i="View",...e}){var o;const{settings:t}=he(),{viewNotificationsBy:n,setViewBy:r}=tt(),s=(o=t.snooze)!=null&&o.enabled?["All","Read","Unread","Snoozed"]:["All","Read","Unread"];return g.jsxs(te,{variant:"light",...e,children:[g.jsxs(te.Button,{variant:"link",children:[i," ",g.jsx("strong",{children:n})]}),g.jsx(te.Content,{children:g.jsx(te.List,{variant:"single",checkIcon:"check",children:s.map(a=>g.jsx(te.Item,{isSelected:n===a.toLowerCase(),onClick:()=>r(a.toLowerCase()),children:a},a))})})]})},HeaderActionClear:function({text:i="Clear All",...e}){const{clearAll:t}=he(),{notificationsCount:n}=tt();return g.jsx(it,{variant:"link",text:i,onClick:t,disabled:n===0,...e})},HeaderActionEdit:function({tooltip:i="Bulk Edit",...e}){const{isBulkActionsSupported:t}=he(),{showBulkActions:n,notificationsCount:r}=tt();return t?g.jsx(qe,{icon:"pen-to-square",title:i,size:"32",onClick:n,disabled:r===0,...e}):null},HeaderBulkActions:function({className:i="io-panel-header-bulk-actions",...e}){const{HeaderBulkActionSelect:t,HeaderBulkActionSelectDropdown:n,HeaderBulkActionMarkAsRead:r,HeaderBulkActionMarkAsUnread:s,HeaderBulkActionSnooze:o,HeaderBulkActionClear:a,HeaderBulkActionClose:c}=on(),{isBulkActionsSupported:l}=he();return l?g.jsx("div",{className:i,...e,children:g.jsxs(Ae,{children:[g.jsx(t,{}),g.jsx(n,{}),g.jsx(r,{}),g.jsx(s,{}),g.jsx(o,{}),g.jsx(a,{}),g.jsx(c,{})]})}):null},HeaderBulkActionSelect:function({...i}){const{isBulkActionsSupported:e,selectedNotifications:t,selectAllNotifications:n}=he(),{notificationsCount:r}=tt();return e?g.jsx(cd,{checked:r===t.length&&r>0,onChange:s=>n("all",s.target.checked),disabled:r===0,...i}):null},HeaderBulkActionSelectDropdown:function({...i}){const{isBulkActionsSupported:e,selectAllNotifications:t}=he(),{notificationsCount:n}=tt();return e?g.jsxs(te,{variant:"light",...i,children:[g.jsx(te.ButtonIcon,{variant:"default",icon:"chevron-down",size:"16",iconSize:"10",disabled:n===0}),g.jsx(i_,{children:g.jsxs(te.List,{variant:"single",checkIcon:"check",children:[g.jsx(te.ItemSection,{children:"Select"}),["All","Read","Unread","Snoozed"].map(r=>g.jsx(te.Item,{onClick:()=>t(r.toLowerCase(),!0),children:r},r))]})})]}):null},HeaderBulkActionMarkAsRead:function({icon:i="envelope-open",size:e="32",variant:t="circle",tooltip:n="Mark as read",...r}){const{isBulkActionsSupported:s,selectedNotifications:o,setStates:a}=he(),{notificationsCount:c}=tt(),l=B.useCallback(()=>{a(o,"Seen")},[o,a]);return s?g.jsx(qe,{icon:i,size:e,variant:t,title:n,onClick:l,disabled:c===0,...r}):null},HeaderBulkActionMarkAsUnread:function({icon:i="envelope",size:e="32",variant:t="circle",tooltip:n="Mark as unread",...r}){const{isBulkActionsSupported:s,selectedNotifications:o,setStates:a}=he(),{notificationsCount:c}=tt(),l=B.useCallback(()=>{a(o,"Active")},[o,a]);return s?g.jsx(qe,{icon:i,size:e,variant:t,title:n,onClick:l,disabled:c===0,...r}):null},HeaderBulkActionSnooze:function({icon:i="snooze",size:e="32",variant:t="circle",tooltip:n="Snooze",...r}){var p,f;const{isBulkActionsSupported:s,selectedNotifications:o,snoozeMany:a,settings:c}=he(),{notificationsCount:l}=tt(),u=B.useCallback(()=>{var w;a(o,((w=c.snooze)==null?void 0:w.duration)??0)},[o,a,(p=c.snooze)==null?void 0:p.duration]);return s&&((f=c.snooze)!=null&&f.enabled)?g.jsx(qe,{icon:i,size:e,variant:t,title:n,onClick:u,disabled:l===0,...r}):null},HeaderBulkActionClear:function({icon:i="trash",size:e="32",variant:t="circle",tooltip:n="Clear",...r}){const{isBulkActionsSupported:s,selectedNotifications:o,clearMany:a}=he(),{notificationsCount:c}=tt(),l=B.useCallback(()=>{a(o)},[o,a]);return s?g.jsx(qe,{icon:i,size:e,variant:t,title:n,onClick:l,disabled:c===0,...r}):null},HeaderBulkActionClose:function({text:i="Done",variant:e="primary",...t}){const{isBulkActionsSupported:n}=he(),{hideBulkActions:r,notificationsCount:s}=tt();return n?g.jsx(it,{variant:e,text:i,onClick:r,disabled:s===0,...t}):null},HeaderSearch:function({className:i="io-panel-header-search",icon:e="search",placeholder:t="Search",...n}){const{isSearchVisible:r,searchQuery:s,setSearch:o,notificationsCount:a}=tt(),c=B.useRef(null);return B.useEffect(()=>{var l,u;r?(l=c.current)==null||l.focus():((u=c.current)==null||u.blur(),o(""))},[r,o]),r?g.jsxs("div",{className:i,children:[g.jsx(ad,{ref:c,value:s,iconPrepend:e,placeholder:t,onChange:l=>o(l.target.value),...n}),r&&s.length>0&&g.jsx("p",{className:`${i}-count`,children:`${a} results`})]}):null},Body:fR,Footer:gR,FooterButtons:mR,FooterButtonClearAll:yR,FooterButtonClearAllOld:wR,Notification:zf,NotificationsList:__,Settings:vR,SettingsGeneral:bR,SettingsAllowNotifications:_R,SettingsShowNotificationBadge:CR,SettingsPanelAutoHide:SR,SettingsPanelAlwaysOnTop:IR,SettingsHideToastsAfter:xR,SettingsMarkAsNew:kR,SettingsMarkAsRead:TR,SettingsStacking:AR,SettingsToastStacking:ER,SettingsToastStackBy:PR,SettingsPlacement:NR,SettingsPlacementPanel:RR,SettingsPlacementToasts:MR,SettingsSnooze:jR,SettingsSnoozeDuration:OR,SettingsSubscriptions:DR,SettingsSubscribeAll:$R,SettingsSubscribeApp:FR,SettingsSubscribeMuteAll:LR,SettingsSubscribeMuteApp:WR},S_=B.createContext(C_),i1=B.memo(({children:i,components:e})=>{const t=B.useMemo(()=>({...C_,...e}),[e]);return g.jsx(S_.Provider,{value:t,children:i})});function on(i){return{...B.useContext(S_),...i}}i1.displayName="ComponentsStoreProvider";const I_={Body:function({className:i="io-toasts-body",notifications:e,maxToasts:t=1,...n}){const{NotificationsList:r,Notification:s}=s1(),[o,a]=B.useState([]);return B.useEffect(()=>{const c=t<0?e.length:t,l=e.filter(u=>u.state==="Active").slice(0,c);for(const u of l)u.onShow();a(l)},[e,t]),g.jsx("div",{className:i,...n,children:g.jsx(r,{Notification:s,notifications:o,noNotificationText:""})})},Notification:zf,NotificationsList:__},x_=B.createContext(I_),r1=B.memo(({children:i,components:e})=>{const t=B.useMemo(()=>({...I_,...e}),[e]);return g.jsx(x_.Provider,{value:t,children:i})});function s1(i){return{...B.useContext(x_),...i}}r1.displayName="ComponentsStoreProvider";const o1=({searchQuery:i,setSearchQuery:e,handleSearchQueryChange:t})=>ce.createElement("div",{className:"column-wrapper"},ce.createElement(qe,{icon:"search",size:"24",className:"io-btn-icon io-btn-icon-size-24 input-search-icon"}),ce.createElement(ad,{placeholder:"Filter apps",value:i,onChange:t}),ce.createElement(qe,{icon:"close",size:"24",onClick:()=>e(""),className:"io-btn-icon io-btn-icon-size-24 input-close-icon"})),a1=({filteredHandlers:i,chosenIntentHandler:e,handleSelectHandlerClick:t})=>{const n=o=>{o.length>1||t(o[0])},r=o=>{let a={};return o.forEach(({handler:c})=>{var u;const l=c.applicationTitle||c.applicationName;if((u=a[l])!=null&&u.length){a[l].push(c);return}a[l]=[c]}),a},s=async o=>{};return ce.createElement(Ft,{checkIcon:"check",variant:"single"},i.instances.length?ce.createElement(ce.Fragment,null,ce.createElement(Ft.ItemSection,null,"Open apps"),Object.entries(r(i.instances)).map(([o,a])=>ce.createElement(Ft.Item,{key:o,prepend:a[0].applicationIcon?ce.createElement(s_,{src:a[0].applicationIcon,alt:""}):ce.createElement(fn,{variant:"application"}),onClick:()=>n(a),isSelected:a.length===1&&(e==null?void 0:e.instanceId)===a[0].instanceId,onMouseEnter:()=>{a.length>1||s(a[0])},append:a.length>1?ce.createElement(te,{variant:"light"},ce.createElement(te.Button,{variant:"link",icon:"chevron-down"},"App Instances"),ce.createElement(te.Content,null,ce.createElement(Ft,{checkIcon:"check",variant:"single"},a.map(c=>ce.createElement(Ft.Item,{key:c.instanceId,onClick:()=>t(c),isSelected:(e==null?void 0:e.instanceId)===c.instanceId,onMouseEnter:()=>s()},c.applicationTitle||c.applicationName||c.instanceId,"(",c.instanceId,")"))))):null},o))):null)},c1=({filteredHandlers:i,chosenIntentHandler:e,handleSelectHandlerClick:t})=>ce.createElement(Ft,{checkIcon:"check",variant:"single"},i.apps.length?ce.createElement(ce.Fragment,null,ce.createElement(Ft.ItemSection,null,"All Available Apps"),i.apps.map(({handler:n,intent:r})=>ce.createElement(Ft.Item,{key:n.id,prepend:n.applicationIcon?ce.createElement(s_,{src:n.applicationIcon,alt:""}):ce.createElement(fn,{variant:"application"}),onClick:()=>t(n),isSelected:!(e!=null&&e.instanceId)&&(e==null?void 0:e.applicationName)===n.applicationName},n.applicationTitle||n.applicationName))):null),k_=B.createContext(null),l1=()=>{const i=B.useContext(k_);if(!i)throw new Error("useCustomIOContext must be used within a CustomContextProvider");return i},u1=({io:i,children:e})=>ce.createElement(k_.Provider,{value:i},e),d1=({callerName:i,intentName:e,setShowIntentList:t,handlers:n})=>{const r=l1(),[s,o]=B.useState(""),[a,c]=B.useState({apps:[],instances:[]}),[l,u]=B.useState(void 0),[p,f]=B.useState(!1);B.useEffect(()=>{const C=n.apps.filter(({handler:M,intent:$})=>e?e&&e===$.intent&&(M.applicationTitle||M.applicationName).toLowerCase().includes(s.toLowerCase()):(M.applicationTitle||M.applicationName).toLowerCase().includes(s.toLowerCase())),T=n.instances.filter(({handler:M,intent:$})=>e?e&&e===$.intent&&(M.applicationTitle||M.applicationName).toLowerCase().includes(s.toLowerCase()):(M.applicationTitle||M.applicationName).toLowerCase().includes(s.toLowerCase()));c({apps:C,instances:T})},[s,n]);const w=C=>{if(!l){u(C);return}const T=C.instanceId,M=T&&T===l.instanceId||!T&&!l.instanceId&&C.applicationName===l.applicationName;u(M?void 0:C)},y=()=>{var C;if(l)return(C=r.intents.resolver)==null?void 0:C.sendResponse(l,{saveHandler:p,intent:e})},S=C=>{o(C.target.value)},O=()=>({intentName:e,filteredHandlers:a,chosenIntentHandler:l,handleSelectHandlerClick:w}),_=()=>{var C;return e||(typeof r.intents.resolver.intent=="string"?r.intents.resolver.intent:(C=r.intents.resolver.intent)==null?void 0:C.intent)},v=()=>i?`Always use this app for "${_()}" in "${i}`:`Always use this app for "${_()}"`;return ce.createElement(ce.Fragment,null,ce.createElement(o1,{searchQuery:s,setSearchQuery:o,handleSearchQueryChange:S}),ce.createElement("div",{className:"io-intent-list-wrapper"},ce.createElement(a1,{...O()}),ce.createElement(c1,{...O()})),ce.createElement(cd,{label:v(),onClick:C=>f(C.target.checked)}),ce.createElement(Ae,{align:"right",variant:"fullwidth"},r.intents.resolver.handlerFilter?ce.createElement(it,{text:"Back",variant:"link",onClick:()=>t(!0)}):null,ce.createElement(it,{disabled:!l,variant:"primary",text:"Action",onClick:y})))},h1=i=>{B.useEffect(()=>{let e=!1;const t=i==null?void 0:i.themes;if(!t)return;const n=async r=>{if(e)return;const s=document.documentElement;if(s.classList.contains(r.name))return;const o=await t.list();s.classList.remove(...o.map(({name:a})=>a)),s.classList.add(r.name)};return t.onChanged(n),t.getCurrent().then(n),()=>{e=!0}},[])},p1=({chosenIntentName:i,handleSelectIntentClick:e,setShowIntentList:t,intentsForFilter:n})=>ce.createElement(ce.Fragment,null,ce.createElement("div",{className:"io-intent-list-wrapper"},ce.createElement(Ft,{checkIcon:"check",variant:"single"},Array.from(new Set(n.map(r=>r.intent))).map(r=>ce.createElement(Ft.Item,{key:r,onClick:()=>e(r),isSelected:r===i},r)))),ce.createElement(Ae,{align:"right",variant:"fullwidth"},ce.createElement(it,{disabled:!i,variant:"primary",text:"Next",onClick:()=>t(!1)}))),f1="T42.Web.Client.Control",g1="T42.Channels.Command",T_=({io:i})=>{window.io=i;const[e,t]=B.useState(""),[n,r]=B.useState(""),[s,o]=B.useState(!!i.intents.resolver.handlerFilter),[a,c]=B.useState(""),[l,u]=B.useState({apps:[],instances:[]}),[p,f]=B.useState([]);h1(i),B.useEffect(()=>{const O=({intent:v,title:C,contextTypes:T,resultType:M},$)=>{if(C){t(C);return}if(v){t(rN({intent:n||v,callerName:$}));return}t(sN({contextTypes:T,resultType:M}))};(()=>{var E;const{handlerFilter:v,intent:C}=i.intents.resolver,T=(E=i.intents.resolver)==null?void 0:E.caller,M=T?T.applicationTitle||T.applicationName||T.id:"",$=n||typeof C=="string"?C:(C==null?void 0:C.intent)||"";if(c(M),v){O(v,M);return}const G=M?`from "${M}" `:"";t(`"${$}" action ${G}is unassigned. Choose an app to perform this action.`)})()},[i,n]),B.useEffect(()=>{let O,_;const v=()=>{O=i.intents.resolver.onHandlerAdded((T,M)=>{if(s&&M&&f(A=>A.concat([M])),n&&n!==(M==null?void 0:M.intent))return;const $=T.instanceId,G=l.instances.find(A=>A.handler.applicationName===T.applicationName);if($&&G){u(A=>({apps:A.apps,instances:[...A.instances,{handler:{...T,id:T.instanceId},intent:M}]}));return}const E={...T,id:$?T.instanceId:T.applicationName},D=T.instanceId?"instances":"apps";u(A=>({...A,[D]:[...A[D],{handler:E,intent:M}]}))})},C=()=>{_=i.intents.resolver.onHandlerRemoved((T,M)=>{if(s&&M&&f(G=>G.filter(E=>(E.displayName||E.intent)!==(M.displayName||M.intent))),n&&n!==(M==null?void 0:M.intent))return;const $=T.instanceId?"instances":"apps";u(G=>({...G,[$]:G[$].filter(({handler:E})=>T.instanceId?E.id!==T.instanceId:E.applicationName!==T.applicationName)}))})};return v(),C(),()=>{O(),_()}},[i]),B.useEffect(()=>{(async()=>{if(typeof i.intents.resolver.handlerFilter!="object"){o(!1);return}if(i.intents.resolver.handlerFilter.intent){o(!1),r(i.intents.resolver.handlerFilter.intent);return}const _=window.glue42core||window.iobrowser,v=_?f1:g1,C=_?{domain:"system",operation:"isFdc3DataWrappingSupported"}:{command:"isFdc3DataWrappingSupported"};try{const T=await i.interop.invoke(v,C,{instance:i.interop.instance.instance}),{isSupported:M}=T.returned;o(M)}catch{o(!1)}})()},[i]);const w=O=>{if(!n){r(O);return}r(_=>_===O?"":O)},y=()=>({chosenIntentName:n,handleSelectIntentClick:w,setShowIntentList:o,intentsForFilter:p}),S=()=>({intentName:n,callerName:a,setShowIntentList:o,handlers:l});return ce.createElement(u1,{io:i},ce.createElement(Nt,null,ce.createElement(Nt.Header,null,ce.createElement(ls,{text:"Intents Resolver",size:"large"})),ce.createElement(Nt.Body,null,ce.createElement("p",{className:"io-text-default-lh16"},e),s?ce.createElement(p1,{...y()}):ce.createElement(d1,{...S()}))))},m1=({config:i})=>i.io?(Xb(i.io),Yb(i.io),ce.createElement(T_,{io:i.io})):ce.createElement(y1,null),y1=()=>{const i=B.useContext(kf);if(!i)throw new Error("Couldn't find io. Provide it in props or wrap the component with IOConnectProvider");return Xb(i),Yb(i),ce.createElement(T_,{io:i})},w1={browser:{config:{libraries:[Tp]},factory:Wf},desktop:{config:{libraries:[Tp],appManager:"full"},factory:TP}};dh.createRoot(document.getElementById("root")).render(fd.jsx(ce.StrictMode,{children:fd.jsx(Tf,{settings:w1,children:fd.jsx(m1,{config:{}})})}));
//# sourceMappingURL=index-BCakHIj1.js.map
