var By=Object.defineProperty;var Hy=(t,e,n)=>e in t?By(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var c=(t,e,n)=>Hy(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function Gy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Bh={exports:{}},zo={},Hh={exports:{}},ne={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ns=Symbol.for("react.element"),qy=Symbol.for("react.portal"),Vy=Symbol.for("react.fragment"),Jy=Symbol.for("react.strict_mode"),Ky=Symbol.for("react.profiler"),Qy=Symbol.for("react.provider"),Yy=Symbol.for("react.context"),Xy=Symbol.for("react.forward_ref"),Zy=Symbol.for("react.suspense"),ev=Symbol.for("react.memo"),tv=Symbol.for("react.lazy"),Vu=Symbol.iterator;function nv(t){return t===null||typeof t!="object"?null:(t=Vu&&t[Vu]||t["@@iterator"],typeof t=="function"?t:null)}var Gh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qh=Object.assign,Vh={};function qr(t,e,n){this.props=t,this.context=e,this.refs=Vh,this.updater=n||Gh}qr.prototype.isReactComponent={};qr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};qr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Jh(){}Jh.prototype=qr.prototype;function yc(t,e,n){this.props=t,this.context=e,this.refs=Vh,this.updater=n||Gh}var vc=yc.prototype=new Jh;vc.constructor=yc;qh(vc,qr.prototype);vc.isPureReactComponent=!0;var Ju=Array.isArray,Kh=Object.prototype.hasOwnProperty,wc={current:null},Qh={key:!0,ref:!0,__self:!0,__source:!0};function Yh(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Kh.call(e,r)&&!Qh.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:ns,type:t,key:s,ref:o,props:i,_owner:wc.current}}function rv(t,e){return{$$typeof:ns,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function bc(t){return typeof t=="object"&&t!==null&&t.$$typeof===ns}function iv(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Ku=/\/+/g;function ba(t,e){return typeof t=="object"&&t!==null&&t.key!=null?iv(""+t.key):e.toString(36)}function js(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ns:case qy:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+ba(o,0):r,Ju(i)?(n="",t!=null&&(n=t.replace(Ku,"$&/")+"/"),js(i,e,n,"",function(u){return u})):i!=null&&(bc(i)&&(i=rv(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Ku,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Ju(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+ba(s,a);o+=js(s,e,n,l,i)}else if(l=nv(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+ba(s,a++),o+=js(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function fs(t,e,n){if(t==null)return t;var r=[],i=0;return js(t,r,"","",function(s){return e.call(n,s,i++)}),r}function sv(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Qe={current:null},Ws={transition:null},ov={ReactCurrentDispatcher:Qe,ReactCurrentBatchConfig:Ws,ReactCurrentOwner:wc};function Xh(){throw Error("act(...) is not supported in production builds of React.")}ne.Children={map:fs,forEach:function(t,e,n){fs(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return fs(t,function(){e++}),e},toArray:function(t){return fs(t,function(e){return e})||[]},only:function(t){if(!bc(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ne.Component=qr;ne.Fragment=Vy;ne.Profiler=Ky;ne.PureComponent=yc;ne.StrictMode=Jy;ne.Suspense=Zy;ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ov;ne.act=Xh;ne.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=qh({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=wc.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)Kh.call(e,l)&&!Qh.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:ns,type:t.type,key:i,ref:s,props:r,_owner:o}};ne.createContext=function(t){return t={$$typeof:Yy,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Qy,_context:t},t.Consumer=t};ne.createElement=Yh;ne.createFactory=function(t){var e=Yh.bind(null,t);return e.type=t,e};ne.createRef=function(){return{current:null}};ne.forwardRef=function(t){return{$$typeof:Xy,render:t}};ne.isValidElement=bc;ne.lazy=function(t){return{$$typeof:tv,_payload:{_status:-1,_result:t},_init:sv}};ne.memo=function(t,e){return{$$typeof:ev,type:t,compare:e===void 0?null:e}};ne.startTransition=function(t){var e=Ws.transition;Ws.transition={};try{t()}finally{Ws.transition=e}};ne.unstable_act=Xh;ne.useCallback=function(t,e){return Qe.current.useCallback(t,e)};ne.useContext=function(t){return Qe.current.useContext(t)};ne.useDebugValue=function(){};ne.useDeferredValue=function(t){return Qe.current.useDeferredValue(t)};ne.useEffect=function(t,e){return Qe.current.useEffect(t,e)};ne.useId=function(){return Qe.current.useId()};ne.useImperativeHandle=function(t,e,n){return Qe.current.useImperativeHandle(t,e,n)};ne.useInsertionEffect=function(t,e){return Qe.current.useInsertionEffect(t,e)};ne.useLayoutEffect=function(t,e){return Qe.current.useLayoutEffect(t,e)};ne.useMemo=function(t,e){return Qe.current.useMemo(t,e)};ne.useReducer=function(t,e,n){return Qe.current.useReducer(t,e,n)};ne.useRef=function(t){return Qe.current.useRef(t)};ne.useState=function(t){return Qe.current.useState(t)};ne.useSyncExternalStore=function(t,e,n){return Qe.current.useSyncExternalStore(t,e,n)};ne.useTransition=function(){return Qe.current.useTransition()};ne.version="18.3.1";Hh.exports=ne;var Mn=Hh.exports;const Us=Gy(Mn);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var av=Mn,lv=Symbol.for("react.element"),cv=Symbol.for("react.fragment"),uv=Object.prototype.hasOwnProperty,dv=av.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hv={key:!0,ref:!0,__self:!0,__source:!0};function Zh(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)uv.call(e,r)&&!hv.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:lv,type:t,key:s,ref:o,props:i,_owner:dv.current}}zo.Fragment=cv;zo.jsx=Zh;zo.jsxs=Zh;Bh.exports=zo;var en=Bh.exports,ef={exports:{}},ft={},tf={exports:{}},nf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,X){var B=U.length;U.push(X);e:for(;0<B;){var ge=B-1>>>1,Se=U[ge];if(0<i(Se,X))U[ge]=X,U[B]=Se,B=ge;else break e}}function n(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var X=U[0],B=U.pop();if(B!==X){U[0]=B;e:for(var ge=0,Se=U.length,Ze=Se>>>1;ge<Ze;){var Mt=2*(ge+1)-1,ur=U[Mt],Bt=Mt+1,dr=U[Bt];if(0>i(ur,B))Bt<Se&&0>i(dr,ur)?(U[ge]=dr,U[Bt]=B,ge=Bt):(U[ge]=ur,U[Mt]=B,ge=Mt);else if(Bt<Se&&0>i(dr,B))U[ge]=dr,U[Bt]=B,ge=Bt;else break e}}return X}function i(U,X){var B=U.sortIndex-X.sortIndex;return B!==0?B:U.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],p=1,g=null,f=3,I=!1,S=!1,k=!1,H=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(U){for(var X=n(u);X!==null;){if(X.callback===null)r(u);else if(X.startTime<=U)r(u),X.sortIndex=X.expirationTime,e(l,X);else break;X=n(u)}}function E(U){if(k=!1,v(U),!S)if(n(l)!==null)S=!0,Xe(x);else{var X=n(u);X!==null&&Ot(E,X.startTime-U)}}function x(U,X){S=!1,k&&(k=!1,C(T),T=-1),I=!0;var B=f;try{for(v(X),g=n(l);g!==null&&(!(g.expirationTime>X)||U&&!D());){var ge=g.callback;if(typeof ge=="function"){g.callback=null,f=g.priorityLevel;var Se=ge(g.expirationTime<=X);X=t.unstable_now(),typeof Se=="function"?g.callback=Se:g===n(l)&&r(l),v(X)}else r(l);g=n(l)}if(g!==null)var Ze=!0;else{var Mt=n(u);Mt!==null&&Ot(E,Mt.startTime-X),Ze=!1}return Ze}finally{g=null,f=B,I=!1}}var L=!1,j=null,T=-1,J=5,P=-1;function D(){return!(t.unstable_now()-P<J)}function O(){if(j!==null){var U=t.unstable_now();P=U;var X=!0;try{X=j(!0,U)}finally{X?$():(L=!1,j=null)}}else L=!1}var $;if(typeof m=="function")$=function(){m(O)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,Y=Z.port2;Z.port1.onmessage=O,$=function(){Y.postMessage(null)}}else $=function(){H(O,0)};function Xe(U){j=U,L||(L=!0,$())}function Ot(U,X){T=H(function(){U(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){S||I||(S=!0,Xe(x))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(U){switch(f){case 1:case 2:case 3:var X=3;break;default:X=f}var B=f;f=X;try{return U()}finally{f=B}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,X){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var B=f;f=U;try{return X()}finally{f=B}},t.unstable_scheduleCallback=function(U,X,B){var ge=t.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?ge+B:ge):B=ge,U){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=B+Se,U={id:p++,callback:X,priorityLevel:U,startTime:B,expirationTime:Se,sortIndex:-1},B>ge?(U.sortIndex=B,e(u,U),n(l)===null&&U===n(u)&&(k?(C(T),T=-1):k=!0,Ot(E,B-ge))):(U.sortIndex=Se,e(l,U),S||I||(S=!0,Xe(x))),U},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(U){var X=f;return function(){var B=f;f=X;try{return U.apply(this,arguments)}finally{f=B}}}})(nf);tf.exports=nf;var fv=tf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pv=Mn,ht=fv;function M(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rf=new Set,Fi={};function lr(t,e){Fr(t,e),Fr(t+"Capture",e)}function Fr(t,e){for(Fi[t]=e,t=0;t<e.length;t++)rf.add(e[t])}var ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),al=Object.prototype.hasOwnProperty,gv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qu={},Yu={};function mv(t){return al.call(Yu,t)?!0:al.call(Qu,t)?!1:gv.test(t)?Yu[t]=!0:(Qu[t]=!0,!1)}function yv(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function vv(t,e,n,r){if(e===null||typeof e>"u"||yv(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ye(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Be={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Be[t]=new Ye(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Be[e]=new Ye(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Be[t]=new Ye(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Be[t]=new Ye(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Be[t]=new Ye(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Be[t]=new Ye(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Be[t]=new Ye(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Be[t]=new Ye(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Be[t]=new Ye(t,5,!1,t.toLowerCase(),null,!1,!1)});var Cc=/[\-:]([a-z])/g;function Sc(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Cc,Sc);Be[e]=new Ye(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Cc,Sc);Be[e]=new Ye(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Cc,Sc);Be[e]=new Ye(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Be[t]=new Ye(t,1,!1,t.toLowerCase(),null,!1,!1)});Be.xlinkHref=new Ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Be[t]=new Ye(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ic(t,e,n,r){var i=Be.hasOwnProperty(e)?Be[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(vv(e,n,i,r)&&(n=null),r||i===null?mv(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var hn=pv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ps=Symbol.for("react.element"),wr=Symbol.for("react.portal"),br=Symbol.for("react.fragment"),_c=Symbol.for("react.strict_mode"),ll=Symbol.for("react.profiler"),sf=Symbol.for("react.provider"),of=Symbol.for("react.context"),Ec=Symbol.for("react.forward_ref"),cl=Symbol.for("react.suspense"),ul=Symbol.for("react.suspense_list"),kc=Symbol.for("react.memo"),bn=Symbol.for("react.lazy"),af=Symbol.for("react.offscreen"),Xu=Symbol.iterator;function Xr(t){return t===null||typeof t!="object"?null:(t=Xu&&t[Xu]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,Ca;function pi(t){if(Ca===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ca=e&&e[1]||""}return`
`+Ca+t}var Sa=!1;function Ia(t,e){if(!t||Sa)return"";Sa=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Sa=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?pi(t):""}function wv(t){switch(t.tag){case 5:return pi(t.type);case 16:return pi("Lazy");case 13:return pi("Suspense");case 19:return pi("SuspenseList");case 0:case 2:case 15:return t=Ia(t.type,!1),t;case 11:return t=Ia(t.type.render,!1),t;case 1:return t=Ia(t.type,!0),t;default:return""}}function dl(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case br:return"Fragment";case wr:return"Portal";case ll:return"Profiler";case _c:return"StrictMode";case cl:return"Suspense";case ul:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case of:return(t.displayName||"Context")+".Consumer";case sf:return(t._context.displayName||"Context")+".Provider";case Ec:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case kc:return e=t.displayName||null,e!==null?e:dl(t.type)||"Memo";case bn:e=t._payload,t=t._init;try{return dl(t(e))}catch{}}return null}function bv(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return dl(e);case 8:return e===_c?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ln(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function lf(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Cv(t){var e=lf(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function gs(t){t._valueTracker||(t._valueTracker=Cv(t))}function cf(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=lf(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function oo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function hl(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Zu(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ln(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function uf(t,e){e=e.checked,e!=null&&Ic(t,"checked",e,!1)}function fl(t,e){uf(t,e);var n=Ln(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?pl(t,e.type,n):e.hasOwnProperty("defaultValue")&&pl(t,e.type,Ln(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ed(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function pl(t,e,n){(e!=="number"||oo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var gi=Array.isArray;function xr(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ln(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function gl(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(M(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function td(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(M(92));if(gi(n)){if(1<n.length)throw Error(M(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ln(n)}}function df(t,e){var n=Ln(e.value),r=Ln(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function nd(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function hf(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ml(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?hf(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ms,ff=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ms=ms||document.createElement("div"),ms.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ms.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function $i(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ri={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sv=["Webkit","ms","Moz","O"];Object.keys(Ri).forEach(function(t){Sv.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ri[e]=Ri[t]})});function pf(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ri.hasOwnProperty(t)&&Ri[t]?(""+e).trim():e+"px"}function gf(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=pf(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Iv=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yl(t,e){if(e){if(Iv[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(M(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(M(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(M(61))}if(e.style!=null&&typeof e.style!="object")throw Error(M(62))}}function vl(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wl=null;function Tc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var bl=null,Ar=null,Nr=null;function rd(t){if(t=ss(t)){if(typeof bl!="function")throw Error(M(280));var e=t.stateNode;e&&(e=Vo(e),bl(t.stateNode,t.type,e))}}function mf(t){Ar?Nr?Nr.push(t):Nr=[t]:Ar=t}function yf(){if(Ar){var t=Ar,e=Nr;if(Nr=Ar=null,rd(t),e)for(t=0;t<e.length;t++)rd(e[t])}}function vf(t,e){return t(e)}function wf(){}var _a=!1;function bf(t,e,n){if(_a)return t(e,n);_a=!0;try{return vf(t,e,n)}finally{_a=!1,(Ar!==null||Nr!==null)&&(wf(),yf())}}function ji(t,e){var n=t.stateNode;if(n===null)return null;var r=Vo(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(M(231,e,typeof n));return n}var Cl=!1;if(ln)try{var Zr={};Object.defineProperty(Zr,"passive",{get:function(){Cl=!0}}),window.addEventListener("test",Zr,Zr),window.removeEventListener("test",Zr,Zr)}catch{Cl=!1}function _v(t,e,n,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(p){this.onError(p)}}var Pi=!1,ao=null,lo=!1,Sl=null,Ev={onError:function(t){Pi=!0,ao=t}};function kv(t,e,n,r,i,s,o,a,l){Pi=!1,ao=null,_v.apply(Ev,arguments)}function Tv(t,e,n,r,i,s,o,a,l){if(kv.apply(this,arguments),Pi){if(Pi){var u=ao;Pi=!1,ao=null}else throw Error(M(198));lo||(lo=!0,Sl=u)}}function cr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Cf(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function id(t){if(cr(t)!==t)throw Error(M(188))}function Rv(t){var e=t.alternate;if(!e){if(e=cr(t),e===null)throw Error(M(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return id(i),t;if(s===r)return id(i),e;s=s.sibling}throw Error(M(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(M(189))}}if(n.alternate!==r)throw Error(M(190))}if(n.tag!==3)throw Error(M(188));return n.stateNode.current===n?t:e}function Sf(t){return t=Rv(t),t!==null?If(t):null}function If(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=If(t);if(e!==null)return e;t=t.sibling}return null}var _f=ht.unstable_scheduleCallback,sd=ht.unstable_cancelCallback,Pv=ht.unstable_shouldYield,Dv=ht.unstable_requestPaint,Ce=ht.unstable_now,xv=ht.unstable_getCurrentPriorityLevel,Rc=ht.unstable_ImmediatePriority,Ef=ht.unstable_UserBlockingPriority,co=ht.unstable_NormalPriority,Av=ht.unstable_LowPriority,kf=ht.unstable_IdlePriority,Bo=null,Ut=null;function Nv(t){if(Ut&&typeof Ut.onCommitFiberRoot=="function")try{Ut.onCommitFiberRoot(Bo,t,void 0,(t.current.flags&128)===128)}catch{}}var xt=Math.clz32?Math.clz32:Lv,Ov=Math.log,Mv=Math.LN2;function Lv(t){return t>>>=0,t===0?32:31-(Ov(t)/Mv|0)|0}var ys=64,vs=4194304;function mi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function uo(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=mi(a):(s&=o,s!==0&&(r=mi(s)))}else o=n&~i,o!==0?r=mi(o):s!==0&&(r=mi(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-xt(e),i=1<<n,r|=t[n],e&=~i;return r}function Fv(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $v(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-xt(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=Fv(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Il(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Tf(){var t=ys;return ys<<=1,!(ys&4194240)&&(ys=64),t}function Ea(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function rs(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-xt(e),t[e]=n}function jv(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-xt(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Pc(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-xt(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var se=0;function Rf(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Pf,Dc,Df,xf,Af,_l=!1,ws=[],kn=null,Tn=null,Rn=null,Wi=new Map,Ui=new Map,Sn=[],Wv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function od(t,e){switch(t){case"focusin":case"focusout":kn=null;break;case"dragenter":case"dragleave":Tn=null;break;case"mouseover":case"mouseout":Rn=null;break;case"pointerover":case"pointerout":Wi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ui.delete(e.pointerId)}}function ei(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=ss(e),e!==null&&Dc(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Uv(t,e,n,r,i){switch(e){case"focusin":return kn=ei(kn,t,e,n,r,i),!0;case"dragenter":return Tn=ei(Tn,t,e,n,r,i),!0;case"mouseover":return Rn=ei(Rn,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Wi.set(s,ei(Wi.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Ui.set(s,ei(Ui.get(s)||null,t,e,n,r,i)),!0}return!1}function Nf(t){var e=Qn(t.target);if(e!==null){var n=cr(e);if(n!==null){if(e=n.tag,e===13){if(e=Cf(n),e!==null){t.blockedOn=e,Af(t.priority,function(){Df(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function zs(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=El(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);wl=r,n.target.dispatchEvent(r),wl=null}else return e=ss(n),e!==null&&Dc(e),t.blockedOn=n,!1;e.shift()}return!0}function ad(t,e,n){zs(t)&&n.delete(e)}function zv(){_l=!1,kn!==null&&zs(kn)&&(kn=null),Tn!==null&&zs(Tn)&&(Tn=null),Rn!==null&&zs(Rn)&&(Rn=null),Wi.forEach(ad),Ui.forEach(ad)}function ti(t,e){t.blockedOn===e&&(t.blockedOn=null,_l||(_l=!0,ht.unstable_scheduleCallback(ht.unstable_NormalPriority,zv)))}function zi(t){function e(i){return ti(i,t)}if(0<ws.length){ti(ws[0],t);for(var n=1;n<ws.length;n++){var r=ws[n];r.blockedOn===t&&(r.blockedOn=null)}}for(kn!==null&&ti(kn,t),Tn!==null&&ti(Tn,t),Rn!==null&&ti(Rn,t),Wi.forEach(e),Ui.forEach(e),n=0;n<Sn.length;n++)r=Sn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Sn.length&&(n=Sn[0],n.blockedOn===null);)Nf(n),n.blockedOn===null&&Sn.shift()}var Or=hn.ReactCurrentBatchConfig,ho=!0;function Bv(t,e,n,r){var i=se,s=Or.transition;Or.transition=null;try{se=1,xc(t,e,n,r)}finally{se=i,Or.transition=s}}function Hv(t,e,n,r){var i=se,s=Or.transition;Or.transition=null;try{se=4,xc(t,e,n,r)}finally{se=i,Or.transition=s}}function xc(t,e,n,r){if(ho){var i=El(t,e,n,r);if(i===null)Ma(t,e,r,fo,n),od(t,r);else if(Uv(i,t,e,n,r))r.stopPropagation();else if(od(t,r),e&4&&-1<Wv.indexOf(t)){for(;i!==null;){var s=ss(i);if(s!==null&&Pf(s),s=El(t,e,n,r),s===null&&Ma(t,e,r,fo,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Ma(t,e,r,null,n)}}var fo=null;function El(t,e,n,r){if(fo=null,t=Tc(r),t=Qn(t),t!==null)if(e=cr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Cf(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return fo=t,null}function Of(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xv()){case Rc:return 1;case Ef:return 4;case co:case Av:return 16;case kf:return 536870912;default:return 16}default:return 16}}var _n=null,Ac=null,Bs=null;function Mf(){if(Bs)return Bs;var t,e=Ac,n=e.length,r,i="value"in _n?_n.value:_n.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return Bs=i.slice(t,1<r?1-r:void 0)}function Hs(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function bs(){return!0}function ld(){return!1}function pt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?bs:ld,this.isPropagationStopped=ld,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=bs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=bs)},persist:function(){},isPersistent:bs}),e}var Vr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nc=pt(Vr),is=ve({},Vr,{view:0,detail:0}),Gv=pt(is),ka,Ta,ni,Ho=ve({},is,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ni&&(ni&&t.type==="mousemove"?(ka=t.screenX-ni.screenX,Ta=t.screenY-ni.screenY):Ta=ka=0,ni=t),ka)},movementY:function(t){return"movementY"in t?t.movementY:Ta}}),cd=pt(Ho),qv=ve({},Ho,{dataTransfer:0}),Vv=pt(qv),Jv=ve({},is,{relatedTarget:0}),Ra=pt(Jv),Kv=ve({},Vr,{animationName:0,elapsedTime:0,pseudoElement:0}),Qv=pt(Kv),Yv=ve({},Vr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Xv=pt(Yv),Zv=ve({},Vr,{data:0}),ud=pt(Zv),ew={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=nw[t])?!!e[t]:!1}function Oc(){return rw}var iw=ve({},is,{key:function(t){if(t.key){var e=ew[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Hs(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?tw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oc,charCode:function(t){return t.type==="keypress"?Hs(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Hs(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),sw=pt(iw),ow=ve({},Ho,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dd=pt(ow),aw=ve({},is,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oc}),lw=pt(aw),cw=ve({},Vr,{propertyName:0,elapsedTime:0,pseudoElement:0}),uw=pt(cw),dw=ve({},Ho,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),hw=pt(dw),fw=[9,13,27,32],Mc=ln&&"CompositionEvent"in window,Di=null;ln&&"documentMode"in document&&(Di=document.documentMode);var pw=ln&&"TextEvent"in window&&!Di,Lf=ln&&(!Mc||Di&&8<Di&&11>=Di),hd=" ",fd=!1;function Ff(t,e){switch(t){case"keyup":return fw.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $f(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Cr=!1;function gw(t,e){switch(t){case"compositionend":return $f(e);case"keypress":return e.which!==32?null:(fd=!0,hd);case"textInput":return t=e.data,t===hd&&fd?null:t;default:return null}}function mw(t,e){if(Cr)return t==="compositionend"||!Mc&&Ff(t,e)?(t=Mf(),Bs=Ac=_n=null,Cr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Lf&&e.locale!=="ko"?null:e.data;default:return null}}var yw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!yw[t.type]:e==="textarea"}function jf(t,e,n,r){mf(r),e=po(e,"onChange"),0<e.length&&(n=new Nc("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var xi=null,Bi=null;function vw(t){Qf(t,0)}function Go(t){var e=_r(t);if(cf(e))return t}function ww(t,e){if(t==="change")return e}var Wf=!1;if(ln){var Pa;if(ln){var Da="oninput"in document;if(!Da){var gd=document.createElement("div");gd.setAttribute("oninput","return;"),Da=typeof gd.oninput=="function"}Pa=Da}else Pa=!1;Wf=Pa&&(!document.documentMode||9<document.documentMode)}function md(){xi&&(xi.detachEvent("onpropertychange",Uf),Bi=xi=null)}function Uf(t){if(t.propertyName==="value"&&Go(Bi)){var e=[];jf(e,Bi,t,Tc(t)),bf(vw,e)}}function bw(t,e,n){t==="focusin"?(md(),xi=e,Bi=n,xi.attachEvent("onpropertychange",Uf)):t==="focusout"&&md()}function Cw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Go(Bi)}function Sw(t,e){if(t==="click")return Go(e)}function Iw(t,e){if(t==="input"||t==="change")return Go(e)}function _w(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Nt=typeof Object.is=="function"?Object.is:_w;function Hi(t,e){if(Nt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!al.call(e,i)||!Nt(t[i],e[i]))return!1}return!0}function yd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function vd(t,e){var n=yd(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=yd(n)}}function zf(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?zf(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Bf(){for(var t=window,e=oo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=oo(t.document)}return e}function Lc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Ew(t){var e=Bf(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&zf(n.ownerDocument.documentElement,n)){if(r!==null&&Lc(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=vd(n,s);var o=vd(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var kw=ln&&"documentMode"in document&&11>=document.documentMode,Sr=null,kl=null,Ai=null,Tl=!1;function wd(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Tl||Sr==null||Sr!==oo(r)||(r=Sr,"selectionStart"in r&&Lc(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ai&&Hi(Ai,r)||(Ai=r,r=po(kl,"onSelect"),0<r.length&&(e=new Nc("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Sr)))}function Cs(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ir={animationend:Cs("Animation","AnimationEnd"),animationiteration:Cs("Animation","AnimationIteration"),animationstart:Cs("Animation","AnimationStart"),transitionend:Cs("Transition","TransitionEnd")},xa={},Hf={};ln&&(Hf=document.createElement("div").style,"AnimationEvent"in window||(delete Ir.animationend.animation,delete Ir.animationiteration.animation,delete Ir.animationstart.animation),"TransitionEvent"in window||delete Ir.transitionend.transition);function qo(t){if(xa[t])return xa[t];if(!Ir[t])return t;var e=Ir[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Hf)return xa[t]=e[n];return t}var Gf=qo("animationend"),qf=qo("animationiteration"),Vf=qo("animationstart"),Jf=qo("transitionend"),Kf=new Map,bd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $n(t,e){Kf.set(t,e),lr(e,[t])}for(var Aa=0;Aa<bd.length;Aa++){var Na=bd[Aa],Tw=Na.toLowerCase(),Rw=Na[0].toUpperCase()+Na.slice(1);$n(Tw,"on"+Rw)}$n(Gf,"onAnimationEnd");$n(qf,"onAnimationIteration");$n(Vf,"onAnimationStart");$n("dblclick","onDoubleClick");$n("focusin","onFocus");$n("focusout","onBlur");$n(Jf,"onTransitionEnd");Fr("onMouseEnter",["mouseout","mouseover"]);Fr("onMouseLeave",["mouseout","mouseover"]);Fr("onPointerEnter",["pointerout","pointerover"]);Fr("onPointerLeave",["pointerout","pointerover"]);lr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));lr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));lr("onBeforeInput",["compositionend","keypress","textInput","paste"]);lr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));lr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));lr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pw=new Set("cancel close invalid load scroll toggle".split(" ").concat(yi));function Cd(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Tv(r,e,void 0,t),t.currentTarget=null}function Qf(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Cd(i,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Cd(i,a,u),s=l}}}if(lo)throw t=Sl,lo=!1,Sl=null,t}function de(t,e){var n=e[Al];n===void 0&&(n=e[Al]=new Set);var r=t+"__bubble";n.has(r)||(Yf(e,t,2,!1),n.add(r))}function Oa(t,e,n){var r=0;e&&(r|=4),Yf(n,t,r,e)}var Ss="_reactListening"+Math.random().toString(36).slice(2);function Gi(t){if(!t[Ss]){t[Ss]=!0,rf.forEach(function(n){n!=="selectionchange"&&(Pw.has(n)||Oa(n,!1,t),Oa(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ss]||(e[Ss]=!0,Oa("selectionchange",!1,e))}}function Yf(t,e,n,r){switch(Of(e)){case 1:var i=Bv;break;case 4:i=Hv;break;default:i=xc}n=i.bind(null,e,n,t),i=void 0,!Cl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Ma(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Qn(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}bf(function(){var u=s,p=Tc(n),g=[];e:{var f=Kf.get(t);if(f!==void 0){var I=Nc,S=t;switch(t){case"keypress":if(Hs(n)===0)break e;case"keydown":case"keyup":I=sw;break;case"focusin":S="focus",I=Ra;break;case"focusout":S="blur",I=Ra;break;case"beforeblur":case"afterblur":I=Ra;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":I=cd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":I=Vv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":I=lw;break;case Gf:case qf:case Vf:I=Qv;break;case Jf:I=uw;break;case"scroll":I=Gv;break;case"wheel":I=hw;break;case"copy":case"cut":case"paste":I=Xv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":I=dd}var k=(e&4)!==0,H=!k&&t==="scroll",C=k?f!==null?f+"Capture":null:f;k=[];for(var m=u,v;m!==null;){v=m;var E=v.stateNode;if(v.tag===5&&E!==null&&(v=E,C!==null&&(E=ji(m,C),E!=null&&k.push(qi(m,E,v)))),H)break;m=m.return}0<k.length&&(f=new I(f,S,null,n,p),g.push({event:f,listeners:k}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",I=t==="mouseout"||t==="pointerout",f&&n!==wl&&(S=n.relatedTarget||n.fromElement)&&(Qn(S)||S[cn]))break e;if((I||f)&&(f=p.window===p?p:(f=p.ownerDocument)?f.defaultView||f.parentWindow:window,I?(S=n.relatedTarget||n.toElement,I=u,S=S?Qn(S):null,S!==null&&(H=cr(S),S!==H||S.tag!==5&&S.tag!==6)&&(S=null)):(I=null,S=u),I!==S)){if(k=cd,E="onMouseLeave",C="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(k=dd,E="onPointerLeave",C="onPointerEnter",m="pointer"),H=I==null?f:_r(I),v=S==null?f:_r(S),f=new k(E,m+"leave",I,n,p),f.target=H,f.relatedTarget=v,E=null,Qn(p)===u&&(k=new k(C,m+"enter",S,n,p),k.target=v,k.relatedTarget=H,E=k),H=E,I&&S)t:{for(k=I,C=S,m=0,v=k;v;v=mr(v))m++;for(v=0,E=C;E;E=mr(E))v++;for(;0<m-v;)k=mr(k),m--;for(;0<v-m;)C=mr(C),v--;for(;m--;){if(k===C||C!==null&&k===C.alternate)break t;k=mr(k),C=mr(C)}k=null}else k=null;I!==null&&Sd(g,f,I,k,!1),S!==null&&H!==null&&Sd(g,H,S,k,!0)}}e:{if(f=u?_r(u):window,I=f.nodeName&&f.nodeName.toLowerCase(),I==="select"||I==="input"&&f.type==="file")var x=ww;else if(pd(f))if(Wf)x=Iw;else{x=Cw;var L=bw}else(I=f.nodeName)&&I.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(x=Sw);if(x&&(x=x(t,u))){jf(g,x,n,p);break e}L&&L(t,f,u),t==="focusout"&&(L=f._wrapperState)&&L.controlled&&f.type==="number"&&pl(f,"number",f.value)}switch(L=u?_r(u):window,t){case"focusin":(pd(L)||L.contentEditable==="true")&&(Sr=L,kl=u,Ai=null);break;case"focusout":Ai=kl=Sr=null;break;case"mousedown":Tl=!0;break;case"contextmenu":case"mouseup":case"dragend":Tl=!1,wd(g,n,p);break;case"selectionchange":if(kw)break;case"keydown":case"keyup":wd(g,n,p)}var j;if(Mc)e:{switch(t){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Cr?Ff(t,n)&&(T="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(Lf&&n.locale!=="ko"&&(Cr||T!=="onCompositionStart"?T==="onCompositionEnd"&&Cr&&(j=Mf()):(_n=p,Ac="value"in _n?_n.value:_n.textContent,Cr=!0)),L=po(u,T),0<L.length&&(T=new ud(T,t,null,n,p),g.push({event:T,listeners:L}),j?T.data=j:(j=$f(n),j!==null&&(T.data=j)))),(j=pw?gw(t,n):mw(t,n))&&(u=po(u,"onBeforeInput"),0<u.length&&(p=new ud("onBeforeInput","beforeinput",null,n,p),g.push({event:p,listeners:u}),p.data=j))}Qf(g,e)})}function qi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function po(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=ji(t,n),s!=null&&r.unshift(qi(t,s,i)),s=ji(t,e),s!=null&&r.push(qi(t,s,i))),t=t.return}return r}function mr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Sd(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,i?(l=ji(n,s),l!=null&&o.unshift(qi(n,l,a))):i||(l=ji(n,s),l!=null&&o.push(qi(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Dw=/\r\n?/g,xw=/\u0000|\uFFFD/g;function Id(t){return(typeof t=="string"?t:""+t).replace(Dw,`
`).replace(xw,"")}function Is(t,e,n){if(e=Id(e),Id(t)!==e&&n)throw Error(M(425))}function go(){}var Rl=null,Pl=null;function Dl(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xl=typeof setTimeout=="function"?setTimeout:void 0,Aw=typeof clearTimeout=="function"?clearTimeout:void 0,_d=typeof Promise=="function"?Promise:void 0,Nw=typeof queueMicrotask=="function"?queueMicrotask:typeof _d<"u"?function(t){return _d.resolve(null).then(t).catch(Ow)}:xl;function Ow(t){setTimeout(function(){throw t})}function La(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),zi(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);zi(e)}function Pn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ed(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Jr=Math.random().toString(36).slice(2),jt="__reactFiber$"+Jr,Vi="__reactProps$"+Jr,cn="__reactContainer$"+Jr,Al="__reactEvents$"+Jr,Mw="__reactListeners$"+Jr,Lw="__reactHandles$"+Jr;function Qn(t){var e=t[jt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[cn]||n[jt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ed(t);t!==null;){if(n=t[jt])return n;t=Ed(t)}return e}t=n,n=t.parentNode}return null}function ss(t){return t=t[jt]||t[cn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _r(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(M(33))}function Vo(t){return t[Vi]||null}var Nl=[],Er=-1;function jn(t){return{current:t}}function he(t){0>Er||(t.current=Nl[Er],Nl[Er]=null,Er--)}function ce(t,e){Er++,Nl[Er]=t.current,t.current=e}var Fn={},Ve=jn(Fn),it=jn(!1),tr=Fn;function $r(t,e){var n=t.type.contextTypes;if(!n)return Fn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function st(t){return t=t.childContextTypes,t!=null}function mo(){he(it),he(Ve)}function kd(t,e,n){if(Ve.current!==Fn)throw Error(M(168));ce(Ve,e),ce(it,n)}function Xf(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(M(108,bv(t)||"Unknown",i));return ve({},n,r)}function yo(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Fn,tr=Ve.current,ce(Ve,t),ce(it,it.current),!0}function Td(t,e,n){var r=t.stateNode;if(!r)throw Error(M(169));n?(t=Xf(t,e,tr),r.__reactInternalMemoizedMergedChildContext=t,he(it),he(Ve),ce(Ve,t)):he(it),ce(it,n)}var tn=null,Jo=!1,Fa=!1;function Zf(t){tn===null?tn=[t]:tn.push(t)}function Fw(t){Jo=!0,Zf(t)}function Wn(){if(!Fa&&tn!==null){Fa=!0;var t=0,e=se;try{var n=tn;for(se=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}tn=null,Jo=!1}catch(i){throw tn!==null&&(tn=tn.slice(t+1)),_f(Rc,Wn),i}finally{se=e,Fa=!1}}return null}var kr=[],Tr=0,vo=null,wo=0,yt=[],vt=0,nr=null,rn=1,sn="";function Jn(t,e){kr[Tr++]=wo,kr[Tr++]=vo,vo=t,wo=e}function ep(t,e,n){yt[vt++]=rn,yt[vt++]=sn,yt[vt++]=nr,nr=t;var r=rn;t=sn;var i=32-xt(r)-1;r&=~(1<<i),n+=1;var s=32-xt(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,rn=1<<32-xt(e)+i|n<<i|r,sn=s+t}else rn=1<<s|n<<i|r,sn=t}function Fc(t){t.return!==null&&(Jn(t,1),ep(t,1,0))}function $c(t){for(;t===vo;)vo=kr[--Tr],kr[Tr]=null,wo=kr[--Tr],kr[Tr]=null;for(;t===nr;)nr=yt[--vt],yt[vt]=null,sn=yt[--vt],yt[vt]=null,rn=yt[--vt],yt[vt]=null}var dt=null,ct=null,pe=!1,Pt=null;function tp(t,e){var n=wt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Rd(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,dt=t,ct=Pn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,dt=t,ct=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=nr!==null?{id:rn,overflow:sn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=wt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,dt=t,ct=null,!0):!1;default:return!1}}function Ol(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ml(t){if(pe){var e=ct;if(e){var n=e;if(!Rd(t,e)){if(Ol(t))throw Error(M(418));e=Pn(n.nextSibling);var r=dt;e&&Rd(t,e)?tp(r,n):(t.flags=t.flags&-4097|2,pe=!1,dt=t)}}else{if(Ol(t))throw Error(M(418));t.flags=t.flags&-4097|2,pe=!1,dt=t}}}function Pd(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;dt=t}function _s(t){if(t!==dt)return!1;if(!pe)return Pd(t),pe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Dl(t.type,t.memoizedProps)),e&&(e=ct)){if(Ol(t))throw np(),Error(M(418));for(;e;)tp(t,e),e=Pn(e.nextSibling)}if(Pd(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(M(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ct=Pn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ct=null}}else ct=dt?Pn(t.stateNode.nextSibling):null;return!0}function np(){for(var t=ct;t;)t=Pn(t.nextSibling)}function jr(){ct=dt=null,pe=!1}function jc(t){Pt===null?Pt=[t]:Pt.push(t)}var $w=hn.ReactCurrentBatchConfig;function ri(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(M(309));var r=n.stateNode}if(!r)throw Error(M(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(M(284));if(!n._owner)throw Error(M(290,t))}return t}function Es(t,e){throw t=Object.prototype.toString.call(e),Error(M(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Dd(t){var e=t._init;return e(t._payload)}function rp(t){function e(C,m){if(t){var v=C.deletions;v===null?(C.deletions=[m],C.flags|=16):v.push(m)}}function n(C,m){if(!t)return null;for(;m!==null;)e(C,m),m=m.sibling;return null}function r(C,m){for(C=new Map;m!==null;)m.key!==null?C.set(m.key,m):C.set(m.index,m),m=m.sibling;return C}function i(C,m){return C=Nn(C,m),C.index=0,C.sibling=null,C}function s(C,m,v){return C.index=v,t?(v=C.alternate,v!==null?(v=v.index,v<m?(C.flags|=2,m):v):(C.flags|=2,m)):(C.flags|=1048576,m)}function o(C){return t&&C.alternate===null&&(C.flags|=2),C}function a(C,m,v,E){return m===null||m.tag!==6?(m=Ha(v,C.mode,E),m.return=C,m):(m=i(m,v),m.return=C,m)}function l(C,m,v,E){var x=v.type;return x===br?p(C,m,v.props.children,E,v.key):m!==null&&(m.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===bn&&Dd(x)===m.type)?(E=i(m,v.props),E.ref=ri(C,m,v),E.return=C,E):(E=Ys(v.type,v.key,v.props,null,C.mode,E),E.ref=ri(C,m,v),E.return=C,E)}function u(C,m,v,E){return m===null||m.tag!==4||m.stateNode.containerInfo!==v.containerInfo||m.stateNode.implementation!==v.implementation?(m=Ga(v,C.mode,E),m.return=C,m):(m=i(m,v.children||[]),m.return=C,m)}function p(C,m,v,E,x){return m===null||m.tag!==7?(m=er(v,C.mode,E,x),m.return=C,m):(m=i(m,v),m.return=C,m)}function g(C,m,v){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Ha(""+m,C.mode,v),m.return=C,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ps:return v=Ys(m.type,m.key,m.props,null,C.mode,v),v.ref=ri(C,null,m),v.return=C,v;case wr:return m=Ga(m,C.mode,v),m.return=C,m;case bn:var E=m._init;return g(C,E(m._payload),v)}if(gi(m)||Xr(m))return m=er(m,C.mode,v,null),m.return=C,m;Es(C,m)}return null}function f(C,m,v,E){var x=m!==null?m.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return x!==null?null:a(C,m,""+v,E);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ps:return v.key===x?l(C,m,v,E):null;case wr:return v.key===x?u(C,m,v,E):null;case bn:return x=v._init,f(C,m,x(v._payload),E)}if(gi(v)||Xr(v))return x!==null?null:p(C,m,v,E,null);Es(C,v)}return null}function I(C,m,v,E,x){if(typeof E=="string"&&E!==""||typeof E=="number")return C=C.get(v)||null,a(m,C,""+E,x);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case ps:return C=C.get(E.key===null?v:E.key)||null,l(m,C,E,x);case wr:return C=C.get(E.key===null?v:E.key)||null,u(m,C,E,x);case bn:var L=E._init;return I(C,m,v,L(E._payload),x)}if(gi(E)||Xr(E))return C=C.get(v)||null,p(m,C,E,x,null);Es(m,E)}return null}function S(C,m,v,E){for(var x=null,L=null,j=m,T=m=0,J=null;j!==null&&T<v.length;T++){j.index>T?(J=j,j=null):J=j.sibling;var P=f(C,j,v[T],E);if(P===null){j===null&&(j=J);break}t&&j&&P.alternate===null&&e(C,j),m=s(P,m,T),L===null?x=P:L.sibling=P,L=P,j=J}if(T===v.length)return n(C,j),pe&&Jn(C,T),x;if(j===null){for(;T<v.length;T++)j=g(C,v[T],E),j!==null&&(m=s(j,m,T),L===null?x=j:L.sibling=j,L=j);return pe&&Jn(C,T),x}for(j=r(C,j);T<v.length;T++)J=I(j,C,T,v[T],E),J!==null&&(t&&J.alternate!==null&&j.delete(J.key===null?T:J.key),m=s(J,m,T),L===null?x=J:L.sibling=J,L=J);return t&&j.forEach(function(D){return e(C,D)}),pe&&Jn(C,T),x}function k(C,m,v,E){var x=Xr(v);if(typeof x!="function")throw Error(M(150));if(v=x.call(v),v==null)throw Error(M(151));for(var L=x=null,j=m,T=m=0,J=null,P=v.next();j!==null&&!P.done;T++,P=v.next()){j.index>T?(J=j,j=null):J=j.sibling;var D=f(C,j,P.value,E);if(D===null){j===null&&(j=J);break}t&&j&&D.alternate===null&&e(C,j),m=s(D,m,T),L===null?x=D:L.sibling=D,L=D,j=J}if(P.done)return n(C,j),pe&&Jn(C,T),x;if(j===null){for(;!P.done;T++,P=v.next())P=g(C,P.value,E),P!==null&&(m=s(P,m,T),L===null?x=P:L.sibling=P,L=P);return pe&&Jn(C,T),x}for(j=r(C,j);!P.done;T++,P=v.next())P=I(j,C,T,P.value,E),P!==null&&(t&&P.alternate!==null&&j.delete(P.key===null?T:P.key),m=s(P,m,T),L===null?x=P:L.sibling=P,L=P);return t&&j.forEach(function(O){return e(C,O)}),pe&&Jn(C,T),x}function H(C,m,v,E){if(typeof v=="object"&&v!==null&&v.type===br&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case ps:e:{for(var x=v.key,L=m;L!==null;){if(L.key===x){if(x=v.type,x===br){if(L.tag===7){n(C,L.sibling),m=i(L,v.props.children),m.return=C,C=m;break e}}else if(L.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===bn&&Dd(x)===L.type){n(C,L.sibling),m=i(L,v.props),m.ref=ri(C,L,v),m.return=C,C=m;break e}n(C,L);break}else e(C,L);L=L.sibling}v.type===br?(m=er(v.props.children,C.mode,E,v.key),m.return=C,C=m):(E=Ys(v.type,v.key,v.props,null,C.mode,E),E.ref=ri(C,m,v),E.return=C,C=E)}return o(C);case wr:e:{for(L=v.key;m!==null;){if(m.key===L)if(m.tag===4&&m.stateNode.containerInfo===v.containerInfo&&m.stateNode.implementation===v.implementation){n(C,m.sibling),m=i(m,v.children||[]),m.return=C,C=m;break e}else{n(C,m);break}else e(C,m);m=m.sibling}m=Ga(v,C.mode,E),m.return=C,C=m}return o(C);case bn:return L=v._init,H(C,m,L(v._payload),E)}if(gi(v))return S(C,m,v,E);if(Xr(v))return k(C,m,v,E);Es(C,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,m!==null&&m.tag===6?(n(C,m.sibling),m=i(m,v),m.return=C,C=m):(n(C,m),m=Ha(v,C.mode,E),m.return=C,C=m),o(C)):n(C,m)}return H}var Wr=rp(!0),ip=rp(!1),bo=jn(null),Co=null,Rr=null,Wc=null;function Uc(){Wc=Rr=Co=null}function zc(t){var e=bo.current;he(bo),t._currentValue=e}function Ll(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Mr(t,e){Co=t,Wc=Rr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rt=!0),t.firstContext=null)}function St(t){var e=t._currentValue;if(Wc!==t)if(t={context:t,memoizedValue:e,next:null},Rr===null){if(Co===null)throw Error(M(308));Rr=t,Co.dependencies={lanes:0,firstContext:t}}else Rr=Rr.next=t;return e}var Yn=null;function Bc(t){Yn===null?Yn=[t]:Yn.push(t)}function sp(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Bc(e)):(n.next=i.next,i.next=n),e.interleaved=n,un(t,r)}function un(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Cn=!1;function Hc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function op(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function an(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Dn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,re&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,un(t,n)}return i=r.interleaved,i===null?(e.next=e,Bc(r)):(e.next=i.next,i.next=e),r.interleaved=e,un(t,n)}function Gs(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Pc(t,n)}}function xd(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function So(t,e,n,r){var i=t.updateQueue;Cn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var p=t.alternate;p!==null&&(p=p.updateQueue,a=p.lastBaseUpdate,a!==o&&(a===null?p.firstBaseUpdate=u:a.next=u,p.lastBaseUpdate=l))}if(s!==null){var g=i.baseState;o=0,p=u=l=null,a=s;do{var f=a.lane,I=a.eventTime;if((r&f)===f){p!==null&&(p=p.next={eventTime:I,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var S=t,k=a;switch(f=e,I=n,k.tag){case 1:if(S=k.payload,typeof S=="function"){g=S.call(I,g,f);break e}g=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=k.payload,f=typeof S=="function"?S.call(I,g,f):S,f==null)break e;g=ve({},g,f);break e;case 2:Cn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else I={eventTime:I,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},p===null?(u=p=I,l=g):p=p.next=I,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(p===null&&(l=g),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=p,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);ir|=o,t.lanes=o,t.memoizedState=g}}function Ad(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(M(191,i));i.call(r)}}}var os={},zt=jn(os),Ji=jn(os),Ki=jn(os);function Xn(t){if(t===os)throw Error(M(174));return t}function Gc(t,e){switch(ce(Ki,e),ce(Ji,t),ce(zt,os),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ml(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ml(e,t)}he(zt),ce(zt,e)}function Ur(){he(zt),he(Ji),he(Ki)}function ap(t){Xn(Ki.current);var e=Xn(zt.current),n=ml(e,t.type);e!==n&&(ce(Ji,t),ce(zt,n))}function qc(t){Ji.current===t&&(he(zt),he(Ji))}var me=jn(0);function Io(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var $a=[];function Vc(){for(var t=0;t<$a.length;t++)$a[t]._workInProgressVersionPrimary=null;$a.length=0}var qs=hn.ReactCurrentDispatcher,ja=hn.ReactCurrentBatchConfig,rr=0,ye=null,Re=null,Fe=null,_o=!1,Ni=!1,Qi=0,jw=0;function He(){throw Error(M(321))}function Jc(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Nt(t[n],e[n]))return!1;return!0}function Kc(t,e,n,r,i,s){if(rr=s,ye=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qs.current=t===null||t.memoizedState===null?Bw:Hw,t=n(r,i),Ni){s=0;do{if(Ni=!1,Qi=0,25<=s)throw Error(M(301));s+=1,Fe=Re=null,e.updateQueue=null,qs.current=Gw,t=n(r,i)}while(Ni)}if(qs.current=Eo,e=Re!==null&&Re.next!==null,rr=0,Fe=Re=ye=null,_o=!1,e)throw Error(M(300));return t}function Qc(){var t=Qi!==0;return Qi=0,t}function Ft(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fe===null?ye.memoizedState=Fe=t:Fe=Fe.next=t,Fe}function It(){if(Re===null){var t=ye.alternate;t=t!==null?t.memoizedState:null}else t=Re.next;var e=Fe===null?ye.memoizedState:Fe.next;if(e!==null)Fe=e,Re=t;else{if(t===null)throw Error(M(310));Re=t,t={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Fe===null?ye.memoizedState=Fe=t:Fe=Fe.next=t}return Fe}function Yi(t,e){return typeof e=="function"?e(t):e}function Wa(t){var e=It(),n=e.queue;if(n===null)throw Error(M(311));n.lastRenderedReducer=t;var r=Re,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,u=s;do{var p=u.lane;if((rr&p)===p)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var g={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=g,o=r):l=l.next=g,ye.lanes|=p,ir|=p}u=u.next}while(u!==null&&u!==s);l===null?o=r:l.next=a,Nt(r,e.memoizedState)||(rt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,ye.lanes|=s,ir|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ua(t){var e=It(),n=e.queue;if(n===null)throw Error(M(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Nt(s,e.memoizedState)||(rt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function lp(){}function cp(t,e){var n=ye,r=It(),i=e(),s=!Nt(r.memoizedState,i);if(s&&(r.memoizedState=i,rt=!0),r=r.queue,Yc(hp.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Fe!==null&&Fe.memoizedState.tag&1){if(n.flags|=2048,Xi(9,dp.bind(null,n,r,i,e),void 0,null),$e===null)throw Error(M(349));rr&30||up(n,e,i)}return i}function up(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ye.updateQueue,e===null?(e={lastEffect:null,stores:null},ye.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function dp(t,e,n,r){e.value=n,e.getSnapshot=r,fp(e)&&pp(t)}function hp(t,e,n){return n(function(){fp(e)&&pp(t)})}function fp(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Nt(t,n)}catch{return!0}}function pp(t){var e=un(t,1);e!==null&&At(e,t,1,-1)}function Nd(t){var e=Ft();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yi,lastRenderedState:t},e.queue=t,t=t.dispatch=zw.bind(null,ye,t),[e.memoizedState,t]}function Xi(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ye.updateQueue,e===null?(e={lastEffect:null,stores:null},ye.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function gp(){return It().memoizedState}function Vs(t,e,n,r){var i=Ft();ye.flags|=t,i.memoizedState=Xi(1|e,n,void 0,r===void 0?null:r)}function Ko(t,e,n,r){var i=It();r=r===void 0?null:r;var s=void 0;if(Re!==null){var o=Re.memoizedState;if(s=o.destroy,r!==null&&Jc(r,o.deps)){i.memoizedState=Xi(e,n,s,r);return}}ye.flags|=t,i.memoizedState=Xi(1|e,n,s,r)}function Od(t,e){return Vs(8390656,8,t,e)}function Yc(t,e){return Ko(2048,8,t,e)}function mp(t,e){return Ko(4,2,t,e)}function yp(t,e){return Ko(4,4,t,e)}function vp(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function wp(t,e,n){return n=n!=null?n.concat([t]):null,Ko(4,4,vp.bind(null,e,t),n)}function Xc(){}function bp(t,e){var n=It();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Jc(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Cp(t,e){var n=It();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Jc(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Sp(t,e,n){return rr&21?(Nt(n,e)||(n=Tf(),ye.lanes|=n,ir|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rt=!0),t.memoizedState=n)}function Ww(t,e){var n=se;se=n!==0&&4>n?n:4,t(!0);var r=ja.transition;ja.transition={};try{t(!1),e()}finally{se=n,ja.transition=r}}function Ip(){return It().memoizedState}function Uw(t,e,n){var r=An(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},_p(t))Ep(e,n);else if(n=sp(t,e,n,r),n!==null){var i=Ke();At(n,t,r,i),kp(n,e,r)}}function zw(t,e,n){var r=An(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(_p(t))Ep(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Nt(a,o)){var l=e.interleaved;l===null?(i.next=i,Bc(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=sp(t,e,i,r),n!==null&&(i=Ke(),At(n,t,r,i),kp(n,e,r))}}function _p(t){var e=t.alternate;return t===ye||e!==null&&e===ye}function Ep(t,e){Ni=_o=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function kp(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Pc(t,n)}}var Eo={readContext:St,useCallback:He,useContext:He,useEffect:He,useImperativeHandle:He,useInsertionEffect:He,useLayoutEffect:He,useMemo:He,useReducer:He,useRef:He,useState:He,useDebugValue:He,useDeferredValue:He,useTransition:He,useMutableSource:He,useSyncExternalStore:He,useId:He,unstable_isNewReconciler:!1},Bw={readContext:St,useCallback:function(t,e){return Ft().memoizedState=[t,e===void 0?null:e],t},useContext:St,useEffect:Od,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Vs(4194308,4,vp.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Vs(4194308,4,t,e)},useInsertionEffect:function(t,e){return Vs(4,2,t,e)},useMemo:function(t,e){var n=Ft();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Ft();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Uw.bind(null,ye,t),[r.memoizedState,t]},useRef:function(t){var e=Ft();return t={current:t},e.memoizedState=t},useState:Nd,useDebugValue:Xc,useDeferredValue:function(t){return Ft().memoizedState=t},useTransition:function(){var t=Nd(!1),e=t[0];return t=Ww.bind(null,t[1]),Ft().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ye,i=Ft();if(pe){if(n===void 0)throw Error(M(407));n=n()}else{if(n=e(),$e===null)throw Error(M(349));rr&30||up(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Od(hp.bind(null,r,s,t),[t]),r.flags|=2048,Xi(9,dp.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Ft(),e=$e.identifierPrefix;if(pe){var n=sn,r=rn;n=(r&~(1<<32-xt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Qi++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=jw++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Hw={readContext:St,useCallback:bp,useContext:St,useEffect:Yc,useImperativeHandle:wp,useInsertionEffect:mp,useLayoutEffect:yp,useMemo:Cp,useReducer:Wa,useRef:gp,useState:function(){return Wa(Yi)},useDebugValue:Xc,useDeferredValue:function(t){var e=It();return Sp(e,Re.memoizedState,t)},useTransition:function(){var t=Wa(Yi)[0],e=It().memoizedState;return[t,e]},useMutableSource:lp,useSyncExternalStore:cp,useId:Ip,unstable_isNewReconciler:!1},Gw={readContext:St,useCallback:bp,useContext:St,useEffect:Yc,useImperativeHandle:wp,useInsertionEffect:mp,useLayoutEffect:yp,useMemo:Cp,useReducer:Ua,useRef:gp,useState:function(){return Ua(Yi)},useDebugValue:Xc,useDeferredValue:function(t){var e=It();return Re===null?e.memoizedState=t:Sp(e,Re.memoizedState,t)},useTransition:function(){var t=Ua(Yi)[0],e=It().memoizedState;return[t,e]},useMutableSource:lp,useSyncExternalStore:cp,useId:Ip,unstable_isNewReconciler:!1};function kt(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Fl(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Qo={isMounted:function(t){return(t=t._reactInternals)?cr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ke(),i=An(t),s=an(r,i);s.payload=e,n!=null&&(s.callback=n),e=Dn(t,s,i),e!==null&&(At(e,t,i,r),Gs(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ke(),i=An(t),s=an(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Dn(t,s,i),e!==null&&(At(e,t,i,r),Gs(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ke(),r=An(t),i=an(n,r);i.tag=2,e!=null&&(i.callback=e),e=Dn(t,i,r),e!==null&&(At(e,t,r,n),Gs(e,t,r))}};function Md(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Hi(n,r)||!Hi(i,s):!0}function Tp(t,e,n){var r=!1,i=Fn,s=e.contextType;return typeof s=="object"&&s!==null?s=St(s):(i=st(e)?tr:Ve.current,r=e.contextTypes,s=(r=r!=null)?$r(t,i):Fn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Qo,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Ld(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Qo.enqueueReplaceState(e,e.state,null)}function $l(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Hc(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=St(s):(s=st(e)?tr:Ve.current,i.context=$r(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Fl(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Qo.enqueueReplaceState(i,i.state,null),So(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function zr(t,e){try{var n="",r=e;do n+=wv(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function za(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function jl(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var qw=typeof WeakMap=="function"?WeakMap:Map;function Rp(t,e,n){n=an(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){To||(To=!0,Kl=r),jl(t,e)},n}function Pp(t,e,n){n=an(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){jl(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){jl(t,e),typeof r!="function"&&(xn===null?xn=new Set([this]):xn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Fd(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new qw;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=ob.bind(null,t,e,n),e.then(t,t))}function $d(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function jd(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=an(-1,1),e.tag=2,Dn(n,e,1))),n.lanes|=1),t)}var Vw=hn.ReactCurrentOwner,rt=!1;function Je(t,e,n,r){e.child=t===null?ip(e,null,n,r):Wr(e,t.child,n,r)}function Wd(t,e,n,r,i){n=n.render;var s=e.ref;return Mr(e,i),r=Kc(t,e,n,r,s,i),n=Qc(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,dn(t,e,i)):(pe&&n&&Fc(e),e.flags|=1,Je(t,e,r,i),e.child)}function Ud(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!ou(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Dp(t,e,s,r,i)):(t=Ys(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Hi,n(o,r)&&t.ref===e.ref)return dn(t,e,i)}return e.flags|=1,t=Nn(s,r),t.ref=e.ref,t.return=e,e.child=t}function Dp(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Hi(s,r)&&t.ref===e.ref)if(rt=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(rt=!0);else return e.lanes=t.lanes,dn(t,e,i)}return Wl(t,e,n,r,i)}function xp(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ce(Dr,lt),lt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ce(Dr,lt),lt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ce(Dr,lt),lt|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ce(Dr,lt),lt|=r;return Je(t,e,i,n),e.child}function Ap(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Wl(t,e,n,r,i){var s=st(n)?tr:Ve.current;return s=$r(e,s),Mr(e,i),n=Kc(t,e,n,r,s,i),r=Qc(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,dn(t,e,i)):(pe&&r&&Fc(e),e.flags|=1,Je(t,e,n,i),e.child)}function zd(t,e,n,r,i){if(st(n)){var s=!0;yo(e)}else s=!1;if(Mr(e,i),e.stateNode===null)Js(t,e),Tp(e,n,r),$l(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=St(u):(u=st(n)?tr:Ve.current,u=$r(e,u));var p=n.getDerivedStateFromProps,g=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";g||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&Ld(e,o,r,u),Cn=!1;var f=e.memoizedState;o.state=f,So(e,r,o,i),l=e.memoizedState,a!==r||f!==l||it.current||Cn?(typeof p=="function"&&(Fl(e,n,p,r),l=e.memoizedState),(a=Cn||Md(e,n,a,r,f,l,u))?(g||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,op(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:kt(e.type,a),o.props=u,g=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=St(l):(l=st(n)?tr:Ve.current,l=$r(e,l));var I=n.getDerivedStateFromProps;(p=typeof I=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==g||f!==l)&&Ld(e,o,r,l),Cn=!1,f=e.memoizedState,o.state=f,So(e,r,o,i);var S=e.memoizedState;a!==g||f!==S||it.current||Cn?(typeof I=="function"&&(Fl(e,n,I,r),S=e.memoizedState),(u=Cn||Md(e,n,u,r,f,S,l)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,S,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,S,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),o.props=r,o.state=S,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Ul(t,e,n,r,s,i)}function Ul(t,e,n,r,i,s){Ap(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Td(e,n,!1),dn(t,e,s);r=e.stateNode,Vw.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Wr(e,t.child,null,s),e.child=Wr(e,null,a,s)):Je(t,e,a,s),e.memoizedState=r.state,i&&Td(e,n,!0),e.child}function Np(t){var e=t.stateNode;e.pendingContext?kd(t,e.pendingContext,e.pendingContext!==e.context):e.context&&kd(t,e.context,!1),Gc(t,e.containerInfo)}function Bd(t,e,n,r,i){return jr(),jc(i),e.flags|=256,Je(t,e,n,r),e.child}var zl={dehydrated:null,treeContext:null,retryLane:0};function Bl(t){return{baseLanes:t,cachePool:null,transitions:null}}function Op(t,e,n){var r=e.pendingProps,i=me.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ce(me,i&1),t===null)return Ml(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Zo(o,r,0,null),t=er(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Bl(n),e.memoizedState=zl,t):Zc(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Jw(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Nn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Nn(a,s):(s=er(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?Bl(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=zl,r}return s=t.child,t=s.sibling,r=Nn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Zc(t,e){return e=Zo({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ks(t,e,n,r){return r!==null&&jc(r),Wr(e,t.child,null,n),t=Zc(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Jw(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=za(Error(M(422))),ks(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Zo({mode:"visible",children:r.children},i,0,null),s=er(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Wr(e,t.child,null,o),e.child.memoizedState=Bl(o),e.memoizedState=zl,s);if(!(e.mode&1))return ks(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(M(419)),r=za(s,r,void 0),ks(t,e,o,r)}if(a=(o&t.childLanes)!==0,rt||a){if(r=$e,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,un(t,i),At(r,t,i,-1))}return su(),r=za(Error(M(421))),ks(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=ab.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,ct=Pn(i.nextSibling),dt=e,pe=!0,Pt=null,t!==null&&(yt[vt++]=rn,yt[vt++]=sn,yt[vt++]=nr,rn=t.id,sn=t.overflow,nr=e),e=Zc(e,r.children),e.flags|=4096,e)}function Hd(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Ll(t.return,e,n)}function Ba(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Mp(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Je(t,e,r.children,n),r=me.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Hd(t,n,e);else if(t.tag===19)Hd(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ce(me,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Io(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Ba(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Io(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Ba(e,!0,n,null,s);break;case"together":Ba(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Js(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function dn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ir|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(M(153));if(e.child!==null){for(t=e.child,n=Nn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Nn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Kw(t,e,n){switch(e.tag){case 3:Np(e),jr();break;case 5:ap(e);break;case 1:st(e.type)&&yo(e);break;case 4:Gc(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ce(bo,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ce(me,me.current&1),e.flags|=128,null):n&e.child.childLanes?Op(t,e,n):(ce(me,me.current&1),t=dn(t,e,n),t!==null?t.sibling:null);ce(me,me.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Mp(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ce(me,me.current),r)break;return null;case 22:case 23:return e.lanes=0,xp(t,e,n)}return dn(t,e,n)}var Lp,Hl,Fp,$p;Lp=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Hl=function(){};Fp=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Xn(zt.current);var s=null;switch(n){case"input":i=hl(t,i),r=hl(t,r),s=[];break;case"select":i=ve({},i,{value:void 0}),r=ve({},r,{value:void 0}),s=[];break;case"textarea":i=gl(t,i),r=gl(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=go)}yl(n,r);var o;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Fi.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Fi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&de("scroll",t),s||a===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};$p=function(t,e,n,r){n!==r&&(e.flags|=4)};function ii(t,e){if(!pe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ge(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Qw(t,e,n){var r=e.pendingProps;switch($c(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ge(e),null;case 1:return st(e.type)&&mo(),Ge(e),null;case 3:return r=e.stateNode,Ur(),he(it),he(Ve),Vc(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(_s(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pt!==null&&(Xl(Pt),Pt=null))),Hl(t,e),Ge(e),null;case 5:qc(e);var i=Xn(Ki.current);if(n=e.type,t!==null&&e.stateNode!=null)Fp(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(M(166));return Ge(e),null}if(t=Xn(zt.current),_s(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[jt]=e,r[Vi]=s,t=(e.mode&1)!==0,n){case"dialog":de("cancel",r),de("close",r);break;case"iframe":case"object":case"embed":de("load",r);break;case"video":case"audio":for(i=0;i<yi.length;i++)de(yi[i],r);break;case"source":de("error",r);break;case"img":case"image":case"link":de("error",r),de("load",r);break;case"details":de("toggle",r);break;case"input":Zu(r,s),de("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},de("invalid",r);break;case"textarea":td(r,s),de("invalid",r)}yl(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Is(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Is(r.textContent,a,t),i=["children",""+a]):Fi.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&de("scroll",r)}switch(n){case"input":gs(r),ed(r,s,!0);break;case"textarea":gs(r),nd(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=go)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=hf(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[jt]=e,t[Vi]=r,Lp(t,e,!1,!1),e.stateNode=t;e:{switch(o=vl(n,r),n){case"dialog":de("cancel",t),de("close",t),i=r;break;case"iframe":case"object":case"embed":de("load",t),i=r;break;case"video":case"audio":for(i=0;i<yi.length;i++)de(yi[i],t);i=r;break;case"source":de("error",t),i=r;break;case"img":case"image":case"link":de("error",t),de("load",t),i=r;break;case"details":de("toggle",t),i=r;break;case"input":Zu(t,r),i=hl(t,r),de("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ve({},r,{value:void 0}),de("invalid",t);break;case"textarea":td(t,r),i=gl(t,r),de("invalid",t);break;default:i=r}yl(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?gf(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&ff(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&$i(t,l):typeof l=="number"&&$i(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Fi.hasOwnProperty(s)?l!=null&&s==="onScroll"&&de("scroll",t):l!=null&&Ic(t,s,l,o))}switch(n){case"input":gs(t),ed(t,r,!1);break;case"textarea":gs(t),nd(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ln(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?xr(t,!!r.multiple,s,!1):r.defaultValue!=null&&xr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=go)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ge(e),null;case 6:if(t&&e.stateNode!=null)$p(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(M(166));if(n=Xn(Ki.current),Xn(zt.current),_s(e)){if(r=e.stateNode,n=e.memoizedProps,r[jt]=e,(s=r.nodeValue!==n)&&(t=dt,t!==null))switch(t.tag){case 3:Is(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Is(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[jt]=e,e.stateNode=r}return Ge(e),null;case 13:if(he(me),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(pe&&ct!==null&&e.mode&1&&!(e.flags&128))np(),jr(),e.flags|=98560,s=!1;else if(s=_s(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(M(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(M(317));s[jt]=e}else jr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ge(e),s=!1}else Pt!==null&&(Xl(Pt),Pt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||me.current&1?Pe===0&&(Pe=3):su())),e.updateQueue!==null&&(e.flags|=4),Ge(e),null);case 4:return Ur(),Hl(t,e),t===null&&Gi(e.stateNode.containerInfo),Ge(e),null;case 10:return zc(e.type._context),Ge(e),null;case 17:return st(e.type)&&mo(),Ge(e),null;case 19:if(he(me),s=e.memoizedState,s===null)return Ge(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)ii(s,!1);else{if(Pe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Io(t),o!==null){for(e.flags|=128,ii(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ce(me,me.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ce()>Br&&(e.flags|=128,r=!0,ii(s,!1),e.lanes=4194304)}else{if(!r)if(t=Io(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ii(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!pe)return Ge(e),null}else 2*Ce()-s.renderingStartTime>Br&&n!==1073741824&&(e.flags|=128,r=!0,ii(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ce(),e.sibling=null,n=me.current,ce(me,r?n&1|2:n&1),e):(Ge(e),null);case 22:case 23:return iu(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?lt&1073741824&&(Ge(e),e.subtreeFlags&6&&(e.flags|=8192)):Ge(e),null;case 24:return null;case 25:return null}throw Error(M(156,e.tag))}function Yw(t,e){switch($c(e),e.tag){case 1:return st(e.type)&&mo(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ur(),he(it),he(Ve),Vc(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return qc(e),null;case 13:if(he(me),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(M(340));jr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return he(me),null;case 4:return Ur(),null;case 10:return zc(e.type._context),null;case 22:case 23:return iu(),null;case 24:return null;default:return null}}var Ts=!1,qe=!1,Xw=typeof WeakSet=="function"?WeakSet:Set,z=null;function Pr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){we(t,e,r)}else n.current=null}function Gl(t,e,n){try{n()}catch(r){we(t,e,r)}}var Gd=!1;function Zw(t,e){if(Rl=ho,t=Bf(),Lc(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,p=0,g=t,f=null;t:for(;;){for(var I;g!==n||i!==0&&g.nodeType!==3||(a=o+i),g!==s||r!==0&&g.nodeType!==3||(l=o+r),g.nodeType===3&&(o+=g.nodeValue.length),(I=g.firstChild)!==null;)f=g,g=I;for(;;){if(g===t)break t;if(f===n&&++u===i&&(a=o),f===s&&++p===r&&(l=o),(I=g.nextSibling)!==null)break;g=f,f=g.parentNode}g=I}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Pl={focusedElem:t,selectionRange:n},ho=!1,z=e;z!==null;)if(e=z,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,z=t;else for(;z!==null;){e=z;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var k=S.memoizedProps,H=S.memoizedState,C=e.stateNode,m=C.getSnapshotBeforeUpdate(e.elementType===e.type?k:kt(e.type,k),H);C.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(M(163))}}catch(E){we(e,e.return,E)}if(t=e.sibling,t!==null){t.return=e.return,z=t;break}z=e.return}return S=Gd,Gd=!1,S}function Oi(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Gl(e,n,s)}i=i.next}while(i!==r)}}function Yo(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ql(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function jp(t){var e=t.alternate;e!==null&&(t.alternate=null,jp(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[jt],delete e[Vi],delete e[Al],delete e[Mw],delete e[Lw])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Wp(t){return t.tag===5||t.tag===3||t.tag===4}function qd(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Wp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Vl(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=go));else if(r!==4&&(t=t.child,t!==null))for(Vl(t,e,n),t=t.sibling;t!==null;)Vl(t,e,n),t=t.sibling}function Jl(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Jl(t,e,n),t=t.sibling;t!==null;)Jl(t,e,n),t=t.sibling}var We=null,Rt=!1;function mn(t,e,n){for(n=n.child;n!==null;)Up(t,e,n),n=n.sibling}function Up(t,e,n){if(Ut&&typeof Ut.onCommitFiberUnmount=="function")try{Ut.onCommitFiberUnmount(Bo,n)}catch{}switch(n.tag){case 5:qe||Pr(n,e);case 6:var r=We,i=Rt;We=null,mn(t,e,n),We=r,Rt=i,We!==null&&(Rt?(t=We,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):We.removeChild(n.stateNode));break;case 18:We!==null&&(Rt?(t=We,n=n.stateNode,t.nodeType===8?La(t.parentNode,n):t.nodeType===1&&La(t,n),zi(t)):La(We,n.stateNode));break;case 4:r=We,i=Rt,We=n.stateNode.containerInfo,Rt=!0,mn(t,e,n),We=r,Rt=i;break;case 0:case 11:case 14:case 15:if(!qe&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Gl(n,e,o),i=i.next}while(i!==r)}mn(t,e,n);break;case 1:if(!qe&&(Pr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){we(n,e,a)}mn(t,e,n);break;case 21:mn(t,e,n);break;case 22:n.mode&1?(qe=(r=qe)||n.memoizedState!==null,mn(t,e,n),qe=r):mn(t,e,n);break;default:mn(t,e,n)}}function Vd(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Xw),e.forEach(function(r){var i=lb.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function _t(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:We=a.stateNode,Rt=!1;break e;case 3:We=a.stateNode.containerInfo,Rt=!0;break e;case 4:We=a.stateNode.containerInfo,Rt=!0;break e}a=a.return}if(We===null)throw Error(M(160));Up(s,o,i),We=null,Rt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){we(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)zp(e,t),e=e.sibling}function zp(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(_t(e,t),Lt(t),r&4){try{Oi(3,t,t.return),Yo(3,t)}catch(k){we(t,t.return,k)}try{Oi(5,t,t.return)}catch(k){we(t,t.return,k)}}break;case 1:_t(e,t),Lt(t),r&512&&n!==null&&Pr(n,n.return);break;case 5:if(_t(e,t),Lt(t),r&512&&n!==null&&Pr(n,n.return),t.flags&32){var i=t.stateNode;try{$i(i,"")}catch(k){we(t,t.return,k)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&uf(i,s),vl(a,o);var u=vl(a,s);for(o=0;o<l.length;o+=2){var p=l[o],g=l[o+1];p==="style"?gf(i,g):p==="dangerouslySetInnerHTML"?ff(i,g):p==="children"?$i(i,g):Ic(i,p,g,u)}switch(a){case"input":fl(i,s);break;case"textarea":df(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var I=s.value;I!=null?xr(i,!!s.multiple,I,!1):f!==!!s.multiple&&(s.defaultValue!=null?xr(i,!!s.multiple,s.defaultValue,!0):xr(i,!!s.multiple,s.multiple?[]:"",!1))}i[Vi]=s}catch(k){we(t,t.return,k)}}break;case 6:if(_t(e,t),Lt(t),r&4){if(t.stateNode===null)throw Error(M(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(k){we(t,t.return,k)}}break;case 3:if(_t(e,t),Lt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{zi(e.containerInfo)}catch(k){we(t,t.return,k)}break;case 4:_t(e,t),Lt(t);break;case 13:_t(e,t),Lt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(nu=Ce())),r&4&&Vd(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(qe=(u=qe)||p,_t(e,t),qe=u):_t(e,t),Lt(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!p&&t.mode&1)for(z=t,p=t.child;p!==null;){for(g=z=p;z!==null;){switch(f=z,I=f.child,f.tag){case 0:case 11:case 14:case 15:Oi(4,f,f.return);break;case 1:Pr(f,f.return);var S=f.stateNode;if(typeof S.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(k){we(r,n,k)}}break;case 5:Pr(f,f.return);break;case 22:if(f.memoizedState!==null){Kd(g);continue}}I!==null?(I.return=f,z=I):Kd(g)}p=p.sibling}e:for(p=null,g=t;;){if(g.tag===5){if(p===null){p=g;try{i=g.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=g.stateNode,l=g.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=pf("display",o))}catch(k){we(t,t.return,k)}}}else if(g.tag===6){if(p===null)try{g.stateNode.nodeValue=u?"":g.memoizedProps}catch(k){we(t,t.return,k)}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===t)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===t)break e;for(;g.sibling===null;){if(g.return===null||g.return===t)break e;p===g&&(p=null),g=g.return}p===g&&(p=null),g.sibling.return=g.return,g=g.sibling}}break;case 19:_t(e,t),Lt(t),r&4&&Vd(t);break;case 21:break;default:_t(e,t),Lt(t)}}function Lt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Wp(n)){var r=n;break e}n=n.return}throw Error(M(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&($i(i,""),r.flags&=-33);var s=qd(t);Jl(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=qd(t);Vl(t,a,o);break;default:throw Error(M(161))}}catch(l){we(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function eb(t,e,n){z=t,Bp(t)}function Bp(t,e,n){for(var r=(t.mode&1)!==0;z!==null;){var i=z,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Ts;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||qe;a=Ts;var u=qe;if(Ts=o,(qe=l)&&!u)for(z=i;z!==null;)o=z,l=o.child,o.tag===22&&o.memoizedState!==null?Qd(i):l!==null?(l.return=o,z=l):Qd(i);for(;s!==null;)z=s,Bp(s),s=s.sibling;z=i,Ts=a,qe=u}Jd(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,z=s):Jd(t)}}function Jd(t){for(;z!==null;){var e=z;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qe||Yo(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!qe)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:kt(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Ad(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ad(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var g=p.dehydrated;g!==null&&zi(g)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(M(163))}qe||e.flags&512&&ql(e)}catch(f){we(e,e.return,f)}}if(e===t){z=null;break}if(n=e.sibling,n!==null){n.return=e.return,z=n;break}z=e.return}}function Kd(t){for(;z!==null;){var e=z;if(e===t){z=null;break}var n=e.sibling;if(n!==null){n.return=e.return,z=n;break}z=e.return}}function Qd(t){for(;z!==null;){var e=z;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Yo(4,e)}catch(l){we(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){we(e,i,l)}}var s=e.return;try{ql(e)}catch(l){we(e,s,l)}break;case 5:var o=e.return;try{ql(e)}catch(l){we(e,o,l)}}}catch(l){we(e,e.return,l)}if(e===t){z=null;break}var a=e.sibling;if(a!==null){a.return=e.return,z=a;break}z=e.return}}var tb=Math.ceil,ko=hn.ReactCurrentDispatcher,eu=hn.ReactCurrentOwner,Ct=hn.ReactCurrentBatchConfig,re=0,$e=null,Ie=null,Ue=0,lt=0,Dr=jn(0),Pe=0,Zi=null,ir=0,Xo=0,tu=0,Mi=null,nt=null,nu=0,Br=1/0,Yt=null,To=!1,Kl=null,xn=null,Rs=!1,En=null,Ro=0,Li=0,Ql=null,Ks=-1,Qs=0;function Ke(){return re&6?Ce():Ks!==-1?Ks:Ks=Ce()}function An(t){return t.mode&1?re&2&&Ue!==0?Ue&-Ue:$w.transition!==null?(Qs===0&&(Qs=Tf()),Qs):(t=se,t!==0||(t=window.event,t=t===void 0?16:Of(t.type)),t):1}function At(t,e,n,r){if(50<Li)throw Li=0,Ql=null,Error(M(185));rs(t,n,r),(!(re&2)||t!==$e)&&(t===$e&&(!(re&2)&&(Xo|=n),Pe===4&&In(t,Ue)),ot(t,r),n===1&&re===0&&!(e.mode&1)&&(Br=Ce()+500,Jo&&Wn()))}function ot(t,e){var n=t.callbackNode;$v(t,e);var r=uo(t,t===$e?Ue:0);if(r===0)n!==null&&sd(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&sd(n),e===1)t.tag===0?Fw(Yd.bind(null,t)):Zf(Yd.bind(null,t)),Nw(function(){!(re&6)&&Wn()}),n=null;else{switch(Rf(r)){case 1:n=Rc;break;case 4:n=Ef;break;case 16:n=co;break;case 536870912:n=kf;break;default:n=co}n=Yp(n,Hp.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Hp(t,e){if(Ks=-1,Qs=0,re&6)throw Error(M(327));var n=t.callbackNode;if(Lr()&&t.callbackNode!==n)return null;var r=uo(t,t===$e?Ue:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Po(t,r);else{e=r;var i=re;re|=2;var s=qp();($e!==t||Ue!==e)&&(Yt=null,Br=Ce()+500,Zn(t,e));do try{ib();break}catch(a){Gp(t,a)}while(!0);Uc(),ko.current=s,re=i,Ie!==null?e=0:($e=null,Ue=0,e=Pe)}if(e!==0){if(e===2&&(i=Il(t),i!==0&&(r=i,e=Yl(t,i))),e===1)throw n=Zi,Zn(t,0),In(t,r),ot(t,Ce()),n;if(e===6)In(t,r);else{if(i=t.current.alternate,!(r&30)&&!nb(i)&&(e=Po(t,r),e===2&&(s=Il(t),s!==0&&(r=s,e=Yl(t,s))),e===1))throw n=Zi,Zn(t,0),In(t,r),ot(t,Ce()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(M(345));case 2:Kn(t,nt,Yt);break;case 3:if(In(t,r),(r&130023424)===r&&(e=nu+500-Ce(),10<e)){if(uo(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Ke(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=xl(Kn.bind(null,t,nt,Yt),e);break}Kn(t,nt,Yt);break;case 4:if(In(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-xt(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Ce()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*tb(r/1960))-r,10<r){t.timeoutHandle=xl(Kn.bind(null,t,nt,Yt),r);break}Kn(t,nt,Yt);break;case 5:Kn(t,nt,Yt);break;default:throw Error(M(329))}}}return ot(t,Ce()),t.callbackNode===n?Hp.bind(null,t):null}function Yl(t,e){var n=Mi;return t.current.memoizedState.isDehydrated&&(Zn(t,e).flags|=256),t=Po(t,e),t!==2&&(e=nt,nt=n,e!==null&&Xl(e)),t}function Xl(t){nt===null?nt=t:nt.push.apply(nt,t)}function nb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Nt(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function In(t,e){for(e&=~tu,e&=~Xo,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-xt(e),r=1<<n;t[n]=-1,e&=~r}}function Yd(t){if(re&6)throw Error(M(327));Lr();var e=uo(t,0);if(!(e&1))return ot(t,Ce()),null;var n=Po(t,e);if(t.tag!==0&&n===2){var r=Il(t);r!==0&&(e=r,n=Yl(t,r))}if(n===1)throw n=Zi,Zn(t,0),In(t,e),ot(t,Ce()),n;if(n===6)throw Error(M(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Kn(t,nt,Yt),ot(t,Ce()),null}function ru(t,e){var n=re;re|=1;try{return t(e)}finally{re=n,re===0&&(Br=Ce()+500,Jo&&Wn())}}function sr(t){En!==null&&En.tag===0&&!(re&6)&&Lr();var e=re;re|=1;var n=Ct.transition,r=se;try{if(Ct.transition=null,se=1,t)return t()}finally{se=r,Ct.transition=n,re=e,!(re&6)&&Wn()}}function iu(){lt=Dr.current,he(Dr)}function Zn(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Aw(n)),Ie!==null)for(n=Ie.return;n!==null;){var r=n;switch($c(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&mo();break;case 3:Ur(),he(it),he(Ve),Vc();break;case 5:qc(r);break;case 4:Ur();break;case 13:he(me);break;case 19:he(me);break;case 10:zc(r.type._context);break;case 22:case 23:iu()}n=n.return}if($e=t,Ie=t=Nn(t.current,null),Ue=lt=e,Pe=0,Zi=null,tu=Xo=ir=0,nt=Mi=null,Yn!==null){for(e=0;e<Yn.length;e++)if(n=Yn[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}Yn=null}return t}function Gp(t,e){do{var n=Ie;try{if(Uc(),qs.current=Eo,_o){for(var r=ye.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}_o=!1}if(rr=0,Fe=Re=ye=null,Ni=!1,Qi=0,eu.current=null,n===null||n.return===null){Pe=1,Zi=e,Ie=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Ue,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,p=a,g=p.tag;if(!(p.mode&1)&&(g===0||g===11||g===15)){var f=p.alternate;f?(p.updateQueue=f.updateQueue,p.memoizedState=f.memoizedState,p.lanes=f.lanes):(p.updateQueue=null,p.memoizedState=null)}var I=$d(o);if(I!==null){I.flags&=-257,jd(I,o,a,s,e),I.mode&1&&Fd(s,u,e),e=I,l=u;var S=e.updateQueue;if(S===null){var k=new Set;k.add(l),e.updateQueue=k}else S.add(l);break e}else{if(!(e&1)){Fd(s,u,e),su();break e}l=Error(M(426))}}else if(pe&&a.mode&1){var H=$d(o);if(H!==null){!(H.flags&65536)&&(H.flags|=256),jd(H,o,a,s,e),jc(zr(l,a));break e}}s=l=zr(l,a),Pe!==4&&(Pe=2),Mi===null?Mi=[s]:Mi.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var C=Rp(s,l,e);xd(s,C);break e;case 1:a=l;var m=s.type,v=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(xn===null||!xn.has(v)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=Pp(s,a,e);xd(s,E);break e}}s=s.return}while(s!==null)}Jp(n)}catch(x){e=x,Ie===n&&n!==null&&(Ie=n=n.return);continue}break}while(!0)}function qp(){var t=ko.current;return ko.current=Eo,t===null?Eo:t}function su(){(Pe===0||Pe===3||Pe===2)&&(Pe=4),$e===null||!(ir&268435455)&&!(Xo&268435455)||In($e,Ue)}function Po(t,e){var n=re;re|=2;var r=qp();($e!==t||Ue!==e)&&(Yt=null,Zn(t,e));do try{rb();break}catch(i){Gp(t,i)}while(!0);if(Uc(),re=n,ko.current=r,Ie!==null)throw Error(M(261));return $e=null,Ue=0,Pe}function rb(){for(;Ie!==null;)Vp(Ie)}function ib(){for(;Ie!==null&&!Pv();)Vp(Ie)}function Vp(t){var e=Qp(t.alternate,t,lt);t.memoizedProps=t.pendingProps,e===null?Jp(t):Ie=e,eu.current=null}function Jp(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Yw(n,e),n!==null){n.flags&=32767,Ie=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pe=6,Ie=null;return}}else if(n=Qw(n,e,lt),n!==null){Ie=n;return}if(e=e.sibling,e!==null){Ie=e;return}Ie=e=t}while(e!==null);Pe===0&&(Pe=5)}function Kn(t,e,n){var r=se,i=Ct.transition;try{Ct.transition=null,se=1,sb(t,e,n,r)}finally{Ct.transition=i,se=r}return null}function sb(t,e,n,r){do Lr();while(En!==null);if(re&6)throw Error(M(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(M(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(jv(t,s),t===$e&&(Ie=$e=null,Ue=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Rs||(Rs=!0,Yp(co,function(){return Lr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Ct.transition,Ct.transition=null;var o=se;se=1;var a=re;re|=4,eu.current=null,Zw(t,n),zp(n,t),Ew(Pl),ho=!!Rl,Pl=Rl=null,t.current=n,eb(n),Dv(),re=a,se=o,Ct.transition=s}else t.current=n;if(Rs&&(Rs=!1,En=t,Ro=i),s=t.pendingLanes,s===0&&(xn=null),Nv(n.stateNode),ot(t,Ce()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(To)throw To=!1,t=Kl,Kl=null,t;return Ro&1&&t.tag!==0&&Lr(),s=t.pendingLanes,s&1?t===Ql?Li++:(Li=0,Ql=t):Li=0,Wn(),null}function Lr(){if(En!==null){var t=Rf(Ro),e=Ct.transition,n=se;try{if(Ct.transition=null,se=16>t?16:t,En===null)var r=!1;else{if(t=En,En=null,Ro=0,re&6)throw Error(M(331));var i=re;for(re|=4,z=t.current;z!==null;){var s=z,o=s.child;if(z.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(z=u;z!==null;){var p=z;switch(p.tag){case 0:case 11:case 15:Oi(8,p,s)}var g=p.child;if(g!==null)g.return=p,z=g;else for(;z!==null;){p=z;var f=p.sibling,I=p.return;if(jp(p),p===u){z=null;break}if(f!==null){f.return=I,z=f;break}z=I}}}var S=s.alternate;if(S!==null){var k=S.child;if(k!==null){S.child=null;do{var H=k.sibling;k.sibling=null,k=H}while(k!==null)}}z=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,z=o;else e:for(;z!==null;){if(s=z,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Oi(9,s,s.return)}var C=s.sibling;if(C!==null){C.return=s.return,z=C;break e}z=s.return}}var m=t.current;for(z=m;z!==null;){o=z;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,z=v;else e:for(o=m;z!==null;){if(a=z,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Yo(9,a)}}catch(x){we(a,a.return,x)}if(a===o){z=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,z=E;break e}z=a.return}}if(re=i,Wn(),Ut&&typeof Ut.onPostCommitFiberRoot=="function")try{Ut.onPostCommitFiberRoot(Bo,t)}catch{}r=!0}return r}finally{se=n,Ct.transition=e}}return!1}function Xd(t,e,n){e=zr(n,e),e=Rp(t,e,1),t=Dn(t,e,1),e=Ke(),t!==null&&(rs(t,1,e),ot(t,e))}function we(t,e,n){if(t.tag===3)Xd(t,t,n);else for(;e!==null;){if(e.tag===3){Xd(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xn===null||!xn.has(r))){t=zr(n,t),t=Pp(e,t,1),e=Dn(e,t,1),t=Ke(),e!==null&&(rs(e,1,t),ot(e,t));break}}e=e.return}}function ob(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ke(),t.pingedLanes|=t.suspendedLanes&n,$e===t&&(Ue&n)===n&&(Pe===4||Pe===3&&(Ue&130023424)===Ue&&500>Ce()-nu?Zn(t,0):tu|=n),ot(t,e)}function Kp(t,e){e===0&&(t.mode&1?(e=vs,vs<<=1,!(vs&130023424)&&(vs=4194304)):e=1);var n=Ke();t=un(t,e),t!==null&&(rs(t,e,n),ot(t,n))}function ab(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Kp(t,n)}function lb(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(M(314))}r!==null&&r.delete(e),Kp(t,n)}var Qp;Qp=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||it.current)rt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return rt=!1,Kw(t,e,n);rt=!!(t.flags&131072)}else rt=!1,pe&&e.flags&1048576&&ep(e,wo,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Js(t,e),t=e.pendingProps;var i=$r(e,Ve.current);Mr(e,n),i=Kc(null,e,r,t,i,n);var s=Qc();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,st(r)?(s=!0,yo(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Hc(e),i.updater=Qo,e.stateNode=i,i._reactInternals=e,$l(e,r,t,n),e=Ul(null,e,r,!0,s,n)):(e.tag=0,pe&&s&&Fc(e),Je(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Js(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=ub(r),t=kt(r,t),i){case 0:e=Wl(null,e,r,t,n);break e;case 1:e=zd(null,e,r,t,n);break e;case 11:e=Wd(null,e,r,t,n);break e;case 14:e=Ud(null,e,r,kt(r.type,t),n);break e}throw Error(M(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),Wl(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),zd(t,e,r,i,n);case 3:e:{if(Np(e),t===null)throw Error(M(387));r=e.pendingProps,s=e.memoizedState,i=s.element,op(t,e),So(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=zr(Error(M(423)),e),e=Bd(t,e,r,n,i);break e}else if(r!==i){i=zr(Error(M(424)),e),e=Bd(t,e,r,n,i);break e}else for(ct=Pn(e.stateNode.containerInfo.firstChild),dt=e,pe=!0,Pt=null,n=ip(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(jr(),r===i){e=dn(t,e,n);break e}Je(t,e,r,n)}e=e.child}return e;case 5:return ap(e),t===null&&Ml(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Dl(r,i)?o=null:s!==null&&Dl(r,s)&&(e.flags|=32),Ap(t,e),Je(t,e,o,n),e.child;case 6:return t===null&&Ml(e),null;case 13:return Op(t,e,n);case 4:return Gc(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Wr(e,null,r,n):Je(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),Wd(t,e,r,i,n);case 7:return Je(t,e,e.pendingProps,n),e.child;case 8:return Je(t,e,e.pendingProps.children,n),e.child;case 12:return Je(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ce(bo,r._currentValue),r._currentValue=o,s!==null)if(Nt(s.value,o)){if(s.children===i.children&&!it.current){e=dn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=an(-1,n&-n),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?l.next=l:(l.next=p.next,p.next=l),u.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Ll(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(M(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Ll(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Je(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Mr(e,n),i=St(i),r=r(i),e.flags|=1,Je(t,e,r,n),e.child;case 14:return r=e.type,i=kt(r,e.pendingProps),i=kt(r.type,i),Ud(t,e,r,i,n);case 15:return Dp(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),Js(t,e),e.tag=1,st(r)?(t=!0,yo(e)):t=!1,Mr(e,n),Tp(e,r,i),$l(e,r,i,n),Ul(null,e,r,!0,t,n);case 19:return Mp(t,e,n);case 22:return xp(t,e,n)}throw Error(M(156,e.tag))};function Yp(t,e){return _f(t,e)}function cb(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wt(t,e,n,r){return new cb(t,e,n,r)}function ou(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ub(t){if(typeof t=="function")return ou(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ec)return 11;if(t===kc)return 14}return 2}function Nn(t,e){var n=t.alternate;return n===null?(n=wt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ys(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")ou(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case br:return er(n.children,i,s,e);case _c:o=8,i|=8;break;case ll:return t=wt(12,n,e,i|2),t.elementType=ll,t.lanes=s,t;case cl:return t=wt(13,n,e,i),t.elementType=cl,t.lanes=s,t;case ul:return t=wt(19,n,e,i),t.elementType=ul,t.lanes=s,t;case af:return Zo(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case sf:o=10;break e;case of:o=9;break e;case Ec:o=11;break e;case kc:o=14;break e;case bn:o=16,r=null;break e}throw Error(M(130,t==null?t:typeof t,""))}return e=wt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function er(t,e,n,r){return t=wt(7,t,r,e),t.lanes=n,t}function Zo(t,e,n,r){return t=wt(22,t,r,e),t.elementType=af,t.lanes=n,t.stateNode={isHidden:!1},t}function Ha(t,e,n){return t=wt(6,t,null,e),t.lanes=n,t}function Ga(t,e,n){return e=wt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function db(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ea(0),this.expirationTimes=Ea(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ea(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function au(t,e,n,r,i,s,o,a,l){return t=new db(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=wt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hc(s),t}function hb(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Xp(t){if(!t)return Fn;t=t._reactInternals;e:{if(cr(t)!==t||t.tag!==1)throw Error(M(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(st(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(M(171))}if(t.tag===1){var n=t.type;if(st(n))return Xf(t,n,e)}return e}function Zp(t,e,n,r,i,s,o,a,l){return t=au(n,r,!0,t,i,s,o,a,l),t.context=Xp(null),n=t.current,r=Ke(),i=An(n),s=an(r,i),s.callback=e??null,Dn(n,s,i),t.current.lanes=i,rs(t,i,r),ot(t,r),t}function ea(t,e,n,r){var i=e.current,s=Ke(),o=An(i);return n=Xp(n),e.context===null?e.context=n:e.pendingContext=n,e=an(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Dn(i,e,o),t!==null&&(At(t,i,o,s),Gs(t,i,o)),o}function Do(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Zd(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function lu(t,e){Zd(t,e),(t=t.alternate)&&Zd(t,e)}function fb(){return null}var eg=typeof reportError=="function"?reportError:function(t){console.error(t)};function cu(t){this._internalRoot=t}ta.prototype.render=cu.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(M(409));ea(t,e,null,null)};ta.prototype.unmount=cu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;sr(function(){ea(null,t,null,null)}),e[cn]=null}};function ta(t){this._internalRoot=t}ta.prototype.unstable_scheduleHydration=function(t){if(t){var e=xf();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Sn.length&&e!==0&&e<Sn[n].priority;n++);Sn.splice(n,0,t),n===0&&Nf(t)}};function uu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function na(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function eh(){}function pb(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=Do(o);s.call(u)}}var o=Zp(e,r,t,0,null,!1,!1,"",eh);return t._reactRootContainer=o,t[cn]=o.current,Gi(t.nodeType===8?t.parentNode:t),sr(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var u=Do(l);a.call(u)}}var l=au(t,0,!1,null,null,!1,!1,"",eh);return t._reactRootContainer=l,t[cn]=l.current,Gi(t.nodeType===8?t.parentNode:t),sr(function(){ea(e,l,n,r)}),l}function ra(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=Do(o);a.call(l)}}ea(e,o,t,i)}else o=pb(n,e,t,i,r);return Do(o)}Pf=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=mi(e.pendingLanes);n!==0&&(Pc(e,n|1),ot(e,Ce()),!(re&6)&&(Br=Ce()+500,Wn()))}break;case 13:sr(function(){var r=un(t,1);if(r!==null){var i=Ke();At(r,t,1,i)}}),lu(t,1)}};Dc=function(t){if(t.tag===13){var e=un(t,134217728);if(e!==null){var n=Ke();At(e,t,134217728,n)}lu(t,134217728)}};Df=function(t){if(t.tag===13){var e=An(t),n=un(t,e);if(n!==null){var r=Ke();At(n,t,e,r)}lu(t,e)}};xf=function(){return se};Af=function(t,e){var n=se;try{return se=t,e()}finally{se=n}};bl=function(t,e,n){switch(e){case"input":if(fl(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Vo(r);if(!i)throw Error(M(90));cf(r),fl(r,i)}}}break;case"textarea":df(t,n);break;case"select":e=n.value,e!=null&&xr(t,!!n.multiple,e,!1)}};vf=ru;wf=sr;var gb={usingClientEntryPoint:!1,Events:[ss,_r,Vo,mf,yf,ru]},si={findFiberByHostInstance:Qn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mb={bundleType:si.bundleType,version:si.version,rendererPackageName:si.rendererPackageName,rendererConfig:si.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Sf(t),t===null?null:t.stateNode},findFiberByHostInstance:si.findFiberByHostInstance||fb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ps=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ps.isDisabled&&Ps.supportsFiber)try{Bo=Ps.inject(mb),Ut=Ps}catch{}}ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gb;ft.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!uu(e))throw Error(M(200));return hb(t,e,null,n)};ft.createRoot=function(t,e){if(!uu(t))throw Error(M(299));var n=!1,r="",i=eg;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=au(t,1,!1,null,null,n,!1,r,i),t[cn]=e.current,Gi(t.nodeType===8?t.parentNode:t),new cu(e)};ft.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(M(188)):(t=Object.keys(t).join(","),Error(M(268,t)));return t=Sf(e),t=t===null?null:t.stateNode,t};ft.flushSync=function(t){return sr(t)};ft.hydrate=function(t,e,n){if(!na(e))throw Error(M(200));return ra(null,t,e,!0,n)};ft.hydrateRoot=function(t,e,n){if(!uu(t))throw Error(M(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=eg;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Zp(e,null,t,1,n??null,i,!1,s,o),t[cn]=e.current,Gi(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new ta(e)};ft.render=function(t,e,n){if(!na(e))throw Error(M(200));return ra(null,t,e,!1,n)};ft.unmountComponentAtNode=function(t){if(!na(t))throw Error(M(40));return t._reactRootContainer?(sr(function(){ra(null,null,t,!1,function(){t._reactRootContainer=null,t[cn]=null})}),!0):!1};ft.unstable_batchedUpdates=ru;ft.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!na(n))throw Error(M(200));if(t==null||t._reactInternals===void 0)throw Error(M(38));return ra(t,e,n,!1,r)};ft.version="18.3.1-next-f1338f8080-20240426";function tg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tg)}catch(t){console.error(t)}}tg(),ef.exports=ft;var yb=ef.exports,ng,th=yb;ng=th.createRoot,th.hydrateRoot;var rg={exports:{}},vb="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",wb=vb,bb=wb;function ig(){}function sg(){}sg.resetWarningCache=ig;var Cb=function(){function t(r,i,s,o,a,l){if(l!==bb){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:sg,resetWarningCache:ig};return n.PropTypes=n,n};rg.exports=Cb();var qa=rg.exports;const Sb=t=>{const e=t.message?JSON.stringify(t.message):JSON.stringify(t);return typeof t=="string"?t:e},Ib=(t,e)=>{const[n,r]=Mn.useState(null);return Mn.useEffect(()=>{(async()=>{var s,o,a,l,u,p,g,f,I,S;try{if(t.browser&&t.browserPlatform)throw new Error("Cannot initialize, because the settings are over-specified: defined are both browser and browserPlatform. Please set one or the other");if(typeof window.glue42gd<"u"||typeof window.iodesktop<"u"){const v=((s=t.desktop)==null?void 0:s.factory)||((o=t.browser)==null?void 0:o.factory)||((a=t.browserPlatform)==null?void 0:a.factory)||window.Glue,E=((l=t.desktop)==null?void 0:l.config)||((u=t.browser)==null?void 0:u.config)||((p=t.browserPlatform)==null?void 0:p.config),x=await v(E);r(x.io||x.glue||x);return}const H=((g=t.browser)==null?void 0:g.config)||((f=t.browserPlatform)==null?void 0:f.config),m=await(((I=t.browser)==null?void 0:I.factory)||((S=t.browserPlatform)==null?void 0:S.factory)||window.IOBrowser||window.IOBrowserPlatform)(H);r(m.io||m.glue||m)}catch(k){console.error(k),e==null||e(k instanceof Error?k:new Error(Sb(k)))}})()},[]),n},og=Mn.createContext(null),du=Mn.memo(({children:t,fallback:e=null,settings:n={},onInitError:r})=>{const i=Ib(n,r);return i?Us.createElement(og.Provider,{value:i},t):Us.createElement(Us.Fragment,null,e)});du.propTypes={children:qa.node,settings:qa.object,fallback:qa.node};du.displayName="IOConnectProvider";const _b="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20id='Layer_2'%20data-name='Layer%202'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20225.32213%20272.21508'%3e%3cdefs%3e%3cstyle%3e%20.cls-1%20{%20fill:%20%23083044;%20}%20.cls-1,%20.cls-2%20{%20stroke-width:%200px;%20}%20.cls-2%20{%20fill:%20%23007be5;%20}%20%3c/style%3e%3c/defs%3e%3cg%20id='Logo'%3e%3cg%3e%3cpath%20class='cls-2'%20d='m133.5325,19.57996L114.83905.88652c-1.18203-1.18202-3.08639-1.18202-4.26841,0l-18.67155,18.67155c-1.18202,1.18202-1.18202,3.08639,0,4.26841l18.69344,18.69344c1.18202,1.18202,3.08639,1.18202,4.2684,0l18.67156-18.67155c1.18203-1.18202,1.18203-3.08639,0-4.26841Z'/%3e%3cpath%20class='cls-2'%20d='m133.46683,248.38859l-18.69345-18.69345c-1.18203-1.18203-3.08639-1.18203-4.26841,0l-18.67155,18.67156c-1.18202,1.18203-1.18202,3.08638,0,4.26841l18.69344,18.69345c1.18202,1.18203,3.08639,1.18203,4.26842,0l18.67155-18.67156c1.18201-1.20391,1.18201-3.10829,0-4.26841Z'/%3e%3cpath%20class='cls-1'%20d='m225.27045,135.22101c-.74424-16.46074-9.47805-33.40304-26.39846-50.32345l-32.2429-32.2429c-5.07832-5.07831-10.02529-8.09903-15.60705-7.85825-5.4942.24078-10.87897,3.69929-16.87663,9.69695-25.06322,24.97566-49.68866,49.51354-74.64244,74.64243-5.64743,5.64743-4.46541,9.71884,2.88939,17.07364l10.48496,10.48497c1.29147,1.29147,3.41473,1.26958,4.74998-.06567l71.09636-71.09637c1.05068-1.05068,2.0576-1.4228,2.88939-1.44469.85369-.02189,1.68548.28456,2.40782,1.0288l22.32706,22.32706c9.04027,9.04028,13.85591,17.27064,15.25683,24.77866.17511.94124.30646,1.90437.37212,2.84561.56912,7.94581-2.75804,15.54139-9.93774,22.93996-.19701.19701-.37212.4159-.56912.6129l-55.53311,55.5331c-1.31336,1.31336-1.35714,3.4585-.06567,4.74998l18.29943,18.29944c1.29147,1.29147,3.41472,1.26959,4.74998-.06568l55.5331-55.5331c14.24991-14.22803,21.56094-29.87886,20.8167-46.38338h0Z'/%3e%3cpath%20class='cls-1'%20d='m.05168,136.95027c.74424,16.46074,8.33981,32.26479,25.26023,49.18521l33.35926,33.35925c5.07832,5.07832,10.02529,8.12093,15.60705,7.85824,5.49421-.24078,10.87897-3.69929,16.87663-9.69695,25.06323-24.97566,49.68867-49.51355,74.64244-74.64244,5.64743-5.64743,4.46542-9.71884-2.88939-17.07364l-10.46307-10.46307c-1.29147-1.29147-3.41472-1.26958-4.74998.06567l-71.09638,71.09638c-1.05068,1.05068-2.05759,1.4228-2.88939,1.44469-.85368.02188-1.68548-.28456-2.40782-1.0288l-23.44341-23.44341c-9.04027-9.04027-12.73956-16.1324-14.14047-23.64042-.17511-.94124-.30645-1.90437-.37212-2.84561-.56912-7.94581,2.75805-15.54139,9.93773-22.93996.197-.19701.37212-.4159.56912-.6129l55.53309-55.5331c1.31336-1.31336,1.35714-3.45851.06567-4.74997l-18.29944-18.29943c-1.29147-1.29147-3.41473-1.26958-4.74998.06567l-55.55498,55.5112C6.61847,104.79491-.69255,120.42386.05168,136.95027H.05168Z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Eb=()=>{const t=Mn.useContext(og);return window.io=t,en.jsx("div",{className:"App",children:en.jsxs("header",{className:"App-header",children:[en.jsx("img",{src:_b,className:"App-logo",alt:"logo"}),en.jsxs("p",{children:["Edit ",en.jsx("code",{children:"src/App.tsx"})," and save to reload."]}),en.jsx("a",{className:"App-link",href:"https://docs.interop.io/browser/getting-started/what-is-io-connect-browser/index.html",target:"_blank",rel:"noopener noreferrer",children:"Learn io.Connect Browser"})]})})};var ag={};function lg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kb=function(e){return Tb(e)&&!Rb(e)};function Tb(t){return!!t&&typeof t=="object"}function Rb(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||xb(t)}var Pb=typeof Symbol=="function"&&Symbol.for,Db=Pb?Symbol.for("react.element"):60103;function xb(t){return t.$$typeof===Db}function Ab(t){return Array.isArray(t)?[]:{}}function es(t,e){return e.clone!==!1&&e.isMergeableObject(t)?Hr(Ab(t),t,e):t}function Nb(t,e,n){return t.concat(e).map(function(r){return es(r,n)})}function Ob(t,e){if(!e.customMerge)return Hr;var n=e.customMerge(t);return typeof n=="function"?n:Hr}function Mb(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return Object.propertyIsEnumerable.call(t,e)}):[]}function nh(t){return Object.keys(t).concat(Mb(t))}function cg(t,e){try{return e in t}catch{return!1}}function Lb(t,e){return cg(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function Fb(t,e,n){var r={};return n.isMergeableObject(t)&&nh(t).forEach(function(i){r[i]=es(t[i],n)}),nh(e).forEach(function(i){Lb(t,i)||(cg(t,i)&&n.isMergeableObject(e[i])?r[i]=Ob(i,n)(t[i],e[i],n):r[i]=es(e[i],n))}),r}function Hr(t,e,n){n=n||{},n.arrayMerge=n.arrayMerge||Nb,n.isMergeableObject=n.isMergeableObject||kb,n.cloneUnlessOtherwiseSpecified=es;var r=Array.isArray(e),i=Array.isArray(t),s=r===i;return s?r?n.arrayMerge(t,e,n):Fb(t,e,n):es(e,n)}Hr.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(r,i){return Hr(r,i,n)},{})};var $b=Hr,jb=$b,Xs=lg(jb),Ne=function(t){return{ok:!0,result:t}},Ee=function(t){return{ok:!1,error:t}},Wb=function(t){return t.ok===!0?Promise.resolve(t.result):Promise.reject(t.error)},Ub=function(t,e){return e.ok===!0?e.result:t},zb=function(t){if(t.ok===!0)return t.result;throw t.error},Bb=function(t,e){return e.ok===!0?Ne(t(e.result)):e},rh=function(t,e,n){return e.ok===!1?e:n.ok===!1?n:Ne(t(e.result,n.result))},Va=function(t,e){return e.ok===!0?e:Ee(t(e.error))},Hb=function(t,e){return e.ok===!0?t(e.result):e};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Zl=function(){return Zl=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Zl.apply(this,arguments)};function Gb(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function ec(t,e){if(t===e||t===null&&e===null)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="object"){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!ec(t[n],e[n]))return!1;return!0}var r=Object.keys(t);if(r.length!==Object.keys(e).length)return!1;for(var n=0;n<r.length;n++)if(!e.hasOwnProperty(r[n])||!ec(t[r[n]],e[r[n]]))return!1;return!0}}var vi=function(t){return Array.isArray(t)},Ds=function(t){return typeof t=="object"&&t!==null&&!vi(t)},qb=function(t){switch(typeof t){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return t instanceof Array?"an array":t===null?"null":"an object";default:return JSON.stringify(t)}},qt=function(t,e){return"expected "+t+", got "+qb(e)},oi=function(t){return t.map(function(e){return typeof e=="string"?"."+e:"["+e+"]"}).join("")},ai=function(t,e){var n=e.at,r=Gb(e,["at"]);return Zl({at:t+(n||"")},r)},De=function(){function t(e){var n=this;this.decode=e,this.run=function(r){return Va(function(i){return{kind:"DecoderError",input:r,at:"input"+(i.at||""),message:i.message||""}},n.decode(r))},this.runPromise=function(r){return Wb(n.run(r))},this.runWithException=function(r){return zb(n.run(r))},this.map=function(r){return new t(function(i){return Bb(r,n.decode(i))})},this.andThen=function(r){return new t(function(i){return Hb(function(s){return r(s).decode(i)},n.decode(i))})},this.where=function(r,i){return n.andThen(function(s){return r(s)?t.succeed(s):t.fail(i)})}}return t.string=function(){return new t(function(e){return typeof e=="string"?Ne(e):Ee({message:qt("a string",e)})})},t.number=function(){return new t(function(e){return typeof e=="number"?Ne(e):Ee({message:qt("a number",e)})})},t.boolean=function(){return new t(function(e){return typeof e=="boolean"?Ne(e):Ee({message:qt("a boolean",e)})})},t.constant=function(e){return new t(function(n){return ec(n,e)?Ne(e):Ee({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(n)})})},t.object=function(e){return new t(function(n){if(Ds(n)&&e){var r={};for(var i in e)if(e.hasOwnProperty(i)){var s=e[i].decode(n[i]);if(s.ok===!0)s.result!==void 0&&(r[i]=s.result);else return n[i]===void 0?Ee({message:"the key '"+i+"' is required but was not present"}):Ee(ai("."+i,s.error))}return Ne(r)}else return Ds(n)?Ne(n):Ee({message:qt("an object",n)})})},t.array=function(e){return new t(function(n){if(vi(n)&&e){var r=function(i,s){return Va(function(o){return ai("["+s+"]",o)},e.decode(i))};return n.reduce(function(i,s,o){return rh(function(a,l){return a.concat([l])},i,r(s,o))},Ne([]))}else return vi(n)?Ne(n):Ee({message:qt("an array",n)})})},t.tuple=function(e){return new t(function(n){if(vi(n)){if(n.length!==e.length)return Ee({message:"expected a tuple of length "+e.length+", got one of length "+n.length});for(var r=[],i=0;i<e.length;i++){var s=e[i].decode(n[i]);if(s.ok)r[i]=s.result;else return Ee(ai("["+i+"]",s.error))}return Ne(r)}else return Ee({message:qt("a tuple of length "+e.length,n)})})},t.union=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.oneOf.apply(t,[e,n].concat(r))},t.intersection=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new t(function(s){return[e,n].concat(r).reduce(function(o,a){return rh(Object.assign,o,a.decode(s))},Ne({}))})},t.anyJson=function(){return new t(function(e){return Ne(e)})},t.unknownJson=function(){return new t(function(e){return Ne(e)})},t.dict=function(e){return new t(function(n){if(Ds(n)){var r={};for(var i in n)if(n.hasOwnProperty(i)){var s=e.decode(n[i]);if(s.ok===!0)r[i]=s.result;else return Ee(ai("."+i,s.error))}return Ne(r)}else return Ee({message:qt("an object",n)})})},t.optional=function(e){return new t(function(n){return n==null?Ne(void 0):e.decode(n)})},t.oneOf=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return new t(function(r){for(var i=[],s=0;s<e.length;s++){var o=e[s].decode(r);if(o.ok===!0)return o;i[s]=o.error}var a=i.map(function(l){return"at error"+(l.at||"")+": "+l.message}).join('", "');return Ee({message:'expected a value matching one of the decoders, got the errors ["'+a+'"]'})})},t.withDefault=function(e,n){return new t(function(r){return Ne(Ub(e,n.decode(r)))})},t.valueAt=function(e,n){return new t(function(r){for(var i=r,s=0;s<e.length;s++){if(i===void 0)return Ee({at:oi(e.slice(0,s+1)),message:"path does not exist"});if(typeof e[s]=="string"&&!Ds(i))return Ee({at:oi(e.slice(0,s+1)),message:qt("an object",i)});if(typeof e[s]=="number"&&!vi(i))return Ee({at:oi(e.slice(0,s+1)),message:qt("an array",i)});i=i[e[s]]}return Va(function(o){return i===void 0?{at:oi(e),message:"path does not exist"}:ai(oi(e),o)},n.decode(i))})},t.succeed=function(e){return new t(function(n){return Ne(e)})},t.fail=function(e){return new t(function(n){return Ee({message:e})})},t.lazy=function(e){return new t(function(n){return e().decode(n)})},t}(),Q=De.string,ie=De.number,W=De.boolean,ee=De.anyJson;De.unknownJson;var w=De.constant,y=De.object,G=De.array;De.tuple;De.dict;var d=De.optional,K=De.oneOf,ia=De.union,Vb=De.intersection;De.withDefault;De.valueAt;De.succeed;De.fail;var tc=De.lazy;const Jb={gateway:{webPlatform:{}},libraries:[],exposeAPI:!0},Kb={awaitFactory:!0,enable:!1,timeout:5*1e3},Qb={alerts:{enabled:!1},dialogs:{enabled:!1},awaitFactory:!0,timeout:5*1e3},Yb={enable:!1,timeout:5*1e3,awaitFactory:!0},gt={platformUnload:{name:"platformUnload"},transportSwitchRequest:{name:"transportSwitchRequest"},transportSwitchResponse:{name:"transportSwitchResponse"},getCurrentTransport:{name:"getCurrentTransport"},getCurrentTransportResponse:{name:"getCurrentTransportResponse"},checkPreferredLogic:{name:"checkPreferredLogic"},checkPreferredConnection:{name:"checkPreferredConnection"},checkPreferredLogicResponse:{name:"checkPreferredLogicResponse"},checkPreferredConnectionResponse:{name:"checkPreferredConnectionResponse"}},ih="web-platform",sh="latest_fdc3_type",ug=new MessageChannel,Xb="requestWidgetFactoryReady",Zb="requestModalsUIFactoryReady",nc=2147483647,eC="requestIntentResolverUIFactoryReady",$t=t=>typeof t=="string"?t:t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):JSON.stringify(t),A=(t,e)=>{try{return t.runWithException(e)}catch(n){return N.raiseError(n,!0)}},Un=t=>Object.keys(t).filter(e=>t[e].execute),zn=(t,e)=>({isSupported:t.some(r=>r.toLowerCase()===e.toLowerCase())}),Ja=t=>Math.min(t,nc),Ka=()=>{let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}};class tC{raiseError(e,n){const r=$t(e);throw ug.port1.postMessage(r),n?e:new Error(r)}}const N=new tC,oh=["name","title","version","customProperties","icon","caption","type"],nC=["appId","name","type","details","version","title","tooltip","lang","description","categories","icons","screenshots","contactEmail","moreInfo","publisher","customConfig","hostManifests","interop","localizedVersions"];var Oe=function(t){return{ok:!0,result:t}},ke=function(t){return{ok:!1,error:t}},rC=function(t){return t.ok===!0?Promise.resolve(t.result):Promise.reject(t.error)},iC=function(t,e){return e.ok===!0?e.result:t},sC=function(t){if(t.ok===!0)return t.result;throw t.error},oC=function(t,e){return e.ok===!0?Oe(t(e.result)):e},ah=function(t,e,n){return e.ok===!1?e:n.ok===!1?n:Oe(t(e.result,n.result))},Qa=function(t,e){return e.ok===!0?e:ke(t(e.error))},aC=function(t,e){return e.ok===!0?t(e.result):e};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var rc=function(){return rc=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},rc.apply(this,arguments)};function lC(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function ic(t,e){if(t===e||t===null&&e===null)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="object"){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!ic(t[n],e[n]))return!1;return!0}var r=Object.keys(t);if(r.length!==Object.keys(e).length)return!1;for(var n=0;n<r.length;n++)if(!e.hasOwnProperty(r[n])||!ic(t[r[n]],e[r[n]]))return!1;return!0}}var wi=function(t){return Array.isArray(t)},xs=function(t){return typeof t=="object"&&t!==null&&!wi(t)},cC=function(t){switch(typeof t){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return t instanceof Array?"an array":t===null?"null":"an object";default:return JSON.stringify(t)}},Vt=function(t,e){return"expected "+t+", got "+cC(e)},li=function(t){return t.map(function(e){return typeof e=="string"?"."+e:"["+e+"]"}).join("")},ci=function(t,e){var n=e.at,r=lC(e,["at"]);return rc({at:t+(n||"")},r)},xe=function(){function t(e){var n=this;this.decode=e,this.run=function(r){return Qa(function(i){return{kind:"DecoderError",input:r,at:"input"+(i.at||""),message:i.message||""}},n.decode(r))},this.runPromise=function(r){return rC(n.run(r))},this.runWithException=function(r){return sC(n.run(r))},this.map=function(r){return new t(function(i){return oC(r,n.decode(i))})},this.andThen=function(r){return new t(function(i){return aC(function(s){return r(s).decode(i)},n.decode(i))})},this.where=function(r,i){return n.andThen(function(s){return r(s)?t.succeed(s):t.fail(i)})}}return t.string=function(){return new t(function(e){return typeof e=="string"?Oe(e):ke({message:Vt("a string",e)})})},t.number=function(){return new t(function(e){return typeof e=="number"?Oe(e):ke({message:Vt("a number",e)})})},t.boolean=function(){return new t(function(e){return typeof e=="boolean"?Oe(e):ke({message:Vt("a boolean",e)})})},t.constant=function(e){return new t(function(n){return ic(n,e)?Oe(e):ke({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(n)})})},t.object=function(e){return new t(function(n){if(xs(n)&&e){var r={};for(var i in e)if(e.hasOwnProperty(i)){var s=e[i].decode(n[i]);if(s.ok===!0)s.result!==void 0&&(r[i]=s.result);else return n[i]===void 0?ke({message:"the key '"+i+"' is required but was not present"}):ke(ci("."+i,s.error))}return Oe(r)}else return xs(n)?Oe(n):ke({message:Vt("an object",n)})})},t.array=function(e){return new t(function(n){if(wi(n)&&e){var r=function(i,s){return Qa(function(o){return ci("["+s+"]",o)},e.decode(i))};return n.reduce(function(i,s,o){return ah(function(a,l){return a.concat([l])},i,r(s,o))},Oe([]))}else return wi(n)?Oe(n):ke({message:Vt("an array",n)})})},t.tuple=function(e){return new t(function(n){if(wi(n)){if(n.length!==e.length)return ke({message:"expected a tuple of length "+e.length+", got one of length "+n.length});for(var r=[],i=0;i<e.length;i++){var s=e[i].decode(n[i]);if(s.ok)r[i]=s.result;else return ke(ci("["+i+"]",s.error))}return Oe(r)}else return ke({message:Vt("a tuple of length "+e.length,n)})})},t.union=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.oneOf.apply(t,[e,n].concat(r))},t.intersection=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new t(function(s){return[e,n].concat(r).reduce(function(o,a){return ah(Object.assign,o,a.decode(s))},Oe({}))})},t.anyJson=function(){return new t(function(e){return Oe(e)})},t.unknownJson=function(){return new t(function(e){return Oe(e)})},t.dict=function(e){return new t(function(n){if(xs(n)){var r={};for(var i in n)if(n.hasOwnProperty(i)){var s=e.decode(n[i]);if(s.ok===!0)r[i]=s.result;else return ke(ci("."+i,s.error))}return Oe(r)}else return ke({message:Vt("an object",n)})})},t.optional=function(e){return new t(function(n){return n==null?Oe(void 0):e.decode(n)})},t.oneOf=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return new t(function(r){for(var i=[],s=0;s<e.length;s++){var o=e[s].decode(r);if(o.ok===!0)return o;i[s]=o.error}var a=i.map(function(l){return"at error"+(l.at||"")+": "+l.message}).join('", "');return ke({message:'expected a value matching one of the decoders, got the errors ["'+a+'"]'})})},t.withDefault=function(e,n){return new t(function(r){return Oe(iC(e,n.decode(r)))})},t.valueAt=function(e,n){return new t(function(r){for(var i=r,s=0;s<e.length;s++){if(i===void 0)return ke({at:li(e.slice(0,s+1)),message:"path does not exist"});if(typeof e[s]=="string"&&!xs(i))return ke({at:li(e.slice(0,s+1)),message:Vt("an object",i)});if(typeof e[s]=="number"&&!wi(i))return ke({at:li(e.slice(0,s+1)),message:Vt("an array",i)});i=i[e[s]]}return Qa(function(o){return i===void 0?{at:li(e),message:"path does not exist"}:ci(li(e),o)},n.decode(i))})},t.succeed=function(e){return new t(function(n){return Oe(e)})},t.fail=function(e){return new t(function(n){return ke({message:e})})},t.lazy=function(e){return new t(function(n){return e().decode(n)})},t}(),ts=xe.string,sc=xe.number,uC=xe.boolean,or=xe.anyJson;xe.unknownJson;var ui=xe.constant,ze=xe.object,_e=xe.array;xe.tuple;var oc=xe.dict,F=xe.optional,dg=xe.oneOf;xe.union;xe.intersection;xe.withDefault;xe.valueAt;xe.succeed;xe.fail;xe.lazy;const q=ts().where(t=>t.length>0,"Expected a non-empty string"),ac=sc().where(t=>t>=0,"Expected a non-negative number"),hg=ze({name:q,displayName:F(ts()),contexts:F(_e(ts())),customConfig:F(ze())}),dC=dg(ui("web"),ui("native"),ui("citrix"),ui("onlineNative"),ui("other")),fg=ze({url:q}),pg=ze({src:q,size:F(q),type:F(q)}),gg=ze({src:q,size:F(q),type:F(q),label:F(q)}),hC=ze({contexts:_e(q),displayName:F(q),resultType:F(q),customConfig:F(or())}),fC=ze({listensFor:F(oc(hC)),raises:F(oc(_e(q)))}),pC=ze({broadcasts:F(_e(q)),listensFor:F(_e(q))}),gC=ze({name:q,description:F(q),broadcasts:F(_e(q)),listensFor:F(_e(q))}),mg=ze({intents:F(fC),userChannels:F(pC),appChannels:F(_e(gC))}),mC=ze({url:F(q),top:F(sc()),left:F(sc()),width:F(ac),height:F(ac)}),yC=ze({name:F(q),type:F(q.where(t=>t==="window","Expected a value of window")),title:F(q),version:F(q),customProperties:F(or()),icon:F(ts()),caption:F(ts()),details:F(mC),intents:F(_e(hg)),hidden:F(uC())}),yg=ze({name:q,appId:q,title:F(q),version:F(q),manifest:q,manifestType:q,tooltip:F(q),description:F(q),contactEmail:F(q),supportEmail:F(q),publisher:F(q),images:F(_e(ze({url:F(q)}))),icons:F(_e(ze({icon:F(q)}))),customConfig:or(),intents:F(_e(hg))}),vC=ze({appId:F(q),name:F(q),details:F(fg),version:F(q),title:F(q),tooltip:F(q),lang:F(q),description:F(q),categories:F(_e(q)),icons:F(_e(pg)),screenshots:F(_e(gg)),contactEmail:F(q),supportEmail:F(q),moreInfo:F(q),publisher:F(q),customConfig:F(_e(or())),hostManifests:F(or()),interop:F(mg)}),vg=ze({appId:q,name:q,type:dC,details:fg,version:F(q),title:F(q),tooltip:F(q),lang:F(q),description:F(q),categories:F(_e(q)),icons:F(_e(pg)),screenshots:F(_e(gg)),contactEmail:F(q),supportEmail:F(q),moreInfo:F(q),publisher:F(q),customConfig:F(_e(or())),hostManifests:F(or()),interop:F(mg),localizedVersions:F(oc(vC))}),Zs=dg(yg,vg),As=t=>`${t.kind} at ${t.at}: ${JSON.stringify(t.input)}. Reason - ${t.message}`;class wC{constructor(){c(this,"fdc3ToDesktopDefinitionType",{web:"window",native:"exe",citrix:"citrix",onlineNative:"clickonce",other:"window"})}toApi(){return{isFdc3Definition:this.isFdc3Definition.bind(this),parseToBrowserBaseAppData:this.parseToBrowserBaseAppData.bind(this),parseToDesktopAppConfig:this.parseToDesktopAppConfig.bind(this)}}isFdc3Definition(e){const n=Zs.run(e);return n.ok?e.appId&&e.details?{isFdc3:!0,version:"2.0"}:e.manifest?{isFdc3:!0,version:"1.2"}:{isFdc3:!1,reason:"The passed definition is not FDC3"}:{isFdc3:!1,reason:As(n.error)}}parseToBrowserBaseAppData(e){var p,g;const{isFdc3:n,version:r}=this.isFdc3Definition(e);if(!n)throw new Error("The passed definition is not FDC3");const i=Zs.run(e);if(!i.ok)throw new Error(`Invalid FDC3 ${r} definition. Error: ${As(i.error)}`);const s=this.getUserPropertiesFromDefinition(e,r),o={url:this.getUrl(e,r)},a={name:e.appId,type:"window",createOptions:o,userProperties:{...s,intents:r==="1.2"?s.intents:this.getIntentsFromV2AppDefinition(e),details:o},title:e.title,version:e.version,icon:this.getIconFromDefinition(e,r),caption:e.description,fdc3:r==="2.0"?{...e,definitionVersion:"2.0"}:void 0},l=((p=e.hostManifests)==null?void 0:p.ioConnect)||((g=e.hostManifests)==null?void 0:g.Glue42);if(!l)return a;const u=yC.run(l);if(!u.ok)throw new Error(`Invalid FDC3 ${r} definition. Error: ${As(u.error)}`);return Object.keys(u.result).length?this.mergeBaseAppDataWithGlueManifest(a,u.result):a}parseToDesktopAppConfig(e){var l,u,p;const{isFdc3:n,version:r}=this.isFdc3Definition(e);if(!n)throw new Error("The passed definition is not FDC3");const i=Zs.run(e);if(!i.ok)throw new Error(`Invalid FDC3 ${r} definition. Error: ${As(i.error)}`);if(r==="1.2"){const g=e;return{name:g.appId,type:"window",details:{url:this.getUrl(e,r)},version:g.version,title:g.title,tooltip:g.tooltip,caption:g.description,icon:(l=g.icons)==null?void 0:l[0].icon,intents:g.intents,customProperties:{manifestType:g.manifestType,images:g.images,contactEmail:g.contactEmail,supportEmail:g.supportEmail,publisher:g.publisher,icons:g.icons,customConfig:g.customConfig}}}const s=e,o={name:s.appId,type:this.fdc3ToDesktopDefinitionType[s.type],details:s.details,version:s.version,title:s.title,tooltip:s.tooltip,caption:s.description,icon:this.getIconFromDefinition(s,"2.0"),intents:this.getIntentsFromV2AppDefinition(s),fdc3:{...s,definitionVersion:"2.0"}},a=((u=e.hostManifests)==null?void 0:u.ioConnect)||((p=e.hostManifests)==null?void 0:p.Glue42);if(!a)return o;if(typeof a!="object"||Array.isArray(a))throw new Error(`Invalid '${e.hostManifests.ioConnect?"hostManifests.ioConnect":"hostManifests['Glue42']"}' key`);return this.mergeDesktopConfigWithGlueManifest(o,a)}getUserPropertiesFromDefinition(e,n){return Object.fromEntries(n==="1.2"?Object.entries(e).filter(([r])=>!oh.includes(r)):Object.entries(e).filter(([r])=>!oh.includes(r)&&!nC.includes(r)))}getUrl(e,n){var i,s;let r;if(n==="1.2"){const o=JSON.parse(e.manifest);r=((i=o.details)==null?void 0:i.url)||o.url}else r=(s=e.details)==null?void 0:s.url;if(!r||typeof r!="string")throw new Error(`Invalid FDC3 ${n} definition. Provide valid 'url' under '${n==="1.2"?"manifest":"details"}' key`);return r}getIntentsFromV2AppDefinition(e){var i,s;const n=(s=(i=e.interop)==null?void 0:i.intents)==null?void 0:s.listensFor;return n?Object.entries(n).map(o=>{const[a,l]=o;return{name:a,...l}}):void 0}getIconFromDefinition(e,n){var r,i,s,o;return n==="1.2"?((i=(r=e.icons)==null?void 0:r.find(a=>a.icon))==null?void 0:i.icon)||void 0:((o=(s=e.icons)==null?void 0:s.find(a=>a.src))==null?void 0:o.src)||void 0}mergeBaseAppDataWithGlueManifest(e,n){let r=e;if(n.customProperties&&(r.userProperties={...e.userProperties,...n.customProperties}),n.details){const i={...e.createOptions,...n.details};r.createOptions=i,r.userProperties.details=i}return Array.isArray(n.intents)&&(r.userProperties.intents=(r.userProperties.intents||[]).concat(n.intents)),r={...r,...n},delete r.details,delete r.intents,r}mergeDesktopConfigWithGlueManifest(e,n){const r=Object.assign({},e,n,{details:{...e.details,...n.details}});return Array.isArray(n.intents)&&(r.intents=(e.intents||[]).concat(n.intents)),r}}const bC={common:{nonEmptyStringDecoder:q,nonNegativeNumberDecoder:ac},fdc3:{allDefinitionsDecoder:Zs,v1DefinitionDecoder:yg,v2DefinitionDecoder:vg}};var lc;(function(t){t.USER_CANCELLED="User Closed Intents Resolver UI without choosing a handler",t.CALLER_NOT_DEFINED="Caller Id is not defined",t.TIMEOUT_HIT="Timeout hit",t.INTENT_NOT_FOUND="Cannot find Intent",t.HANDLER_NOT_FOUND="Cannot find Intent Handler",t.TARGET_INSTANCE_UNAVAILABLE="Cannot start Target Instance",t.INTENT_DELIVERY_FAILED="Target Instance did not add a listener",t.RESOLVER_UNAVAILABLE="Intents Resolver UI unavailable",t.RESOLVER_TIMEOUT="User did not choose a handler",t.INVALID_RESOLVER_RESPONSE="Intents Resolver UI returned invalid response",t.INTENT_HANDLER_REJECTION="Intent Handler function processing the raised intent threw an error or rejected the promise it returned"})(lc||(lc={}));let CC=class{constructor(){c(this,"_fdc3");c(this,"_decoders",bC);c(this,"_errors",{intents:lc})}get fdc3(){return this._fdc3||(this._fdc3=new wC().toApi()),this._fdc3}get decoders(){return this._decoders}get errors(){return this._errors}};const hu=new CC;hu.fdc3;const ar=hu.decoders;hu.errors;const b=Q().where(t=>t.length>0,"Expected a non-empty string"),oe=ie().where(t=>t>=0,"Expected a non-negative number"),xo=d(b),SC=K(w("system"),w("windows"),w("appManager"),w("layouts"),w("intents"),w("notifications"),w("channels"),w("extension"),w("themes"),w("prefs"),w("ui")),IC=K(w("openWindow"),w("windowHello"),w("windowAdded"),w("windowRemoved"),w("getBounds"),w("getFrameBounds"),w("getUrl"),w("moveResize"),w("focus"),w("close"),w("getTitle"),w("setTitle"),w("focusChange"),w("getChannel"),w("notifyChannelsChanged"),w("operationCheck")),_C=K(w("appHello"),w("appDirectoryStateChange"),w("instanceStarted"),w("instanceStopped"),w("applicationStart"),w("instanceStop"),w("clear"),w("operationCheck")),EC=K(w("layoutAdded"),w("layoutChanged"),w("layoutRemoved"),w("layoutRenamed"),w("get"),w("getAll"),w("export"),w("import"),w("remove"),w("rename"),w("clientSaveRequest"),w("getGlobalPermissionState"),w("checkGlobalActivated"),w("requestGlobalPermission"),w("getDefaultGlobal"),w("setDefaultGlobal"),w("clearDefaultGlobal"),w("updateMetadata"),w("operationCheck"),w("getCurrent"),w("defaultLayoutChanged"),w("layoutRestored")),kC=K(w("raiseNotification"),w("requestPermission"),w("notificationShow"),w("notificationClick"),w("getPermission"),w("list"),w("notificationRaised"),w("notificationClosed"),w("click"),w("clear"),w("clearAll"),w("configure"),w("getConfiguration"),w("configurationChanged"),w("setState"),w("clearOld"),w("activeCountChange"),w("stateChange"),w("operationCheck"),w("getActiveCount")),TC=K(w("getEnvironment"),w("getBase"),w("platformShutdown"),w("isFdc3DataWrappingSupported"),w("clientError"),w("systemHello"),w("operationCheck")),sa=K(w("top"),w("left"),w("right"),w("bottom")),fu=y({top:ie(),left:ie(),width:oe,height:oe}),wg=d(y({top:d(ie()),left:d(ie()),width:d(oe),height:d(oe),context:d(ee()),relativeTo:d(b),relativeDirection:d(sa),windowId:d(b),layoutComponentId:d(b)})),RC=y({name:b,url:b,options:wg}),bg=y({windowId:d(b)}),cc=y({windowId:b,name:b}),yn=y({windowId:b}),PC=y({windows:G(cc),isWorkspaceFrame:W()}),lh=y({windowId:b,title:Q()}),DC=y({windowId:b,hasFocus:W()}),xC=y({windowId:b,top:d(ie()),left:d(ie()),width:d(oe),height:d(oe),relative:d(W())}),AC=y({windowId:b,bounds:y({top:ie(),left:ie(),width:oe,height:oe})}),NC=y({bounds:y({top:ie(),left:ie(),width:oe,height:oe})}),OC=y({windowId:b,url:b}),Ao=ee(),MC=y({top:d(ie()),left:d(ie()),width:d(oe),height:d(oe)}),eo=y({id:b,applicationName:b}),LC=y({flags:Q()}),FC=y({flags:Q()}),$C=y({windowId:b,channelsNames:G(b)}),jC=y({enabled:W()}),WC=y({url:b,top:d(ie()),left:d(ie()),width:d(oe),height:d(oe),workspacesSandbox:d(FC),channelSelector:d(jC),iframePermissionsPolicy:d(LC)}),Cg=y({name:b,displayName:d(Q()),contexts:d(G(Q())),customConfig:d(y())});y({name:b,title:d(b),version:d(b),appId:d(b),manifest:b,manifestType:b,tooltip:d(b),description:d(b),contactEmail:d(b),supportEmail:d(b),publisher:d(b),images:d(G(y({url:d(b)}))),icons:d(G(y({icon:d(b)}))),customConfig:ee(),intents:d(G(Cg))});const pu=y({name:b,type:b.where(t=>t==="window","Expected a value of window"),title:d(b),version:d(b),customProperties:d(ee()),icon:d(Q()),caption:d(Q()),details:WC,intents:d(G(Cg)),hidden:d(W()),fdc3:d(ar.fdc3.v2DefinitionDecoder)}),UC=K(pu,ar.fdc3.v2DefinitionDecoder,ar.fdc3.v1DefinitionDecoder);y({definitions:G(UC),mode:K(w("replace"),w("merge"))});const zC=y({name:b}),BC=y({definitions:G(pu)}),HC=y({name:b,type:b.where(t=>t==="window","Expected a value of window"),instances:G(eo),userProperties:d(ee()),title:d(b),version:d(b),icon:d(b),caption:d(b)}),Ya=y({name:b,type:b.where(t=>t==="window","Expected a value of window"),userProperties:ee(),title:d(b),version:d(b),icon:d(b),caption:d(b)}),GC=y({appsAdded:G(Ya),appsChanged:G(Ya),appsRemoved:G(Ya)}),qC=y({apps:G(HC),initialChannelId:d(b)}),VC=y({id:b}),on=K(w("Global"),w("Activity"),w("ApplicationDefault"),w("Swimlane"),w("Workspace")),Sg=K(w("application"),w("activity")),JC=y({context:d(ee()),bounds:fu,createArgs:y({name:d(b),url:d(b),context:d(ee())}),windowState:d(b),restoreState:d(b),instanceId:b,isCollapsed:d(W()),isSticky:d(W()),restoreSettings:y({groupId:d(b),groupZOrder:d(ie())})}),Ig=y({type:w("window"),componentType:d(Sg),application:b,state:JC}),oa=y({type:w("window"),config:y({appName:b,url:d(b),title:d(Q()),allowExtract:d(W()),allowReorder:d(W()),showCloseButton:d(W()),isMaximized:d(W())})}),gu=y({type:w("group"),config:ee(),children:G(K(oa))}),mu=y({type:w("column"),config:ee(),children:G(K(gu,oa,tc(()=>mu),tc(()=>yu)))}),yu=y({type:w("row"),config:ee(),children:G(K(mu,gu,oa,tc(()=>yu)))}),_g=y({config:ee(),context:ee(),children:G(K(yu,mu,gu,oa))}),Eg=y({type:w("Workspace"),application:d(b),state:_g}),KC=y({bounds:fu,instanceId:b,selectedWorkspace:oe,workspaces:G(_g),windowState:d(b),restoreState:d(b),context:d(ee())}),kg=y({type:w("workspaceFrame"),application:b,componentType:d(Sg),state:KC}),ut=y({name:b,type:on,token:d(b),components:G(K(Ig,Eg,kg)),context:d(ee()),metadata:d(ee()),version:d(ie())}),QC=y({name:b,type:on,token:d(b),components:G(K(Ig,Eg,kg)),context:d(ee()),metadata:d(ee()),version:d(ie()),prevName:b}),Tg=y({name:b,context:d(ee()),metadata:d(ee()),instances:d(G(b)),ignoreInstances:d(G(b))}),Rg=y({name:b,context:d(ee()),closeRunningInstance:d(W()),closeMe:d(W()),timeout:d(oe)}),YC=y({name:b,type:on,context:d(ee()),metadata:d(ee())}),ch=y({name:b,type:on}),XC=y({layout:Tg}),ZC=y({layout:ut,newName:b}),eS=y({status:b}),tS=y({layout:ut}),nS=y({layout:Rg}),uh=y({type:on}),rS=y({layouts:G(ut)}),iS=d(y({name:b})),vu=K(w("replace"),w("merge")),sS=y({layouts:G(ut),mode:vu,skipManagerRequest:d(W())}),oS=y({summaries:G(YC)}),aS=y({layout:ut}),Xa=y({layout:d(ut)}),lS=y({name:b}),cS=K(w("findIntent"),w("getIntents"),w("getIntentsByHandler"),w("raise"),w("filterHandlers")),Bn=y({applicationName:b,applicationTitle:d(Q()),applicationDescription:d(Q()),applicationIcon:d(Q()),type:K(w("app"),w("instance")),displayName:d(Q()),contextTypes:d(G(b)),instanceId:d(Q()),instanceTitle:d(Q()),resultType:d(Q())});y({applicationName:Q(),applicationIcon:d(Q()),instanceId:d(Q())});y({intent:b,handler:Bn});const uS=y({name:b,handlers:G(Bn)}),dS=K(w("startNew"),w("reuse"),y({app:d(b),instance:d(b)})),hS=y({type:d(b),data:d(ee())}),fS=G(uS),dh=y({intents:fS}),Pg=y({name:d(b),contextType:d(b),resultType:d(b)}),pS=K(b,Pg),gS=y({filter:d(Pg)}),mS=y({top:d(ie()),left:d(ie()),width:d(oe),height:d(oe),relativeTo:d(b),relativeDirection:d(sa),waitForAGMReady:d(W()),channelId:d(b)}),Kr=y({intent:b,target:d(dS),context:d(hS),options:d(mS),handlers:d(G(Bn)),timeout:d(oe),waitUserResponseIndefinitely:d(W()),clearSavedHandler:d(W())}),yS=y({interopInstance:b,name:d(b)}),vS=y({originApp:yS,intentRequest:d(Kr)}),wS=y({name:b,waitForAGMReady:W(),id:d(b),context:d(ee()),top:d(ie()),left:d(ie()),width:d(oe),height:d(oe),relativeTo:d(b),relativeDirection:d(sa),forceChromeTab:d(W()),layoutComponentId:d(b),channelId:d(b),startReason:vS}),bS=K(b,Kr),Dg=y({enabled:W(),appName:b,waitResponseTimeout:ie()}),wu=y({title:d(b),openResolver:d(W()),timeout:d(oe),intent:d(b),contextTypes:d(G(b)),resultType:d(b),applicationNames:d(G(b))}),xg=y({enabled:W(),initialCaller:y({instanceId:b})}),CS=y({intentRequest:Kr,resolverConfig:Dg,embeddedResolverConfig:d(xg)}),SS=y({request:Kr,handler:Bn,result:ee()}),IS=y({handlers:G(Bn)}),_S=y({filterHandlersRequest:wu,resolverConfig:Dg,embeddedResolverConfig:d(xg)}),ES=y({intent:b,contextTypes:d(G(b)),displayName:d(Q()),icon:d(Q()),description:d(Q()),resultType:d(Q())}),hh=K(b,ES),kS=y({intent:b,contextTypes:d(G(b)),description:d(b),displayName:d(b),icon:d(b),resultType:d(b)}),TS=y({intents:G(kS)}),Jt=t=>b.where(e=>t.includes(e),"Expected a valid channel name"),Ns=y({contextType:d(b)}),RS=d(K(b,y({name:d(b),fdc3:d(W())}))),PS=y({windowId:xo,channel:xo}),DS=ee().where(t=>typeof t.type=="string","Expected a valid FDC3 Context with compulsory 'type' field"),bu=y({method:b,arguments:d(ee()),target:d(K(w("all"),w("best")))}),Ag=y({action:Q(),title:b,icon:d(Q()),interop:d(bu)}),aa=K(w("Active"),w("Acknowledged"),w("Seen"),w("Closed"),w("Stale"),w("Snoozed"),w("Processing")),fh=y({count:ie()}),xS=y({badge:d(Q()),body:d(Q()),data:d(ee()),dir:d(K(w("auto"),w("ltr"),w("rtl"))),icon:d(Q()),image:d(Q()),lang:d(Q()),renotify:d(W()),requireInteraction:d(W()),silent:d(W()),tag:d(Q()),timestamp:d(oe),vibrate:d(G(ie()))}),Cu=y({title:b,clickInterop:d(bu),actions:d(G(Ag)),focusPlatformOnDefaultClick:d(W()),badge:d(Q()),body:d(Q()),data:d(ee()),dir:d(K(w("auto"),w("ltr"),w("rtl"))),icon:d(Q()),image:d(Q()),lang:d(Q()),renotify:d(W()),requireInteraction:d(W()),silent:d(W()),tag:d(Q()),timestamp:d(oe),vibrate:d(G(ie())),severity:d(K(w("Low"),w("None"),w("Medium"),w("High"),w("Critical"))),showToast:d(W()),showInPanel:d(W()),state:d(aa)}),ph=y({id:b,state:aa});y().where(t=>t.fdc3?typeof t.fdc3.type=="string":!0,"Expected a valid FDC3 Context with compulsory 'type' field");const AS=y({color:d(b),icon:d(b),name:d(b),glyph:d(b)}),NS=y({id:b,displayMetadata:d(AS)}),OS=y({color:b,fdc3:d(NS)}),Ng=y({name:b,meta:OS,data:d(y())}),Og=y({path:b,value:ee()}),MS=G(Og),LS=y({name:b}),Mg=y({name:b,read:W(),write:W(),windowId:d(b)}),FS=y({name:b,read:W(),write:W(),windowId:b}),$S=y({config:FS}),jS=y({channels:G(Mg)}),WS=y({windowId:b}),Lg=y({read:W(),write:W(),windowId:d(b)}),US=y({restrictions:Lg}),zS=y({settings:Cu,id:b}),BS=y({settings:Cu}),HS=y({permissionGranted:W()}),GS=y({permission:K(w("default"),w("granted"),w("denied"))}),gh=y({definition:xS,action:d(Q()),id:d(b)}),Fg=y({allowed:d(G(b)),blocked:d(G(b))}),$g=y({enable:d(W()),enableToasts:d(W()),sourceFilter:d(Fg),showNotificationBadge:d(W())}),qS=y({configuration:$g}),mh=y({configuration:y({enable:W(),enableToasts:W(),sourceFilter:y({allowed:G(b),blocked:G(b)})})}),VS=y({layoutType:K(w("Global"),w("Workspace")),layoutName:b,context:d(ee())}),JS=y({windowContext:d(ee())}),KS=y({state:K(w("prompt"),w("denied"),w("granted"))}),yh=y({isAvailable:W()}),QS=y({itemId:b}),jg=y({isSupported:W()}),Wg=y({operation:b}),YS=y({bounds:fu}),Ug=y({displayName:b,name:b}),zg=y({theme:Ug}),XS=y({themes:G(Ug)}),ZS=y({name:b}),Bg=y({id:b,title:b,clickInterop:d(bu),actions:d(G(Ag)),focusPlatformOnDefaultClick:d(W()),badge:d(Q()),body:d(Q()),data:d(ee()),dir:d(K(w("auto"),w("ltr"),w("rtl"))),icon:d(Q()),image:d(Q()),lang:d(Q()),renotify:d(W()),requireInteraction:d(W()),silent:d(W()),tag:d(Q()),timestamp:d(oe),vibrate:d(G(ie())),severity:d(K(w("Low"),w("None"),w("Medium"),w("High"),w("Critical"))),showToast:d(W()),showInPanel:d(W()),state:d(aa)}),e0=y({notification:Bg}),t0=y({notifications:G(Bg)}),n0=y({id:b}),r0=y({channel:b}),i0=y({windowIds:G(b)}),s0=K(w("addChannel"),w("getMyChannel"),w("getWindowIdsOnChannel"),w("getWindowIdsWithChannels"),w("joinChannel"),w("restrict"),w("getRestrictions"),w("restrictAll"),w("notifyChannelsChanged"),w("leaveChannel"),w("getMode"),w("operationCheck")),o0=y({mode:K(w("single"),w("multi"))}),a0=y({channel:d(b)}),Hg=y({application:d(b),channels:d(G(b)),windowIds:d(G(b))}),l0=y({filter:d(Hg)}),c0=y({windowIdsWithChannels:G(y({application:b,channel:d(b),windowId:b}))}),u0=d(ee()),d0=d(y({top:d(ie()),left:d(ie()),width:d(oe),height:d(oe),relativeTo:d(b),relativeDirection:d(sa),waitForAGMReady:d(W()),channelId:d(b),reuseId:d(b),originIntentRequest:d(Kr)})),h0=y({channel:b,windowId:b}),f0=y({windowId:b,channelName:d(b)}),Gg=y({windowId:b,channelNames:G(b)}),p0=y({channel:d(b)}),g0=K(w("clear"),w("clearAll"),w("get"),w("getAll"),w("set"),w("update"),w("prefsChanged"),w("prefsHello"),w("operationCheck"),w("registerSubscriber")),qg=y({app:b,data:y(),lastUpdate:d(b)}),No=y({app:b}),vh=y({prefs:qg}),m0=y({all:G(qg)}),y0=y({interopId:b}),wh=y({app:b,data:y()}),v0=y({platform:y({app:b}),validNonExistentApps:d(G(b))}),w0=y({message:b}),b0=y({isClientErrorOperationSupported:W()}),ue=ar.common.nonEmptyStringDecoder,On=ar.common.nonNegativeNumberDecoder,C0=y({bundle:ue,styles:G(ue),fonts:d(G(ue))}),S0=y({bundle:ue,styles:G(ue),fonts:d(G(ue))}),I0=y({bundle:ue,styles:G(ue),fonts:d(G(ue))}),_0=K(w("directional"),w("default")),E0=y({type:d(_0),enable:d(W())}),Vg=K(w("top"),w("bottom"),w("left"),w("right")),Jg=K(w("default"),w("compact")),k0=K(w("all"),w("fdc3")),Kg=y({selector:d(E0),displayMode:d(k0)}),T0=y({channels:d(Kg),position:d(Vg),mode:d(Jg),displayInWorkspace:d(W())}),Qg=y({enable:W(),awaitFactory:d(W()),timeout:d(On),channels:d(Kg),position:d(Vg),mode:d(Jg),displayInWorkspace:d(W())}),Yg=y({alerts:d(y({enabled:W()})),dialogs:d(y({enabled:W()})),awaitFactory:d(W()),timeout:d(On)}),R0=K(w("getResources"),w("operationCheck"),w("showAlert"),w("showDialog"),w("alertInteropAction"),w("showResolver")),P0=y({origin:ue}),Su=y({blockedOrigin:w(!0)}),D0=y({blockedOrigin:w(!1),config:T0,sources:C0}),x0=ia(Su,D0),A0=y({blockedOrigin:w(!1),sources:S0}),N0=ia(Su,A0),O0=y({blockedOrigin:w(!1),sources:I0}),M0=ia(Su,O0),L0=y({widget:d(x0),modals:d(N0),intentResolver:d(M0)}),F0=y({resources:L0}),to=y({method:ue,arguments:d(ee()),target:d(K(w("best"),w("all"),ue))}),Xg=K(w("Global"),w("WindowContainer"),ue),Zg=y({instance:ue,container:d(K(w("Global"),w("WindowContainer")))}),$0=y({variant:K(w("default"),w("success"),w("critical"),w("info"),w("warning")),text:ue,showCloseButton:d(W()),clickInterop:d(to),onCloseInterop:d(to),actions:d(G(y({id:ue,title:ue,clickInterop:to}))),data:d(ee()),ttl:d(On),target:d(Xg)}),j0=y({config:$0,target:Zg}),W0=y({templateName:ue,variables:ee(),target:d(Xg),timer:d(y({duration:On})),size:d(y({width:On,height:On})),movable:d(W()),transparent:d(W())}),em=y({isExpired:d(W()),isClosed:d(W()),isEnterPressed:d(W()),responseButtonClicked:d(y({id:ue,text:ue})),inputs:d(G(y({type:K(w("checkbox"),w("email"),w("number"),w("password"),w("text")),id:ue,checked:d(W()),value:d(Q())})))});y({result:em});const U0=y({config:W0,target:Zg}),z0=y({id:ue}),B0=y({id:ue,responsePromise:ee()}),H0=y({response:em}),tm=y({name:ue,settings:to}),G0=y({interopAction:tm}),q0=y({interopAction:tm}),nm=y({enable:W(),awaitFactory:d(W()),timeout:d(On)}),V0=y({id:ue}),J0=y({preserveChoice:W()}),K0=y({intent:ue,handler:Bn,userSettings:J0}),rm=y({isExpired:d(W()),isClosed:d(W()),userChoice:d(K0)}),Q0=y({response:rm}),Y0=y({intentRequest:Kr}),X0=y({handlerFilter:wu}),Z0=ia(Y0,X0),eI=Vb(Z0,y({timeout:On})),tI=y({config:eI}),nI=y({result:rm}),rI=(t={})=>{var o,a,l;const e=!!((a=(o=t==null?void 0:t.gateway)==null?void 0:o.webPlatform)!=null&&a.port),n=d(Qg).run(t.widget);if(!n.ok)throw N.raiseError(`The provided widget config is invalid. Error: ${JSON.stringify(n.error)}`);const r=d(Yg).run(t.modals);if(!r.ok)throw N.raiseError(`The provided modals config is invalid. Error: ${JSON.stringify(r.error)}`);const i=d(nm).run(t.intentResolver);if(!i.ok)throw N.raiseError(`The provided 'intentResolver' config is invalid. Error: ${JSON.stringify(i.error)}`);return{...Jb,...t,isPlatformInternal:e,logger:((l=t.systemLogger)==null?void 0:l.level)??"info",widget:Xs(Kb,n.result??{}),modals:Xs(Qb,r.result??{}),intentResolver:Xs(Yb,i.result??{})}},iI=()=>{const t=window.glue42core||window.iobrowser;if(t&&t.webStarted)return N.raiseError("IoConnect Browser has already been started for this application.");if(!t){window.iobrowser={webStarted:!0};return}t.webStarted=!0},sI=t=>{var r;const e={windows:!0,layouts:"full",appManager:"full",channels:!0,libraries:(t==null?void 0:t.libraries)??[],logger:((r=t==null?void 0:t.systemLogger)==null?void 0:r.level)??"warn"};return(window.IODesktop||window.Glue)(e)},ae={openWindow:{name:"openWindow",dataDecoder:RC,resultDecoder:cc},windowHello:{name:"windowHello",dataDecoder:bg,resultDecoder:PC},windowAdded:{name:"windowAdded",dataDecoder:cc},windowRemoved:{name:"windowRemoved",dataDecoder:yn},getBounds:{name:"getBounds",dataDecoder:yn,resultDecoder:AC},getFrameBounds:{name:"getFrameBounds",dataDecoder:yn,resultDecoder:NC},getUrl:{name:"getUrl",dataDecoder:yn,resultDecoder:OC},moveResize:{name:"moveResize",dataDecoder:xC},focus:{name:"focus",dataDecoder:yn},close:{name:"close",dataDecoder:yn},getTitle:{name:"getTitle",dataDecoder:yn,resultDecoder:lh},setTitle:{name:"setTitle",dataDecoder:lh},focusChange:{name:"focusChange",dataDecoder:DC},getChannel:{name:"getChannel",dataDecoder:yn,resultDecoder:p0},notifyChannelsChanged:{name:"notifyChannelsChanged",dataDecoder:Gg},operationCheck:{name:"operationCheck"}};function uc(t){if(t&&t.errorHandling&&typeof t.errorHandling!="function"&&t.errorHandling!=="log"&&t.errorHandling!=="silent"&&t.errorHandling!=="throw")throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof t.errorHandling+" was passed");var e=t&&typeof t.errorHandling=="function"&&t.errorHandling,n={};function r(l,u,p){var g=n[l];return g||(g=[],n[l]=g),g.push(u),p&&setTimeout(function(){p.forEach(function(f){var I;if(!((I=n[l])===null||I===void 0)&&I.includes(u))try{Array.isArray(f)?u.apply(void 0,f):u.apply(void 0,[f])}catch(S){s(S,l)}})},0),function(){var f=n[l];f&&(f=f.reduce(function(I,S,k){return S===u&&I.length===k||I.push(S),I},[]),f.length===0?delete n[l]:n[l]=f)}}function i(l){for(var u=[],p=1;p<arguments.length;p++)u[p-1]=arguments[p];var g=n[l];if(!g||g.length===0)return[];var f=[];return g.forEach(function(I){try{var S=I.apply(void 0,u);f.push(S)}catch(k){f.push(void 0),s(k,l)}}),f}function s(l,u){var p=l instanceof Error?l:new Error(l);if(e){e(p);return}var g='[ERROR] callback-registry: User callback for key "'+u+'" failed: '+p.stack;if(t)switch(t.errorHandling){case"log":return console.error(g);case"silent":return;case"throw":throw new Error(g)}console.error(g)}function o(){n={}}function a(l){var u=n[l];u&&delete n[l]}return{add:r,execute:i,clear:o,clearKey:a}}uc.default=uc;var oI=uc,fn=lg(oI);class aI{constructor(e,n,r){c(this,"_id");c(this,"_name");c(this,"_bridge");c(this,"registry",fn());c(this,"myCtxKey");c(this,"ctxUnsubscribe");c(this,"me");this._id=e,this._name=n,this._bridge=r,this.myCtxKey=`___window___${this.id}`}get id(){return this._id.slice()}get name(){return this._name.slice()}clean(){this.ctxUnsubscribe&&this.ctxUnsubscribe()}processSelfFocusEvent(e){this.me.isFocused=e,this.registry.execute("focus-change",this.me)}processChannelsChangedEvent(e){this.registry.execute("channels-changed",e)}async toApi(){return this.ctxUnsubscribe=await this._bridge.contextLib.subscribe(this.myCtxKey,e=>this.registry.execute("context-updated",e)),this.me={id:this.id,name:this.name,isFocused:!1,getURL:this.getURL.bind(this),moveResize:this.moveResize.bind(this),resizeTo:this.resizeTo.bind(this),moveTo:this.moveTo.bind(this),focus:this.focus.bind(this),close:this.close.bind(this),getTitle:this.getTitle.bind(this),setTitle:this.setTitle.bind(this),getBounds:this.getBounds.bind(this),getContext:this.getContext.bind(this),updateContext:this.updateContext.bind(this),setContext:this.setContext.bind(this),onContextUpdated:this.onContextUpdated.bind(this),onFocusChanged:this.onFocusChanged.bind(this),getChannel:this.getChannel.bind(this),onChannelsChanged:this.onChannelsChanged.bind(this)},this.me}async getURL(){return(await this._bridge.send("windows",ae.getUrl,{windowId:this.id})).url}onFocusChanged(e){return typeof e!="function"?N.raiseError("Cannot subscribe to context changes, because the provided callback is not a function!"):this.registry.add("focus-change",e)}async moveResize(e){const n=A(MC,e),r=Object.assign({},n,{windowId:this.id,relative:!1});return await this._bridge.send("windows",ae.moveResize,r),this.me}async resizeTo(e,n){if(typeof e>"u"&&typeof n>"u")return this.me;typeof e<"u"&&A(oe,e),typeof n<"u"&&A(oe,n);const r=Object.assign({},{width:e,height:n},{windowId:this.id,relative:!0});return await this._bridge.send("windows",ae.moveResize,r),this.me}async moveTo(e,n){if(typeof e>"u"&&typeof n>"u")return this.me;typeof e<"u"&&A(ie(),e),typeof n<"u"&&A(ie(),n);const r=Object.assign({},{top:e,left:n},{windowId:this.id,relative:!0});return await this._bridge.send("windows",ae.moveResize,r),this.me}async focus(){return this.name==="Platform"?window.open(void 0,this.id):await this._bridge.send("windows",ae.focus,{windowId:this.id}),this.me}async close(){return await this._bridge.send("windows",ae.close,{windowId:this.id}),this.me}async getTitle(){return(await this._bridge.send("windows",ae.getTitle,{windowId:this.id})).title}async setTitle(e){const n=A(b,e);return await this._bridge.send("windows",ae.setTitle,{windowId:this.id,title:n}),this.me}async getBounds(){return(await this._bridge.send("windows",ae.getBounds,{windowId:this.id})).bounds}async getContext(){const e=await this._bridge.contextLib.get(this.myCtxKey),{___io___:n,...r}=e;return r}async updateContext(e){const n=A(Ao,e);return await this._bridge.contextLib.update(this.myCtxKey,n),this.me}async setContext(e){const n=A(Ao,e),r=await this._bridge.contextLib.get(this.myCtxKey),i=r.___io___?{...n,___io___:r.___io___}:n;return await this._bridge.contextLib.set(this.myCtxKey,i),this.me}onContextUpdated(e){if(typeof e!="function")return N.raiseError("Cannot subscribe to context changes, because the provided callback is not a function!");const n=r=>{const{___io___:i,...s}=r;e(s,this.me)};return this.registry.add("context-updated",n)}async getChannel(){return(await this._bridge.send("windows",ae.getChannel,{windowId:this.id},void 0,{includeOperationCheck:!0})).channel}onChannelsChanged(e){return this.registry.add("channels-changed",e)}}const im={operationCheck:{name:"operationCheck",dataDecoder:Wg,resultDecoder:jg},getWorkspaceWindowFrameBounds:{name:"getWorkspaceWindowFrameBounds",resultDecoder:YS,dataDecoder:QS}},no=(t,e,n)=>new Promise((r,i)=>{let s=!0;const o=setTimeout(()=>{if(!s)return;s=!1;const a=n||`Promise timeout hit: ${e}`;i(a)},e);t().then(a=>{s&&(s=!1,clearTimeout(o),r(a))}).catch(a=>{s&&(s=!1,clearTimeout(o),i(a))})}),sm=(t,e,n)=>new Promise((r,i)=>{const s=setTimeout(()=>{const a=n||`Promise timeout hit: ${e}`;i(a)},e);new Promise(t).then(a=>{clearTimeout(s),r(a)}).catch(a=>{clearTimeout(s),i(a)})});class lI{constructor(){c(this,"supportedOperationsNames",[]);c(this,"focusEventHandler");c(this,"registry",fn());c(this,"platformRegistration");c(this,"ioc");c(this,"bridge");c(this,"publicWindowId");c(this,"allWindowProjections",[]);c(this,"me");c(this,"logger");c(this,"isWorkspaceFrame");c(this,"instanceId");c(this,"channelsController")}async start(e,n){this.logger=e.logger.subLogger("windows.controller.web"),this.logger.trace("starting the web windows controller"),this.publicWindowId=n.publicWindowId,this.addWindowOperationExecutors(),this.ioc=n,this.bridge=n.bridge,this.instanceId=e.interop.instance.instance,this.channelsController=n.channelsController,this.logger.trace(`set the public window id: ${this.publicWindowId}, set the bridge operations and ioc, registering with the platform now`),this.platformRegistration=this.registerWithPlatform(),await this.platformRegistration,await this.initializeFocusTracking(),this.logger.trace("registration with the platform successful, attaching the windows property to glue and returning");const r=this.toApi();e.windows=r}handlePlatformShutdown(){this.registry.clear(),this.allWindowProjections=[],this.focusEventHandler&&(document.removeEventListener("visibilityChange",this.focusEventHandler),window.removeEventListener("focus",this.focusEventHandler),window.removeEventListener("blur",this.focusEventHandler))}async handleBridgeMessage(e){await this.platformRegistration;const n=A(IC,e.operation),r=ae[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}async open(e,n,r){A(b,e),A(b,n);const i=A(wg,r),s=await this.bridge.send("windows",ae.openWindow,{name:e,url:n,options:i});return this.waitForWindowAdded(s.windowId)}list(){return this.allWindowProjections.map(e=>e.api)}findById(e){var n;return A(b,e),(n=this.allWindowProjections.find(r=>r.id===e))==null?void 0:n.api}toApi(){return{open:this.open.bind(this),my:this.my.bind(this),list:this.list.bind(this),findById:this.findById.bind(this),onWindowAdded:this.onWindowAdded.bind(this),onWindowRemoved:this.onWindowRemoved.bind(this),onWindowGotFocus:this.onWindowGotFocus.bind(this),onWindowLostFocus:this.onWindowLostFocus.bind(this)}}addWindowOperationExecutors(){ae.focusChange.execute=this.handleFocusChangeEvent.bind(this),ae.windowAdded.execute=this.handleWindowAdded.bind(this),ae.windowRemoved.execute=this.handleWindowRemoved.bind(this),ae.getBounds.execute=this.handleGetBounds.bind(this),ae.getFrameBounds.execute=this.handleGetBounds.bind(this),ae.getTitle.execute=this.handleGetTitle.bind(this),ae.getUrl.execute=this.handleGetUrl.bind(this),ae.moveResize.execute=this.handleMoveResize.bind(this),ae.setTitle.execute=this.handleSetTitle.bind(this),ae.getChannel.execute=this.handleGetChannel.bind(this),ae.notifyChannelsChanged.execute=this.handleChannelsChanged.bind(this),ae.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),this.supportedOperationsNames=Un(ae)}my(){return Object.assign({},this.me)}onWindowAdded(e){return typeof e!="function"?N.raiseError("Cannot subscribe to window added, because the provided callback is not a function!"):this.registry.add("window-added",e)}onWindowRemoved(e){return typeof e!="function"?N.raiseError("Cannot subscribe to window removed, because the provided callback is not a function!"):this.registry.add("window-removed",e)}onWindowGotFocus(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onWindowGotFocus, because the provided callback is not a function!"):this.registry.add("window-got-focus",e)}onWindowLostFocus(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onWindowLostFocus, because the provided callback is not a function!"):this.registry.add("window-lost-focus",e)}async sayHello(){return await this.bridge.send("windows",ae.windowHello,{windowId:this.publicWindowId})}async registerWithPlatform(){const{windows:e,isWorkspaceFrame:n}=await this.sayHello();if(this.isWorkspaceFrame=n,this.logger.trace("the platform responded to the hello message"),!this.isWorkspaceFrame&&this.publicWindowId){this.logger.trace("i am not treated as a workspace frame, setting my window");const i=e.find(o=>o.windowId===this.publicWindowId);if(!i){const o=e.map(a=>`${a.windowId}:${a.name}`).join(", ");return N.raiseError(`Cannot initialize the window library, because I received no information about me -> id: ${this.publicWindowId} name: ${window.name} from the platform: known windows: ${o}`)}const s=await this.ioc.buildWebWindow(this.publicWindowId,i.name);this.me=s.api,this.allWindowProjections.push(s)}const r=await Promise.all(e.filter(i=>i.windowId!==this.publicWindowId).map(i=>this.ioc.buildWebWindow(i.windowId,i.name)));this.logger.trace("all windows projections are completed, building the list collection"),this.allWindowProjections.push(...r)}async handleFocusChangeEvent(e){const n=this.allWindowProjections.find(i=>i.id===e.windowId);if(!n)return;n.model.processSelfFocusEvent(e.hasFocus);const r=e.hasFocus?"window-got-focus":"window-lost-focus";this.registry.execute(r,n.api)}async handleWindowAdded(e){if(this.allWindowProjections.some(r=>r.id===e.windowId))return;const n=await this.ioc.buildWebWindow(e.windowId,e.name);this.allWindowProjections.push(n),this.registry.execute("window-added",n.api)}async handleWindowRemoved(e){const n=this.allWindowProjections.find(r=>r.id===e.windowId);n&&(this.allWindowProjections=this.allWindowProjections.filter(r=>r.id!==e.windowId),n.model.clean(),this.registry.execute("window-removed",n.api))}async handleGetBounds(){return!this.me&&!this.isWorkspaceFrame?N.raiseError("This window cannot report it's bounds, because it is not a Glue Window, most likely because it is an iframe"):{windowId:this.isWorkspaceFrame?"noop":this.me.id,bounds:{top:window.screenTop,left:window.screenLeft,width:window.innerWidth,height:window.innerHeight}}}async handleGetTitle(){return this.me?{windowId:this.me.id,title:document.title}:N.raiseError("This window cannot report it's title, because it is not a Glue Window, most likely because it is an iframe")}async handleGetUrl(){return this.me?{windowId:this.me.id,url:window.location.href}:N.raiseError("This window cannot report it's url, because it is not a Glue Window, most likely because it is an iframe")}async handleMoveResize(e){const n=typeof e.top=="number"?e.top:e.relative?0:window.screenTop,r=typeof e.left=="number"?e.left:e.relative?0:window.screenLeft,i=typeof e.height=="number"?e.height:e.relative?0:window.innerHeight,s=typeof e.width=="number"?e.width:e.relative?0:window.innerWidth,o=e.relative?window.moveBy:window.moveTo,a=e.relative?window.resizeBy:window.resizeTo;o(r,n),a(s,i)}async handleSetTitle(e){document.title=e.title}async initializeFocusTracking(){if(this.isWorkspaceFrame){this.logger.trace("Ignoring the focus tracking, because this client is a workspace frame");return}try{await this.bridge.send("windows",im.operationCheck,{operation:"focusChange"})}catch{this.logger.warn("The platform of this client is outdated and does not support focus tracking, disabling focus events for this client.");return}const e=document.hasFocus();await this.transmitFocusChange(!0),e||await this.transmitFocusChange(!1),this.defineEventListeners()}processFocusEvent(){const e=document.hasFocus();this.transmitFocusChange(e)}waitForWindowAdded(e){const n=this.allWindowProjections.find(r=>r.id===e);return n?Promise.resolve(n.api):sm(r=>{const i=this.onWindowAdded(s=>{s.id===e&&(i(),r(s))})},3e4,`Timed out waiting for ${e} to be announced`)}async transmitFocusChange(e){var r;const n={windowId:((r=this.me)==null?void 0:r.id)||`iframe-${this.instanceId}`,hasFocus:e};this.me&&(this.me.isFocused=e),await this.bridge.send("windows",ae.focusChange,n)}defineEventListeners(){this.focusEventHandler=this.processFocusEvent.bind(this),document.addEventListener("visibilityChange",this.focusEventHandler),window.addEventListener("focus",this.focusEventHandler),window.addEventListener("blur",this.focusEventHandler)}async handleGetChannel(){if(!this.me)return N.raiseError("This window cannot report it's channel, because it is not a Glue Window, most likely because it is an iframe");const e=this.channelsController.my();return{...e?{channel:e}:{}}}async handleChannelsChanged(e){const n=this.allWindowProjections.find(r=>r.id===e.windowId);n==null||n.model.processChannelsChangedEvent(e.channelNames)}}const bh="T42.Web.Platform.Control",Ch="T42.Web.Platform.Stream",Sh="T42.Web.Client.Control",Ih="T42.Core.Plus.Themes.Stream";class cI{constructor(e,n){c(this,"coreGlue");c(this,"communicationId");c(this,"platformMethodTimeoutMs",1e4);c(this,"controllers");c(this,"sub");c(this,"running");this.coreGlue=e,this.communicationId=n}get contextLib(){return this.coreGlue.contexts}get interopInstance(){return this.coreGlue.interop.instance.instance}async stop(){this.running=!1,this.sub.close(),await this.coreGlue.interop.unregister(Sh)}async start(e){this.running=!0,this.controllers=e,await Promise.all([this.checkWaitMethod(bh),this.checkWaitMethod(Ch)]);const n=this.communicationId,[r]=await Promise.all([this.coreGlue.interop.subscribe(Ch,n?{target:{instance:this.communicationId}}:void 0),this.coreGlue.interop.registerAsync(Sh,(i,s,o,a)=>this.passMessageController(i,o,a))]);this.sub=r,this.sub.onData(i=>this.passMessageController(i.data))}getInteropInstance(e){const n=this.coreGlue.interop.servers().find(r=>r.windowId&&r.windowId===e);return{application:n==null?void 0:n.application,applicationName:n==null?void 0:n.applicationName,peerId:n==null?void 0:n.peerId,instance:n==null?void 0:n.instance,windowId:n==null?void 0:n.windowId}}async send(e,n,r,i,s){if(n.dataDecoder)try{n.dataDecoder.runWithException(r)}catch(a){return N.raiseError(`Unexpected Web->Platform outgoing validation error: ${a.message}, for operation: ${n.name} and input: ${JSON.stringify(a.input)}`)}if(!(s!=null&&s.includeOperationCheck?(await this.checkOperationSupported(e,n)).isSupported:!0))return N.raiseError(`Cannot complete operation: ${n.name} for domain: ${e} because this client is connected to a platform which does not support it`);try{const a=await this.transmitMessage(e,n,r,i);return n.resultDecoder&&n.resultDecoder.runWithException(a),a}catch(a){return a!=null&&a.kind?N.raiseError(`Unexpected Web<-Platform incoming validation error: ${a.message}, for operation: ${n.name} and input: ${JSON.stringify(a.input)}`):N.raiseError(a)}}async createNotificationsSteam(){return this.coreGlue.interop.methods().some(n=>n.name===Ih)?this.coreGlue.interop.subscribe(Ih,this.communicationId?{target:{instance:this.communicationId}}:void 0):N.raiseError("Cannot subscribe to theme changes, because the underlying interop stream does not exist. Most likely this is the case when this client is not connected to Core Plus.")}async checkOperationSupported(e,n){try{return await this.send(e,im.operationCheck,{operation:n.name})}catch{return{isSupported:!1}}}checkWaitMethod(e){return sm(n=>{if(this.coreGlue.interop.methods().some(s=>{const o=s.name===e,a=this.communicationId?s.getServers().some(l=>l.instance===this.communicationId):!0;return o&&a}))return n();const i=this.coreGlue.interop.serverMethodAdded(s=>{const o=s.method,a=s.server,l=this.communicationId?a.instance===this.communicationId:!0;o.name===e&&l&&(i(),n())})},this.platformMethodTimeoutMs,`Cannot initiate Glue Web, because a system method's discovery timed out: ${e}`)}passMessageController(e,n,r){const i=SC.run(e.domain);if(!i.ok){r&&r(`Cannot execute this client control, because of domain validation error: ${JSON.stringify(i.error)}`);return}const s=i.result;this.controllers[s].handleBridgeMessage(e).then(o=>{n&&n(o)}).catch(o=>{r&&r(o),console.warn(o)})}async transmitMessage(e,n,r,i){const s={domain:e,data:r,operation:n.name};let o;const a=`Internal Platform Communication Error. Attempted operation: ${JSON.stringify(n.name)} with data: ${JSON.stringify(r)}. `,l=this.communicationId;try{if(!this.running)throw new Error("Cannot send a control message, because the platform shut down");if(o=await this.coreGlue.interop.invoke(bh,s,l?{instance:this.communicationId}:void 0,i),!o)throw new Error("Received unsupported result from the platform - empty result");if(!Array.isArray(o.all_return_values)||o.all_return_values.length===0)throw new Error("Received unsupported result from the platform - empty values collection")}catch(u){if(u&&u.all_errors&&u.all_errors.length){const p=u.all_errors[0].message;throw new Error(`${a} -> Inner message: ${p}`)}throw new Error(`${a} -> Inner message: ${u.message}`)}return o.all_return_values[0].returned}}const at={appHello:{name:"appHello",dataDecoder:bg,resultDecoder:qC},appDirectoryStateChange:{name:"appDirectoryStateChange",dataDecoder:GC},instanceStarted:{name:"instanceStarted",dataDecoder:eo},instanceStopped:{name:"instanceStopped",dataDecoder:eo},applicationStart:{name:"applicationStart",dataDecoder:wS,resultDecoder:eo},instanceStop:{name:"instanceStop",dataDecoder:VC},import:{name:"import"},remove:{name:"remove",dataDecoder:zC},export:{name:"export",resultDecoder:BC},clear:{name:"clear"},operationCheck:{name:"operationCheck"}};class uI{constructor(){c(this,"me");c(this,"supportedOperationsNames",[]);c(this,"baseApplicationsTimeoutMS",6e4);c(this,"appImportTimeoutMS",20);c(this,"registry",fn());c(this,"ioc");c(this,"bridge");c(this,"publicWindowId");c(this,"applications",[]);c(this,"instances",[]);c(this,"platformRegistration");c(this,"logger");c(this,"channelsController");c(this,"sessionController");c(this,"interop")}handlePlatformShutdown(){this.registry.clear(),this.applications=[],this.instances=[],delete this.me}async start(e,n){this.logger=e.logger.subLogger("appManger.controller.web"),this.logger.trace("starting the web appManager controller"),this.publicWindowId=n.publicWindowId,this.addOperationsExecutors(),this.ioc=n,this.bridge=n.bridge,this.channelsController=n.channelsController,this.sessionController=n.sessionController,this.interop=e.interop,this.platformRegistration=this.registerWithPlatform(),await this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the appManager property to glue and returning");const r=this.toApi();e.appManager=r}async handleBridgeMessage(e){await this.platformRegistration;const n=A(_C,e.operation),r=at[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}onInstanceStarted(e){return typeof e!="function"?N.raiseError("onInstanceStarted requires a single argument of type function"):this.registry.add("instance-started",e,this.instances)}onInstanceStopped(e){return typeof e!="function"?N.raiseError("onInstanceStopped requires a single argument of type function"):this.registry.add("instance-stopped",e)}async startApplication(e,n,r){var l;const i=await this.channelsController.all();if(r!=null&&r.channelId&&!i.includes(r.channelId))return N.raiseError(`The channel with name "${r.channelId}" doesn't exist!`);const s={name:e,waitForAGMReady:(r==null?void 0:r.waitForAGMReady)??!0,context:n,top:r==null?void 0:r.top,left:r==null?void 0:r.left,width:r==null?void 0:r.width,height:r==null?void 0:r.height,relativeTo:r==null?void 0:r.relativeTo,relativeDirection:r==null?void 0:r.relativeDirection,id:r==null?void 0:r.reuseId,forceChromeTab:r==null?void 0:r.forceTab,layoutComponentId:r==null?void 0:r.layoutComponentId,channelId:r==null?void 0:r.channelId,startReason:{originApp:{name:(l=this.me)==null?void 0:l.application.name,interopInstance:this.interop.instance.instance}}};r!=null&&r.originIntentRequest&&(s.startReason.intentRequest=r.originIntentRequest);const o=await this.bridge.send("appManager",at.applicationStart,s),a=this.applications.find(u=>u.name===o.applicationName);return this.ioc.buildInstance(o,a)}getApplication(e){const n=A(b,e);return this.applications.find(r=>r.name===n)}getInstances(){return this.instances.slice()}onAppAdded(e){return typeof e!="function"?N.raiseError("onAppAdded requires a single argument of type function"):this.registry.add("application-added",e,this.applications)}onAppRemoved(e){return typeof e!="function"?N.raiseError("onAppRemoved requires a single argument of type function"):this.registry.add("application-removed",e)}toApi(){return{myInstance:this.me,inMemory:{import:this.importApps.bind(this),remove:this.remove.bind(this),export:this.exportApps.bind(this),clear:this.clear.bind(this)},application:this.getApplication.bind(this),applications:this.getApplications.bind(this),instances:this.getInstances.bind(this),onAppAdded:this.onAppAdded.bind(this),onAppChanged:this.onAppChanged.bind(this),onAppRemoved:this.onAppRemoved.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)}}addOperationsExecutors(){at.appDirectoryStateChange.execute=this.handleAppDirectoryStateChange.bind(this),at.instanceStarted.execute=this.handleInstanceStartedMessage.bind(this),at.instanceStopped.execute=this.handleInstanceStoppedMessage.bind(this),at.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),this.supportedOperationsNames=Un(at)}async handleAppDirectoryStateChange(e){e.appsAdded.forEach(this.handleApplicationAddedMessage.bind(this)),e.appsChanged.forEach(this.handleApplicationChangedMessage.bind(this)),e.appsRemoved.forEach(this.handleApplicationRemovedMessage.bind(this))}onAppChanged(e){return typeof e!="function"?N.raiseError("onAppChanged requires a single argument of type function"):this.registry.add("application-changed",e)}async handleApplicationAddedMessage(e){if(this.applications.some(i=>i.name===e.name))return;const n=await this.ioc.buildApplication(e,[]),r=this.instances.filter(i=>i.application.name===n.name);n.instances.push(...r),this.applications.push(n),this.registry.execute("application-added",n)}async handleApplicationRemovedMessage(e){const n=this.applications.findIndex(i=>i.name===e.name);if(n<0)return;const r=this.applications[n];this.applications.splice(n,1),this.registry.execute("application-removed",r)}async handleApplicationChangedMessage(e){const n=this.applications.find(r=>r.name===e.name);if(!n)return this.handleApplicationAddedMessage(e);n.title=e.title,n.version=e.version,n.icon=e.icon,n.caption=e.caption,n.userProperties=e.userProperties,this.registry.execute("application-changed",n)}async handleInstanceStartedMessage(e){if(this.instances.some(i=>i.id===e.id))return;const n=this.applications.find(i=>i.name===e.applicationName);if(!n)return N.raiseError(`Cannot add instance: ${e.id}, because there is no application definition associated with it`);const r=this.ioc.buildInstance(e,n);this.instances.push(r),n.instances.push(r),this.registry.execute("instance-started",r)}async handleInstanceStoppedMessage(e){const n=this.instances.find(i=>i.id===e.id);if(n){const i=this.instances.findIndex(s=>s.id===e.id);this.instances.splice(i,1)}const r=this.applications.find(i=>i.instances.some(s=>s.id===e.id));if(r){const i=r.instances.findIndex(s=>s.id===e.id);r.instances.splice(i,1)}n&&this.registry.execute("instance-stopped",n)}async importApps(e,n="replace"){if(A(vu,n),!Array.isArray(e))return N.raiseError("Import must be called with an array of definitions");if(e.length>1e4)return N.raiseError("Cannot import more than 10000 app definitions in Glue42 Core.");const r=e.reduce((s,o)=>{const{isValid:a,error:l}=this.isValidDefinition(o);return a?s.valid.push(o):s.invalid.push({app:o==null?void 0:o.name,error:l??`Provided definition is invalid ${JSON.stringify(o)}`}),s},{valid:[],invalid:[]}),i=this.baseApplicationsTimeoutMS+this.appImportTimeoutMS*r.valid.length;return await this.bridge.send("appManager",at.import,{definitions:r.valid,mode:n},{methodResponseTimeoutMs:i}),{imported:r.valid.map(s=>s.name),errors:r.invalid}}isValidDefinition(e){if((e==null?void 0:e.appId)&&(e==null?void 0:e.details)){const s=ar.fdc3.v2DefinitionDecoder.run(e);return{isValid:s.ok,error:s.ok?void 0:`Received invalid FDC3 v2 definition. Error: ${JSON.stringify(s.error)}`}}if((e==null?void 0:e.appId)&&(e==null?void 0:e.manifest)){const s=ar.fdc3.v1DefinitionDecoder.run(e);return{isValid:s.ok,error:s.ok?void 0:`Received invalid FDC3 v1 definition. Error: ${JSON.stringify(s.error)}`}}const i=pu.run(e);return{isValid:i.ok,error:i.ok?void 0:`Received invalid definition. Error: ${JSON.stringify(i.error)}`}}async remove(e){A(b,e),await this.bridge.send("appManager",at.remove,{name:e},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}async clear(){await this.bridge.send("appManager",at.clear,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}async exportApps(){return(await this.bridge.send("appManager",at.export,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})).definitions}getApplications(){return this.applications.slice()}async joinInitialChannel(e){try{await this.channelsController.join(e)}catch(n){this.logger.warn(`Application instance ${this.me} was unable to join the ${e} channel. Reason: ${JSON.stringify(n)}`)}}async registerWithPlatform(){const e=await this.bridge.send("appManager",at.appHello,{windowId:this.publicWindowId},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});this.logger.trace("the platform responded to the hello message with a full list of apps"),this.applications=await Promise.all(e.apps.map(i=>this.ioc.buildApplication(i,i.instances))),this.instances=this.applications.reduce((i,s)=>(i.push(...s.instances),i),[]),this.me=this.findMyInstance(),this.logger.trace(`all applications were parsed and saved. I am ${this.me?"NOT a":"a"} valid instance`);const{channels:n}=this.sessionController.getWindowData(),r=n?n.currentNames:[e.initialChannelId];r!=null&&r.length&&await Promise.all(r.map(i=>i?this.joinInitialChannel(i):Promise.resolve()))}findMyInstance(){for(const e of this.applications){const n=e.instances.find(r=>r.id===this.publicWindowId);if(n)return n}}}class dI{constructor(e,n,r){c(this,"data");c(this,"bridge");c(this,"application");c(this,"me");c(this,"myCtxKey");this.data=e,this.bridge=n,this.application=r,this.myCtxKey=`___instance___${this.data.id}`}toApi(){const e=this.bridge.getInteropInstance(this.data.id),n={id:this.data.id,agm:e,application:this.application,stop:this.stop.bind(this),getContext:this.getContext.bind(this)};return this.me=Object.freeze(n),this.me}async getContext(){return this.bridge.contextLib.get(this.myCtxKey)}async stop(){await this.bridge.send("appManager",at.instanceStop,{id:this.data.id})}}class hI{constructor(e,n,r){c(this,"data");c(this,"instances");c(this,"controller");c(this,"me");this.data=e,this.instances=n,this.controller=r}toApi(){const e={name:this.data.name,title:this.data.title,version:this.data.version,icon:this.data.icon,caption:this.data.caption,userProperties:this.data.userProperties,instances:this.instances,start:this.start.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return this.me=e,this.me}onInstanceStarted(e){return typeof e!="function"?N.raiseError("OnInstanceStarted requires a single argument of type function"):this.controller.onInstanceStarted(n=>{n.application.name===this.data.name&&e(n)})}onInstanceStopped(e){return typeof e!="function"?N.raiseError("OnInstanceStarted requires a single argument of type function"):this.controller.onInstanceStopped(n=>{n.application.name===this.data.name&&e(n)})}async start(e,n){const r=A(u0,e),i=A(d0,n);return this.controller.startApplication(this.data.name,r,i)}}const te={layoutAdded:{name:"layoutAdded",dataDecoder:ut},layoutChanged:{name:"layoutChanged",dataDecoder:ut},layoutRemoved:{name:"layoutRemoved",dataDecoder:ut},layoutRestored:{name:"layoutRestored",dataDecoder:ut},defaultLayoutChanged:{name:"defaultLayoutChanged",dataDecoder:iS},layoutRenamed:{name:"layoutRenamed",dataDecoder:QC},get:{name:"get",dataDecoder:ch,resultDecoder:Xa},getAll:{name:"getAll",dataDecoder:uh,resultDecoder:oS},export:{name:"export",dataDecoder:uh,resultDecoder:rS},import:{name:"import",dataDecoder:sS},remove:{name:"remove",dataDecoder:ch},rename:{name:"rename",dataDecoder:ZC,resultDecoder:eS},save:{name:"save",dataDecoder:XC,resultDecoder:aS},restore:{name:"restore",dataDecoder:nS},clientSaveRequest:{name:"clientSaveRequest",dataDecoder:VS,resultDecoder:JS},getGlobalPermissionState:{name:"getGlobalPermissionState",resultDecoder:KS},requestGlobalPermission:{name:"requestGlobalPermission",resultDecoder:yh},checkGlobalActivated:{name:"checkGlobalActivated",resultDecoder:yh},getDefaultGlobal:{name:"getDefaultGlobal",resultDecoder:Xa},setDefaultGlobal:{name:"setDefaultGlobal",dataDecoder:lS},clearDefaultGlobal:{name:"clearDefaultGlobal"},getCurrent:{name:"getCurrent",resultDecoder:Xa},updateMetadata:{name:"updateMetadata",dataDecoder:tS},operationCheck:{name:"operationCheck"}};class fI{constructor(){c(this,"supportedOperationsNames",[]);c(this,"defaultLayoutRestoreTimeoutMS",12e4);c(this,"registry",fn());c(this,"bridge");c(this,"logger");c(this,"windowsController");c(this,"saveRequestSubscription")}handlePlatformShutdown(){this.registry.clear()}async start(e,n){this.logger=e.logger.subLogger("layouts.controller.web"),this.logger.trace("starting the web layouts controller"),this.bridge=n.bridge,this.windowsController=n.windowsController,this.addOperationsExecutors();const r=this.toApi();this.logger.trace("no need for platform registration, attaching the layouts property to glue and returning"),e.layouts=r}async handleBridgeMessage(e){const n=A(EC,e.operation),r=te[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}toApi(){const e={get:this.get.bind(this),getAll:this.getAll.bind(this),getCurrentLayout:this.getCurrentLayout.bind(this),export:this.exportLayouts.bind(this),import:this.importLayouts.bind(this),save:this.save.bind(this),restore:this.restore.bind(this),remove:this.remove.bind(this),onAdded:this.onAdded.bind(this),onChanged:this.onChanged.bind(this),onRemoved:this.onRemoved.bind(this),onDefaultGlobalChanged:this.onDefaultGlobalChanged.bind(this),onSaveRequested:this.subscribeOnSaveRequested.bind(this),getMultiScreenPermissionState:this.getGlobalPermissionState.bind(this),requestMultiScreenPermission:this.requestGlobalPermission.bind(this),getGlobalTypeState:this.checkGlobalActivated.bind(this),getDefaultGlobal:this.getDefaultGlobal.bind(this),setDefaultGlobal:this.setDefaultGlobal.bind(this),clearDefaultGlobal:this.clearDefaultGlobal.bind(this),rename:this.rename.bind(this),onRenamed:this.onRenamed.bind(this),onRestored:this.onRestored.bind(this),updateMetadata:this.updateMetadata.bind(this)};return Object.freeze(e)}addOperationsExecutors(){te.layoutAdded.execute=this.handleOnAdded.bind(this),te.layoutChanged.execute=this.handleOnChanged.bind(this),te.layoutRemoved.execute=this.handleOnRemoved.bind(this),te.layoutRenamed.execute=this.handleOnRenamed.bind(this),te.layoutRestored.execute=this.handleOnRestored.bind(this),te.defaultLayoutChanged.execute=this.handleOnDefaultChanged.bind(this),te.clientSaveRequest.execute=this.handleSaveRequest.bind(this),te.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),this.supportedOperationsNames=Un(te)}async get(e,n){return A(b,e),A(on,n),(await this.bridge.send("layouts",te.get,{name:e,type:n})).layout}async getCurrentLayout(){return(await this.bridge.send("layouts",te.getCurrent,void 0)).layout}async getAll(e){return A(on,e),(await this.bridge.send("layouts",te.getAll,{type:e})).summaries}async exportLayouts(e){return A(on,e),(await this.bridge.send("layouts",te.export,{type:e})).layouts}async importLayouts(e,n="replace"){if(A(vu,n),!Array.isArray(e))return N.raiseError("Import must be called with an array of layouts");if(e.length>1e3)return N.raiseError("Cannot import more than 1000 layouts at once in Glue42 Core.");const r=e.reduce((s,o)=>{const a=ut.run(o);return a.ok?s.valid.push(o):this.logger.warn(`A layout with name: ${o.name} was not imported, because of error: ${JSON.stringify(a.error)}`),s},{valid:[]}),i=e.filter(s=>r.valid.some(o=>o.name===s.name));await this.bridge.send("layouts",te.import,{layouts:i,mode:n})}async save(e){return A(Tg,e),(await this.bridge.send("layouts",te.save,{layout:e})).layout}async restore(e){A(Rg,e);const n=e.timeout?e.timeout*2:this.defaultLayoutRestoreTimeoutMS;await this.bridge.send("layouts",te.restore,{layout:e},{methodResponseTimeoutMs:n})}async remove(e,n){A(on,e),A(b,n),await this.bridge.send("layouts",te.remove,{type:e,name:n})}async handleSaveRequest(e){const n={};if(this.saveRequestSubscription)try{const r=this.saveRequestSubscription(e);n.windowContext=r==null?void 0:r.windowContext}catch(r){this.logger.warn(`An error was thrown by the onSaveRequested callback, ignoring the callback: ${JSON.stringify(r)}`)}return n}async getGlobalPermissionState(){return await this.bridge.send("layouts",te.getGlobalPermissionState,void 0)}async requestGlobalPermission(){const e=(await this.getGlobalPermissionState()).state;if(e==="denied")return{permissionGranted:!1};if(e==="granted")return{permissionGranted:!0};const n=this.windowsController.my(),i=(window.glue42core||window.iobrowser).isPlatformFrame;return n.name!=="Platform"&&!i?N.raiseError("Cannot request permission for multi-window placement from any app other than the Platform."):{permissionGranted:(await this.bridge.send("layouts",te.requestGlobalPermission,void 0,{methodResponseTimeoutMs:18e4})).isAvailable}}async checkGlobalActivated(){return{activated:(await this.bridge.send("layouts",te.checkGlobalActivated,void 0)).isAvailable}}async getDefaultGlobal(){return(await this.bridge.send("layouts",te.getDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})).layout}async setDefaultGlobal(e){A(b,e),await this.bridge.send("layouts",te.setDefaultGlobal,{name:e},void 0,{includeOperationCheck:!0})}async clearDefaultGlobal(){await this.bridge.send("layouts",te.clearDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})}async rename(e,n){return A(ut,e),A(b,n),await this.bridge.send("layouts",te.rename,{layout:e,newName:n},void 0,{includeOperationCheck:!0})}async updateMetadata(e){A(ut,e),await this.bridge.send("layouts",te.updateMetadata,{layout:e},void 0,{includeOperationCheck:!0})}onAdded(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onAdded, because the provided callback is not a function!"):(this.exportLayouts("Global").then(n=>n.forEach(r=>e(r))).catch(()=>{}),this.exportLayouts("Workspace").then(n=>n.forEach(r=>e(r))).catch(()=>{}),this.registry.add(te.layoutAdded.name,e))}onChanged(e){return this.registry.add(te.layoutChanged.name,e)}onDefaultGlobalChanged(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onDefaultGlobalChanged, because the provided callback is not a function!"):(this.getDefaultGlobal().then(n=>e(n?{name:n.name}:void 0)).catch(()=>{}),this.registry.add(te.defaultLayoutChanged.name,e))}onRemoved(e){return this.registry.add(te.layoutRemoved.name,e)}onRenamed(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onRenamed, because the provided callback is not a function!"):this.registry.add(te.layoutRenamed.name,e)}onRestored(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onRestored, because the provided callback is not a function!"):this.registry.add(te.layoutRestored.name,e)}subscribeOnSaveRequested(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onSaveRequested, because the provided argument is not a valid callback function."):this.saveRequestSubscription?N.raiseError("Cannot subscribe to onSaveRequested, because this client has already subscribed and only one subscription is supported. Consider unsubscribing from the initial one."):(this.saveRequestSubscription=e,()=>{delete this.saveRequestSubscription})}async handleOnAdded(e){this.registry.execute(te.layoutAdded.name,e)}async handleOnChanged(e){this.registry.execute(te.layoutChanged.name,e)}async handleOnDefaultChanged(e){this.registry.execute(te.defaultLayoutChanged.name,e)}async handleOnRemoved(e){this.registry.execute(te.layoutRemoved.name,e)}async handleOnRestored(e){this.registry.execute(te.layoutRestored.name,e)}async handleOnRenamed(e){const{prevName:n,...r}=e;this.registry.execute(te.layoutRenamed.name,r,{name:n})}}const fe={raiseNotification:{name:"raiseNotification",dataDecoder:zS,resultDecoder:BS},requestPermission:{name:"requestPermission",resultDecoder:HS},notificationShow:{name:"notificationShow",dataDecoder:gh},notificationClick:{name:"notificationClick",dataDecoder:gh},getPermission:{name:"getPermission",resultDecoder:GS},list:{name:"list",resultDecoder:t0},notificationRaised:{name:"notificationRaised",dataDecoder:e0},notificationClosed:{name:"notificationClosed",dataDecoder:n0},click:{name:"click"},clear:{name:"clear"},clearAll:{name:"clearAll"},clearOld:{name:"clearOld"},configure:{name:"configure",dataDecoder:qS},getConfiguration:{name:"getConfiguration",resultDecoder:mh},getActiveCount:{name:"getActiveCount",resultDecoder:fh},configurationChanged:{name:"configurationChanged",resultDecoder:mh},setState:{name:"setState",dataDecoder:ph},activeCountChange:{name:"activeCountChange",resultDecoder:fh},stateChange:{name:"stateChange",resultDecoder:ph},operationCheck:{name:"operationCheck"}};let pI="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",om=(t=21)=>{let e="",n=t|0;for(;n--;)e+=pI[Math.random()*64|0];return e};class gI{constructor(){c(this,"supportedOperationsNames",[]);c(this,"registry",fn());c(this,"logger");c(this,"bridge");c(this,"notificationsSettings");c(this,"notifications",{});c(this,"coreGlue");c(this,"buildNotificationFunc");c(this,"notificationsConfiguration");c(this,"notificationsActiveCount",0)}handlePlatformShutdown(){this.notifications={},this.registry.clear()}async start(e,n){this.logger=e.logger.subLogger("notifications.controller.web"),this.logger.trace("starting the web notifications controller"),this.bridge=n.bridge,this.coreGlue=e,this.notificationsSettings=n.config.notifications,this.buildNotificationFunc=n.buildNotification,this.notificationsConfiguration=await this.getConfiguration(),this.notificationsActiveCount=await this.getActiveCount();const r=this.toApi();this.addOperationExecutors(),e.notifications=r,this.logger.trace("notifications are ready")}async handleBridgeMessage(e){const n=A(kC,e.operation),r=fe[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}toApi(){const e={raise:this.raise.bind(this),requestPermission:this.requestPermission.bind(this),getPermission:this.getPermission.bind(this),list:this.list.bind(this),onRaised:this.onRaised.bind(this),onClosed:this.onClosed.bind(this),click:this.click.bind(this),clear:this.clear.bind(this),clearAll:this.clearAll.bind(this),clearOld:this.clearOld.bind(this),configure:this.configure.bind(this),getConfiguration:this.getConfiguration.bind(this),getFilter:this.getFilter.bind(this),setFilter:this.setFilter.bind(this),setState:this.setState.bind(this),onConfigurationChanged:this.onConfigurationChanged.bind(this),onActiveCountChanged:this.onActiveCountChanged.bind(this),onCounterChanged:this.onActiveCountChanged.bind(this),onStateChanged:this.onStateChanged.bind(this)};return Object.freeze(e)}async getPermission(){return(await this.bridge.send("notifications",fe.getPermission,void 0)).permission}async requestPermission(){return(await this.bridge.send("notifications",fe.requestPermission,void 0)).permissionGranted}async raise(e){const n=A(Cu,e);if(n.showToast=typeof n.showToast=="boolean"?n.showToast:!0,n.showInPanel=typeof n.showInPanel=="boolean"?n.showInPanel:!0,!await this.requestPermission())return N.raiseError("Cannot raise the notification, because the user has declined the permission request");const i=om(10),s=await this.bridge.send("notifications",fe.raiseNotification,{settings:n,id:i}),o=this.buildNotificationFunc(s.settings,i);return this.notifications[i]=o,o}async list(){return(await this.bridge.send("notifications",fe.list,void 0,void 0,{includeOperationCheck:!0})).notifications}onRaised(e){return typeof e!="function"?N.raiseError("onRaised expects a callback of type function"):this.registry.add("notification-raised",e)}onClosed(e){return typeof e!="function"?N.raiseError("onClosed expects a callback of type function"):this.registry.add("notification-closed",e)}async click(e,n){A(b,e),n&&A(b,n),await this.bridge.send("notifications",fe.click,{id:e,action:n},void 0,{includeOperationCheck:!0})}async clear(e){A(b,e),await this.bridge.send("notifications",fe.clear,{id:e},void 0,{includeOperationCheck:!0})}async clearAll(){await this.bridge.send("notifications",fe.clearAll,void 0,void 0,{includeOperationCheck:!0})}async clearOld(){await this.bridge.send("notifications",fe.clearOld,void 0,void 0,{includeOperationCheck:!0})}async configure(e){const n=A($g,e);await this.bridge.send("notifications",fe.configure,{configuration:n},void 0,{includeOperationCheck:!0})}async getConfiguration(){return(await this.bridge.send("notifications",fe.getConfiguration,void 0,void 0,{includeOperationCheck:!0})).configuration}async getActiveCount(){try{return(await this.bridge.send("notifications",fe.getActiveCount,void 0,void 0,{includeOperationCheck:!0})).count}catch(e){return console.warn("Failed to get accurate active notifications count",e),0}}async getFilter(){return(await this.bridge.send("notifications",fe.getConfiguration,void 0,void 0,{includeOperationCheck:!0})).configuration.sourceFilter}async setFilter(e){const n=A(Fg,e);return await this.bridge.send("notifications",fe.configure,{configuration:{sourceFilter:n}},void 0,{includeOperationCheck:!0}),n}async setState(e,n){A(b,e),A(aa,n),await this.bridge.send("notifications",fe.setState,{id:e,state:n},void 0,{includeOperationCheck:!0})}onConfigurationChanged(e){return typeof e!="function"?N.raiseError("Cannot subscribe to configuration changed, because the provided callback is not a function!"):(setTimeout(()=>e(this.notificationsConfiguration),0),this.registry.add("notifications-config-changed",e))}onActiveCountChanged(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onActiveCountChanged changed, because the provided callback is not a function!"):(setTimeout(()=>e({count:this.notificationsActiveCount}),0),this.registry.add("notifications-active-count-changed",e))}onStateChanged(e){return typeof e!="function"?N.raiseError("Cannot subscribe to onStateChanged changed, because the provided callback is not a function!"):this.registry.add("notification-state-changed",e)}addOperationExecutors(){fe.notificationShow.execute=this.handleNotificationShow.bind(this),fe.notificationClick.execute=this.handleNotificationClick.bind(this),fe.notificationRaised.execute=this.handleNotificationRaised.bind(this),fe.notificationClosed.execute=this.handleNotificationClosed.bind(this),fe.configurationChanged.execute=this.handleConfigurationChanged.bind(this),fe.activeCountChange.execute=this.handleActiveCountChanged.bind(this),fe.stateChange.execute=this.handleNotificationStateChanged.bind(this),fe.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),this.supportedOperationsNames=Un(fe)}async handleConfigurationChanged(e){this.notificationsConfiguration=e.configuration,this.registry.execute("notifications-config-changed",e.configuration)}async handleActiveCountChanged(e){this.notificationsActiveCount=e.count,this.registry.execute("notifications-active-count-changed",e)}async handleNotificationStateChanged(e){this.registry.execute("notification-state-changed",{id:e.id},e.state)}async handleNotificationShow(e){if(!e.id)return;const n=this.notifications[e.id];n&&n.onshow&&n.onshow()}async handleNotificationClick(e){var r,i,s,o,a;if(!e.action&&((r=this.notificationsSettings)!=null&&r.defaultClick)&&this.notificationsSettings.defaultClick(this.coreGlue,e.definition),e.action&&((s=(i=this.notificationsSettings)==null?void 0:i.actionClicks)!=null&&s.some(l=>l.action===e.action))&&((a=(o=this.notificationsSettings)==null?void 0:o.actionClicks)==null?void 0:a.find(u=>u.action===e.action)).handler(this.coreGlue,e.definition),!e.id)return;const n=this.notifications[e.id];n&&n.onclick&&(n.onclick(),delete this.notifications[e.id])}async handleNotificationRaised(e){this.registry.execute("notification-raised",e.notification)}async handleNotificationClosed(e){this.registry.execute("notification-closed",e)}}const Vn={getIntents:{name:"getIntents",resultDecoder:dh},findIntent:{name:"findIntent",dataDecoder:gS,resultDecoder:dh},raise:{name:"raise",dataDecoder:CS,resultDecoder:SS},filterHandlers:{name:"filterHandlers",dataDecoder:_S,resultDecoder:IS},getIntentsByHandler:{name:"getIntentsByHandler",dataDecoder:Bn,resultDecoder:TS}},Za="Tick42.FDC3.Intents.",mI="intentsResolver",_h=60*1e3,Eh=30*1e3,kh=90*1e3;class yI{constructor(){c(this,"bridge");c(this,"logger");c(this,"interop");c(this,"appManagerController");c(this,"windowsController");c(this,"myIntents",new Set);c(this,"prefsController");c(this,"uiController");c(this,"useIntentsResolverUI",!0);c(this,"intentsResolverAppName");c(this,"intentResolverResponseTimeout",_h);c(this,"unregisterIntentPromises",[])}async start(e,n){this.logger=e.logger.subLogger("intents.controller.web"),this.logger.trace("starting the web intents controller"),this.bridge=n.bridge,this.interop=e.interop,this.appManagerController=n.appManagerController,this.windowsController=n.windowsController,this.prefsController=n.prefsController,this.uiController=n.uiController,this.checkIfIntentsResolverIsEnabled(n.config);const r=this.toApi();this.logger.trace("no need for platform registration, attaching the intents property to glue and returning"),e.intents=r}handlePlatformShutdown(){this.myIntents=new Set,this.unregisterIntentPromises=[]}async handleBridgeMessage(e){const n=A(cS,e.operation),r=Vn[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}toApi(){return{raise:this.raise.bind(this),all:this.all.bind(this),addIntentListener:this.addIntentListener.bind(this),register:this.register.bind(this),find:this.find.bind(this),filterHandlers:this.filterHandlers.bind(this),getIntents:this.getIntentsByHandler.bind(this),clearSavedHandlers:this.clearSavedHandlers.bind(this),onHandlerAdded:this.onHandlerAdded.bind(this),onHandlerRemoved:this.onHandlerRemoved.bind(this)}}async raise(e){const n=A(bS,e),r=typeof n=="string"?{intent:n}:n;await Promise.all(this.unregisterIntentPromises),r.clearSavedHandler&&(this.logger.trace(`User removes saved handler for intent ${r.intent}`),await this.removeRememberedHandler(r.intent));const i=await this.checkHandleRaiseWithRememberedHandler(r);if(i)return i;const s={intentRequest:r,resolverConfig:this.getLegacyResolverConfigByRequest({intentRequest:r}),embeddedResolverConfig:this.getEmbeddedResolverConfig()},o=r.waitUserResponseIndefinitely?nc:(r.timeout||this.intentResolverResponseTimeout)+Eh;this.logger.trace(`Sending raise request to the platform: ${JSON.stringify(e)} and method response timeout of ${o}ms`);const a=await this.bridge.send("intents",Vn.raise,s,{methodResponseTimeoutMs:o,waitTimeoutMs:o});return this.logger.trace(`Raise operation completed with response: ${JSON.stringify(a)}`),a}getLegacyResolverConfigByRequest(e){var r,i,s,o;if(e.handlerFilter)return{enabled:typeof((r=e.handlerFilter)==null?void 0:r.openResolver)=="boolean"?(i=e.handlerFilter)==null?void 0:i.openResolver:this.useIntentsResolverUI,appName:this.intentsResolverAppName,waitResponseTimeout:((s=e.handlerFilter)==null?void 0:s.timeout)||kh};const n=(o=e.intentRequest)!=null&&o.waitUserResponseIndefinitely?nc:this.intentResolverResponseTimeout;return{enabled:this.useIntentsResolverUI,appName:this.intentsResolverAppName,waitResponseTimeout:n}}getEmbeddedResolverConfig(){return{enabled:this.uiController.isIntentResolverEnabled(),initialCaller:{instanceId:this.interop.instance.instance}}}async all(){return await Promise.all(this.unregisterIntentPromises),(await this.bridge.send("intents",Vn.getIntents,void 0)).intents}addIntentListener(e,n){if(A(hh,e),typeof n!="function")return N.raiseError("Cannot add intent listener, because the provided handler is not a function!");let r;const i=typeof e=="string"?e:e.intent,s=this.buildInteropMethodName(i);if(this.myIntents.has(i))return N.raiseError(`Intent listener for intent ${i} already registered!`);this.myIntents.add(i);const a={unsubscribe:()=>{this.myIntents.delete(i),r.then(()=>this.interop.unregister(s)).catch(u=>this.logger.trace(`Unregistration of a method with name ${s} failed with reason: ${u}`))}};let l={};if(typeof e=="object"){const{intent:u,...p}=e;l=p}return r=this.interop.register({name:s,flags:{intent:l}},u=>{if(this.myIntents.has(i)){const{_initialCallerId:p,...g}=u;return n(g)}}),r.catch(u=>{this.myIntents.delete(i),this.logger.warn(`Registration of a method with name ${s} failed with reason: ${u}`)}),a}async register(e,n){if(A(hh,e),typeof n!="function")return N.raiseError("Cannot add intent listener, because the provided handler is not a function!");await Promise.all(this.unregisterIntentPromises);const r=typeof e=="string"?e:e.intent,i=this.buildInteropMethodName(r);if(this.myIntents.has(r))return N.raiseError(`Intent listener for intent ${r} already registered!`);this.myIntents.add(r);let o={};if(typeof e=="object"){const{intent:a,...l}=e;o=l}try{await this.interop.register({name:i,flags:{intent:o}},a=>{if(this.myIntents.has(r)){const{_initialCallerId:l,...u}=a,p=this.interop.servers().find(g=>g.instance===l);return n(u,p)}})}catch(a){return this.myIntents.delete(r),N.raiseError(`Registration of a method with name ${i} failed with reason: ${JSON.stringify(a)}`)}return{unsubscribe:()=>this.unsubscribeIntent(r)}}async find(e){let n;if(typeof e<"u"){const i=A(pS,e);typeof i=="string"?n={filter:{name:i}}:typeof i=="object"&&(n={filter:i})}return await Promise.all(this.unregisterIntentPromises),(await this.bridge.send("intents",Vn.findIntent,n)).intents}onHandlerAdded(e){if(typeof e!="function")return N.raiseError("Cannot subscribe for 'onHandlerAdded' event - callback is not a function!");const n=this.subscribeForAppEvent("onAppAdded",e),r=this.subscribeForServerMethodEvent("serverMethodAdded",e);return()=>{n(),r()}}onHandlerRemoved(e){if(typeof e!="function")return N.raiseError("Cannot subscribe for 'onHandlerRemoved' event - callback is not a function!");const n=this.subscribeForAppEvent("onAppRemoved",e),r=this.subscribeForServerMethodEvent("serverMethodRemoved",e);return()=>{n(),r()}}subscribeForAppEvent(e,n){return this.appManagerController[e](r=>{const i=r.userProperties.intents;i!=null&&i.length&&i.forEach(s=>{const o=this.buildIntentHandlerFromApp(r,s);n(o,s.name)})})}subscribeForServerMethodEvent(e,n){return this.interop[e](async({server:r,method:i})=>{if(!i.name.startsWith(Za))return;const s=i.name.replace(Za,""),o=await this.buildIntentHandlerFromServerMethod(e,r,i,s);n(o,s)})}buildIntentHandlerFromApp(e,n){return{applicationName:e.name,type:"app",applicationDescription:e.caption,applicationIcon:e.icon,applicationTitle:e.title,contextTypes:n.contexts,displayName:n.displayName,resultType:n.resultType}}async buildIntentHandlerFromServerMethod(e,n,r,i){var p,g,f;const s=r.flags.intent,o=this.appManagerController.getApplication(n.application||n.applicationName);let a;e==="serverMethodAdded"&&n.windowId&&(a=await((p=this.windowsController.findById(n.windowId))==null?void 0:p.getTitle()));const l=(f=(g=o==null?void 0:o.userProperties)==null?void 0:g.intents)==null?void 0:f.find(I=>I.name===i);return{applicationName:n.application||n.applicationName||"",instanceId:n.windowId||n.instance,type:"instance",applicationIcon:(s==null?void 0:s.icon)||(o==null?void 0:o.icon),applicationTitle:o==null?void 0:o.title,applicationDescription:(s==null?void 0:s.description)||(o==null?void 0:o.caption),contextTypes:(s==null?void 0:s.contextTypes)||(l==null?void 0:l.contexts),instanceTitle:a,displayName:(s==null?void 0:s.displayName)||(l==null?void 0:l.displayName),resultType:(s==null?void 0:s.resultType)||(l==null?void 0:l.resultType)}}async clearSavedHandlers(){this.logger.trace("Removing all saved handlers from prefs storage for current app"),await this.prefsController.update({intents:void 0})}checkIfIntentsResolverIsEnabled(e){var n,r,i;this.useIntentsResolverUI=typeof((n=e.intents)==null?void 0:n.enableIntentsResolverUI)=="boolean"?e.intents.enableIntentsResolverUI:!0,this.intentsResolverAppName=((r=e.intents)==null?void 0:r.intentsResolverAppName)??mI,this.intentResolverResponseTimeout=((i=e.intents)==null?void 0:i.methodResponseTimeoutMs)??_h}clearUnregistrationPromise(e){this.unregisterIntentPromises=this.unregisterIntentPromises.filter(n=>n!==e)}buildInteropMethodName(e){return`${Za}${e}`}unsubscribeIntent(e){this.myIntents.delete(e);const n=this.buildInteropMethodName(e),r=this.interop.unregister(n);this.unregisterIntentPromises.push(r),r.then(()=>{this.clearUnregistrationPromise(r)}).catch(i=>{this.logger.error(`Unregistration of a method with name ${n} failed with reason: ${i}`),this.clearUnregistrationPromise(r)})}async filterHandlers(e){A(wu,e),this.checkIfAtLeastOneFilterIsPresent(e);const n=this.getEmbeddedResolverConfig();if(e.openResolver&&!this.useIntentsResolverUI&&!n.enabled)return N.raiseError("Cannot resolve 'filterHandlers' request using Intents Resolver UI because it's globally disabled");const r=(e.timeout||kh)+Eh,i={filterHandlersRequest:e,resolverConfig:this.getLegacyResolverConfigByRequest({handlerFilter:e}),embeddedResolverConfig:n};return await this.bridge.send("intents",Vn.filterHandlers,i,{methodResponseTimeoutMs:r,waitTimeoutMs:r},{includeOperationCheck:!0})}checkIfAtLeastOneFilterIsPresent(e){const n="Provide at least one filter criteria of the following: 'intent' | 'contextTypes' | 'resultType' | 'applicationNames'";if(!Object.keys(e).length)return N.raiseError(n);const{intent:r,resultType:i,contextTypes:s,applicationNames:o}=e,a=s==null?void 0:s.length,l=o==null?void 0:o.length;if(!r&&!i&&!a&&!l)return N.raiseError(n)}async getIntentsByHandler(e){return A(Bn,e),await this.bridge.send("intents",Vn.getIntentsByHandler,e,void 0,{includeOperationCheck:!0})}async removeRememberedHandler(e){var s;this.logger.trace(`Removing saved handler from prefs storage for intent ${e}`);let n;try{n=await this.prefsController.get()}catch(o){this.logger.warn(`prefs.get() threw the following error: ${o}`);return}const r=(s=n.data)==null?void 0:s.intents;if(!r){this.logger.trace("No app prefs found for current app");return}delete r[e];const i={...n.data,intents:r};try{await this.prefsController.update(i)}catch(o){this.logger.warn(`prefs.update() threw the following error: ${o}`);return}this.logger.trace(`Handler saved choice for intent ${e} removed successfully`)}async checkForRememberedHandler(e){var i,s;let n;try{n=await this.prefsController.get()}catch(o){this.logger.warn(`prefs.get() threw the following error: ${o}`);return}const r=(s=(i=n.data)==null?void 0:i.intents)==null?void 0:s[e.intent];return r==null?void 0:r.handler}async checkHandleRaiseWithRememberedHandler(e){if(e.target)return;const n=await this.checkForRememberedHandler(e);if(!n)return;const r={intentRequest:{...e,target:{app:n.applicationName,instance:n.instanceId}},resolverConfig:this.getLegacyResolverConfigByRequest({intentRequest:e}),embeddedResolverConfig:this.getEmbeddedResolverConfig()};try{return await this.bridge.send("intents",Vn.raise,r)}catch(i){this.logger.trace(`Could not raise intent to remembered handler. Reason: ${i}. Removing it from Prefs store`),await this.removeRememberedHandler(e.intent)}}}const be={addChannel:{name:"addChannel",dataDecoder:Ng},removeChannel:{name:"removeChannel",dataDecoder:LS},getMyChannel:{name:"getMyChannel",resultDecoder:a0},getWindowIdsOnChannel:{name:"getWindowIdsOnChannel",dataDecoder:r0,resultDecoder:i0},getWindowIdsWithChannels:{name:"getWindowIdsWithChannels",dataDecoder:l0,resultDecoder:c0},joinChannel:{name:"joinChannel",dataDecoder:h0},restrict:{name:"restrict",dataDecoder:$S},getRestrictions:{name:"getRestrictions",dataDecoder:WS,resultDecoder:jS},restrictAll:{name:"restrictAll",dataDecoder:US},notifyChannelsChanged:{name:"notifyChannelsChanged",dataDecoder:Gg},leaveChannel:{name:"leaveChannel",dataDecoder:f0},requestChannelSelector:{name:"requestChannelSelector",dataDecoder:$C},getMode:{name:"getMode",resultDecoder:o0},operationCheck:{name:"operationCheck"}},vI="single",el="___channel___",Os="subs",Th="changed",Rh="channels_changed";class wI{constructor(){c(this,"supportedOperationsNames",[]);c(this,"registry",fn());c(this,"logger");c(this,"contexts");c(this,"interop");c(this,"bridge");c(this,"windowsController");c(this,"sessionController");c(this,"_mode");c(this,"currentChannels",[]);c(this,"unsubscribeDict",{});c(this,"replaySubscribe",(e,n)=>{this.get(n).then(r=>{if(!r)return;const i=this.createContextName(r.name);return this.contexts.subscribe(i,(s,o,a,l,u)=>{e(s.data,s,o,u==null?void 0:u.updaterId)})}).then(r=>r==null?void 0:r()).catch(r=>this.logger.trace(r))})}handlePlatformShutdown(){this.registry.clear()}addOperationsExecutors(){be.getMyChannel.execute=this.handleGetMyChannel.bind(this),be.joinChannel.execute=this.handleJoinChannel.bind(this),be.leaveChannel.execute=this.handleLeaveChannel.bind(this),be.restrict.execute=({config:e})=>this.restrict(e),be.getRestrictions.execute=({windowId:e})=>this.getRestrictions(e),be.restrictAll.execute=({restrictions:e})=>this.restrictAll(e),be.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),this.supportedOperationsNames=Un(be)}async start(e,n){this.logger=e.logger.subLogger("channels.controller.web"),this.logger.trace("starting the web channels controller"),this.contexts=e.contexts,this.interop=e.interop,this.addOperationsExecutors(),this.bridge=n.bridge,this.windowsController=n.windowsController,this.sessionController=n.sessionController,this.logger.trace("no need for platform registration, attaching the channels property to glue and returning"),this._mode=await this.getPlatformChannelsMode();const r=this.toApi();e.channels=r}async postStart(e,n){try{await this.requestChannelSelector(e.appManager.myInstance)}catch(r){this.logger.warn(`Failed to display channel selector: ${$t(r)}`)}}async handleBridgeMessage(e){const n=A(s0,e.operation),r=be[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}async list(){const e=this.getAllChannelNames();return await Promise.all(e.map(r=>this.get(r)))}my(){return this.current()}async handleGetMyChannel(){const e=this.my();return e?{channel:e}:{}}async join(e,n){const r=this.getAllChannelNames();return A(Jt(r),e),A(xo,n),n&&n!==this.interop.instance.instance?await this.bridge.send("channels",be.joinChannel,{channel:e,windowId:n},void 0,{includeOperationCheck:!0}):this._mode==="single"?this.switchToChannel(e):this.joinAdditionalChannel(e)}handleJoinChannel({channel:e,windowId:n}){return this.join(e,n)}onChanged(e){return this.changed(e)}async leave(e={}){if(A(PS,e),e.channel){const i=this.getAllChannelNames();A(Jt(i),e.channel)}const n=e.windowId&&e.windowId!==this.interop.instance.instance;if(e.windowId&&n){const i={windowId:e.windowId,channelName:e.channel};await this.bridge.send("channels",be.leaveChannel,i,void 0,{includeOperationCheck:!0});return}const r=e.channel?[e.channel]:this.currentChannels;r.forEach(i=>this.unsubscribe(i)),this.currentChannels=this.currentChannels.filter(i=>!r.includes(i)),this.sessionController.setWindowData({currentNames:this.currentChannels},"channels"),this.executeChangedEvents(),await this.notifyChannelsChanged()}handleLeaveChannel(e){return this.leave({channel:e.channelName})}toApi(){const e={mode:this._mode,subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),publish:this.publish.bind(this),all:this.all.bind(this),list:this.list.bind(this),get:this.get.bind(this),getMyChannels:this.getMyChannels.bind(this),myChannels:this.myChannels.bind(this),onChannelsChanged:this.onChannelsChanged.bind(this),join:this.join.bind(this),leave:this.leave.bind(this),current:this.current.bind(this),my:this.my.bind(this),changed:this.changed.bind(this),onChanged:this.onChanged.bind(this),add:this.add.bind(this),remove:this.remove.bind(this),getMy:this.getMy.bind(this),getWindowsOnChannel:this.getWindowsOnChannel.bind(this),getWindowsWithChannels:this.getWindowsWithChannels.bind(this),restrict:this.restrict.bind(this),getRestrictions:this.getRestrictions.bind(this),restrictAll:this.restrictAll.bind(this),clearChannelData:this.clearChannelData.bind(this),setPath:this.setPath.bind(this),setPaths:this.setPaths.bind(this)};return Object.freeze(e)}createContextName(e){return`${el}${e}`}getAllChannelNames(){return this.contexts.all().filter(i=>i.startsWith(el)).map(i=>i.replace(el,""))}async joinAdditionalChannel(e){if(this.currentChannels.includes(e))return;this.currentChannels=[...this.currentChannels,e];const n=this.createContextName(e),r=await this.contexts.subscribe(n,(i,s,o,a,l)=>{this.registry.execute(Os,i.data,i,s,l==null?void 0:l.updaterId)});this.unsubscribeDict[e]=r,this.executeChangedEvents(e),this.sessionController.setWindowData({currentNames:this.currentChannels},"channels"),await this.notifyChannelsChanged()}async switchToChannel(e){const n=this.currentChannels[0];if(e===n)return;this.unsubscribe(n),this.currentChannels=[e];const r=this.createContextName(e),i=await this.contexts.subscribe(r,(s,o,a,l,u)=>{this.registry.execute(Os,s.data,s,o,u==null?void 0:u.updaterId)});this.unsubscribeDict[e]=i,this.executeChangedEvents(e),this.sessionController.setWindowData({currentNames:this.currentChannels},"channels"),await this.notifyChannelsChanged()}unsubscribe(e){var n,r;if(e){(r=(n=this.unsubscribeDict)[e])==null||r.call(n),delete this.unsubscribeDict[e];return}Object.values(this.unsubscribeDict).forEach(i=>i()),this.unsubscribeDict={}}executeChangedEvents(e){this.registry.execute(Th,e),this.registry.execute(Rh,this.currentChannels)}async notifyChannelsChanged(){const e=this.windowsController.my().id;if(e)try{await this.bridge.send("channels",be.notifyChannelsChanged,{channelNames:this.currentChannels,windowId:e},void 0,{includeOperationCheck:!0})}catch(n){this.logger.warn(`Failed to notify channel changed: ${$t(n)}`)}}async updateData(e,n){const r=this.createContextName(e),i=this.getFDC3Type(n);if(this.contexts.setPathSupported){const s=Object.keys(n).map(o=>({path:`data.${o}`,value:n[o]}));i&&s.push({path:sh,value:i}),await this.contexts.setPaths(r,s)}else i&&(n[sh]=i),await this.contexts.update(r,{data:n})}getFDC3Type(e){const n=Object.keys(e).filter(r=>r.indexOf("fdc3_")===0);if(n.length!==0)return n.length>1?N.raiseError("FDC3 does not support updating of multiple context keys"):n[0].split("_").slice(1).join("_")}subscribe(e,n){if(typeof e!="function")return N.raiseError("Cannot subscribe to channels, because the provided callback is not a function!");n&&A(Ns,n);const r=this.current(),i=n!=null&&n.contextType?this.getWrappedSubscribeCallbackWithFdc3Type(e,n.contextType):this.getWrappedSubscribeCallback(e);return r&&this.replaySubscribe(i,r),this.registry.add(Os,i)}async subscribeFor(e,n,r){const i=this.getAllChannelNames();if(A(Jt(i),e),typeof n!="function")return N.raiseError(`Cannot subscribe to channel ${e}, because the provided callback is not a function!`);r&&A(Ns,r);const s=this.createContextName(e),o=r!=null&&r.contextType?this.getWrappedSubscribeCallbackWithFdc3Type(n,r.contextType):this.getWrappedSubscribeCallback(n);return this.contexts.subscribe(s,(a,l,u,p,g)=>{o(a.data,a,l,g==null?void 0:g.updaterId)})}async publish(e,n){if(typeof e!="object")return N.raiseError("Cannot publish to channel, because the provided data is not an object!");if(A(RS,n),typeof n=="object")return this.publishWithOptions(e,n);if(typeof n=="string"){const s=this.getAllChannelNames();A(Jt(s),n)}if(!n&&this.currentChannels.length>1)return this.publishOnMultipleChannels(e);const r=typeof n=="string"?n:this.currentChannels[0];return r?this.isAllowedByRestrictions(r,"write")?this.updateData(r,e):N.raiseError(`Cannot publish on channel ${r} due to restrictions`):N.raiseError("Cannot publish to channel, because not joined to a channel!")}async all(){return this.getAllChannelNames()}async get(e,n){const r=this.getAllChannelNames();A(Jt(r),e),n&&A(Ns,n);const i=this.createContextName(e),s=await this.contexts.get(i);return n!=null&&n.contextType?this.getContextForFdc3Type(s,n.contextType):s.latest_fdc3_type?this.getContextWithFdc3Data(s):s}async getMyChannels(){return Promise.all(this.currentChannels.map(e=>{const n=this.createContextName(e);return this.contexts.get(n)}))}myChannels(){return this.currentChannels}getContextForFdc3Type(e,n){const r=`fdc3_${n.split(".").join("&")}`;if(!e.data[r])return{name:e.name,meta:e.meta,data:{}};const i={type:n,...e.data[r]};return{name:e.name,meta:e.meta,data:{fdc3:i}}}getContextWithFdc3Data(e){const{latest_fdc3_type:n,...r}=e,s={type:n.split("&").join("."),...r.data[`fdc3_${n}`]};return delete r.data[`fdc3_${n}`],{name:e.name,meta:e.meta,data:{...r.data,fdc3:s}}}current(){return this.currentChannels[0]}changed(e){return typeof e!="function"?N.raiseError("Cannot subscribe to channel changed, because the provided callback is not a function!"):this.registry.add(Th,e)}async add(e){const n=A(Ng,e);return this.getAllChannelNames().includes(n.name)?N.raiseError("There's an already existing channel with such name"):(await this.bridge.send("channels",be.addChannel,n),{name:n.name,meta:n.meta,data:n.data||{}})}async remove(e){if(A(b,e),!this.getAllChannelNames().includes(e))return N.raiseError("There's no channel with such name");await this.bridge.send("channels",be.removeChannel,{name:e},void 0,{includeOperationCheck:!0})}async getMy(e){if(this.currentChannels.length)return e&&A(Ns,e),this.get(this.currentChannels[this.currentChannels.length-1],e)}async getWindowsOnChannel(e){const n=this.getAllChannelNames();A(Jt(n),e);const{windowIds:r}=await this.bridge.send("channels",be.getWindowIdsOnChannel,{channel:e},void 0,{includeOperationCheck:!0});return r.reduce((s,o)=>{const a=this.windowsController.findById(o);return a?[...s,a]:s},[])}async getWindowsWithChannels(e){const n=e!==void 0?{filter:A(Hg,e)}:{},{windowIdsWithChannels:r}=await this.bridge.send("channels",be.getWindowIdsWithChannels,n,void 0,{includeOperationCheck:!0});return r.reduce((s,{application:o,channel:a,windowId:l})=>{const u=this.windowsController.findById(l);return u?[...s,{application:o,channel:a,window:u}]:s},[])}async clearChannelData(e){const n=[{path:"data",value:{}},{path:"latest_fdc3_type",value:null}];await this.handleSetPaths("clearChannelData",n,e)}async restrict(e){A(Mg,e);const n=this.getAllChannelNames();if(A(Jt(n),e.name),e.windowId&&e.windowId!==this.interop.instance.instance)return this.bridge.send("channels",be.restrict,{config:e},void 0,{includeOperationCheck:!0});const i=this.sessionController.getWindowData(),s=i!=null&&i.restrictions?{...i.restrictions,[e.name]:e}:{[e.name]:e},o=await this.getMy(),a=this.checkPreviousReadAllowed(o==null?void 0:o.name);this.sessionController.setWindowData(s,"restrictions"),!(!o||a||!e.read||o.name!==e.name)&&this.replaySubscribeCallback(e.name)}async getRestrictions(e){A(xo,e);const n=e&&e!==this.interop.instance.instance;return e&&n?this.bridge.send("channels",be.getRestrictions,{windowId:e},void 0,{includeOperationCheck:!0}):this.getMyRestrictions()}async restrictAll(e){A(Lg,e);const n=this.getAllChannelNames();if(e.windowId&&e.windowId!==this.interop.instance.instance)return this.bridge.send("channels",be.restrictAll,{restrictions:e},void 0,{includeOperationCheck:!0});const i={};n.forEach(a=>{i[a]={...e,name:a}});const s=await this.getMy(),o=this.checkPreviousReadAllowed(s==null?void 0:s.name);this.sessionController.setWindowData(i,"restrictions"),!(!s||o||!e.read)&&this.replaySubscribeCallback(s.name)}async setPath(e,n){const r=A(Og,e),i=[{path:`data.${r.path}`,value:r.value}];await this.handleSetPaths("setPath",i,n)}async setPaths(e,n){const i=A(MS,e).map(({path:s,value:o})=>({path:`data.${s}`,value:o}));await this.handleSetPaths("setPaths",i,n)}async handleSetPaths(e,n,r){const i=r?[r]:this.currentChannels;if(!i.length)return N.raiseError(`Cannot complete ${e} operation, because channel is not specified. Either join one or pass a channel name as second argument!`);this.validateChannelNames(i);const{allowed:s,forbidden:o}=this.groupChannelsByPermission("write",i);if(i.length===o.length)return N.raiseError(`Cannot complete ${e} operation due to write restrictions to the following channels: ${i.join(", ")}`);o.length&&this.logger.warn(`Cannot set paths on channel${o.length>1?"s":""}: ${o.join(", ")} due to write restrictions`),await Promise.all(s.map(a=>{const l=this.createContextName(a);return this.contexts.setPaths(l,n)}))}validateChannelNames(e){const n=this.getAllChannelNames();e.forEach(r=>A(Jt(n),r))}groupChannelsByPermission(e,n){return n.reduce((r,i)=>(this.isAllowedByRestrictions(i,e)?r.allowed.push(i):r.forbidden.push(i),r),{allowed:[],forbidden:[]})}isAllowedByRestrictions(e,n){const{channels:r}=this.getMyRestrictions();if(!(r!=null&&r.length))return!0;const i=r.find(s=>s.name===e);return i?i[n]:!0}getMyRestrictions(){const e=this.sessionController.getWindowData();return{channels:Object.values((e==null?void 0:e.restrictions)||{})}}replaySubscribeCallback(e){const n=this.createContextName(e);this.contexts.subscribe(n,(r,i,s,o,a)=>{this.registry.execute(Os,r.data,r,i,a==null?void 0:a.updaterId)}).then(r=>{r&&typeof r=="function"&&r()}).catch(r=>this.logger.error(r))}checkPreviousReadAllowed(e){if(!e)return!0;const n=this.sessionController.getWindowData().restrictions;return n!=null&&n[e]?n[e].read:!0}async publishWithOptions(e,n){if(n.name){const o=this.getAllChannelNames();A(Jt(o),n.name)}if(n.name?!1:this.currentChannels.length>1)return this.publishOnMultipleChannels(e,n.fdc3);const i=n.name||this.currentChannels[0];return i?this.isAllowedByRestrictions(i,"write")?n.fdc3?this.publishFdc3Data(i,e):this.updateData(i,e):N.raiseError(`Cannot publish on channel ${i} due to restrictions`):N.raiseError("Cannot publish to channel, because not joined to a channel!")}async publishOnMultipleChannels(e,n){const{allowed:r,forbidden:i}=this.groupChannelsByPermission("write",this.currentChannels);if(this.currentChannels.length===i.length)return N.raiseError(`Cannot complete 'publish' operation due to write restrictions to all joined channels: ${this.currentChannels.join(", ")}`);i.length&&this.logger.warn(`Data on channel${i.length>1?"s":""}: ${i.join(", ")} won't be published due to write restrictions`);const s=n?this.publishFdc3Data.bind(this):this.updateData.bind(this);await Promise.all(r.map(o=>s(o,e)))}async publishFdc3Data(e,n){A(DS,n);const{type:r,...i}=n,o={[`fdc3_${r.split(".").join("&")}`]:i};return this.updateData(e,o)}getWrappedSubscribeCallback(e){return(r,i,s,o)=>{if(!this.isAllowedByRestrictions(i.name,"read"))return;const{data:l,latest_fdc3_type:u}=i,p=`fdc3_${u}`;if(!u||s.data&&!s.data[p]){e(r,i,o);return}const f={type:u.split("&").join("."),...l[p]},{[p]:I,...S}=r;e({...S,fdc3:f},i,o)}}getWrappedSubscribeCallbackWithFdc3Type(e,n){const r={replayed:!1};return(s,o,a,l)=>{if(!this.isAllowedByRestrictions(o.name,"read"))return;const{data:p,latest_fdc3_type:g}=o,f=`fdc3_${n.split(".").join("&")}`;if(!p[f]||a.data&&!a.data[f])return;if(r.replayed)return this.parseDataAndInvokeSubscribeCallback({latestFdc3TypeEncoded:g,searchedType:n,callback:e,context:o,updaterId:l});const I={type:n,...p[f]};e({fdc3:I},o,l),r.replayed=!0}}parseDataAndInvokeSubscribeCallback(e){const{latestFdc3TypeEncoded:n,searchedType:r,callback:i,context:s,updaterId:o}=e;if(n.split("&").join(".")!==r)return;const l={type:r,...s.data[`fdc3_${n}`]};i({fdc3:l},s,o)}async requestChannelSelector(e){var l,u;if(!e)return;const r=(l=e.application.userProperties)==null?void 0:l.details;if(!r||!((u=r==null?void 0:r.channelSelector)!=null&&u.enabled))return;const{channels:i}=this.sessionController.getWindowData(),s=e.id,o=(i==null?void 0:i.currentNames)||[],a={windowId:s,channelsNames:o};await this.bridge.send("channels",be.requestChannelSelector,a,void 0,{includeOperationCheck:!0})}async getPlatformChannelsMode(){try{return(await this.bridge.send("channels",be.getMode,{},void 0,{includeOperationCheck:!0})).mode}catch(e){return this.logger.warn((e==null?void 0:e.message)||JSON.stringify(e)),vI}}onChannelsChanged(e){return typeof e!="function"?N.raiseError("Cannot subscribe to channels changed, because the provided callback is not a function"):this.registry.add(Rh,e)}}const Kt={getEnvironment:{name:"getEnvironment",resultDecoder:Ao},getBase:{name:"getBase",resultDecoder:Ao},platformShutdown:{name:"platformShutdown"},isFdc3DataWrappingSupported:{name:"isFdc3DataWrappingSupported"},clientError:{name:"clientError",dataDecoder:w0},systemHello:{name:"systemHello",resultDecoder:b0},operationCheck:{name:"operationCheck"}};class bI{constructor(){c(this,"supportedOperationsNames",[]);c(this,"bridge");c(this,"ioc");c(this,"logger");c(this,"errorPort",ug.port2)}async start(e,n){this.logger=e.logger.subLogger("system.controller.web"),this.logger.trace("starting the web system controller"),this.bridge=n.bridge,this.ioc=n,this.addOperationsExecutors();let r=!1;try{r=(await this.bridge.send("system",Kt.systemHello,void 0,void 0,{includeOperationCheck:!0})).isClientErrorOperationSupported}catch{this.logger.warn("The platform of this client is outdated and does not support some system operations.")}this.errorPort.onmessage=async i=>{r&&await this.bridge.send("system",Kt.clientError,{message:i.data},void 0,{includeOperationCheck:!0})},await this.setEnvironment()}async handleBridgeMessage(e){const n=A(TC,e.operation),r=Kt[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}async processPlatformShutdown(){Object.values(this.ioc.controllers).forEach(e=>e.handlePlatformShutdown?e.handlePlatformShutdown():null),this.ioc.preferredConnectionController.stop(),this.ioc.eventsDispatcher.stop(),await this.bridge.stop()}async setEnvironment(){const e=await this.bridge.send("system",Kt.getEnvironment,void 0),n=await this.bridge.send("system",Kt.getBase,void 0),r=window.glue42core||window.iobrowser,i=window.glue42core?"glue42core":"iobrowser",s=Object.assign({},r,n,{environment:e});window[i]=s}addOperationsExecutors(){Kt.platformShutdown.execute=this.processPlatformShutdown.bind(this),Kt.isFdc3DataWrappingSupported.execute=this.handleIsFdc3DataWrappingSupported.bind(this),Kt.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),this.supportedOperationsNames=Un(Kt)}async handleIsFdc3DataWrappingSupported(){return{isSupported:!0}}}class CI{constructor(e,n){c(this,"onclick",()=>{});c(this,"onshow",()=>{});c(this,"id");c(this,"title");c(this,"badge");c(this,"body");c(this,"data");c(this,"dir");c(this,"icon");c(this,"image");c(this,"lang");c(this,"renotify");c(this,"requireInteraction");c(this,"silent");c(this,"tag");c(this,"timestamp");c(this,"vibrate");c(this,"clickInterop");c(this,"actions");c(this,"focusPlatformOnDefaultClick");c(this,"severity");c(this,"showToast");c(this,"showInPanel");c(this,"state");this.id=n,this.badge=e.badge,this.body=e.body,this.data=e.data,this.dir=e.dir,this.icon=e.icon,this.image=e.image,this.lang=e.lang,this.renotify=e.renotify,this.requireInteraction=e.requireInteraction,this.silent=e.silent,this.tag=e.tag,this.timestamp=e.timestamp,this.vibrate=e.vibrate,this.title=e.title,this.clickInterop=e.clickInterop,this.actions=e.actions,this.focusPlatformOnDefaultClick=e.focusPlatformOnDefaultClick,this.severity=e.severity,this.showToast=e.showToast,this.showInPanel=e.showInPanel,this.state=e.state}}K(w("clientHello"));const SI=y({widget:y({inject:W()})}),II={clientHello:{name:"clientHello",resultDecoder:SI}};class _I{constructor(){c(this,"windowId");c(this,"logger");c(this,"bridge");c(this,"eventsDispatcher");c(this,"channelsController");c(this,"config");c(this,"channels",[]);c(this,"unsubFuncs",[]);c(this,"contentCommands",{widgetVisualizationPermission:{name:"widgetVisualizationPermission",handle:this.handleWidgetVisualizationPermission.bind(this)},changeChannel:{name:"changeChannel",handle:this.handleChangeChannel.bind(this)}})}handlePlatformShutdown(){this.unsubFuncs.forEach(e=>e()),this.channels=[],this.unsubFuncs=[]}async start(e,n){this.logger=e.logger.subLogger("extension.controller.web"),this.windowId=n.publicWindowId,this.logger.trace("starting the extension web controller"),this.bridge=n.bridge,this.channelsController=n.channelsController,this.eventsDispatcher=n.eventsDispatcher;try{await this.registerWithPlatform()}catch{return}this.channels=await this.channelsController.list();const r=this.eventsDispatcher.onContentMessage(this.handleContentMessage.bind(this)),i=this.channelsController.onChanged(s=>{this.eventsDispatcher.sendContentMessage({command:"channelChange",newChannel:s})});this.unsubFuncs.push(r),this.unsubFuncs.push(i)}async handleBridgeMessage(e){}handleContentMessage(e){if(!e||typeof e.command!="string")return;const n=this.contentCommands[e.command];n&&n.handle(e)}async registerWithPlatform(){this.logger.trace("registering with the platform"),this.config=await this.bridge.send("extension",II.clientHello,{windowId:this.windowId}),this.logger.trace("the platform responded to the hello message with a valid extension config")}async handleWidgetVisualizationPermission(){var n;if(!((n=this.config)!=null&&n.widget.inject))return this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!1});const e=this.channels.find(r=>r.name===this.channelsController.my());this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!0,channels:this.channels,currentChannel:e})}async handleChangeChannel(e){if(e.name==="no-channel"){await this.channelsController.leave();return}await this.channelsController.join(e.name)}}class EI{constructor(e){c(this,"config");c(this,"glue");c(this,"registry",fn());c(this,"glue42EventName","Glue42");c(this,"_handleMessage");c(this,"_resolveWidgetReadyPromise");c(this,"_resolveModalsUIFactoryReadyPromise");c(this,"_resolveIntentResolverUIFactoryReadyPromise");c(this,"events",{notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},contentInc:{name:"contentInc",handle:this.handleContentInc.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)},widgetFactoryReady:{name:"widgetFactoryReady",handle:this.handleWidgetReady.bind(this)},modalsUIFactoryReady:{name:"modalsUIFactoryReady",handle:this.handleModalsUIFactoryReady.bind(this)},intentResolverUIFactoryReady:{name:"intentResolverUIFactoryReady",handle:this.handleIntentResolverUIFactoryReady.bind(this)}});this.config=e}stop(){window.removeEventListener(this.glue42EventName,this._handleMessage)}start(e){this.glue=e,this.wireCustomEventListener(),this.announceStarted()}sendContentMessage(e){this.send("contentOut","glue42core",e)}onContentMessage(e){return this.registry.add("content-inc",e)}async widgetReady(){const e=new Promise(n=>{this._resolveWidgetReadyPromise=n});return this.requestWidgetReady(),e}async modalsUIFactoryReady(){const e=new Promise(n=>{this._resolveModalsUIFactoryReadyPromise=n});return this.requestModalsUIFactoryReady(),e}async intentResolverUIFactoryReady(){const e=new Promise(n=>{this._resolveIntentResolverUIFactoryReadyPromise=n});return this.requestIntentResolverUIFactoryReady(),e}wireCustomEventListener(){this._handleMessage=this.handleMessage.bind(this),window.addEventListener(this.glue42EventName,this._handleMessage)}handleMessage(e){const n=e.detail,r=(n==null?void 0:n.glue42)??(n==null?void 0:n.glue42core);if(!r)return;const i=r.event,s=this.events[i];s&&s.handle(r.message)}announceStarted(){this.send("start","glue42")}handleRequestGlue(){if(!this.config.exposeAPI){this.send("requestGlueResponse","glue42",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."});return}this.send("requestGlueResponse","glue42",{glue:this.glue})}handleNotifyStarted(){this.announceStarted()}handleContentInc(e){this.registry.execute("content-inc",e)}requestWidgetReady(){this.send(Xb,"glue42")}handleWidgetReady(){var e;(e=this._resolveWidgetReadyPromise)==null||e.call(this)}requestModalsUIFactoryReady(){this.send(Zb,"glue42")}handleModalsUIFactoryReady(){var e;(e=this._resolveModalsUIFactoryReadyPromise)==null||e.call(this)}requestIntentResolverUIFactoryReady(){this.send(eC,"glue42")}handleIntentResolverUIFactoryReady(){var e;(e=this._resolveIntentResolverUIFactoryReadyPromise)==null||e.call(this)}send(e,n,r){const i={};i[n]={event:e,message:r};const s=new CustomEvent(this.glue42EventName,{detail:i});window.dispatchEvent(s)}}class kI{constructor(e){c(this,"coreGlue");c(this,"transactionTimeout",15e3);c(this,"transactionLocks",{});c(this,"webPlatformTransport");c(this,"webPlatformMessagesUnsubscribe");c(this,"reconnectCounter",0);c(this,"logger");this.coreGlue=e,this.logger=this.coreGlue.logger.subLogger("web.preferred.connection.controller")}stop(){this.webPlatformMessagesUnsubscribe&&this.webPlatformMessagesUnsubscribe()}async start(e){if(e.isPlatformInternal){this.logger.trace("This is an internal client to the platform, skipping all client preferred communication logic.");return}if(!(this.coreGlue.connection.transport.name()===ih))return N.raiseError("Cannot initiate the Glue Web Bridge, because the initial connection was not handled by a Web Platform transport.");if(!this.coreGlue.connection.transport.isPreferredActivated){this.logger.trace("The platform of this client was configured without a preferred connection, skipping the rest of the initialization.");return}this.webPlatformTransport=this.coreGlue.connection.transport,this.webPlatformMessagesUnsubscribe=this.webPlatformTransport.onMessage(this.handleWebPlatformMessage.bind(this));const r=await this.getCurrentPlatformTransportState();await this.checkSwitchTransport(r)}handleWebPlatformMessage(e){if(typeof e=="string")return;const n=this.coreGlue.connection.transport.name()===ih,r=e.type,i=e.args,s=e.transactionId;if(r===gt.transportSwitchRequest.name)return this.handleTransportSwitchRequest(i,s);if(r===gt.platformUnload.name&&!n)return this.handlePlatformUnload();if(r===gt.getCurrentTransportResponse.name)return this.handleGetCurrentTransportResponse(i,s);if(r===gt.checkPreferredLogic.name)return this.handleCheckPreferredLogic(s);if(r===gt.checkPreferredConnection.name)return this.handleCheckPreferredConnection(i,s)}async reEstablishPlatformPort(){try{await this.webPlatformTransport.connect()}catch(n){if(this.logger.trace(`Error when re-establishing port connection to the platform: ${JSON.stringify(n)}`),--this.reconnectCounter,this.reconnectCounter>0)return this.reEstablishPlatformPort();this.logger.warn("This client lost connection to the platform while connected to a preferred GW and was not able to re-connect to the platform.")}this.logger.trace("The connection to the platform was re-established, closing the connection to the web gateway."),this.reconnectCounter=0,this.webPlatformTransport.close();const e=await this.getCurrentPlatformTransportState();await this.checkSwitchTransport(e)}async checkSwitchTransport(e){const n=this.coreGlue.connection.transport.name();if(n===e.transportName){this.logger.trace("A check switch was requested, but the platform transport and my transport are identical, no switch is necessary");return}this.logger.trace(`A check switch was requested and a transport switch is necessary, because this client is now on ${n}, but it should reconnect to ${JSON.stringify(e)}`);const r=await this.coreGlue.connection.switchTransport(e);this.setConnected(),this.logger.trace(`The transport switch was completed with result: ${JSON.stringify(r)}`)}async getCurrentPlatformTransportState(){this.logger.trace("Requesting the current transport state of the platform.");const e=this.setTransaction(gt.getCurrentTransport.name);this.sendPlatformMessage(gt.getCurrentTransport.name,e.id);const n=await e.lock;return this.logger.trace(`The platform responded with transport state: ${JSON.stringify(n)}`),n}setTransaction(e){const n={},r=om(10),i=new Promise((s,o)=>{let a=!0;n.lift=l=>{a=!1,delete this.transactionLocks[r],s(l)},n.fail=l=>{a=!1,delete this.transactionLocks[r],o(l)},setTimeout(()=>{a&&(a=!1,this.logger.warn(`Transaction for operation: ${e} timed out.`),delete this.transactionLocks[r],o(`Transaction for operation: ${e} timed out.`))},this.transactionTimeout)});return n.lock=i,n.id=r,this.transactionLocks[r]=n,n}sendPlatformMessage(e,n,r){this.logger.trace(`Sending a platform message of type: ${e}, id: ${n} and args: ${JSON.stringify(r)}`),this.webPlatformTransport.sendObject({glue42core:{type:e,args:r,transactionId:n}})}handleTransportSwitchRequest(e,n){this.logger.trace(`Received a transport switch request with id: ${n} and data: ${JSON.stringify(e)}`),this.coreGlue.connection.switchTransport(e.switchSettings).then(r=>{this.logger.trace(`The transport switch was completed with result: ${JSON.stringify(r)}`),this.setConnected(),this.sendPlatformMessage(gt.transportSwitchResponse.name,n,{success:r.success})}).catch(r=>{this.logger.error(r),this.sendPlatformMessage(gt.transportSwitchResponse.name,n,{success:!1})})}handlePlatformUnload(){this.reconnectCounter=5,this.logger.trace("The platform was unloaded while I am connected to a preferred connection, re-establishing the port connection."),this.reEstablishPlatformPort()}handleGetCurrentTransportResponse(e,n){this.logger.trace(`Got a current transport response from the platform with id: ${n} and data: ${JSON.stringify(e)}`);const r=e.transportState,i=this.transactionLocks[n];i==null||i.lift(r)}handleCheckPreferredLogic(e){setTimeout(()=>this.sendPlatformMessage(gt.checkPreferredLogicResponse.name,e),0)}handleCheckPreferredConnection(e,n){const r=e.url;this.logger.trace(`Testing the possible connection to: ${r}`),this.checkPreferredConnection(r).then(i=>{this.logger.trace(`The connection to ${r} is possible`),this.sendPlatformMessage(gt.checkPreferredConnectionResponse.name,n,i)}).catch(i=>{this.logger.trace(`The connection to ${r} is not possible`),this.sendPlatformMessage(gt.checkPreferredConnectionResponse.name,n,{error:i})})}checkPreferredConnection(e){return new Promise(n=>{const r=new WebSocket(e);r.onerror=()=>n({live:!1}),r.onopen=()=>{r.close(),n({live:!0})}})}setConnected(){this.webPlatformTransport.manualSetReadyState()}}const tl={getCurrent:{name:"getCurrent",resultDecoder:zg},list:{name:"list",resultDecoder:XS},select:{name:"select",dataDecoder:ZS}};class TI{constructor(){c(this,"logger");c(this,"bridge");c(this,"registry",fn());c(this,"themesSubscription");c(this,"activeThemeSubs",0)}async start(e,n){this.logger=e.logger.subLogger("themes.controller.web"),this.logger.trace("starting the web themes controller"),this.bridge=n.bridge;const r=this.toApi();e.themes=r,this.logger.trace("themes are ready")}handlePlatformShutdown(){var e;this.registry.clear(),this.activeThemeSubs=0,(e=this.themesSubscription)==null||e.close(),delete this.themesSubscription}async handleBridgeMessage(){}toApi(){const e={getCurrent:this.getCurrent.bind(this),list:this.list.bind(this),select:this.select.bind(this),onChanged:this.onChanged.bind(this)};return Object.freeze(e)}async getCurrent(){return(await this.bridge.send("themes",tl.getCurrent,void 0,void 0,{includeOperationCheck:!0})).theme}async list(){return(await this.bridge.send("themes",tl.list,void 0,void 0,{includeOperationCheck:!0})).themes}async select(e){A(b,e),await this.bridge.send("themes",tl.select,{name:e},void 0,{includeOperationCheck:!0})}async onChanged(e){if(typeof e!="function")return N.raiseError("onChanged requires a callback of type function");await(this.themesSubscription?Promise.resolve():this.configureThemeSubscription()),++this.activeThemeSubs;const r=this.registry.add("on-theme-change",e);return()=>this.themeUnsub(r)}async configureThemeSubscription(){this.themesSubscription||(this.themesSubscription=await this.bridge.createNotificationsSteam(),this.themesSubscription.onData(e=>{const n=e.data,r=zg.run(n);if(!r.ok){this.logger.warn(`Received invalid theme data on the theme event stream: ${JSON.stringify(r.error)}`);return}const i=r.result;this.registry.execute("on-theme-change",i.theme)}),this.themesSubscription.onClosed(()=>{this.logger.warn("The Themes interop stream was closed, no theme changes notifications will be received"),this.registry.clear(),this.activeThemeSubs=0,delete this.themesSubscription}))}themeUnsub(e){var n;e(),--this.activeThemeSubs,!this.activeThemeSubs&&((n=this.themesSubscription)==null||n.close(),delete this.themesSubscription)}}class RI{constructor(){c(this,"sessionStorage",window.sessionStorage);c(this,"windowId")}get allNamespaces(){return[{namespace:this.windowNamespace,defaultValue:{}}]}configure(e){this.windowId=e.windowId,this.allNamespaces.forEach(({namespace:n,defaultValue:r})=>{this.sessionStorage.getItem(n)||this.sessionStorage.setItem(n,JSON.stringify(r))})}get windowNamespace(){return`io_connect_window_${this.windowId}`}getWindowData(){return JSON.parse(this.sessionStorage.getItem(this.windowNamespace))}setWindowData(e,n){const r=this.getWindowData();r[n]=e,this.sessionStorage.setItem(this.windowNamespace,JSON.stringify(r))}}const mt={clear:{name:"clear",dataDecoder:No},clearAll:{name:"clearAll"},get:{name:"get",dataDecoder:No,resultDecoder:vh},getAll:{name:"getAll",resultDecoder:m0},set:{name:"set",dataDecoder:wh},update:{name:"update",dataDecoder:wh},prefsChanged:{name:"prefsChanged",dataDecoder:vh},prefsHello:{name:"prefsHello",resultDecoder:v0},operationCheck:{name:"operationCheck"},registerSubscriber:{name:"registerSubscriber",dataDecoder:y0}};class PI{constructor(){c(this,"supportedOperationsNames",[]);c(this,"bridge");c(this,"config");c(this,"logger");c(this,"appManagerController");c(this,"platformAppName");c(this,"registry",fn());c(this,"validNonExistentApps");c(this,"signaledSubscription",!1);c(this,"interopId")}handlePlatformShutdown(){this.registry.clear()}async start(e,n){this.logger=e.logger.subLogger("prefs.controller.web"),this.logger.trace("starting the web prefs controller"),this.addOperationsExecutors(),this.interopId=e.interop.instance.instance,this.bridge=n.bridge,this.config=n.config,this.appManagerController=n.appManagerController;try{const i=await this.bridge.send("prefs",mt.prefsHello,void 0,void 0,{includeOperationCheck:!0});this.platformAppName=i.platform.app,this.validNonExistentApps=i.validNonExistentApps??[]}catch{this.logger.warn("The platform of this client is outdated and does not support Prefs API.");return}this.logger.trace("no need for platform registration, attaching the prefs property to glue and returning");const r=this.toApi();e.prefs=r}async handleBridgeMessage(e){const n=A(g0,e.operation),r=mt[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}async get(e){const n=e==null?this.getMyAppName():A(b,e),{prefs:r}=await this.bridge.send("prefs",mt.get,{app:n},void 0,{includeOperationCheck:!0});return r}async update(e,n){const r=A(d(No),n),i=(r==null?void 0:r.app)??this.getMyAppName();await this.updateFor(i,e)}addOperationsExecutors(){mt.prefsChanged.execute=this.handleOnChanged.bind(this),mt.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),this.supportedOperationsNames=Un(mt)}toApi(){return{clear:this.clear.bind(this),clearAll:this.clearAll.bind(this),clearFor:this.clearFor.bind(this),get:this.get.bind(this),getAll:this.getAll.bind(this),set:this.set.bind(this),setFor:this.setFor.bind(this),subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),update:this.update.bind(this),updateFor:this.updateFor.bind(this)}}async clear(){const e=this.getMyAppName();await this.clearFor(e)}async clearAll(){await this.bridge.send("prefs",mt.clearAll,void 0,void 0,{includeOperationCheck:!0})}async clearFor(e){const n=A(b,e);await this.bridge.send("prefs",mt.clear,{app:n},void 0,{includeOperationCheck:!0})}async getAll(){return await this.bridge.send("prefs",mt.getAll,void 0,void 0,{includeOperationCheck:!0})}async set(e,n){const r=A(d(No),n),i=(r==null?void 0:r.app)??this.getMyAppName();await this.setFor(i,e)}async setFor(e,n){const r=A(b,e),i=A(y(),n);await this.bridge.send("prefs",mt.set,{app:r,data:i},void 0,{includeOperationCheck:!0})}subscribe(e){const n=this.getMyAppName();return this.subscribeFor(n,e)}subscribeFor(e,n){const r=A(b,e),i=this.appManagerController.getApplications();if(!(r===this.platformAppName||i.some(a=>a.name===r)||this.validNonExistentApps.includes(r)))return N.raiseError(`The provided app name "${e}" is not valid.`);if(typeof n!="function")return N.raiseError("Cannot subscribe to prefs, because the provided callback is not a function!");this.signaledSubscription||(this.bridge.send("prefs",mt.registerSubscriber,{interopId:this.interopId},void 0,{includeOperationCheck:!0}).catch(a=>{this.logger.warn("Failed to register subscriber for prefs"),this.logger.error(a)}),this.signaledSubscription=!0);const o=this.getSubscriptionKey(r);return this.get(r).then(n),this.registry.add(o,n)}async updateFor(e,n){const r=A(b,e),i=A(y(),n);await this.bridge.send("prefs",mt.update,{app:r,data:i},void 0,{includeOperationCheck:!0})}getMyAppName(){var n;const e=this.config.isPlatformInternal?this.platformAppName:(n=this.appManagerController.me)==null?void 0:n.application.name;return e||N.raiseError("App Preferences operations can not be executed for windows that do not have app!")}getSubscriptionKey(e){return`prefs-changed-${e}`}async handleOnChanged({prefs:e}){const n=this.getSubscriptionKey(e.app);this.registry.execute(n,e)}}const vn={getResources:{name:"getResources",dataDecoder:P0,resultDecoder:F0},operationCheck:{name:"operationCheck",dataDecoder:Wg,resultDecoder:jg},showAlert:{name:"showAlert",dataDecoder:j0},showDialog:{name:"showDialog",dataDecoder:U0},alertInteropAction:{name:"alertInteropAction",dataDecoder:q0},showResolver:{name:"showResolver",dataDecoder:tI,resultDecoder:nI}},DI=5*1e3,Ph="io-modals-shadow-host",xI="io-modals-root",Dh="io-widget-shadow-host",AI="io-widget-root",xh="io-intent-resolver-shadow-host",NI="io-intent-resolver-root",OI="io-body io-variables";class MI{constructor(e){c(this,"ioc");c(this,"supportedOperationsNames",[]);c(this,"logger");c(this,"bridge");c(this,"config");c(this,"zIndexDictionary",{[Dh]:"100",[Ph]:"101",[xh]:"100"});c(this,"widgetResources");c(this,"modalsResources");c(this,"intentResolverResources");c(this,"modalsUiApi");c(this,"isDialogOpen",!1);c(this,"intentResolverUiApi");c(this,"isIntentResolverOpen",!1);this.ioc=e}async start(e,n){this.logger=e.logger.subLogger("ui.controller.web"),this.logger.trace("starting the ui controller"),this.bridge=n.bridge,this.config=n.config,this.addOperationsExecutors();const r=await this.getResources();if(!r){this.logger.trace("No UI elements to display - platform is not initialized with any UI resources");return}this.logger.trace(`Received UI resources from platform: ${JSON.stringify(r)}`),this.setResources(r)}async handleBridgeMessage(e){const n=A(R0,e.operation),r=vn[n];if(!r.execute)return;let i=e.data;return r.dataDecoder&&(i=A(r.dataDecoder,e.data)),await r.execute(i)}async showComponents(e){const n=this.widgetResources?this.initializeWidget(e,this.widgetResources):Promise.resolve(),r=this.modalsResources?this.initializeModalsUi(e,this.modalsResources):Promise.resolve(),i=this.intentResolverResources?this.initializeIntentResolverUI(e,this.intentResolverResources):Promise.resolve();await Promise.all([this.config.widget.awaitFactory?n:Promise.resolve(),this.config.modals.awaitFactory?r:Promise.resolve(),this.config.intentResolver.awaitFactory?i:Promise.resolve()])}isIntentResolverEnabled(){return!!this.intentResolverResources&&this.config.intentResolver.enable}addOperationsExecutors(){vn.operationCheck.execute=async e=>zn(this.supportedOperationsNames,e.operation),vn.showAlert.execute=this.handleShowAlert.bind(this),vn.showDialog.execute=this.handleShowDialog.bind(this),vn.showResolver.execute=this.handleShowResolver.bind(this),this.supportedOperationsNames=Un(vn)}async handleShowAlert({config:e}){if(!this.config.modals.alerts.enabled)return N.raiseError("Unable to perform showAlert operation because the client was initialized with 'modals: { alerts: { enabled: false } }' config.");const n=this.modalsUiApi;if(!n)return N.raiseError("Unable to perform showAlert operation because modalsUiApi is missing.");const{promise:r,resolve:i}=Ka(),s=u=>{const p=G0.run(u);if(!p.ok){this.logger.error(`alert.onClick() was invoked with an invalid config. Error: ${JSON.stringify(p.error)}.`);return}const{interopAction:g}=p.result;this.bridge.send("ui",vn.alertInteropAction,{interopAction:g},void 0,{includeOperationCheck:!0}).catch(f=>this.logger.warn($t(f)))};let o;try{this.logger.trace(`Open alert with config: ${JSON.stringify(e)}`),o=n.alerts.open({...e,onClick:s,onClose:i})}catch(u){return N.raiseError(`modalsUiApi.alerts.open() failed. Reason: ${$t(u)}.`)}const a=z0.run(o);if(!a.ok)return N.raiseError(`modalsUiApi.alerts.open() returned an invalid result. Error: ${JSON.stringify(a.error)}.`);const l=setTimeout(()=>{i()},Ja(e.ttl??DI));r.then(()=>{clearTimeout(l);try{n.alerts.close({id:a.result.id})}catch(u){this.logger.warn(`Failed to close alert with id ${a.result.id}. Reason: ${$t(u)}`)}})}async handleShowDialog({config:e}){if(!this.config.modals.dialogs.enabled)return N.raiseError("Unable to perform showDialog operation because the client was initialized with 'modals: { dialogs: { enabled: false } }' config.");const n=this.modalsUiApi;if(!n)return N.raiseError("Unable to perform showDialog operation because modalsUiApi is missing.");if(this.isDialogOpen)return N.raiseError("Cannot open a dialog because another one is already open.");const{promise:r,resolve:i}=Ka();let s;try{this.logger.trace(`Open dialog with config: ${JSON.stringify(e)}`),s=n.dialogs.open({...e,onCompletion:i})}catch(p){return N.raiseError(`modalsUiApi.dialogs.open() failed. Reason: ${$t(p)}.`)}const o=B0.run(s);if(!o.ok)return N.raiseError(`modalsUiApi.dialogs.open() returned an invalid result. Error: ${JSON.stringify(o.error)}.`);this.isDialogOpen=!0;let a;e.timer&&(a=setTimeout(()=>{i({response:{isExpired:!0}})},Ja(e.timer.duration)));const l=await r;clearTimeout(a),this.isDialogOpen=!1;try{n.dialogs.close({id:o.result.id})}catch(p){this.logger.warn(`Failed to close dialog with id ${o.result.id}. Reason: ${$t(p)}`)}const u=H0.run(l);return u.ok?{result:u.result.response}:N.raiseError(`completionPromise was resolved with an invalid result. Error: ${JSON.stringify(u.error)}.`)}async handleShowResolver({config:e}){if(this.logger.trace(`Received open intent resolver request with config: ${JSON.stringify(e)}`),!this.config.intentResolver.enable)return N.raiseError("Unable to perform showResolver operation because the client was initialized with 'intentResolver: { enable: false }' config.");const n=this.intentResolverUiApi;if(!n)return N.raiseError("Unable to perform showResolver operation because intentResolverApi is missing.");if(this.isIntentResolverOpen)return N.raiseError("Cannot open the intent resolver because another one is already open.");const{promise:r,resolve:i}=Ka();let s;try{this.logger.trace(`Open intent resolver with config: ${JSON.stringify(e)}`),s=n.open({...e,onUserResponse:i})}catch(p){return N.raiseError(`intentResolverUI.open() failed. Reason: ${$t(p)}.`)}const o=V0.run(s);if(!o.ok)return N.raiseError(`intentResolverUI.open() returned an invalid result. Error: ${JSON.stringify(o.error)}.`);const a=setTimeout(()=>i({response:{isExpired:!0}}),Ja(e.timeout)),l=await r;clearTimeout(a),this.isIntentResolverOpen=!1;try{n.close({id:o.result.id})}catch(p){this.logger.warn(`Failed to close intent resolver with id ${o.result.id}. Reason: ${$t(p)}`)}const u=Q0.run(l);return u.ok?{result:u.result.response}:N.raiseError(`completionPromise was resolved with an invalid result. Error: ${JSON.stringify(u.error)}.`)}async getResources(){const e={origin:window.origin};try{return(await this.bridge.send("ui",vn.getResources,e,void 0,{includeOperationCheck:!0})).resources}catch(n){this.logger.warn((n==null?void 0:n.message)||JSON.stringify(n))}}appendModalsResources(e){return this.logger.trace("Appending modals resources"),this.appendResources(Ph,xI,e.sources)}appendWidgetResources(e){return this.logger.trace("Appending widget resources"),this.appendResources(Dh,AI,e.sources)}appendIntentResolverResources(e){return this.logger.trace("Appending intent resolver resources"),this.appendResources(xh,NI,e.sources)}appendResources(e,n,r){const{bundle:i,fonts:s=[],styles:o}=r,a=document.createElement("div");a.id=e,a.style.position="fixed",a.style.zIndex=this.zIndexDictionary[e];const l=a.attachShadow({mode:"open"}),u=document.createElement("script");u.src=i,u.type="module",l.appendChild(u);const p=document.createElement("div");return p.id=n,p.className=OI,l.appendChild(p),o.forEach(g=>{const f=document.createElement("link");f.rel="stylesheet",f.href=g,l.appendChild(f)}),s.forEach(g=>{const f=document.createElement("link");f.rel="stylesheet",f.href=g,document.head.insertBefore(f,document.head.firstChild)}),document.body.appendChild(a),{rootElement:p}}async initializeWidget(e,n){this.logger.trace("Initializing IOBrowserWidget.");const{rootElement:r}=this.appendWidgetResources(n);this.subscribeForThemeChanges(e,r);const i={...Xs(n.config,this.config.widget),rootElement:r};return no(async()=>{await this.ioc.eventsDispatcher.widgetReady(),this.logger.trace(`IOBrowserWidget factory is available. Invoking it with config: ${JSON.stringify(i)}`),await window.IOBrowserWidget(e,i),this.logger.trace("IOBrowserWidget was initialized successfully.")},i.timeout,`Timeout of ${i.timeout}ms hit waiting for IOBrowserWidget to initialize.`)}async initializeModalsUi(e,n){this.logger.trace("Initializing IOBrowserModalsUI.");const{rootElement:r}=this.appendModalsResources(n);this.subscribeForThemeChanges(e,r);const i={...this.config.modals,rootElement:r};return no(async()=>{await this.ioc.eventsDispatcher.modalsUIFactoryReady(),this.logger.trace(`IOBrowserModalsUI factory is available. Invoking it with config: ${JSON.stringify(i)}`),this.modalsUiApi=await window.IOBrowserModalsUI(e,i),this.logger.trace("IOBrowserModalsUI was initialized successfully.")},i.timeout,`Timeout of ${i.timeout}ms hit waiting for IOBrowserModalsUI to initialize.`)}async initializeIntentResolverUI(e,n){this.logger.trace("Initializing IOBrowserIntentResolverUI.");const{rootElement:r}=this.appendIntentResolverResources(n);this.subscribeForThemeChanges(e,r);const i={...this.config.intentResolver,rootElement:r},s=i.timeout;return no(async()=>{await this.ioc.eventsDispatcher.intentResolverUIFactoryReady(),this.logger.trace(`IOBrowserIntentResolverUI factory is available. Invoking it with config: ${JSON.stringify(i)}`),this.intentResolverUiApi=await window.IOBrowserIntentResolverUI(e,i),this.logger.trace("IOBrowserIntentResolverUI initialized successfully.")},s,`Timeout of ${s}ms hit waiting for IOBrowserIntentResolverUI to initialize.`)}setResources(e){this.setWidgetResources(e.widget),this.setModalsUiResources(e.modals),this.setIntentResolverResources(e.intentResolver)}setWidgetResources(e){const n="Widget won't be displayed. Reason: ",r=Qg.run(this.config.widget);if(!r.ok){this.logger.warn(`${n} invalid widget config. Error: ${r.error}`);return}if(!this.config.widget.enable){this.logger.trace(`${n} Client initialized with 'widget: { enable: false }' config`);return}if(!e){this.logger.trace(`${n} Platform did not provide resources`);return}if(e.blockedOrigin){this.logger.warn(`${n} Platform has blocked client's origin ('${window.location.toString()}') from retrieving widget resources`);return}this.widgetResources=e}setModalsUiResources(e){const n="Modals won't be displayed. Reason: ",r=Yg.run(this.config.modals);if(!r.ok){this.logger.warn(`${n} invalid modals config. Error: ${r.error}`);return}if(!this.config.modals.alerts.enabled&&!this.config.modals.dialogs.enabled){this.logger.trace(`${n} Client initialized with 'modals: { alerts: { enabled: false }, dialogs: { enabled: false } }' config`);return}if(!e){this.logger.trace(`${n} Platform did not provide resources`);return}if(e.blockedOrigin){this.logger.warn(`${n} Platform has blocked client's origin ('${window.location.toString()}') from retrieving modals resources`);return}this.modalsResources=e}setIntentResolverResources(e){const n="Intent Resolver UI won't be displayed. Reason: ",r=nm.run(this.config.intentResolver);if(!r.ok){this.logger.warn(`${n} invalid intent resolver config. Error: ${JSON.stringify(r.error)}`);return}if(!this.config.intentResolver.enable){this.logger.trace(`${n} Client initialized with 'intentResolver: { enable: false }' config`);return}if(!e){this.logger.trace(`${n} Platform did not provide resources`);return}if(e.blockedOrigin){this.logger.warn(`${n} Platform has blocked client's origin ('${window.location.toString()}') from retrieving intent resolver resources`);return}this.intentResolverResources=e}subscribeForThemeChanges(e,n){const r=e.themes;if(!r)return;const i=async s=>{if(n.classList.contains(s.name))return;const o=await r.list();n.classList.remove(...o.map(({name:a})=>a)),n.classList.add(s.name)};r.onChanged(i),r.getCurrent().then(i)}}class LI{constructor(){c(this,"_coreGlue");c(this,"_communicationId");c(this,"_publicWindowId");c(this,"_webConfig");c(this,"_windowsControllerInstance");c(this,"_appManagerControllerInstance");c(this,"_layoutsControllerInstance");c(this,"_notificationsControllerInstance");c(this,"_intentsControllerInstance");c(this,"_channelsControllerInstance");c(this,"_themesControllerInstance");c(this,"_extensionController");c(this,"_systemControllerInstance");c(this,"_bridgeInstance");c(this,"_eventsDispatcher");c(this,"_preferredConnectionController");c(this,"_sessionController");c(this,"_prefsControllerInstance");c(this,"_uiController");c(this,"controllers",{windows:this.windowsController,appManager:this.appManagerController,layouts:this.layoutsController,notifications:this.notificationsController,intents:this.intentsController,channels:this.channelsController,system:this.systemController,extension:this.extensionController,themes:this.themesController,prefs:this.prefsController,ui:this.uiController})}get communicationId(){return this._communicationId}get publicWindowId(){return this._publicWindowId}get windowsController(){return this._windowsControllerInstance||(this._windowsControllerInstance=new lI),this._windowsControllerInstance}get uiController(){return this._uiController||(this._uiController=new MI(this)),this._uiController}get appManagerController(){return this._appManagerControllerInstance||(this._appManagerControllerInstance=new uI),this._appManagerControllerInstance}get layoutsController(){return this._layoutsControllerInstance||(this._layoutsControllerInstance=new fI),this._layoutsControllerInstance}get themesController(){return this._themesControllerInstance||(this._themesControllerInstance=new TI),this._themesControllerInstance}get notificationsController(){return this._notificationsControllerInstance||(this._notificationsControllerInstance=new gI),this._notificationsControllerInstance}get intentsController(){return this._intentsControllerInstance||(this._intentsControllerInstance=new yI),this._intentsControllerInstance}get systemController(){return this._systemControllerInstance||(this._systemControllerInstance=new bI),this._systemControllerInstance}get channelsController(){return this._channelsControllerInstance||(this._channelsControllerInstance=new wI),this._channelsControllerInstance}get prefsController(){return this._prefsControllerInstance||(this._prefsControllerInstance=new PI),this._prefsControllerInstance}get extensionController(){return this._extensionController||(this._extensionController=new _I),this._extensionController}get eventsDispatcher(){return this._eventsDispatcher||(this._eventsDispatcher=new EI(this.config)),this._eventsDispatcher}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new cI(this._coreGlue,this.communicationId)),this._bridgeInstance}get preferredConnectionController(){return this._preferredConnectionController||(this._preferredConnectionController=new kI(this._coreGlue)),this._preferredConnectionController}get sessionController(){return this._sessionController||(this._sessionController=new RI),this._sessionController}get config(){return this._webConfig}defineGlue(e){this._coreGlue=e,this._publicWindowId=e.connection.transport.publicWindowId;const n=window.glue42core||window.iobrowser;this._communicationId=e.connection.transport.communicationId||n.communicationId}defineConfig(e){this._webConfig=e}async buildWebWindow(e,n){const r=new aI(e,n,this.bridge),i=await r.toApi();return{id:e,model:r,api:i}}buildNotification(e,n){return new CI(e,n)}async buildApplication(e,n){const r=new hI(e,[],this.appManagerController).toApi(),i=n.map(s=>this.buildInstance(s,r));return r.instances.push(...i),r}buildInstance(e,n){return new dI(e,this.bridge,n).toApi()}}var am="4.0.0";const lm=(t,e)=>({getContainerInfo:async()=>{if(window!==window.parent)return window.name.includes("#wsp")?{workspaceFrame:{id:"N/A"}}:window.parent===window.top?{top:{}}:{parent:{}}},getProfileData:async()=>{if(!e)throw new Error("Bridge is not available and cannot fetch the profile data");return await e.send("system",{name:"getProfileData"},void 0)}}),FI=t=>{let e;const n=async i=>{const s=new LI,o=await no(()=>t(i,{version:am}),3e4,"Glue Web initialization timed out, because core didn't resolve"),a=o.logger.subLogger("web.main.controller");s.defineGlue(o),s.sessionController.configure({windowId:o.interop.instance.instance}),await s.preferredConnectionController.start(i),await s.bridge.start(s.controllers),s.defineConfig(i),a.trace("the bridge has been started, initializing all controllers"),await Promise.all(Object.values(s.controllers).map(l=>l.start(o,s))),a.trace("all controllers reported started, starting all additional libraries");try{return await Promise.all(i.libraries.map(l=>l(o,i))),a.trace("all libraries were started"),s.eventsDispatcher.start(o),a.trace("start event dispatched, glue is ready, returning it"),await s.uiController.showComponents(o).catch(l=>a.warn(l!=null&&l.message?l.message:JSON.stringify(l))),await Promise.all(Object.values(s.controllers).map(l=>l.postStart?l.postStart(o,s):Promise.resolve())),window.iobrowser.system=lm(o,s.bridge),window.iobrowser=Object.freeze({...window.iobrowser}),o}catch(l){return N.raiseError(l,!0)}};return i=>{if(window.glue42gd||window.iodesktop)return sI(i);const s=rI(i);try{iI()}catch(a){return typeof e>"u"?Promise.reject(new Error(a)):e}const o=n(s);return e=i!=null&&i.memoizeAPI?o:void 0,o}};var bt={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function cm(t){return t.type===bt.TIMESTAMP?"timestamp":t.type===bt.NUMBER?"number":t.type===bt.STRING?"string":t.type===bt.OBJECT?"object":"unknown"}function um(t){return t.constructor===Date?"timestamp":typeof t=="number"?"number":typeof t=="string"?"string":typeof t=="object"?"object":"string"}function $I(t){const e={},n=cm(t);if(n==="object"){const r=Object.keys(t.value).reduce((i,s)=>{const o=um(t.value[s]);if(o==="object"){const a=dm(t.value[s]);i[s]={type:"object",description:"",context:{},composite:a}}else i[s]={type:o,description:"",context:{}};return i},{});e.composite=r}return e.name=ro(t.path.join("/")+"/"+t.name),e.type=n,e.description=t.description,e.context={},e}function dm(t){return Object.keys(t).reduce((e,n)=>{const r=um(t[n]);return r==="object"?e[n]={type:"object",description:"",context:{},composite:dm(t[n])}:e[n]={type:r,description:"",context:{}},e},{})}function ro(t){return typeof t<"u"&&t.length>0&&t[0]!=="/"?"/"+t:t}function jI(t){return cm(t)==="timestamp"?Date.now():hm(t.value)}function hm(t){return typeof t!="object"?t:Object.keys(t).reduce((e,n)=>{const r=t[n];return typeof r=="object"&&r.constructor!==Date?e[n]=hm(r):r.constructor===Date?e[n]=new Date(r).getTime():r.constructor===Boolean?e[n]=r.toString():e[n]=r,e},{})}function fm(t){return t.reduce((e,n)=>e.concat(Array.isArray(n)?fm(n):n),[])}function WI(t){return t.sort((e,n)=>e.state?n.state?n.state-e.state:-1:1)[0]}function UI(t){let e="";return t.forEach((n,r,i)=>{const s=n.path.join(".");r===i.length-1?e+=s+"."+n.name+": "+n.description:e+=s+"."+n.name+": "+n.description+","}),e.length>100?e.slice(0,100)+"...":e}function zI(t){const e=t.root.getAggregateState(),n=fm(e),r=WI(n);return{description:UI(n),value:r.state}}function BI(t,e){if(!t||typeof t!="object")throw new Error("Connection is required parameter");let n,r;const i=S=>{let k;n=new Promise(H=>{k=H}),r=t.domain("metrics"),r.onJoined(H=>{!H&&k&&(k(),k=void 0);const m={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(m),H&&s(S)}),r.join({system:e.system,service:e.service,instance:e.instance})},s=S=>{o(S.root)},o=S=>{a(S),S.metrics.forEach(k=>{u(k)}),S.subSystems.forEach(k=>{o(k)})},a=async S=>{if(S.parent===void 0)return;await n;const H={type:"define",metrics:[{name:ro(S.path.join("/")+"/"+S.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(H)},l=async(S,k)=>{await n;const H={type:"publish",values:[{name:ro(S.path.join("/")+"/"+S.name+"/State"),value:{Description:k.description,Value:k.state},timestamp:Date.now()}]};r.send(H);const C=zI(S),m={type:"publish",peer_id:t.peerId,values:[{name:"/State",value:{Description:C.description,Value:C.value},timestamp:Date.now()}]};r.send(m)},u=async S=>{const k=f(S);await n;const C={type:"define",metrics:[$I(k)]};r.send(C),typeof k.value<"u"&&g(k)},p=async S=>{const k=f(S);await n,g(k)},g=S=>{if(I()){const k=jI(S),H={type:"publish",values:[{name:ro(S.path.join("/")+"/"+S.name),value:k,timestamp:Date.now()}]};return r.sendFireAndForget(H)}return Promise.resolve()},f=S=>{const k={...S};return typeof S.value=="object"&&S.value!==null&&(k.value={...S.value}),k},I=()=>{try{return(e.canUpdateMetric??(()=>!0))()}catch{return!0}};return{init:i,createSystem:a,updateSystem:l,createMetric:u,updateMetric:p}}var HI={validate:(t,e,n)=>{if(t===null||typeof t!="object")throw new Error("Missing definition");if(e===null||typeof e!="object")throw new Error("Missing parent");if(n===null||typeof n!="object")throw new Error("Missing transport")}};class la{constructor(e,n,r,i,s){c(this,"definition");c(this,"system");c(this,"transport");c(this,"value");c(this,"type");c(this,"path",[]);c(this,"name");c(this,"description");this.definition=e,this.system=n,this.transport=r,this.value=i,this.type=s,HI.validate(e,n,r),this.path=n.path.slice(0),this.path.push(n.name),this.name=e.name,this.description=e.description,r.createMetric(this)}get repo(){var e;return(e=this.system)==null?void 0:e.repo}get id(){return`${this.system.path}/${name}`}update(e){return this.value=e,this.transport.updateMetric(this)}}class GI extends la{constructor(e,n,r,i){super(e,n,r,i,bt.NUMBER)}incrementBy(e){this.update(this.value+e)}increment(){this.incrementBy(1)}decrement(){this.incrementBy(-1)}decrementBy(e){this.incrementBy(e*-1)}}class qI extends la{constructor(e,n,r,i){super(e,n,r,i,bt.OBJECT)}update(e){return this.mergeValues(e),this.transport.updateMetric(this)}mergeValues(e){return Object.keys(this.value).forEach(n=>{typeof e[n]<"u"&&(this.value[n]=e[n])})}}class VI extends la{constructor(e,n,r,i){super(e,n,r,i,bt.STRING)}}class JI extends la{constructor(e,n,r,i){super(e,n,r,i,bt.TIMESTAMP)}now(){this.update(new Date)}}function pm(t,e,n,r,i){if(!e)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");const s=n,o=t,a=i||"",l=e,u=r,p=j(r);let g={};const f=T(p,"/")+t,I=e.root,S=[],k=[];function H(D,O){if(!D||D.length===0)throw new Error("name is required");const $=S.filter(Y=>Y.name===D);if($.length>0)return $[0];const Z=pm(D,l,s,P,O);return S.push(Z),Z}function C(D,O){g={state:D,description:O},s.updateSystem(P,g)}function m(D,O){return L(D,bt.STRING,O,$=>new VI($,P,s,O))}function v(D,O){return L(D,bt.NUMBER,O,$=>new GI($,P,s,O))}function E(D,O){return L(D,bt.OBJECT,O,$=>new qI($,P,s,O))}function x(D,O){return L(D,bt.TIMESTAMP,O,$=>new JI($,P,s,O))}function L(D,O,$,Z){let Y={name:""};typeof D=="string"?Y={name:D}:Y=D;const Xe=k.filter(U=>U.name===Y.name);if(Xe.length>0){const U=Xe[0];if(U.type!==O)throw new Error(`A metric named ${Y.name} is already defined with different type.`);return typeof $<"u"&&U.update($).catch(()=>{}),U}const Ot=Z(Y);return k.push(Ot),Ot}function j(D){if(!D||!D.parent)return[];const O=j(D.parent);return O.push(D.name),O}function T(D,O){return D&&D.length>0?D.join(O):""}function J(){const D=[];return Object.keys(g).length>0&&D.push({name:o,path:p,state:g.state,description:g.description}),S.forEach(O=>{const $=O.getAggregateState();$.length>0&&D.push(...$)}),D}const P={get name(){return o},get description(){return a},get repo(){return l},get parent(){return u},path:p,id:f,root:I,get subSystems(){return S},get metrics(){return k},subSystem:H,getState:()=>g,setState:C,stringMetric:m,timestampMetric:x,objectMetric:E,numberMetric:v,getAggregateState:J};return s.createSystem(P),P}class KI{constructor(e,n){c(this,"root");n.init(this),this.root=pm("",this,n),this.addSystemMetrics(this.root,e.clickStream||e.clickStream===void 0)}addSystemMetrics(e,n){if(typeof navigator<"u"&&e.stringMetric("UserAgent",navigator.userAgent),n&&typeof document<"u"){const s=e.subSystem("ClickStream"),o=a=>{if(!a.target)return;const l=a.target,u=l?l.getAttribute("class")??"":"";s.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:u,id:l.id,type:"<"+l.tagName.toLowerCase()+">",href:l.href||""}})};s.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",o):document.attachEvent("onclick",o)}e.stringMetric("StartTime",new Date().toString());const r=e.stringMetric("StartURL",""),i=e.stringMetric("AppName","");if(typeof window<"u"){if(typeof window.location<"u"){const s=window.location.href;r.update(s)}typeof window.glue42gd<"u"&&i.update(window.glue42gd.appName)}}}class QI{init(e){}createSystem(e){return Promise.resolve()}updateSystem(e,n){return Promise.resolve()}createMetric(e){return Promise.resolve()}updateMetric(e){return Promise.resolve()}}class YI{constructor(e,n,r){c(this,"api");c(this,"lastCount",0);c(this,"initialPublishTimeout",10*1e3);c(this,"publishInterval",60*1e3);c(this,"system");this.api=e,this.initialPublishTimeout=n??this.initialPublishTimeout,this.publishInterval=r??this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}scheduleCollection(){setTimeout(()=>{this.collect(),setInterval(()=>{this.collect()},this.publishInterval)},this.initialPublishTimeout)}collect(){try{this.collectMemory(),this.collectEntries()}catch{}}collectMemory(){const e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))}collectEntries(){const e=window.performance.getEntries();if(e.length<=this.lastCount)return;this.lastCount=e.length;const n=e.map(r=>r.toJSON());this.system.stringMetric("entries",JSON.stringify(n))}}var XI=t=>{let e;!t.connection||typeof t.connection!="object"?e=new QI:e=BI(t.connection,t);let r=new KI(t,e).root;t.disableAutoAppSystem||(r=r.subSystem("App"));const i=e_(r);return ZI(i,t.pagePerformanceMetrics),i};function ZI(t,e){var r,i;if(typeof window>"u")return;const n=(i=(r=window==null?void 0:window.glue42gd)==null?void 0:r.metrics)==null?void 0:i.pagePerformanceMetrics;n&&(e=n),e!=null&&e.enabled&&new YI(t,e.initialPublishTimeout,e.publishInterval)}function e_(t){const e=t.subSystem("reporting"),n={name:"features"};let r;const i=(s,o,a)=>{if(typeof s>"u"||s==="")throw new Error("name is mandatory");if(typeof o>"u"||o==="")throw new Error("action is mandatory");if(typeof a>"u"||a==="")throw new Error("payload is mandatory");r?r.update({name:s,action:o,payload:a}):r=e.objectMetric(n,{name:s,action:o,payload:a})};return t.featureMetric=i,t}var Ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gm(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function dc(t){if(t&&t.errorHandling&&typeof t.errorHandling!="function"&&t.errorHandling!=="log"&&t.errorHandling!=="silent"&&t.errorHandling!=="throw")throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof t.errorHandling+" was passed");var e=t&&typeof t.errorHandling=="function"&&t.errorHandling,n={};function r(l,u,p){var g=n[l];return g||(g=[],n[l]=g),g.push(u),p&&setTimeout(function(){p.forEach(function(f){var I;if(!((I=n[l])===null||I===void 0)&&I.includes(u))try{Array.isArray(f)?u.apply(void 0,f):u.apply(void 0,[f])}catch(S){s(S,l)}})},0),function(){var f=n[l];f&&(f=f.reduce(function(I,S,k){return S===u&&I.length===k||I.push(S),I},[]),f.length===0?delete n[l]:n[l]=f)}}function i(l){for(var u=[],p=1;p<arguments.length;p++)u[p-1]=arguments[p];var g=n[l];if(!g||g.length===0)return[];var f=[];return g.forEach(function(I){try{var S=I.apply(void 0,u);f.push(S)}catch(k){f.push(void 0),s(k,l)}}),f}function s(l,u){var p=l instanceof Error?l:new Error(l);if(e){e(p);return}var g='[ERROR] callback-registry: User callback for key "'+u+'" failed: '+p.stack;if(t)switch(t.errorHandling){case"log":return console.error(g);case"silent":return;case"throw":throw new Error(g)}console.error(g)}function o(){n={}}function a(l){var u=n[l];u&&delete n[l]}return{add:r,execute:i,clear:o,clearKey:a}}dc.default=dc;var t_=dc,pn=gm(t_);class n_{constructor(e,n){c(this,"gw");c(this,"registry",pn());c(this,"client");this.gw=e.facade,this.gw.connect((r,i)=>{this.messageHandler(i)}).then(r=>{this.client=r})}get isObjectBasedTransport(){return!0}sendObject(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")}send(e){return Promise.reject("not supported")}onMessage(e){return this.registry.add("onMessage",e)}onConnectedChanged(e){return e(!0),()=>{}}close(){return Promise.resolve()}open(){return Promise.resolve()}name(){return"in-memory"}reconnect(){return Promise.resolve()}messageHandler(e){this.registry.execute("onMessage",e)}}class r_{constructor(e,n){c(this,"logger");c(this,"worker");c(this,"registry",pn());this.logger=n,this.worker=new SharedWorker(e),this.worker.port.onmessage=r=>{this.messageHandler(r.data)}}get isObjectBasedTransport(){return!0}sendObject(e){return this.worker.port.postMessage(e),Promise.resolve()}send(e){return Promise.reject("not supported")}onMessage(e){return this.registry.add("onMessage",e)}onConnectedChanged(e){return e(!0),()=>{}}close(){return Promise.resolve()}open(){return Promise.resolve()}name(){return"shared-worker"}reconnect(){return Promise.resolve()}messageHandler(e){this.registry.execute("onMessage",e)}}const Xt=class Xt{static isNode(){if(typeof Xt._isNode<"u")return Xt._isNode;if(typeof window<"u")return Xt._isNode=!1,!1;try{Xt._isNode=Object.prototype.toString.call(global.process)==="[object process]"}catch{Xt._isNode=!1}return Xt._isNode}};c(Xt,"_isNode");let nn=Xt;class Oo{constructor(){c(this,"resolve");c(this,"reject");c(this,"promise");c(this,"rejected",!1);c(this,"resolved",!1);this.promise=new Promise((e,n)=>{this.resolve=r=>{this.resolved=!0,e(r)},this.reject=r=>{this.rejected=!0,n(r)}})}static delay(e){return new Promise(n=>setTimeout(n,e))}get ended(){return this.rejected||this.resolved}}const hc={};function i_(){return hc}function Tt(t){const e=hc[t];if(e)return e;const n=[];function r(){return new Date().getTime()}const i=r();l("start",i);let s,o;function a(){return s=r(),l("end",s),o=s-i,o}function l(p,g){const f=g??r();let I=0;n.length>0&&(I=f-n[n.length-1].time),n.push({name:p,time:f,diff:I})}const u={get startTime(){return i},get endTime(){return s},get period(){return o},stop:a,mark:l,marks:n};return hc[t]=u,u}const s_=nn.isNode()?null:window.WebSocket;class Ah{constructor(e,n){c(this,"ws");c(this,"logger");c(this,"settings");c(this,"startupTimer",Tt("connection"));c(this,"_running",!0);c(this,"_registry",pn());c(this,"wsRequests",[]);if(this.settings=e,this.logger=n,!this.settings.ws)throw new Error("ws is missing")}onMessage(e){return this._registry.add("onMessage",e)}send(e,n){return new Promise((r,i)=>{this.waitForSocketConnection(()=>{var s;try{(s=this.ws)==null||s.send(e),r()}catch(o){i(o)}},i)})}open(){return this.logger.info("opening ws..."),this._running=!0,new Promise((e,n)=>{this.waitForSocketConnection(e,n)})}close(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()}onConnectedChanged(e){return this._registry.add("onConnectedChanged",e)}name(){return this.settings.ws}reconnect(){var n;(n=this.ws)==null||n.close();const e=new Oo;return this.waitForSocketConnection(()=>{e.resolve()}),e.promise}waitForSocketConnection(e,n){var r;if(n=n??(()=>{}),!this._running){n(`wait for socket on ${this.settings.ws} failed - socket closed by user`);return}if(((r=this.ws)==null?void 0:r.readyState)===1){e();return}this.wsRequests.push({callback:e,failed:n}),!(this.wsRequests.length>1)&&this.openSocket()}async openSocket(e,n){if(this.logger.info(`opening ws to ${this.settings.ws}, retryInterval: ${e}, retriesLeft: ${n}...`),this.startupTimer.mark("opening-socket"),e===void 0&&(e=this.settings.reconnectInterval),typeof n>"u"&&(n=this.settings.reconnectAttempts),n!==void 0){if(n===0){this.notifyForSocketState(`wait for socket on ${this.settings.ws} failed - no more retries left`);return}this.logger.debug(`will retry ${n} more times (every ${e} ms)`)}try{await this.initiateSocket(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState()}catch{setTimeout(()=>{const r=n===void 0?void 0:n-1;this.openSocket(e,r)},e)}}initiateSocket(){const e=new Oo;return this.logger.debug(`initiating ws to ${this.settings.ws}...`),this.ws=new s_(this.settings.ws??""),this.ws.onerror=n=>{let r="";try{r=JSON.stringify(n)}catch{const s=new WeakSet;r=JSON.stringify(n,(a,l)=>{if(typeof l=="object"&&l!==null){if(s.has(l))return;s.add(l)}return l})}this.logger.info(`ws error - reason: ${r}`),e.reject("error"),this.notifyStatusChanged(!1,r)},this.ws.onclose=n=>{this.logger.info(`ws closed - code: ${n==null?void 0:n.code} reason: ${n==null?void 0:n.reason}`),e.reject("closed"),this.notifyStatusChanged(!1)},this.ws.onopen=()=>{var n;this.startupTimer.mark("ws-opened"),this.logger.info(`ws opened ${(n=this.settings.identity)==null?void 0:n.application}`),e.resolve(),this.notifyStatusChanged(!0)},this.ws.onmessage=n=>{this._registry.execute("onMessage",n.data)},e.promise}notifyForSocketState(e){this.wsRequests.forEach(n=>{e?n.failed&&n.failed(e):n.callback()}),this.wsRequests=[]}notifyStatusChanged(e,n){this._registry.execute("onConnectedChanged",e,n)}}class o_{constructor(e){c(this,"specs");c(this,"specsNames",[]);c(this,"messages",{});c(this,"isDone");c(this,"subs",{});c(this,"subsRefCount",{});c(this,"connection");this.specs={};for(const n of e)this.specs[n.name]=n,this.specsNames.push(n.name)}init(e){this.connection=e;for(const n of this.specsNames)for(const r of this.specs[n].types){let i=this.subsRefCount[r];if(i||(i=0),i+=1,this.subsRefCount[r]=i,i>1)continue;const s=e.on(r,o=>this.processMessage(r,o));this.subs[r]=s}}processMessage(e,n){if(!(this.isDone||!n)){for(const r of this.specsNames)if(this.specs[r].types.indexOf(e)!==-1){const i=this.messages[r]||[];this.messages[r]=i,i.push(n)}}}drain(e,n){var r;n&&(this.messages[e]||[]).forEach(n),delete this.messages[e];for(const i of this.specs[e].types)this.subsRefCount[i]-=1,this.subsRefCount[i]<=0&&((r=this.connection)==null||r.off(this.subs[i]),delete this.subs[i],delete this.subsRefCount[i]);delete this.specs[e],this.specs.length||(this.isDone=!0)}}let a_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Dt=(t=21)=>{let e="",n=t|0;for(;n--;)e+=a_[Math.random()*64|0];return e};const bi=(t,e,n)=>new Promise((r,i)=>{const s=setTimeout(()=>{const a=n||`Promise timeout hit: ${e}`;i(a)},e);new Promise(t).then(a=>{clearTimeout(s),r(a)}).catch(a=>{clearTimeout(s),i(a)})});class l_{constructor(e,n,r){c(this,"settings");c(this,"logger");c(this,"identity");c(this,"isPreferredActivated");c(this,"_communicationId");c(this,"publicWindowId");c(this,"selfAssignedWindowId");c(this,"iAmConnected",!1);c(this,"parentReady",!1);c(this,"rejected",!1);c(this,"parentPingResolve");c(this,"parentPingInterval");c(this,"connectionResolve");c(this,"extConnectionResolve");c(this,"extConnectionReject");c(this,"connectionReject");c(this,"port");c(this,"myClientId");c(this,"extContentAvailable",!1);c(this,"extContentConnecting",!1);c(this,"extContentConnected",!1);c(this,"parentWindowId");c(this,"parentInExtMode",!1);c(this,"webNamespace","g42_core_web");c(this,"parent");c(this,"parentType");c(this,"parentPingTimeout",5e3);c(this,"connectionRequestTimeout",7e3);c(this,"defaultTargetString","*");c(this,"registry",pn());c(this,"messages",{connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:()=>{}},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:()=>{}},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}});this.settings=e,this.logger=n,this.identity=r,this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.parentType=window.name.includes("#wsp")?"workspace":void 0}manualSetReadyState(){this.iAmConnected=!0,this.parentReady=!0}get transportWindowId(){return this.publicWindowId}get communicationId(){return this._communicationId}async sendObject(e){if(this.extContentConnected)return window.postMessage({glue42ExtOut:e},window.origin);if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");this.port.postMessage(e)}get isObjectBasedTransport(){return!0}onMessage(e){return this.registry.add("onMessage",e)}send(){return Promise.reject("not supported")}onConnectedChanged(e){return this.registry.add("onConnectedChanged",e)}async open(){this.logger.debug("opening a connection to the web platform gateway."),await this.connect(),this.notifyStatusChanged(!0)}close(){var n,r;const e={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:(n=this.identity)==null?void 0:n.windowId}}};return(r=this.port)==null||r.postMessage(e),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()}name(){return"web-platform"}async reconnect(){return await this.close(),Promise.resolve()}initiateInternalConnection(){return new Promise((e,n)=>{if(this.logger.debug("opening an internal web platform connection"),this.port=this.settings.port,this.iAmConnected){this.logger.warn("cannot open a new connection, because this client is currently connected");return}this.port.onmessage=r=>{var s,o;if(this.iAmConnected&&!((s=r.data)!=null&&s.glue42core)){this.registry.execute("onMessage",r.data);return}const i=(o=r.data)==null?void 0:o.glue42core;i&&(i.type===this.messages.gatewayInternalConnect.name&&i.success&&(this.publicWindowId=this.settings.windowId,this.identity&&this.publicWindowId&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.publicWindowId),e()),i.type===this.messages.gatewayInternalConnect.name&&i.error&&n(i.error))},this.port.postMessage({glue42core:{type:this.messages.gatewayInternalConnect.name}})})}initiateRemoteConnection(e){return bi((n,r)=>{this.connectionResolve=n,this.connectionReject=r,this.myClientId=this.myClientId??Dt(10);const i=this.getMyWindowId()||Dt(10),s={glue42core:{type:this.messages.connectionRequest.name,clientId:this.myClientId,clientType:"child",bridgeInstanceId:i,selfAssignedWindowId:this.selfAssignedWindowId}};if(this.logger.debug("sending connection request"),this.extContentConnecting)return s.glue42core.clientType="child",s.glue42core.bridgeInstanceId=this.myClientId,s.glue42core.parentWindowId=this.parentWindowId,window.postMessage(s,window.origin);if(!e)throw new Error("Cannot send a connection request, because no glue target was specified!");e.postMessage(s,this.defaultTargetString)},this.connectionRequestTimeout,"The connection to the target glue window timed out")}async isParentCheckSuccess(e){try{return await e,{success:!0}}catch{return{success:!1}}}setUpMessageListener(){if(this.settings.port){this.logger.debug("skipping generic message listener, because this is an internal client");return}window.addEventListener("message",e=>{var s;const n=(s=e.data)==null?void 0:s.glue42core;if(!n||this.rejected)return;const r=this.settings.allowedOrigins||[];if(r.length&&!r.includes(e.origin)){this.logger.warn(`received a message from an origin which is not in the allowed list: ${e.origin}`);return}if(!this.checkMessageTypeValid(n.type)){this.logger.error(`cannot handle the incoming glue42 core message, because the type is invalid: ${n.type}`);return}const i=n.type;this.logger.debug(`received valid glue42core message of type: ${i}`),this.messages[i].handle(e)})}setUpUnload(){if(this.settings.port){this.logger.debug("skipping unload event listener, because this is an internal client");return}window.addEventListener("beforeunload",()=>{var n,r;if(this.extContentConnected)return;const e={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:(n=this.identity)==null?void 0:n.windowId}}};this.parent&&this.parent.postMessage(e,this.defaultTargetString),(r=this.port)==null||r.postMessage(e)})}handlePlatformReady(e){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval),this.parent=e.source,this.parentType=window.name.includes("#wsp")?"workspace":"window"}handleConnectionAccepted(e){var r,i;const n=(r=e.data)==null?void 0:r.glue42core;return this.myClientId!==n.clientId?(i=this.logger)==null?void 0:i.debug(`ignoring a connection accepted signal, because it is not targeted at me. My id: ${this.myClientId}, the id in the message: ${n.clientId}`):this.handleAcceptanceOfMyRequest(n)}handleAcceptanceOfMyRequest(e){if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(!e.port){this.logger.error("cannot set up my connection, because I was not provided with a port");return}if(this.publicWindowId=this.getMyWindowId(),this.identity&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.identity.instance?this.identity.instance:this.publicWindowId||Dt(10)),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=n=>this.registry.execute("onMessage",n.data),this.connectionResolve){this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),delete this.connectionResolve;return}this.logger.error("unable to call the connection resolve, because no connection promise was found")}processExtContentConnection(e){if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",n=>{var s;const r=(s=n.data)==null?void 0:s.glue42ExtInc;if(!r)return;const i=this.settings.allowedOrigins||[];if(i.length&&!i.includes(n.origin)){this.logger.warn(`received a message from an origin which is not in the allowed list: ${n.origin}`);return}this.registry.execute("onMessage",r)}),this.connectionResolve){this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),delete this.connectionResolve;return}}handleConnectionRejected(e){var r,i;if(this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),!this.connectionReject)return;const n=typeof((r=e.data.glue42core)==null?void 0:r.error)=="string"?`Connection was rejected. ${(i=e.data.glue42core)==null?void 0:i.error}`:"The platform connection was rejected. Most likely because this window was not created by a glue API call";this.connectionReject(n),delete this.connectionReject}handleConnectionRequest(){if(this.extContentConnecting){this.logger.debug("This connection request event is targeted at the extension content");return}}handleParentPing(e){if(!this.parentReady){this.logger.debug("my parent is not ready, I am ignoring the parent ping");return}if(!this.iAmConnected){this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");return}const n={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(n.glue42core.extMode={windowId:this.myClientId});const r=e.source;this.logger.debug("responding to a parent ping with a ready message"),r.postMessage(n,e.origin)}setupPlatformUnloadListener(){this.onMessage(e=>{e.type==="platformUnload"&&(this.logger.debug("detected a web platform unload"),this.parentReady=!1,this.notifyStatusChanged(!1,"Gateway unloaded"))})}handleManualUnload(){var n,r;const e={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:(n=this.identity)==null?void 0:n.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:e},window.origin);(r=this.port)==null||r.postMessage(e)}handlePlatformPing(){}notifyStatusChanged(e,n){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,n)}checkMessageTypeValid(e){return typeof e=="string"&&!!this.messages[e]}requestConnectionPermissionFromExt(){return this.waitForContentScript().then(()=>bi((e,n)=>{this.extConnectionResolve=e,this.extConnectionReject=n;const r={glue42core:{type:"extSetupRequest"}};this.logger.debug("permission request to the extension content script was sent"),window.postMessage(r,window.origin)},this.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out"))}handleExtConnectionResponse(e){var r;if(!((r=e.data)==null?void 0:r.glue42core).approved)return this.extConnectionReject?this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected"):void 0;this.extConnectionResolve&&(this.extConnectionResolve(),delete this.extConnectionResolve),this.extContentConnecting=!0,this.parentType="extension",this.logger.debug("The extension connection was approved, proceeding.")}handleExtSetupRequest(){}handleGatewayDisconnect(){}handleGatewayInternalConnect(){}waitForContentScript(){var n;return(n=window.glue42ext)!=null&&n.content?Promise.resolve():bi(r=>{window.addEventListener("Glue42EXTReady",()=>{r()})},this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")}async connect(){if(this.settings.port){await this.initiateInternalConnection(),this.logger.debug("internal web platform connection completed");return}this.logger.debug("opening a client web platform connection"),await this.findParent(),await this.initiateRemoteConnection(this.parent),this.logger.debug("the client is connected")}async findParent(){var o;const e="Cannot initiate glue, because this window was not opened or created by a glue client",n=this.getPossibleParentsInWindow(window),r=this.getPossibleParentsOutsideWindow((o=window.top)==null?void 0:o.opener,window.top),i=new Set([...n,...r]);if(!i.size&&!this.extContentAvailable)throw new Error(e);if(!i.size&&this.extContentAvailable){await this.requestConnectionPermissionFromExt();return}if((await this.isParentCheckSuccess(this.confirmParent(Array.from(i)))).success){this.logger.debug("The default parent was found!");return}if(!this.extContentAvailable)throw new Error(e);await this.requestConnectionPermissionFromExt()}getPossibleParentsInWindow(e){return!(e!=null&&e.parent)||e===e.parent?[]:[e.parent,...this.getPossibleParentsInWindow(e.parent)]}getPossibleParentsOutsideWindow(e,n){return!e||!n||e===n?[]:[e,...this.getPossibleParentsInWindow(e),...this.getPossibleParentsOutsideWindow(e.opener,e)]}confirmParent(e){const r=bi(i=>{this.parentPingResolve=i;const s={glue42core:{type:this.messages.platformPing.name}};this.parentPingInterval=setInterval(()=>{e.forEach(o=>{o.postMessage(s,this.defaultTargetString)})},1e3)},this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client");return r.catch(()=>{this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval)}),r}getMyWindowId(){var e;if(this.parentType==="workspace")return window.name.substring(0,window.name.indexOf("#wsp"));if(window===window.top)return(e=window.name)!=null&&e.includes("g42")?window.name:(this.selfAssignedWindowId=this.selfAssignedWindowId||`g42-${Dt(10)}`,this.selfAssignedWindowId)}}const c_=(t,e)=>{let n=t;return()=>{n--,n===0&&e()}};class u_{constructor(e=0){c(this,"minSequenceInterval");c(this,"queue",[]);c(this,"isExecutingQueue",!1);this.minSequenceInterval=e}enqueue(e){return new Promise((n,r)=>{this.queue.push({action:e,resolve:n,reject:r}),this.executeQueue()})}async executeQueue(){if(!this.isExecutingQueue){for(this.isExecutingQueue=!0;this.queue.length;){const e=this.queue.shift();if(!e){this.isExecutingQueue=!1;return}try{const n=await e.action();e.resolve(n)}catch(n){e.reject(n)}await this.intervalBreak()}this.isExecutingQueue=!1}}intervalBreak(){return new Promise(e=>setTimeout(e,this.minSequenceInterval))}}function Nh(t,e,n,r,i){t==null&&(t="global"),r=r??["success"],i=i??["error"];let s=t==="global",o=!1,a,l=!1;const u=pn();e.disconnected(S),e.loggedIn(k),e.on("success",T=>v(T)),e.on("error",T=>m(T)),e.on("result",T=>v(T)),r&&r.forEach(T=>{e.on(T,J=>v(J))}),i&&i.forEach(T=>{e.on(T,J=>m(J))});const p={};function g(T){return a=T,new Promise((J,P)=>{if(s){J({});return}let D;t==="global"?D=l?Promise.resolve({}):Promise.reject("not connected to gateway"):(n.debug(`joining domain ${t}`),D=L({type:"join",destination:t,domain:"global",options:T})),D.then(()=>{I(),J({})}).catch(O=>{n.debug("error joining "+t+" domain: "+JSON.stringify(O)),P(O)})})}function f(){if(t==="global")return Promise.resolve();n.debug("stopping session "+t+"...");const T={type:"leave",destination:t,domain:"global"};return o=!1,L(T).then(()=>{s=!1,u.execute("onLeft")}).catch(()=>{s=!1,u.execute("onLeft")})}function I(){n.debug("did join "+t),s=!0;const T=o;o=!1,u.execute("onJoined",T)}function S(){l=!1,n.debug("connection is down"),s=!1,o=!0,u.execute("onLeft",{disconnected:!0})}function k(){l=!0,o&&(n.debug("connection is now up - trying to reconnect..."),g(a))}function H(T){return s&&T(!1),u.add("onJoined",T)}function C(T){return s||T(),u.add("onLeft",T)}function m(T){if(t!==T.domain)return;const J=T.request_id;if(!J)return;const P=p[J];P&&P.error(T)}function v(T){if(T.domain!==t)return;const J=T.request_id;if(!J)return;const P=p[J];P&&P.success(T)}function E(){return Dt(10)}let x=[];function L(T,J,P){const D=["hello","join"];if(T.type&&D.indexOf(T.type)===-1&&!s){console.warn(`trying to send a message (${T.domain} ${T.type}) but not connected, will queue`);const $=new Oo;if(x.push({msg:T,tag:J,options:P,pw:$}),x.length===1){const Z=H(()=>{n.info(`joined - will now send queued messages (${x.length} -> [${x.map(Y=>Y.msg.type)}])`),x.forEach(Y=>{L(Y.msg,Y.tag,Y.options).then(Xe=>Y.pw.resolve(Xe)).catch(Xe=>Y.pw.reject(Xe))}),x=[],Z()})}return $.promise}P=P??{},T.request_id=T.request_id??E(),T.domain=T.domain??t,P.skipPeerId||(T.peer_id=e.peerId);const O=T.request_id;return new Promise(($,Z)=>{p[O]={success:Y=>{delete p[O],Y._tag=J,$(Y)},error:Y=>{n.warn(`Gateway error - ${JSON.stringify(Y)}`),delete p[O],Y._tag=J,Z(Y)}},e.send(T,P).catch(Y=>{p[O].error({err:Y})})})}function j(T){return T.request_id=T.request_id?T.request_id:E(),T.domain=T.domain??t,T.peer_id=e.peerId,e.send(T)}return{join:g,leave:f,onJoined:H,onLeft:C,send:L,sendFireAndForget:j,on:(T,J)=>{e.on(T,P=>{if(P.domain===t)try{J(P)}catch(D){n.error(`Callback  failed: ${D} 
 ${D.stack} 
 msg was: ${JSON.stringify(P)}`,D)}})},loggedIn:T=>e.loggedIn(T),connected:T=>e.connected(T),disconnected:T=>e.disconnected(T),get peerId(){return e.peerId},get domain(){return t}}}class d_{constructor(e,n){c(this,"settings");c(this,"logger");c(this,"protocolVersion",3);c(this,"peerId");c(this,"token");c(this,"info");c(this,"resolvedIdentity");c(this,"availableDomains");c(this,"gatewayToken");c(this,"replayer");c(this,"messageHandlers",{});c(this,"ids",1);c(this,"registry",pn());c(this,"_connected",!1);c(this,"isTrace",!1);c(this,"transport");c(this,"_defaultTransport");c(this,"_defaultAuth");c(this,"_targetTransport");c(this,"_targetAuth");c(this,"_swapTransport",!1);c(this,"_switchInProgress",!1);c(this,"_transportSubscriptions",[]);c(this,"datePrefix","#T42_DATE#");c(this,"datePrefixLen",this.datePrefix.length);c(this,"dateMinLen",this.datePrefixLen+1);c(this,"datePrefixFirstChar",this.datePrefix[0]);c(this,"_sequelizer",new u_);c(this,"_isLoggedIn",!1);c(this,"shouldTryLogin",!0);c(this,"pingTimer");c(this,"sessions",[]);c(this,"globalDomain");c(this,"initialLogin",!0);c(this,"initialLoginAttempts",3);c(this,"loginConfig");if(this.settings=e,this.logger=n,e=e||{},e.reconnectAttempts=e.reconnectAttempts??10,e.reconnectInterval=e.reconnectInterval??1e3,e.inproc)this.transport=new n_(e.inproc,n.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new r_(e.sharedWorker,n.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new l_(e.webPlatform,n.subLogger("web-platform"),e.identity);else if(e.ws!==void 0)this.transport=new Ah(e,n.subLogger("ws"));else throw new Error("No connection information specified");this.isTrace=n.canPublish("trace"),n.debug(`starting with ${this.transport.name()} transport`);const r=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),i=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(r),this._transportSubscriptions.push(i),this._defaultTransport=this.transport,this.ping()}async switchTransport(e){return this._sequelizer.enqueue(async()=>{if(!e||typeof e!="object")throw new Error("Cannot switch transports, because the settings are missing or invalid.");if(typeof e.type>"u")throw new Error("Cannot switch the transport, because the type is not defined");this.logger.trace(`Starting transport switch with settings: ${JSON.stringify(e)}`);const n=e.type==="secondary"?this.getNewSecondaryTransport(e):this._defaultTransport;this._targetTransport=n,this._targetAuth=e.type==="secondary"?this.getNewSecondaryAuth(e):this._defaultAuth;const r=this.verifyConnection();this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),await this.transport.close();try{await r;const i=this.transport===n;return this.logger.info(`The reconnection after the switch was completed. Was the switch a success: ${i}`),this._switchInProgress=!1,{success:i}}catch{return this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,{success:!1}}})}onLibReAnnounced(e){return this.registry.add("libReAnnounced",e)}setLibReAnnounced(e){this.registry.execute("libReAnnounced",e)}send(e,n){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){const r=this.createObjectMessage(e);return this.isTrace&&this.logger.trace(`>> ${JSON.stringify(r)}`),this.transport.sendObject(r,n)}else{const r=this.createStringMessage(e);return this.isTrace&&this.logger.trace(`>> ${r}`),this.transport.send(r,n)}}on(e,n){e=e.toLowerCase(),this.messageHandlers[e]===void 0&&(this.messageHandlers[e]={});const r=this.ids++;return this.messageHandlers[e][r]=n,{type:e,id:r}}off(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]}get isConnected(){return this._isLoggedIn}connected(e){return this.loggedIn(()=>{const n=this.transport.name();e(n)})}disconnected(e){return this.registry.add("disconnected",e)}async login(e,n){this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),e=this.transportSwap()??e),this.logger.trace(`Starting login for transport: ${this.transport.name()} and auth ${JSON.stringify(e)}`);try{await this.transport.open(),this.logger.trace(`Transport: ${this.transport.name()} opened, logging in`),Tt("connection").mark("transport-opened");const r=await this.loginCore(e,n);return this.logger.trace(`Logged in with identity: ${JSON.stringify(r)}`),Tt("connection").mark("protocol-logged-in"),r}catch(r){throw this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(r)}}async logout(){await this.logoutCore(),await this.transport.close()}loggedIn(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)}domain(e,n,r){let i=this.sessions.find(s=>s.domain===e);return i||(i=Nh(e,this,this.logger.subLogger(`domain=${e}`),n,r),this.sessions.push(i)),i}authToken(){const e={domain:"global",type:"create-token"};return this.globalDomain?this.globalDomain.send(e).then(n=>n.token):Promise.reject(new Error("no global domain session"))}reconnect(){return this.transport.reconnect()}setLoggedIn(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")}distributeMessage(e,n){const r=this.messageHandlers[n.toLowerCase()];r!==void 0&&Object.keys(r).forEach(i=>{const s=r[i];if(s!==void 0)try{s(e)}catch(o){try{this.logger.error(`Message handler failed with ${o.stack}`,o)}catch{console.log("Message handler failed",o)}}})}handleConnectionChanged(e){var n,r;this._connected!==e&&(this._connected=e,e?((r=(n=this.settings)==null?void 0:n.replaySpecs)!=null&&r.length&&(this.replayer=new o_(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):(this.handleDisconnected(),this.registry.execute("disconnected")))}handleDisconnected(){if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.login(this.loginConfig,!0).catch(()=>{setTimeout(this.handleDisconnected.bind(this),this.settings.reconnectInterval||1e3)})}}handleTransportMessage(e){let n;typeof e=="string"?n=this.processStringMessage(e):n=this.processObjectMessage(e),this.isTrace&&this.logger.trace(`<< ${JSON.stringify(n)}`),this.distributeMessage(n.msg,n.msgType)}verifyConnection(){return bi(e=>{let n;const r=c_(2,()=>{n&&n(),e()});n=this.onLibReAnnounced(i=>{if(i.name==="interop"||i.name==="contexts")return r()})},1e4,"Transport switch timed out waiting for all libraries to be re-announced")}getNewSecondaryTransport(e){var n;if(!((n=e.transportConfig)!=null&&n.url))throw new Error("Missing secondary transport URL.");return new Ah(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))}getNewSecondaryAuth(e){var n;if(!((n=e.transportConfig)!=null&&n.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth}transportSwap(){if(this._swapTransport=!1,!this._targetTransport||!this._targetAuth){this.logger.warn(`Error while switching transports - either the target transport or auth is not defined: transport defined -> ${!!this._defaultTransport}, auth defined -> ${!!this._targetAuth}. Staying on the current one.`);return}this._transportSubscriptions.forEach(r=>r()),this._transportSubscriptions=[],this.transport=this._targetTransport;const e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),n=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(n),this._targetAuth}prepareDefaultSwap(){this._transportSubscriptions.forEach(e=>e()),this._transportSubscriptions=[],this.transport.close().catch(e=>this.logger.warn(`Error closing the ${this.transport.name()} transport after a failed connection attempt: ${JSON.stringify(e)}`)),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0}processStringMessage(e){const n=JSON.parse(e,(r,i)=>{if(typeof i!="string"||i.length<this.dateMinLen||!i.startsWith(this.datePrefixFirstChar)||i.substring(0,this.datePrefixLen)!==this.datePrefix)return i;try{const s=parseInt(i.substring(this.datePrefixLen,i.length),10);return isNaN(s)?i:new Date(s)}catch{return i}});return{msg:n,msgType:n.type}}createStringMessage(e){const n=Date.prototype.toJSON;try{const r=this.datePrefix;return Date.prototype.toJSON=function(){return r+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=n}}processObjectMessage(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}}createObjectMessage(e){return e}async loginCore(e,n){this.logger.info("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0;const r=await this.setupAuthConfig(e,n),i={type:"hello",identity:this.settings.identity,authentication:r};e.sessionId&&(i.request_id=e.sessionId),this.globalDomain=Nh("global",this,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]);const s={skipPeerId:!0};this.initialLogin&&(s.retryInterval=this.settings.reconnectInterval,s.maxRetries=this.settings.reconnectAttempts);try{const o=await this.tryAuthenticate(this.globalDomain,i,s,e);return this.initialLogin=!1,this.logger.info("login successful with peerId "+o.peer_id),this.peerId=o.peer_id,this.resolvedIdentity=o.resolved_identity,this.availableDomains=o.available_domains,o.options&&(this.token=o.options.access_token,this.info=o.options.info),this.setLoggedIn(!0),o.resolved_identity}catch(o){throw this.logger.error("error sending hello message - "+(o.message||o.msg||o.reason||o),o),o}finally{e!=null&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null)}}async tryAuthenticate(e,n,r,i){let s;for(;;){const o=await e.send(n,void 0,r);if(o.type==="authentication-request"){const a=Buffer.from(o.authentication.token,"base64");i.flowCallback&&i.sessionId&&(n.authentication.token=(await i.flowCallback(i.sessionId,a)).data.toString("base64")),n.request_id=i.sessionId}else if(o.type==="welcome"){s=o;break}else throw o.type==="error"?new Error("Authentication failed: "+o.reason):new Error("Unexpected message type during authentication: "+o.type)}return s}async setupAuthConfig(e,n){const r={};if(this.gatewayToken=e.gatewayToken,e.gatewayToken){if(n)try{e.gatewayToken=await this.getNewGWToken()}catch(i){this.logger.warn(`failed to get GW token when reconnecting ${(i==null?void 0:i.message)||i}`)}r.method="gateway-token",r.token=e.gatewayToken,this.gatewayToken=e.gatewayToken}else if(e.flowName==="sspi")if(r.provider="win",r.method="access-token",e.flowCallback&&e.sessionId)r.token=(await e.flowCallback(e.sessionId,null)).data.toString("base64");else throw new Error("Invalid SSPI config");else if(e.token)r.method="access-token",r.token=e.token;else if(e.username)r.method="secret",r.login=e.username,r.secret=e.password;else if(e.provider)r.provider=e.provider,r.providerContext=e.providerContext;else throw new Error("invalid auth message"+JSON.stringify(e));return r}async logoutCore(){this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer);const e=this.sessions.map(n=>{n.leave()});await Promise.all(e)}getNewGWToken(){if(typeof window<"u"){const e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))}ping(){this.shouldTryLogin&&(this._isLoggedIn&&this.send({type:"ping"}),this.pingTimer=setTimeout(()=>{this.ping()},30*1e3))}}const Oh=["trace","debug","info","warn","error","off"],Zt=class Zt{constructor(e,n,r){c(this,"name");c(this,"parent");c(this,"path");c(this,"subLoggers",[]);c(this,"_consoleLevel");c(this,"_publishLevel");c(this,"loggerFullName");c(this,"includeTimeAndLevel");c(this,"logFn",console);c(this,"customLogFn",!1);this.name=e,this.parent=n,this.name=e,n?this.path=`${n.path}.${e}`:this.path=e,this.loggerFullName=`[${this.path}]`,this.includeTimeAndLevel=!r,r&&(this.logFn=r,this.customLogFn=!0)}subLogger(e){const n=this.subLoggers.filter(i=>i.name===e)[0];if(n!==void 0)return n;Object.keys(this).forEach(i=>{if(i===e)throw new Error("This sub logger name is not allowed.")});const r=new Zt(e,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r}publishLevel(e){var n;return e&&(this._publishLevel=e),this._publishLevel||((n=this.parent)==null?void 0:n.publishLevel())}consoleLevel(e){var n;return e&&(this._consoleLevel=e),this._consoleLevel||((n=this.parent)==null?void 0:n.consoleLevel())}log(e,n,r){this.publishMessage(n||"info",e,r)}trace(e){this.log(e,"trace")}debug(e){this.log(e,"debug")}info(e){this.log(e,"info")}warn(e){this.log(e,"warn")}error(e,n){this.log(e,"error",n)}canPublish(e,n){const r=Oh.indexOf(e),i=Oh.indexOf(n||this.consoleLevel()||"trace");return r>=i}publishMessage(e,n,r){const i=this.loggerFullName;if(e==="error"&&!r){const s=new Error;s.stack&&(n=n+`
`+s.stack.split(`
`).slice(4).join(`
`))}if(this.canPublish(e,this.publishLevel())){const s=Zt.Interop;if(s)try{if(s.methods({name:Zt.InteropMethodName}).length>0){const o={msg:n,logger:i,level:e};r&&r instanceof Error&&(o.error={message:r.message,stack:r.stack??""}),s.invoke(Zt.InteropMethodName,o).catch(a=>{this.logFn.error(`Unable to send log message to the platform: ${a.message}`,a)})}}catch{}}if(this.canPublish(e)){let s="";if(this.includeTimeAndLevel){const a=new Date;s=`[${`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}:${a.getMilliseconds()}`}] [${e}] `}const o=`${s}${i}: ${n}`;switch(e){case"trace":this.logFn.debug(o);break;case"debug":this.logFn.debug?this.logFn.debug(o):this.logFn.log(o);break;case"info":this.logFn.info(o);break;case"warn":this.logFn.warn(o);break;case"error":this.logFn.error(o,r);break}}}};c(Zt,"Interop"),c(Zt,"InteropMethodName","T42.AppLogger.Log"),c(Zt,"Instance");let Mo=Zt;const mm="create-context",Ci="created",Si="destroyed",Ii="context-created",_i="context-added",ym="subscribe-context",wn="subscribed-context",vm="unsubscribe-context",wm="destroy-context",Ei="context-destroyed",io="update-context",yr="context-updated",vr="joined",Lo={get name(){return"context"},get types(){return[mm,Ci,Si,Ii,_i,ym,wn,vm,wm,Ei,io,yr,vr]}};var Fo="6.6.0";function h_(t,e,n){var g;let r;if(nn.isNode()){const f=ag._GD_STARTING_CONTEXT_;if(f)try{r=JSON.parse(f)}catch{}}function i(){var Z;const f=t.gateway,I=(f==null?void 0:f.protocolVersion)??3,S=f==null?void 0:f.reconnectInterval,k=f==null?void 0:f.reconnectAttempts,H="ws://localhost:8385";let C=f==null?void 0:f.ws;const m=f==null?void 0:f.sharedWorker,v=f==null?void 0:f.inproc,E=(f==null?void 0:f.webPlatform)??void 0;n&&(C=n.gwURL),nn.isNode()&&r&&r.gwURL&&(C=r.gwURL),!C&&!m&&!v&&(C=H);let x,L,j,T,J;const P=o();let D=P;typeof n<"u"?(L=n.windowId,j=n.pid,n.env&&(T=n.env.env,J=n.env.region),D=n.application??"glue-app",x=n.appInstanceId):nn.isNode()?(j=process.pid,r&&(T=r.env,J=r.region,x=r.instanceId)):typeof(window==null?void 0:window.glue42electron)<"u"&&(L=window==null?void 0:window.glue42electron.instanceId,j=window==null?void 0:window.glue42electron.pid,T=window==null?void 0:window.glue42electron.env,J=window==null?void 0:window.glue42electron.region,D=(window==null?void 0:window.glue42electron.application)??"glue-app",x=window==null?void 0:window.glue42electron.instanceId);const O=((Z=t.gateway)==null?void 0:Z.replaySpecs)??[];O.push(Lo);let $={application:D,applicationName:P,windowId:L,instance:x,process:j,region:J,environment:T,api:e.version||Fo};return t.identity&&($=Object.assign($,t.identity)),{identity:$,reconnectInterval:S,ws:C,sharedWorker:m,webPlatform:E,inproc:v,protocolVersion:I,reconnectAttempts:k,replaySpecs:O}}function s(){return typeof t.contexts>"u"?{reAnnounceKnownContexts:!0}:typeof t.contexts=="boolean"&&t.contexts?{reAnnounceKnownContexts:!0}:typeof t.contexts=="object"?Object.assign({},{reAnnounceKnownContexts:!0},t.contexts):!1}function o(){if(t.application)return t.application;if(n)return n.applicationName;if(typeof window<"u"&&typeof window.glue42electron<"u")return window.glue42electron.application;const f=Dt(10);return nn.isNode()?r?r.applicationConfig.name:"NodeJS"+f:typeof window<"u"&&typeof document<"u"?document.title+` (${f})`:f}function a(){var f,I,S;if(typeof t.auth=="string")return{token:t.auth};if(t.auth)return t.auth;if(nn.isNode()&&r&&r.gwToken)return{gatewayToken:r.gwToken};if((f=t.gateway)!=null&&f.webPlatform||(I=t.gateway)!=null&&I.inproc||(S=t.gateway)!=null&&S.sharedWorker)return{username:"glue42",password:"glue42"}}function l(){let f=t.logger;const I="warn";f||(f=I);let S;return n&&(S=n.consoleLogLevel),typeof f=="string"?{console:S??f,publish:I}:{console:S??f.console??I,publish:f.publish??I}}const u=i();let p=o();if(typeof window<"u"){const f=window,I=f.htmlContainer?`${f.htmlContainer.containerName}.${f.htmlContainer.application}`:(g=f==null?void 0:f.glue42gd)==null?void 0:g.application;I&&(p=I)}return{bus:t.bus??!1,application:p,auth:a(),logger:l(),connection:u,metrics:t.metrics??!0,contexts:s(),version:e.version||Fo,libs:e.libs??[],customLogger:t.customLogger}}class di{constructor(e,n,r,i){c(this,"name");c(this,"contextId");c(this,"context");c(this,"isAnnounced");c(this,"joinedActivity");c(this,"updateCallbacks",{});c(this,"activityId");c(this,"sentExplicitSubscription");c(this,"hasReceivedSnapshot");this.contextId=e,this.name=n,this.isAnnounced=r,this.activityId=i,this.context={}}hasCallbacks(){return Object.keys(this.updateCallbacks).length>0}getState(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0}}var $o={exports:{}};$o.exports;(function(t,e){var n=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",u="[object Error]",p="[object Function]",g="[object GeneratorFunction]",f="[object Map]",I="[object Number]",S="[object Object]",k="[object Promise]",H="[object RegExp]",C="[object Set]",m="[object String]",v="[object Symbol]",E="[object WeakMap]",x="[object ArrayBuffer]",L="[object DataView]",j="[object Float32Array]",T="[object Float64Array]",J="[object Int8Array]",P="[object Int16Array]",D="[object Int32Array]",O="[object Uint8Array]",$="[object Uint8ClampedArray]",Z="[object Uint16Array]",Y="[object Uint32Array]",Xe=/[\\^$.*+?()[\]{}|]/g,Ot=/\w*$/,U=/^\[object .+?Constructor\]$/,X=/^(?:0|[1-9]\d*)$/,B={};B[s]=B[o]=B[x]=B[L]=B[a]=B[l]=B[j]=B[T]=B[J]=B[P]=B[D]=B[f]=B[I]=B[S]=B[H]=B[C]=B[m]=B[v]=B[O]=B[$]=B[Z]=B[Y]=!0,B[u]=B[p]=B[E]=!1;var ge=typeof Ms=="object"&&Ms&&Ms.Object===Object&&Ms,Se=typeof self=="object"&&self&&self.Object===Object&&self,Ze=ge||Se||Function("return this")(),Mt=e&&!e.nodeType&&e,ur=Mt&&!0&&t&&!t.nodeType&&t,Bt=ur&&ur.exports===Mt;function dr(h,_){return h.set(_[0],_[1]),h}function Tm(h,_){return h.add(_),h}function Rm(h,_){for(var R=-1,V=h?h.length:0;++R<V&&_(h[R],R,h)!==!1;);return h}function Pm(h,_){for(var R=-1,V=_.length,je=h.length;++R<V;)h[je+R]=_[R];return h}function _u(h,_,R,V){for(var je=-1,et=h?h.length:0;++je<et;)R=_(R,h[je],je,h);return R}function Dm(h,_){for(var R=-1,V=Array(h);++R<h;)V[R]=_(R);return V}function xm(h,_){return h==null?void 0:h[_]}function Eu(h){var _=!1;if(h!=null&&typeof h.toString!="function")try{_=!!(h+"")}catch{}return _}function ku(h){var _=-1,R=Array(h.size);return h.forEach(function(V,je){R[++_]=[je,V]}),R}function ca(h,_){return function(R){return h(_(R))}}function Tu(h){var _=-1,R=Array(h.size);return h.forEach(function(V){R[++_]=V}),R}var Am=Array.prototype,Nm=Function.prototype,as=Object.prototype,ua=Ze["__core-js_shared__"],Ru=function(){var h=/[^.]+$/.exec(ua&&ua.keys&&ua.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),Pu=Nm.toString,gn=as.hasOwnProperty,ls=as.toString,Om=RegExp("^"+Pu.call(gn).replace(Xe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Du=Bt?Ze.Buffer:void 0,xu=Ze.Symbol,Au=Ze.Uint8Array,Mm=ca(Object.getPrototypeOf,Object),Lm=Object.create,Fm=as.propertyIsEnumerable,$m=Am.splice,Nu=Object.getOwnPropertySymbols,jm=Du?Du.isBuffer:void 0,Wm=ca(Object.keys,Object),da=pr(Ze,"DataView"),Qr=pr(Ze,"Map"),ha=pr(Ze,"Promise"),fa=pr(Ze,"Set"),pa=pr(Ze,"WeakMap"),Yr=pr(Object,"create"),Um=qn(da),zm=qn(Qr),Bm=qn(ha),Hm=qn(fa),Gm=qn(pa),Ou=xu?xu.prototype:void 0,Mu=Ou?Ou.valueOf:void 0;function Hn(h){var _=-1,R=h?h.length:0;for(this.clear();++_<R;){var V=h[_];this.set(V[0],V[1])}}function qm(){this.__data__=Yr?Yr(null):{}}function Vm(h){return this.has(h)&&delete this.__data__[h]}function Jm(h){var _=this.__data__;if(Yr){var R=_[h];return R===r?void 0:R}return gn.call(_,h)?_[h]:void 0}function Km(h){var _=this.__data__;return Yr?_[h]!==void 0:gn.call(_,h)}function Qm(h,_){var R=this.__data__;return R[h]=Yr&&_===void 0?r:_,this}Hn.prototype.clear=qm,Hn.prototype.delete=Vm,Hn.prototype.get=Jm,Hn.prototype.has=Km,Hn.prototype.set=Qm;function Ht(h){var _=-1,R=h?h.length:0;for(this.clear();++_<R;){var V=h[_];this.set(V[0],V[1])}}function Ym(){this.__data__=[]}function Xm(h){var _=this.__data__,R=cs(_,h);if(R<0)return!1;var V=_.length-1;return R==V?_.pop():$m.call(_,R,1),!0}function Zm(h){var _=this.__data__,R=cs(_,h);return R<0?void 0:_[R][1]}function ey(h){return cs(this.__data__,h)>-1}function ty(h,_){var R=this.__data__,V=cs(R,h);return V<0?R.push([h,_]):R[V][1]=_,this}Ht.prototype.clear=Ym,Ht.prototype.delete=Xm,Ht.prototype.get=Zm,Ht.prototype.has=ey,Ht.prototype.set=ty;function hr(h){var _=-1,R=h?h.length:0;for(this.clear();++_<R;){var V=h[_];this.set(V[0],V[1])}}function ny(){this.__data__={hash:new Hn,map:new(Qr||Ht),string:new Hn}}function ry(h){return us(this,h).delete(h)}function iy(h){return us(this,h).get(h)}function sy(h){return us(this,h).has(h)}function oy(h,_){return us(this,h).set(h,_),this}hr.prototype.clear=ny,hr.prototype.delete=ry,hr.prototype.get=iy,hr.prototype.has=sy,hr.prototype.set=oy;function fr(h){this.__data__=new Ht(h)}function ay(){this.__data__=new Ht}function ly(h){return this.__data__.delete(h)}function cy(h){return this.__data__.get(h)}function uy(h){return this.__data__.has(h)}function dy(h,_){var R=this.__data__;if(R instanceof Ht){var V=R.__data__;if(!Qr||V.length<n-1)return V.push([h,_]),this;R=this.__data__=new hr(V)}return R.set(h,_),this}fr.prototype.clear=ay,fr.prototype.delete=ly,fr.prototype.get=cy,fr.prototype.has=uy,fr.prototype.set=dy;function hy(h,_){var R=ya(h)||Ly(h)?Dm(h.length,String):[],V=R.length,je=!!V;for(var et in h)gn.call(h,et)&&!(je&&(et=="length"||Ay(et,V)))&&R.push(et);return R}function Lu(h,_,R){var V=h[_];(!(gn.call(h,_)&&Wu(V,R))||R===void 0&&!(_ in h))&&(h[_]=R)}function cs(h,_){for(var R=h.length;R--;)if(Wu(h[R][0],_))return R;return-1}function fy(h,_){return h&&Fu(_,va(_),h)}function ga(h,_,R,V,je,et,Gt){var tt;if(V&&(tt=et?V(h,je,et,Gt):V(h)),tt!==void 0)return tt;if(!ds(h))return h;var Bu=ya(h);if(Bu){if(tt=Py(h),!_)return ky(h,tt)}else{var gr=Gn(h),Hu=gr==p||gr==g;if($y(h))return wy(h,_);if(gr==S||gr==s||Hu&&!et){if(Eu(h))return et?h:{};if(tt=Dy(Hu?{}:h),!_)return Ty(h,fy(tt,h))}else{if(!B[gr])return et?h:{};tt=xy(h,gr,ga,_)}}Gt||(Gt=new fr);var Gu=Gt.get(h);if(Gu)return Gu;if(Gt.set(h,tt),!Bu)var qu=R?Ry(h):va(h);return Rm(qu||h,function(wa,hs){qu&&(hs=wa,wa=h[hs]),Lu(tt,hs,ga(wa,_,R,V,hs,h,Gt))}),tt}function py(h){return ds(h)?Lm(h):{}}function gy(h,_,R){var V=_(h);return ya(h)?V:Pm(V,R(h))}function my(h){return ls.call(h)}function yy(h){if(!ds(h)||Oy(h))return!1;var _=zu(h)||Eu(h)?Om:U;return _.test(qn(h))}function vy(h){if(!ju(h))return Wm(h);var _=[];for(var R in Object(h))gn.call(h,R)&&R!="constructor"&&_.push(R);return _}function wy(h,_){if(_)return h.slice();var R=new h.constructor(h.length);return h.copy(R),R}function ma(h){var _=new h.constructor(h.byteLength);return new Au(_).set(new Au(h)),_}function by(h,_){var R=_?ma(h.buffer):h.buffer;return new h.constructor(R,h.byteOffset,h.byteLength)}function Cy(h,_,R){var V=_?R(ku(h),!0):ku(h);return _u(V,dr,new h.constructor)}function Sy(h){var _=new h.constructor(h.source,Ot.exec(h));return _.lastIndex=h.lastIndex,_}function Iy(h,_,R){var V=_?R(Tu(h),!0):Tu(h);return _u(V,Tm,new h.constructor)}function _y(h){return Mu?Object(Mu.call(h)):{}}function Ey(h,_){var R=_?ma(h.buffer):h.buffer;return new h.constructor(R,h.byteOffset,h.length)}function ky(h,_){var R=-1,V=h.length;for(_||(_=Array(V));++R<V;)_[R]=h[R];return _}function Fu(h,_,R,V){R||(R={});for(var je=-1,et=_.length;++je<et;){var Gt=_[je],tt=void 0;Lu(R,Gt,tt===void 0?h[Gt]:tt)}return R}function Ty(h,_){return Fu(h,$u(h),_)}function Ry(h){return gy(h,va,$u)}function us(h,_){var R=h.__data__;return Ny(_)?R[typeof _=="string"?"string":"hash"]:R.map}function pr(h,_){var R=xm(h,_);return yy(R)?R:void 0}var $u=Nu?ca(Nu,Object):Uy,Gn=my;(da&&Gn(new da(new ArrayBuffer(1)))!=L||Qr&&Gn(new Qr)!=f||ha&&Gn(ha.resolve())!=k||fa&&Gn(new fa)!=C||pa&&Gn(new pa)!=E)&&(Gn=function(h){var _=ls.call(h),R=_==S?h.constructor:void 0,V=R?qn(R):void 0;if(V)switch(V){case Um:return L;case zm:return f;case Bm:return k;case Hm:return C;case Gm:return E}return _});function Py(h){var _=h.length,R=h.constructor(_);return _&&typeof h[0]=="string"&&gn.call(h,"index")&&(R.index=h.index,R.input=h.input),R}function Dy(h){return typeof h.constructor=="function"&&!ju(h)?py(Mm(h)):{}}function xy(h,_,R,V){var je=h.constructor;switch(_){case x:return ma(h);case a:case l:return new je(+h);case L:return by(h,V);case j:case T:case J:case P:case D:case O:case $:case Z:case Y:return Ey(h,V);case f:return Cy(h,V,R);case I:case m:return new je(h);case H:return Sy(h);case C:return Iy(h,V,R);case v:return _y(h)}}function Ay(h,_){return _=_??i,!!_&&(typeof h=="number"||X.test(h))&&h>-1&&h%1==0&&h<_}function Ny(h){var _=typeof h;return _=="string"||_=="number"||_=="symbol"||_=="boolean"?h!=="__proto__":h===null}function Oy(h){return!!Ru&&Ru in h}function ju(h){var _=h&&h.constructor,R=typeof _=="function"&&_.prototype||as;return h===R}function qn(h){if(h!=null){try{return Pu.call(h)}catch{}try{return h+""}catch{}}return""}function My(h){return ga(h,!0,!0)}function Wu(h,_){return h===_||h!==h&&_!==_}function Ly(h){return Fy(h)&&gn.call(h,"callee")&&(!Fm.call(h,"callee")||ls.call(h)==s)}var ya=Array.isArray;function Uu(h){return h!=null&&jy(h.length)&&!zu(h)}function Fy(h){return Wy(h)&&Uu(h)}var $y=jm||zy;function zu(h){var _=ds(h)?ls.call(h):"";return _==p||_==g}function jy(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=i}function ds(h){var _=typeof h;return!!h&&(_=="object"||_=="function")}function Wy(h){return!!h&&typeof h=="object"}function va(h){return Uu(h)?hy(h):vy(h)}function Uy(){return[]}function zy(){return!1}t.exports=My})($o,$o.exports);var f_=$o.exports,p_=gm(f_);function Mh(t,e,n){try{if(n!=null&&n.canPublish("trace")&&(n==null||n.trace(`applying context delta ${JSON.stringify(e)} on context ${JSON.stringify(t)}`)),!e)return t;if(e.reset)return t={...e.reset},t;if(t=Et(t,void 0),e.commands){for(const o of e.commands)o.type==="remove"?m_(t,o.path):o.type==="set"&&so(t,o.value,o.path);return t}const r=e.added,i=e.updated,s=e.removed;return r&&Object.keys(r).forEach(o=>{t[o]=r[o]}),i&&Object.keys(i).forEach(o=>{g_(o,t,i)}),s&&s.forEach(o=>{delete t[o]}),t}catch(r){return n==null||n.error(`error applying context delta ${JSON.stringify(e)} on context ${JSON.stringify(t)}`,r),t}}function Et(t,e){return p_(t)}const g_=(t,e,n)=>{const r=n[t];if(r===void 0)return e;const i=e[t];return!i||!r||typeof i=="string"||typeof i=="number"||typeof i=="boolean"||typeof r=="string"||typeof r=="number"||typeof r=="boolean"||Array.isArray(i)||Array.isArray(r)?(e[t]=r,e):(e[t]=Object.assign({},i,r),e)};function ki(t,e){if(t===e)return!0;if(!(t instanceof Object)||!(e instanceof Object)||t.constructor!==e.constructor)return!1;for(const n in t)if(t.hasOwnProperty(n)){if(!e.hasOwnProperty(n))return!1;if(t[n]!==e[n]&&(typeof t[n]!="object"||!ki(t[n],e[n])))return!1}for(const n in e)if(e.hasOwnProperty(n)&&!t.hasOwnProperty(n))return!1;return!0}function so(t,e,n){const r=n.split(".");let i;for(i=0;i<r.length-1;i++)t[r[i]]||(t[r[i]]={}),typeof t[r[i]]!="object"&&(t[r[i]]={}),t=t[r[i]];t[r[i]]=e}function bm(t,e){return Object.keys(e).every(n=>typeof e[n]=="object"?bm((t==null?void 0:t[n])||{},e[n]||{}):e[n]===(t==null?void 0:t[n]))}function m_(t,e){const n=e.split(".");let r;for(r=0;r<n.length-1;r++){if(!t[n[r]])return;t=t[n[r]]}delete t[n[r]]}class y_{constructor(e){c(this,"_logger");c(this,"_connection");c(this,"_trackAllContexts");c(this,"_reAnnounceKnownContexts");c(this,"_gw3Session");c(this,"_contextNameToData",{});c(this,"_gw3Subscriptions",[]);c(this,"_nextCallbackSubscriptionNumber",0);c(this,"_creationPromises",{});c(this,"_contextNameToId",{});c(this,"_contextIdToName",{});c(this,"_protocolVersion");c(this,"_contextsTempCache",{});c(this,"_contextsSubscriptionsCache",[]);c(this,"_systemContextsSubKey");var n;this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[Ii,wn,Ei,yr]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined(r=>{if(r){if(!this._reAnnounceKnownContexts)return this._connection.setLibReAnnounced({name:"contexts"});this.reInitiateState().then(()=>this._connection.setLibReAnnounced({name:"contexts"}))}}),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),(n=this._connection.replayer)==null||n.drain(Lo.name,r=>{const i=r.type;i&&(i===Ii||i===_i||i===Ci?this.handleContextCreatedMessage(r):i===wn||i===yr||i===vr?this.handleContextUpdatedMessage(r):(i===Ei||i===Si)&&this.handleContextDestroyedMessage(r))})}get protocolVersion(){if(!this._protocolVersion){const e=this._connection.availableDomains.find(n=>n.uri==="context");this._protocolVersion=(e==null?void 0:e.version)??1}return this._protocolVersion}get setPathSupported(){return this.protocolVersion>=2}dispose(){for(const e of this._gw3Subscriptions)this._connection.off(e);this._gw3Subscriptions.length=0;for(const e in this._contextNameToData)this._contextNameToId.hasOwnProperty(e)&&delete this._contextNameToData[e]}createContext(e,n){return e in this._creationPromises?this._creationPromises[e]:(this._creationPromises[e]=this._gw3Session.send({type:mm,domain:"global",name:e,data:n,lifetime:"retained"}).then(r=>{this._contextNameToId[e]=r.context_id,this._contextIdToName[r.context_id]=e;const i=this._contextNameToData[e]||new di(r.context_id,e,!0,void 0);return i.isAnnounced=!0,i.name=e,i.contextId=r.context_id,i.context=r.data||Et(n),i.hasReceivedSnapshot=!0,this._contextNameToData[e]=i,delete this._creationPromises[e],r.context_id}),this._creationPromises[e])}all(){return Object.keys(this._contextNameToData).filter(e=>this._contextNameToData[e].isAnnounced)}async update(e,n){var o;n&&(n=Et(n)),e in this._creationPromises&&await this._creationPromises[e];const r=this._contextNameToData[e];if(!r||!r.isAnnounced)return this.createContext(e,n);let i=r.context;r.hasCallbacks()||(i=await this.get(r.name));const s=this.setPathSupported?this.calculateContextDeltaV2(i,n):this.calculateContextDeltaV1(i,n);return!Object.keys(s.added).length&&!Object.keys(s.updated).length&&!s.removed.length&&!((o=s.commands)!=null&&o.length)?Promise.resolve():this._gw3Session.send({type:io,domain:"global",context_id:r.contextId,delta:s},{},{skipPeerId:!1}).then(a=>{this.handleUpdated(r,s,{updaterId:a.peer_id})})}async set(e,n){n&&(n=Et(n)),e in this._creationPromises&&await this._creationPromises[e];const r=this._contextNameToData[e];return!r||!r.isAnnounced?this.createContext(e,n):this._gw3Session.send({type:io,domain:"global",context_id:r.contextId,delta:{reset:n}},{},{skipPeerId:!1}).then(i=>{this.handleUpdated(r,{reset:n,added:{},removed:[],updated:{}},{updaterId:i.peer_id})})}setPath(e,n,r){return this.setPathSupported?this.setPaths(e,[{path:n,value:r}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")}async setPaths(e,n){if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");n&&(n=Et(n)),e in this._creationPromises&&await this._creationPromises[e];const r=this._contextNameToData[e];if(!r||!r.isAnnounced){const s={};for(const o of n)so(s,o.value,o.path);return this.createContext(e,s)}const i=[];for(const s of n)s.value===null?i.push({type:"remove",path:s.path}):i.push({type:"set",path:s.path,value:s.value});return this._gw3Session.send({type:io,domain:"global",context_id:r.contextId,delta:{commands:i}},{},{skipPeerId:!1}).then(s=>{this.handleUpdated(r,{added:{},removed:[],updated:{},commands:i},{updaterId:s.peer_id})})}async get(e){e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];if(!n||!n.isAnnounced)return Promise.resolve({});if(n&&(!n.hasCallbacks()||!n.hasReceivedSnapshot))return new Promise(i=>{this.subscribe(e,(s,o,a,l)=>{this.unsubscribe(l),i(s)})});const r=(n==null?void 0:n.context)??{};return Promise.resolve(Et(r))}async subscribe(e,n,r){e in this._creationPromises&&await this._creationPromises[e];const i=typeof r>"u"?this._nextCallbackSubscriptionNumber:r;typeof r>"u"&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every(a=>a.subKey!==this._nextCallbackSubscriptionNumber)&&this._contextsSubscriptionsCache.push({contextName:e,subKey:i,callback:n});let s=this._contextNameToData[e];if(!s||!s.isAnnounced)return s=s||new di(void 0,e,!1,void 0),this._contextNameToData[e]=s,s.updateCallbacks[i]=n,Promise.resolve(i);const o=s.hasCallbacks();if(s.updateCallbacks[i]=n,o){if(s.hasReceivedSnapshot){const a=Et(s.context);n(a,a,[],i)}return Promise.resolve(i)}else if(s.joinedActivity){if(s.hasReceivedSnapshot){const a=Et(s.context);n(a,a,[],i)}return Promise.resolve(i)}else{if(s.context&&s.sentExplicitSubscription){if(s.hasReceivedSnapshot){const a=Et(s.context);n(a,a,[],i)}return Promise.resolve(i)}return this.sendSubscribe(s).then(()=>i)}}unsubscribe(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter(n=>n.subKey!==e);for(const n of Object.keys(this._contextNameToData)){const r=this._contextNameToData[n];if(!r)return;const i=r.hasCallbacks();delete r.updateCallbacks[e],r.isAnnounced&&i&&!r.hasCallbacks()&&r.sentExplicitSubscription&&this.sendUnsubscribe(r).catch(()=>{}),!r.isAnnounced&&!r.hasCallbacks()&&delete this._contextNameToData[n]}}async destroy(e){e in this._creationPromises&&await this._creationPromises[e];const n=this._contextNameToData[e];return n?this._gw3Session.send({type:wm,domain:"global",context_id:n.contextId}).then(r=>{}):Promise.reject(`context with ${e} does not exist`)}handleUpdated(e,n,r){const i=e.context;e.context=Mh(e.context,n,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]===e&&!ki(i,e.context)&&this.invokeUpdateCallbacks(e,n,r)}subscribeToContextCreatedMessages(){const e=[_i,Ii,Ci];for(const n of e){const r=this._connection.on(n,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}}handleContextCreatedMessage(e){const n=e.type;n===Ci?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):n===_i&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);const r=this._contextIdToName[e.context_id];if(!r)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[r])throw new Error("Received created event for context with unknown id: "+e.context_id);let i=this._contextNameToData[r];if(i){if(i.isAnnounced)return;if(!i.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");i.isAnnounced=!0,i.contextId=e.context_id,i.activityId=e.activity_id,i.sentExplicitSubscription||this.sendSubscribe(i)}else this._contextNameToData[r]=i=new di(e.context_id,r,!0,e.activity_id),this._trackAllContexts&&this.subscribe(r,()=>{}).then(s=>this._systemContextsSubKey=s)}subscribeToContextUpdatedMessages(){const e=[yr,wn,vr];for(const n of e){const r=this._connection.on(n,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}}handleContextUpdatedMessage(e){const n=e.type,r=e.context_id;let i=this._contextNameToData[this._contextIdToName[r]];const s=!i||!i.isAnnounced;if(n===vr)i||(i=this._contextNameToData[e.activity_id]||new di(r,e.activity_id,!0,e.activity_id)),this._contextNameToData[e.activity_id]=i,this._contextIdToName[r]=e.activity_id,this._contextNameToId[e.activity_id]=r,i.contextId=r,i.isAnnounced=!0,i.activityId=e.activity_id,i.joinedActivity=!0;else if(!i||!i.isAnnounced){n===wn?(i=i||new di(r,e.name,!0,void 0),i.sentExplicitSubscription=!0,this._contextNameToData[e.name]=i,this._contextIdToName[r]=e.name,this._contextNameToId[e.name]=r):this._logger.error(`Received 'update' for unknown context: ${r}`);return}const o=i.context;if(i.hasReceivedSnapshot=!0,n===wn)i.context=e.data||{};else if(n===vr)i.context=e.context_snapshot||{};else if(n===yr)i.context=Mh(i.context,e.delta,this._logger);else throw new Error("Unrecognized context update message "+n);(s||!ki(i.context,o)||n===wn)&&this.invokeUpdateCallbacks(i,e.delta,{updaterId:e.updater_id})}invokeUpdateCallbacks(e,n,r){if(n=n||{added:{},updated:{},reset:{},removed:[]},n.commands){n.added=n.updated=n.reset={},n.removed=[];for(const i of n.commands)i.type==="remove"?(i.path.indexOf(".")===-1&&n.removed.push(i.path),so(n.updated,null,i.path)):i.type==="set"&&so(n.updated,i.value,i.path)}for(const i in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(i))try{const s=e.updateCallbacks[i];s(Et(e.context),Et(Object.assign({},n.added||{},n.updated||{},n.reset||{})),n.removed,parseInt(i,10),r)}catch(s){this._logger.debug("callback error: "+JSON.stringify(s))}}subscribeToContextDestroyedMessages(){const e=[Ei,Si];for(const n of e){const r=this._connection.on(n,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}}handleContextDestroyedMessage(e){const n=e.type;let r,i;if(n===Si){if(i=e.activity_id,r=this._contextNameToId[i],!r){this._logger.error(`Received 'destroyed' for unknown activity: ${e.activity_id}`);return}}else if(r=e.context_id,i=this._contextIdToName[r],!i){this._logger.error(`Received 'destroyed' for unknown context: ${e.context_id}`);return}delete this._contextIdToName[r],delete this._contextNameToId[i];const s=this._contextNameToData[i];if(delete this._contextNameToData[i],!s||!s.isAnnounced){this._logger.error(`Received 'destroyed' for unknown context: ${r}`);return}}sendSubscribe(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:ym,domain:"global",context_id:e.contextId}).then(n=>{})}sendUnsubscribe(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:vm,domain:"global",context_id:e.contextId}).then(n=>{})}calculateContextDeltaV1(e,n){const r={added:{},updated:{},removed:[],reset:void 0};if(e)for(const i of Object.keys(e))Object.keys(n).indexOf(i)!==-1&&n[i]!==null&&!ki(e[i],n[i])&&(r.updated[i]=n[i]);for(const i of Object.keys(n))!e||Object.keys(e).indexOf(i)===-1?n[i]!==null&&(r.added[i]=n[i]):n[i]===null&&r.removed.push(i);return r}calculateContextDeltaV2(e,n){var i,s;const r={added:{},updated:{},removed:[],reset:void 0,commands:[]};for(const o of Object.keys(n))if(n[o]!==null){const a=e?e[o]:null;ki(a,n[o])||(i=r.commands)==null||i.push({type:"set",path:o,value:n[o]})}else(s=r.commands)==null||s.push({type:"remove",path:o});return r}resetState(){for(const e of this._gw3Subscriptions)this._connection.off(e);this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((e,n)=>(e[n]=this._contextNameToData[n].context,e),{}),this._contextNameToData={}}async reInitiateState(){var e;this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),(e=this._connection.replayer)==null||e.drain(Lo.name,n=>{const r=n.type;r&&(r===Ii||r===_i||r===Ci?this.handleContextCreatedMessage(n):r===wn||r===yr||r===vr?this.handleContextUpdatedMessage(n):(r===Ei||r===Si)&&this.handleContextDestroyedMessage(n))}),await Promise.all(this._contextsSubscriptionsCache.map(n=>this.subscribe(n.contextName,n.callback,n.subKey))),await this.flushQueue();for(const n in this._contextsTempCache){if(typeof this._contextsTempCache[n]!="object"||Object.keys(this._contextsTempCache[n]).length===0)continue;const r=this._contextsTempCache[n];this._logger.info(`Re-announcing known context: ${n}`),await this.flushQueue(),await this.update(n,r)}this._contextsTempCache={},this._logger.info("Contexts are re-announced")}flushQueue(){return new Promise(e=>setTimeout(()=>e(),0))}}class v_{constructor(e){c(this,"initTime");c(this,"initStartTime");c(this,"initEndTime");c(this,"_bridge");this._bridge=new y_(e)}all(){return this._bridge.all()}update(e,n){return this.checkName(e),this.checkData(n),this._bridge.update(e,n)}set(e,n){return this.checkName(e),this.checkData(n),this._bridge.set(e,n)}setPath(e,n,r){return this.checkName(e),this.checkPath(n),n===""?(this.checkData(r),this.set(e,r)):this._bridge.setPath(e,n,r)}setPaths(e,n){if(this.checkName(e),!Array.isArray(n))throw new Error("Please provide the paths as an array of PathValues!");for(const{path:r,value:i}of n)this.checkPath(r),r===""&&this.checkData(i);return this._bridge.setPaths(e,n)}subscribe(e,n){if(this.checkName(e),typeof n!="function")throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(r,i,s,o,a)=>n(r,i,s,()=>this._bridge.unsubscribe(o),a)).then(r=>()=>{this._bridge.unsubscribe(r)})}get(e){return this.checkName(e),this._bridge.get(e)}ready(){return Promise.resolve(this)}destroy(e){return this.checkName(e),this._bridge.destroy(e)}get setPathSupported(){return this._bridge.setPathSupported}checkName(e){if(typeof e!="string"||e==="")throw new Error("Please provide the name as a non-empty string!")}checkPath(e){if(typeof e!="string")throw new Error("Please provide the path as a dot delimited string!")}checkData(e){if(typeof e!="object")throw new Error("Please provide the data as an object!")}}function fc(t,e,n){return typeof e!="function"&&typeof n!="function"?t:(typeof e!="function"?e=()=>{}:typeof n!="function"&&(n=()=>{}),t.then(e,n))}function w_(t=0,e,n){let r;const i=()=>{r&&clearTimeout(r)};return e.then(()=>{i()}).catch(()=>{i()}),new Promise((s,o)=>{r=setTimeout(()=>o(n),t)})}var Me=function(t){return{ok:!0,result:t}},Te=function(t){return{ok:!1,error:t}},b_=function(t){return t.ok===!0?Promise.resolve(t.result):Promise.reject(t.error)},C_=function(t,e){return e.ok===!0?e.result:t},S_=function(t){if(t.ok===!0)return t.result;throw t.error},I_=function(t,e){return e.ok===!0?Me(t(e.result)):e},Lh=function(t,e,n){return e.ok===!1?e:n.ok===!1?n:Me(t(e.result,n.result))},nl=function(t,e){return e.ok===!0?e:Te(t(e.error))},__=function(t,e){return e.ok===!0?t(e.result):e};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var pc=function(){return pc=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},pc.apply(this,arguments)};function E_(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function gc(t,e){if(t===e||t===null&&e===null)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="object"){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!gc(t[n],e[n]))return!1;return!0}var r=Object.keys(t);if(r.length!==Object.keys(e).length)return!1;for(var n=0;n<r.length;n++)if(!e.hasOwnProperty(r[n])||!gc(t[r[n]],e[r[n]]))return!1;return!0}}var Ti=function(t){return Array.isArray(t)},Ls=function(t){return typeof t=="object"&&t!==null&&!Ti(t)},k_=function(t){switch(typeof t){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return t instanceof Array?"an array":t===null?"null":"an object";default:return JSON.stringify(t)}},Qt=function(t,e){return"expected "+t+", got "+k_(e)},hi=function(t){return t.map(function(e){return typeof e=="string"?"."+e:"["+e+"]"}).join("")},fi=function(t,e){var n=e.at,r=E_(e,["at"]);return pc({at:t+(n||"")},r)},Ae=function(){function t(e){var n=this;this.decode=e,this.run=function(r){return nl(function(i){return{kind:"DecoderError",input:r,at:"input"+(i.at||""),message:i.message||""}},n.decode(r))},this.runPromise=function(r){return b_(n.run(r))},this.runWithException=function(r){return S_(n.run(r))},this.map=function(r){return new t(function(i){return I_(r,n.decode(i))})},this.andThen=function(r){return new t(function(i){return __(function(s){return r(s).decode(i)},n.decode(i))})},this.where=function(r,i){return n.andThen(function(s){return r(s)?t.succeed(s):t.fail(i)})}}return t.string=function(){return new t(function(e){return typeof e=="string"?Me(e):Te({message:Qt("a string",e)})})},t.number=function(){return new t(function(e){return typeof e=="number"?Me(e):Te({message:Qt("a number",e)})})},t.boolean=function(){return new t(function(e){return typeof e=="boolean"?Me(e):Te({message:Qt("a boolean",e)})})},t.constant=function(e){return new t(function(n){return gc(n,e)?Me(e):Te({message:"expected "+JSON.stringify(e)+", got "+JSON.stringify(n)})})},t.object=function(e){return new t(function(n){if(Ls(n)&&e){var r={};for(var i in e)if(e.hasOwnProperty(i)){var s=e[i].decode(n[i]);if(s.ok===!0)s.result!==void 0&&(r[i]=s.result);else return n[i]===void 0?Te({message:"the key '"+i+"' is required but was not present"}):Te(fi("."+i,s.error))}return Me(r)}else return Ls(n)?Me(n):Te({message:Qt("an object",n)})})},t.array=function(e){return new t(function(n){if(Ti(n)&&e){var r=function(i,s){return nl(function(o){return fi("["+s+"]",o)},e.decode(i))};return n.reduce(function(i,s,o){return Lh(function(a,l){return a.concat([l])},i,r(s,o))},Me([]))}else return Ti(n)?Me(n):Te({message:Qt("an array",n)})})},t.tuple=function(e){return new t(function(n){if(Ti(n)){if(n.length!==e.length)return Te({message:"expected a tuple of length "+e.length+", got one of length "+n.length});for(var r=[],i=0;i<e.length;i++){var s=e[i].decode(n[i]);if(s.ok)r[i]=s.result;else return Te(fi("["+i+"]",s.error))}return Me(r)}else return Te({message:Qt("a tuple of length "+e.length,n)})})},t.union=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.oneOf.apply(t,[e,n].concat(r))},t.intersection=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new t(function(s){return[e,n].concat(r).reduce(function(o,a){return Lh(Object.assign,o,a.decode(s))},Me({}))})},t.anyJson=function(){return new t(function(e){return Me(e)})},t.unknownJson=function(){return new t(function(e){return Me(e)})},t.dict=function(e){return new t(function(n){if(Ls(n)){var r={};for(var i in n)if(n.hasOwnProperty(i)){var s=e.decode(n[i]);if(s.ok===!0)r[i]=s.result;else return Te(fi("."+i,s.error))}return Me(r)}else return Te({message:Qt("an object",n)})})},t.optional=function(e){return new t(function(n){return n==null?Me(void 0):e.decode(n)})},t.oneOf=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return new t(function(r){for(var i=[],s=0;s<e.length;s++){var o=e[s].decode(r);if(o.ok===!0)return o;i[s]=o.error}var a=i.map(function(l){return"at error"+(l.at||"")+": "+l.message}).join('", "');return Te({message:'expected a value matching one of the decoders, got the errors ["'+a+'"]'})})},t.withDefault=function(e,n){return new t(function(r){return Me(C_(e,n.decode(r)))})},t.valueAt=function(e,n){return new t(function(r){for(var i=r,s=0;s<e.length;s++){if(i===void 0)return Te({at:hi(e.slice(0,s+1)),message:"path does not exist"});if(typeof e[s]=="string"&&!Ls(i))return Te({at:hi(e.slice(0,s+1)),message:Qt("an object",i)});if(typeof e[s]=="number"&&!Ti(i))return Te({at:hi(e.slice(0,s+1)),message:Qt("an array",i)});i=i[e[s]]}return nl(function(o){return i===void 0?{at:hi(e),message:"path does not exist"}:fi(hi(e),o)},n.decode(i))})},t.succeed=function(e){return new t(function(n){return Me(e)})},t.fail=function(e){return new t(function(n){return Te({message:e})})},t.lazy=function(e){return new t(function(n){return e().decode(n)})},t}(),T_=Ae.string,Cm=Ae.number,Sm=Ae.boolean,jo=Ae.anyJson;Ae.unknownJson;var rl=Ae.constant,Wo=Ae.object,Im=Ae.array;Ae.tuple;Ae.dict;var le=Ae.optional;Ae.oneOf;var _m=Ae.union;Ae.intersection;Ae.withDefault;Ae.valueAt;Ae.succeed;var R_=Ae.fail;Ae.lazy;const mc=(t,e)=>{const n=typeof t;return n==="function"?jo():R_(`The provided argument as ${e} should be of type function, provided: ${typeof n}`)},Le=T_().where(t=>t.length>0,"Expected a non-empty string"),Em=Cm().where(t=>t>=0,"Expected a non-negative number or 0"),Fh=Cm().where(t=>t>0,"Expected a positive number"),P_=Wo({name:Le,objectTypes:le(Im(Le)),displayName:le(Le),accepts:le(Le),returns:le(Le),description:le(Le),version:le(Em),supportsStreaming:le(Sm()),flags:le(Wo()),getServers:le(jo().andThen(t=>mc(t,"method definition getServers")))}),D_=_m(Le,P_),$h=Wo({application:le(Le),applicationName:le(Le),pid:le(Em),machine:le(Le),user:le(Le),environment:le(Le),region:le(Le),service:le(Le),instance:le(Le),windowId:le(Le),peerId:le(Le),isLocal:le(Sm()),api:le(Le),getMethods:le(jo().andThen(t=>mc(t,"instance getMethods"))),getStreams:le(jo().andThen(t=>mc(t,"instance getStreams")))}),x_=_m(rl("best"),rl("all"),rl("skipMine"),$h,Im($h)),A_=Wo({waitTimeoutMs:le(Fh),methodResponseTimeoutMs:le(Fh)});var Wt;(function(t){t[t.Success=0]="Success",t[t.Error=1]="Error"})(Wt||(Wt={}));class N_{constructor(e,n,r,i){c(this,"protocol");c(this,"repo");c(this,"instance");c(this,"configuration");this.protocol=e,this.repo=n,this.instance=r,this.configuration=i}subscribe(e,n,r,i,s){const o=(l,u,p,g)=>{n.methodResponseTimeout=n.methodResponseTimeout??n.waitTimeoutMs,this.protocol.client.subscribe(u,n,l,p,g,s)},a=new Promise((l,u)=>{const p=C=>{l(C)},g=C=>{u(C)};if(!e){u("Method definition is required. Please, provide either a unique string for a method name or a “methodDefinition” object with a required “name” property.");return}let f;if(typeof e=="string"?f={name:e}:f=e,!f.name){u("Method definition is required. Please, provide either a unique string for a method name or a “methodDefinition” object with a required “name” property.");return}n===void 0&&(n={});let I=n.target;if(I===void 0&&(I="best"),typeof I=="string"&&I!=="all"&&I!=="best"){u(new Error(`"${I}" is not a valid target. Valid targets are "all", "best", or an instance.`));return}n.methodResponseTimeout===void 0&&(n.methodResponseTimeout=n.method_response_timeout,n.methodResponseTimeout===void 0&&(n.methodResponseTimeout=this.configuration.methodResponseTimeout)),n.waitTimeoutMs===void 0&&(n.waitTimeoutMs=n.wait_for_method_timeout,n.waitTimeoutMs===void 0&&(n.waitTimeoutMs=this.configuration.waitTimeoutMs));const S=500;let k=0,H=this.getServerMethodsByFilterAndTarget(f,I);if(H.length>0)o(H,H[0].methods[0],p,g);else{const C=()=>{if(!(!I||!n.waitTimeoutMs))if(k+=S,H=this.getServerMethodsByFilterAndTarget(f,I),H.length>0){const m=H[0].methods[0];o(H,m,p,g)}else k>=n.waitTimeoutMs?o(H,typeof e=="string"?{name:e}:e,p,g):setTimeout(C,S)};setTimeout(C,S)}});return fc(a,r,i)}servers(e){const n=e===void 0?void 0:{...e};return this.getServers(n).map(r=>r.server.instance)}methods(e){return typeof e=="string"?e={name:e}:e={...e},this.getMethods(e)}methodsForInstance(e){return this.getMethodsForInstance(e)}methodAdded(e){return this.repo.onMethodAdded(e)}methodRemoved(e){return this.repo.onMethodRemoved(e)}serverAdded(e){return this.repo.onServerAdded(e)}serverRemoved(e){return this.repo.onServerRemoved((n,r)=>{e(n,r)})}serverMethodAdded(e){return this.repo.onServerMethodAdded((n,r)=>{e({server:n,method:r})})}serverMethodRemoved(e){return this.repo.onServerMethodRemoved((n,r)=>{e({server:n,method:r})})}async invoke(e,n,r,i,s,o){return fc((async()=>{const l=typeof e=="string"?{name:e}:{...e};n||(n={}),r||(r="best"),i||(i={});const u=D_.run(l);if(!u.ok){const v=`The provided 'method' argument is invalid. Error: ${JSON.stringify(u.error)}.`;return Promise.reject(this.generateInvalidInputInvocationResult(v,l,n))}if(typeof n!="object")return Promise.reject(this.generateInvalidInputInvocationResult("The provided 'argumentObj' argument is invalid. Error: The argumentObj should be an instance of an object",l,n));const p=x_.run(r);if(!p.ok){const v=`The provided 'target' argument is invalid. Error: ${JSON.stringify(p.error)}.`;return Promise.reject(this.generateInvalidInputInvocationResult(v,l,n))}const g=A_.run(i);if(!g.ok){const v=`The provided 'options' argument is invalid. Error: ${JSON.stringify(g.error)}.`;return Promise.reject(this.generateInvalidInputInvocationResult(v,l,n))}if(s&&typeof s!="function")return Promise.reject(this.generateInvalidInputInvocationResult("The provided 'success' function is invalid. Error: The success should be a valid function",l,n));if(o&&typeof o!="function")return Promise.reject(this.generateInvalidInputInvocationResult("The provided 'error' function is invalid. Error: The error should be a valid function",l,n));i.methodResponseTimeoutMs===void 0&&(i.methodResponseTimeoutMs=i.method_response_timeout,i.methodResponseTimeoutMs===void 0&&(i.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),i.waitTimeoutMs===void 0&&(i.waitTimeoutMs=i.wait_for_method_timeout,i.waitTimeoutMs===void 0&&(i.waitTimeoutMs=this.configuration.waitTimeoutMs));let f=this.getServerMethodsByFilterAndTarget(l,r);if(f.length===0)try{f=await this.tryToAwaitForMethods(l,r,i)}catch{const E=`Can not find a method matching ${JSON.stringify(e)} with server filter ${JSON.stringify(r)}`;return Promise.reject(this.generateInvalidInputInvocationResult(E,l,n))}const I=i.methodResponseTimeoutMs,S=i,k=f.map(v=>{const E=Dt(10),x=v.methods[0],L=v.server,j=this.protocol.client.invoke(E,x,n,L,S);return Promise.race([j,w_(I,j,{invocationId:E,message:`Invocation timeout (${I} ms) reached for method name: ${x==null?void 0:x.name}, target instance: ${JSON.stringify(L.instance)}, options: ${JSON.stringify(S)}`,status:Wt.Error})])}),H=await Promise.all(k),C=this.getInvocationResultObj(H,l,n);return H.every(v=>v.status===Wt.Error)?Promise.reject(C):C})(),s,o)}generateInvalidInputInvocationResult(e,n,r){var o;const i={...n,getServers:()=>[],supportsStreaming:!1,objectTypes:n.objectTypes??[],flags:((o=n.flags)==null?void 0:o.metadata)??{}},s={invocationId:Dt(10),status:Wt.Error,message:e};return this.getInvocationResultObj([s],i,r)}getInvocationResultObj(e,n,r){const i=e.filter(l=>l.status===Wt.Success).reduce((l,u)=>(l=[...l,{executed_by:u.instance,returned:u.result,called_with:r,method:n,message:u.message,status:u.status}],l),[]),s=e.filter(l=>l.status===Wt.Error).reduce((l,u)=>(l=[...l,{executed_by:u.instance,called_with:r,name:n.name,message:u.message}],l),[]),o=e[0];return{method:n,called_with:r,returned:o.result,executed_by:o.instance,all_return_values:i,all_errors:s,message:o.message,status:o.status}}tryToAwaitForMethods(e,n,r){return new Promise((i,s)=>{if(r.waitTimeoutMs===0){s();return}const o=500;let a=0;const u=setInterval(()=>{a+=o;const p=this.getServerMethodsByFilterAndTarget(e,n);if(p.length>0)clearInterval(u),i(p);else if(a>=(r.waitTimeoutMs||1e4)){clearInterval(u),s();return}},o)})}filterByTarget(e,n){if(typeof e=="string"){if(e==="all")return[...n];if(e==="best"){const r=n.find(i=>i.server.instance.isLocal);if(r)return[r];if(n[0]!==void 0)return[n[0]]}else if(e==="skipMine")return n.filter(({server:r})=>r.instance.peerId!==this.instance.peerId)}else{let r;return Array.isArray(e)?r=e:r=[e],r.reduce((s,o)=>{const a=n.filter(l=>this.instanceMatch(o,l.server.instance));return s.concat(a)},[])}return[]}instanceMatch(e,n){return e!=null&&e.peerId&&(e!=null&&e.instance)&&(e={...e},delete e.peerId),this.containsProps(e,n)}methodMatch(e,n){return this.containsProps(e,n)}containsProps(e,n){return Object.keys(e).filter(i=>e[i]!==void 0&&e[i]!==null&&typeof e[i]!="function"&&i!=="object_types"&&i!=="display_name"&&i!=="id"&&i!=="gatewayId"&&i!=="identifier"&&i[0]!=="_").every(i=>{let s;const o=e[i],a=n[i];switch(i){case"objectTypes":s=(o||[]).every(l=>(a||[]).includes(l));break;case"flags":s=bm(a||{},o||{});break;default:s=String(o).toLowerCase()===String(a).toLowerCase()}return s})}getMethods(e){return e===void 0?this.repo.getMethods():this.repo.getMethods().filter(r=>this.methodMatch(e,r))}getMethodsForInstance(e){const r=this.repo.getServers().filter(s=>this.instanceMatch(e,s.instance));if(r.length===0)return[];let i={};return r.length===1?i=r[0].methods:r.forEach(s=>{Object.keys(s.methods).forEach(o=>{const a=s.methods[o];i[a.identifier]=a})}),Object.keys(i).map(s=>i[s])}getServers(e){const n=this.repo.getServers();return e===void 0?n.map(r=>({server:r,methods:[]})):n.reduce((r,i)=>{const o=Object.values(i.methods).filter(a=>this.methodMatch(e,a));return o.length>0&&r.push({server:i,methods:o}),r},[])}getServerMethodsByFilterAndTarget(e,n){const r=this.getServers(e);return this.filterByTarget(n,r)}}class Uo{constructor(e,n,r){c(this,"protocol");c(this,"repoMethod");c(this,"subscription");this.protocol=e,this.repoMethod=n,this.subscription=r}get stream(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream}get arguments(){return this.subscription.arguments||{}}get branchKey(){return this.subscription.branchKey}get instance(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance}close(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)}push(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)}}class O_{constructor(e,n,r){c(this,"protocol");c(this,"repoMethod");c(this,"requestContext");c(this,"arguments");c(this,"instance");this.protocol=e,this.repoMethod=n,this.requestContext=r,this.arguments=r.arguments,this.instance=r.instance}accept(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")}acceptOnBranch(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)}reject(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)}}let M_=class{constructor(e,n){c(this,"protocol");c(this,"server");this.protocol=e,this.server=n,e.server.onSubRequest((r,i)=>this.handleSubRequest(r,i)),e.server.onSubAdded((r,i)=>this.handleSubAdded(r,i)),e.server.onSubRemoved((r,i)=>this.handleSubRemoved(r,i))}handleSubRequest(e,n){if(!(n&&n.streamCallbacks&&typeof n.streamCallbacks.subscriptionRequestHandler=="function"))return;const r=new O_(this.protocol,n,e);n.streamCallbacks.subscriptionRequestHandler(r)}handleSubAdded(e,n){if(!(n&&n.streamCallbacks&&typeof n.streamCallbacks.subscriptionAddedHandler=="function"))return;const r=new Uo(this.protocol,n,e);n.streamCallbacks.subscriptionAddedHandler(r)}handleSubRemoved(e,n){if(!(n&&n.streamCallbacks&&typeof n.streamCallbacks.subscriptionRemovedHandler=="function"))return;const r=new Uo(this.protocol,n,e);n.streamCallbacks.subscriptionRemovedHandler(r)}};class jh{constructor(e,n,r){c(this,"key");c(this,"protocol");c(this,"repoMethod");this.key=e,this.protocol=n,this.repoMethod=r}subscriptions(){return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map(n=>new Uo(this.protocol,this.repoMethod,n))}close(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)}push(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])}}class L_{constructor(e,n,r){c(this,"_protocol");c(this,"_repoMethod");c(this,"_server");c(this,"name");this._protocol=e,this._repoMethod=n,this._server=r,this.name=this._repoMethod.definition.name}branches(e){const n=this._protocol.server.getBranchList(this._repoMethod);return e?n.indexOf(e)>-1?new jh(e,this._protocol,this._repoMethod):void 0:n.map(r=>new jh(r,this._protocol,this._repoMethod))}branch(e){return this.branches(e)}subscriptions(){return this._protocol.server.getSubscriptionList(this._repoMethod).map(n=>new Uo(this._protocol,this._repoMethod,n))}get definition(){var n;const e=this._repoMethod.definition;return{accepts:e.accepts,description:e.description,displayName:e.displayName,name:e.name,objectTypes:e.objectTypes,returns:e.returns,supportsStreaming:e.supportsStreaming,flags:(n=e.flags)==null?void 0:n.metadata}}close(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)}push(e,n){if(typeof n!="string"&&!Array.isArray(n)&&n!==void 0)throw new Error("invalid branches should be string or string array");if(typeof e!="object")throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,n)}updateRepoMethod(e){this._repoMethod=e}}class F_{constructor(e,n){c(this,"protocol");c(this,"serverRepository");c(this,"streaming");c(this,"invocations",0);c(this,"currentlyUnregistering",{});this.protocol=e,this.serverRepository=n,this.streaming=new M_(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}createStream(e,n,r,i,s){const o=new Promise((a,l)=>{if(!e){l("The stream name must be unique! Please, provide either a unique string for a stream name to “glue.interop.createStream()” or a “methodDefinition” object with a unique “name” property for the stream.");return}let u;if(typeof e=="string"?u={name:""+e}:u={...e},!u.name)return l(`The “name” property is required for the “streamDefinition” object and must be unique. Stream definition: ${JSON.stringify(u)}`);if(this.serverRepository.getList().some(f=>f.definition.name===u.name))return l(`A stream with the name "${u.name}" already exists! Please, provide a unique name for the stream.`);u.supportsStreaming=!0,n||(n={}),typeof n.subscriptionRequestHandler!="function"&&(n.subscriptionRequestHandler=f=>{f.accept()});const g=this.serverRepository.add({definition:u,streamCallbacks:n,protocolState:{}});this.protocol.server.createStream(g).then(()=>{let f;s?(f=s,s.updateRepoMethod(g)):f=new L_(this.protocol,g,this),g.stream=f,a(f)}).catch(f=>{g.repoId&&this.serverRepository.remove(g.repoId),l(f)})});return fc(o,r,i)}register(e,n){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a “methodDefinition” object with a required “name” property.");if(typeof n!="function")return Promise.reject(`The second parameter must be a callback function. Method: ${typeof e=="string"?e:e.name}`);const r=async(i,s)=>{try{const o=n(i.args,i.instance);if(o&&typeof o.then=="function"){const a=await o;s(void 0,a)}else s(void 0,o)}catch(o){s(o??"",o??"")}};return r.userCallback=n,this.registerCore(e,r)}registerAsync(e,n){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a “methodDefinition” object with a required “name” property.");if(typeof n!="function")return Promise.reject(`The second parameter must be a callback function. Method: ${typeof e=="string"?e:e.name}`);const r=async(i,s)=>{try{let o=!1;const a=p=>{o||s(void 0,p),o=!0},l=p=>{o||(p||(p=""),s(p,p)),o=!0},u=n(i.args,i.instance,a,l);u&&typeof u.then=="function"&&u.then(a).catch(l)}catch(o){s(o,void 0)}};return r.userCallbackAsync=n,this.registerCore(e,r)}async unregister(e,n=!1){if(e===void 0)return Promise.reject("Please, provide either a unique string for a name or an object containing a “name” property.");if(typeof e=="function"){await this.unregisterWithPredicate(e,n);return}let r;if(typeof e=="string"?r={name:e}:r=e,r.name===void 0)return Promise.reject("Method name is required. Cannot find a method if the method name is undefined!");const i=this.serverRepository.getList().find(s=>s.definition.name===r.name&&(s.definition.supportsStreaming||!1)===n);if(!i)return Promise.reject(`Method with a name "${r.name}" does not exist or is not registered by your application!`);await this.removeMethodsOrStreams([i])}async unregisterWithPredicate(e,n){const r=this.serverRepository.getList().filter(i=>e(i.definition)).filter(i=>(i.definition.supportsStreaming||!1)===n);if(!r||r.length===0)return Promise.reject(`Could not find a ${n?"stream":"method"} matching the specified condition!`);await this.removeMethodsOrStreams(r)}removeMethodsOrStreams(e){const n=[];return e.forEach(r=>{const i=this.protocol.server.unregister(r).then(()=>{r.repoId&&this.serverRepository.remove(r.repoId)});n.push(i),this.addAsCurrentlyUnregistering(r.definition.name,i)}),Promise.all(n)}async addAsCurrentlyUnregistering(e,n){const r=new Promise(i=>setTimeout(i,5e3));this.currentlyUnregistering[e]=Promise.race([n,r]).then(()=>{delete this.currentlyUnregistering[e]})}async registerCore(e,n){let r;if(typeof e=="string"?r={name:""+e}:r={...e},!r.name)return Promise.reject(`Please, provide a (unique) string value for the “name” property in the “methodDefinition” object: ${JSON.stringify(e)}`);const i=this.currentlyUnregistering[r.name];if(typeof i<"u"&&await i,this.serverRepository.getList().some(a=>a.definition.name===r.name))return Promise.reject(`A method with the name "${r.name}" already exists! Please, provide a unique name for the method.`);if(r.supportsStreaming)return Promise.reject(`When you create methods with “glue.interop.register()” or “glue.interop.registerAsync()” the property “supportsStreaming” cannot be “true”. If you want “${r.name}” to be a stream, please use the “glue.interop.createStream()” method.`);const o=this.serverRepository.add({definition:r,theFunction:n,protocolState:{}});return this.protocol.server.register(o).catch(a=>{throw o!=null&&o.repoId&&this.serverRepository.remove(o.repoId),a})}onMethodInvoked(e,n,r){!e||!e.theFunction||e.theFunction(r,(i,s)=>{if(i!=null){if(i.message&&typeof i.message=="string")i=i.message;else if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=`un-stringifyable error in onMethodInvoked! Top level prop names: ${Object.keys(i)}`}}s?(typeof s!="object"||Array.isArray(s))&&(s={_value:s}):s={},this.protocol.server.methodInvocationResult(e,n,i,s)})}}class km{constructor(e,n,r){c(this,"wrapped",{});this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter(i=>i.supportsStreaming)},n&&this.refreshWrappedObject(n),r&&(r.loggedIn(()=>{this.refresh(r)}),this.refresh(r))}unwrap(){return this.wrapped}refresh(e){if(!e)return;const n=e==null?void 0:e.resolvedIdentity,r=Object.assign({},n??{},{peerId:e==null?void 0:e.peerId});this.refreshWrappedObject(r)}refreshWrappedObject(e){Object.keys(e).forEach(n=>{this.wrapped[n]=e[n]}),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=e.application??Dt(10),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=e.pid??e.process??Math.floor(Math.random()*1e10),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=e.isLocal??!0,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId}}const Fs=t=>({...t,flags:t.flags.metadata||{}});class $_{constructor(e,n){c(this,"logger");c(this,"API");c(this,"servers",{});c(this,"myServer");c(this,"methodsCount",{});c(this,"callbacks",pn());this.logger=e,this.API=n;const r=this.API.instance.peerId;this.myServer={id:r,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[r]=this.myServer}addServer(e,n){this.logger.debug(`adding server ${n}`);const r=this.servers[n];if(r)return r.id;const i=new km(this.API,e),s={id:n,methods:{},instance:i.unwrap(),wrapper:i};return this.servers[n]=s,this.callbacks.execute("onServerAdded",s.instance),n}removeServerById(e,n){const r=this.servers[e];if(r)this.logger.debug(`removing server ${e}`);else{this.logger.warn(`not aware of server ${e}, my state ${JSON.stringify(Object.keys(this.servers))}`);return}Object.keys(r.methods).forEach(i=>{this.removeServerMethod(e,i)}),delete this.servers[e],this.callbacks.execute("onServerRemoved",r.instance,n)}addServerMethod(e,n){const r=this.servers[e];if(!r)throw new Error("server does not exists");if(r.methods[n.id])return;const i=this.createMethodIdentifier(n),s=this,o={identifier:i,gatewayId:n.id,name:n.name,displayName:n.display_name,description:n.description,version:n.version,objectTypes:n.object_types||[],accepts:n.input_signature,returns:n.result_signature,supportsStreaming:typeof n.flags<"u"?n.flags.streaming:!1,flags:n.flags??{},getServers:()=>s.getServersByMethod(i)};o.object_types=o.objectTypes,o.display_name=o.displayName,o.version=o.version,r.methods[n.id]=o;const a=Fs(o);return this.methodsCount[i]||(this.methodsCount[i]=0,this.callbacks.execute("onMethodAdded",a)),this.methodsCount[i]=this.methodsCount[i]+1,this.callbacks.execute("onServerMethodAdded",r.instance,a),o}removeServerMethod(e,n){const r=this.servers[e];if(!r)throw new Error("server does not exists");const i=r.methods[n];delete r.methods[n];const s=Fs(i);this.methodsCount[i.identifier]=this.methodsCount[i.identifier]-1,this.methodsCount[i.identifier]===0&&this.callbacks.execute("onMethodRemoved",s),this.callbacks.execute("onServerMethodRemoved",r.instance,s)}getMethods(){return this.extractMethodsFromServers(Object.values(this.servers)).map(Fs)}getServers(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)}onServerAdded(e){const n=this.callbacks.add("onServerAdded",e),r=this.getServers().map(i=>i.instance);return this.returnUnsubWithDelayedReplay(n,r,e)}onMethodAdded(e){const n=this.callbacks.add("onMethodAdded",e),r=this.getMethods();return this.returnUnsubWithDelayedReplay(n,r,e)}onServerMethodAdded(e){const n=this.callbacks.add("onServerMethodAdded",e);let r=!1;const i=this.getServers();return setTimeout(()=>{i.forEach(s=>{const o=s.methods;Object.keys(o).forEach(a=>{r||e(s.instance,o[a])})})},0),()=>{r=!0,n()}}onMethodRemoved(e){return this.callbacks.add("onMethodRemoved",e)}onServerRemoved(e){return this.callbacks.add("onServerRemoved",e)}onServerMethodRemoved(e){return this.callbacks.add("onServerMethodRemoved",e)}getServerById(e){if(this.servers[e])return this.hideServerMethodSystemFlags(this.servers[e])}reset(){Object.keys(this.servers).forEach(e=>{this.removeServerById(e,"reset")}),this.servers={[this.myServer.id]:this.myServer},this.methodsCount={}}createMethodIdentifier(e){const n=e.input_signature??"",r=e.result_signature??"";return(e.name+n+r).toLowerCase()}getServersByMethod(e){const n=[];return Object.values(this.servers).forEach(r=>{Object.values(r.methods).forEach(i=>{i.identifier===e&&n.push(r.instance)})}),n}returnUnsubWithDelayedReplay(e,n,r){let i=!1;return setTimeout(()=>{n.forEach(s=>{i||r(s)})},0),()=>{i=!0,e()}}hideServerMethodSystemFlags(e){const n={};return Object.entries(e.methods).forEach(([r,i])=>{n[r]=Fs(i)}),{...e,methods:n}}extractMethodsFromServers(e){return Object.values(e).reduce((r,i)=>[...r,...Object.values(i.methods)],[])}}class j_{constructor(){c(this,"nextId",0);c(this,"methods",[])}add(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e}remove(e){if(typeof e!="string")return new TypeError("Expecting a string");this.methods=this.methods.filter(n=>n.repoId!==e)}getById(e){if(typeof e=="string")return this.methods.find(n=>n.repoId===e)}getList(){return this.methods.map(e=>e)}length(){return this.methods.length}reset(){this.methods=[]}}const Wh="onSubscriptionRequest",Uh="onSubscriptionAdded",il="onSubscriptionRemoved";class W_{constructor(e,n,r){c(this,"session");c(this,"repository");c(this,"serverRepository");c(this,"ERR_URI_SUBSCRIPTION_FAILED","com.tick42.agm.errors.subscription.failure");c(this,"callbacks",pn());c(this,"nextStreamId",0);this.session=e,this.repository=n,this.serverRepository=r,e.on("add-interest",i=>{this.handleAddInterest(i)}),e.on("remove-interest",i=>{this.handleRemoveInterest(i)})}acceptRequestOnBranch(e,n,r){if(typeof r!="string"&&(r=""),typeof n.protocolState.subscriptionsMap!="object")throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(n.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");const i=this.getStreamId(n,r),s=e.msg.subscription_id,o={id:s,arguments:e.arguments,instance:e.instance,branchKey:r,streamId:i,subscribeMsg:e.msg};n.protocolState.subscriptionsMap[s]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:s,stream_id:i}),this.callbacks.execute(Uh,o,n)}rejectRequest(e,n,r){typeof r!="string"&&(r=""),this.sendSubscriptionFailed("Subscription rejected by user. "+r,e.msg.subscription_id)}pushData(e,n,r){if(typeof e!="object"||!Array.isArray(e.protocolState.branchKeyToStreamIdMap))return;if(typeof n!="object")throw new Error("Invalid arguments. Data must be an object.");typeof r=="string"?r=[r]:(!Array.isArray(r)||r.length<=0)&&(r=[]),e.protocolState.branchKeyToStreamIdMap.filter(s=>!r||r.length===0?!0:r.indexOf(s.key)>=0).map(s=>s.streamId).forEach(s=>{const o={type:"publish",stream_id:s,data:n};this.session.sendFireAndForget(o)})}pushDataToSingle(e,n,r){if(typeof r!="object")throw new Error("Invalid arguments. Data must be an object.");const i={type:"post",subscription_id:n.id,data:r};this.session.sendFireAndForget(i)}closeSingleSubscription(e,n){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[n.id];const r={type:"drop-subscription",subscription_id:n.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(r),n.instance,this.callbacks.execute(il,n,e)}closeMultipleSubscriptions(e,n){if(typeof e!="object"||typeof e.protocolState.subscriptionsMap!="object"||!e.protocolState.subscriptionsMap)return;const r=e.protocolState.subscriptionsMap;let i=Object.keys(r).map(s=>r[s]);typeof n=="string"&&(i=i.filter(s=>s.branchKey===n)),i.forEach(s=>{delete r[s.id];const o={type:"drop-subscription",subscription_id:s.id,reason:"Server dropping all subscriptions on stream_id: "+s.streamId};this.session.sendFireAndForget(o)})}getSubscriptionList(e,n){if(typeof e!="object")return[];let r=[];if(!e.protocolState.subscriptionsMap)return[];const i=e.protocolState.subscriptionsMap,s=Object.keys(i).map(o=>i[o]);return typeof n!="string"?r=s:r=s.filter(o=>o.branchKey===n),r}getBranchList(e){if(typeof e!="object")return[];if(!e.protocolState.subscriptionsMap)return[];const n=e.protocolState.subscriptionsMap,r=Object.keys(n).map(s=>n[s]),i=[];return r.forEach(s=>{let o="";typeof s=="object"&&typeof s.branchKey=="string"&&(o=s.branchKey),i.indexOf(o)===-1&&i.push(o)}),i}onSubAdded(e){this.onSubscriptionLifetimeEvent(Uh,e)}onSubRequest(e){this.onSubscriptionLifetimeEvent(Wh,e)}onSubRemoved(e){this.onSubscriptionLifetimeEvent(il,e)}handleRemoveInterest(e){const n=this.serverRepository.getById(e.method_id);if(typeof e.subscription_id!="string"||typeof n!="object"||!n.protocolState.subscriptionsMap||typeof n.protocolState.subscriptionsMap[e.subscription_id]!="object")return;const r=n.protocolState.subscriptionsMap[e.subscription_id];delete n.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(il,r,n)}onSubscriptionLifetimeEvent(e,n){this.callbacks.add(e,n)}getNextStreamId(){return this.nextStreamId+++""}handleAddInterest(e){const n=this.repository.getServerById(e.caller_id),r=(n==null?void 0:n.instance)??{},i={msg:e,arguments:e.arguments_kv||{},instance:r},s=this.serverRepository.getById(e.method_id);if(s===void 0){const o="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(o,e.subscription_id);return}if(s.protocolState.subscriptionsMap&&s.protocolState.subscriptionsMap[e.subscription_id]){this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id);return}this.callbacks.execute(Wh,i,s)}sendSubscriptionFailed(e,n){const r={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:n};this.session.sendFireAndForget(r)}getStreamId(e,n){if(typeof n!="string"&&(n=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error(`streaming ${e.definition.name} method without protocol state`);const r=e.protocolState.branchKeyToStreamIdMap.filter(s=>s.key===n)[0];let i=r?r.streamId:void 0;return(typeof i!="string"||i==="")&&(i=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:n,streamId:i})),i}}class U_{constructor(e,n,r,i){c(this,"session");c(this,"clientRepository");c(this,"serverRepository");c(this,"logger");c(this,"callbacks",pn());c(this,"streaming");this.session=e,this.clientRepository=n,this.serverRepository=r,this.logger=i,this.streaming=new W_(e,n,r),this.session.on("invoke",s=>this.handleInvokeMessage(s))}createStream(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)}register(e,n){const r=e.definition,i=Object.assign({},{metadata:r.flags??{}},{streaming:n||!1}),s={type:"register",methods:[{id:e.repoId,name:r.name,display_name:r.displayName,description:r.description,version:r.version,flags:i,object_types:r.objectTypes||r.object_types,input_signature:r.accepts,result_signature:r.returns,restrictions:void 0}]};return this.session.send(s,{methodId:e.repoId}).then(()=>{this.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)}).catch(o=>{throw this.logger.warn(`failed to register method ${e.definition.name} with id ${e.repoId} - ${JSON.stringify(o)}`),o})}onInvoked(e){this.callbacks.add("onInvoked",e)}methodInvocationResult(e,n,r,i){let s;r||r===""?s={type:"error",request_id:n,reason_uri:"agm.errors.client_error",reason:r,context:i,peer_id:void 0}:s={type:"yield",invocation_id:n,peer_id:this.session.peerId,result:i,request_id:void 0},this.session.sendFireAndForget(s)}async unregister(e){const n={type:"unregister",methods:[e.repoId]};await this.session.send(n)}getBranchList(e){return this.streaming.getBranchList(e)}getSubscriptionList(e,n){return this.streaming.getSubscriptionList(e,n)}closeAllSubscriptions(e,n){this.streaming.closeMultipleSubscriptions(e,n)}pushData(e,n,r){this.streaming.pushData(e,n,r)}pushDataToSingle(e,n,r){this.streaming.pushDataToSingle(e,n,r)}closeSingleSubscription(e,n){this.streaming.closeSingleSubscription(e,n)}acceptRequestOnBranch(e,n,r){this.streaming.acceptRequestOnBranch(e,n,r)}rejectRequest(e,n,r){this.streaming.rejectRequest(e,n,r)}onSubRequest(e){this.streaming.onSubRequest(e)}onSubAdded(e){this.streaming.onSubAdded(e)}onSubRemoved(e){this.streaming.onSubRemoved(e)}handleInvokeMessage(e){var p;const n=e.invocation_id,r=e.caller_id,i=e.method_id,s=e.arguments_kv,a=this.serverRepository.getList().filter(g=>g.repoId===i)[0];if(a===void 0)return;const l=(p=this.clientRepository.getServerById(r))==null?void 0:p.instance,u={args:s,instance:l};this.callbacks.execute("onInvoked",a,n,u)}}class z_{constructor(e,n){c(this,"repository");c(this,"subscriptionData");this.repository=e,this.subscriptionData=n}get requestArguments(){return this.subscriptionData.params.arguments||{}}get servers(){return this.subscriptionData.trackedServers.reduce((e,n)=>{var r;if(n.subscriptionId){const i=(r=this.repository.getServerById(n.serverId))==null?void 0:r.instance;i&&e.push(i)}return e},[])}get serverInstance(){return this.servers[0]}get stream(){return this.subscriptionData.method}onData(e){if(typeof e!="function")throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),this.subscriptionData.handlers.onData.length===1&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach(n=>{e(n)})}onClosed(e){if(typeof e!="function")throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)}onFailed(e){}onConnected(e){if(typeof e!="function")throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)}close(){this.subscriptionData.close()}setNewSubscription(e){this.subscriptionData=e}}class B_{constructor(e){c(this,"config");c(this,"cache",[]);c(this,"timeoutIds",[]);this.config=e}add(e){const n=Dt(10);this.cache.push({id:n,element:e});const r=setTimeout(()=>{const i=this.cache.findIndex(s=>s.id===n);i<0||this.cache.splice(i,1)},this.config.ELEMENT_TTL_MS);this.timeoutIds.push(r)}flush(){const e=this.cache.map(n=>n.element);return this.timeoutIds.forEach(n=>clearInterval(n)),this.cache=[],this.timeoutIds=[],e}}const $s="awaitingAccept",sl="subscribed",ol="Subscription failed.",H_="Subscription rejected.",G_="ServerInitiated",zh="ClientInitiated";class q_{constructor(e,n,r){c(this,"session");c(this,"repository");c(this,"logger");c(this,"subscriptionsList",{});c(this,"timedCache",new B_({ELEMENT_TTL_MS:1e4}));c(this,"subscriptionIdToLocalKeyMap",{});c(this,"nextSubLocalKey",0);c(this,"handleErrorSubscribing",e=>{const n=e._tag,r=n.subLocalKey,i=this.subscriptionsList[r];if(typeof i=="object"&&(i.trackedServers=i.trackedServers.filter(s=>s.serverId!==n.serverId),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===$s){const s=typeof e.reason=="string"&&e.reason!==""?' Publisher said "'+e.reason+'".':" No reason given.",o=typeof i.params.arguments=="object"?JSON.stringify(i.params.arguments):"{}";i.error({message:H_+s+" Called with:"+o,called_with:i.params.arguments,method:i.method})}else i.status===sl&&this.callOnClosedHandlers(i);delete this.subscriptionsList[r]}});c(this,"handleSubscribed",e=>{const n=e._tag.subLocalKey,r=this.subscriptionsList[n];if(typeof r!="object")return;const i=e._tag.serverId,s=r.trackedServers.filter(a=>a.serverId===i)[0];if(typeof s!="object")return;s.subscriptionId=e.subscription_id,this.subscriptionIdToLocalKeyMap[e.subscription_id]=n;const o=r.status===$s;if(r.status=sl,o){let a=!1,l=r.subscription;l?(l.setNewSubscription(r),r.success(l),a=!0):(l=new z_(this.repository,r),r.subscription=l,r.success(l));for(const u of r.handlers.onConnected)try{u(l.serverInstance,a)}catch{}}});c(this,"handleEventData",e=>{const n=this.subscriptionIdToLocalKeyMap[e.subscription_id];if(typeof n>"u")return;const r=this.subscriptionsList[n];if(typeof r!="object")return;const i=r.trackedServers.filter(g=>g.subscriptionId===e.subscription_id);if(i.length!==1)return;const s=e.oob,o=i[0].serverId,a=this.repository.getServerById(o),l=()=>({data:e.data,server:(a==null?void 0:a.instance)??{},requestArguments:r.params.arguments,message:void 0,private:s}),u=r.handlers.onData,p=r.queued.data;u.length>0?u.forEach(g=>{typeof g=="function"&&g(l())}):p.push(l())});c(this,"handleSubscriptionCancelled",e=>{const n=this.subscriptionIdToLocalKeyMap[e.subscription_id];if(typeof n>"u")return;const r=this.subscriptionsList[n];if(typeof r!="object")return;const i=r.trackedServers.length-1;r.trackedServers=r.trackedServers.filter(s=>s.subscriptionId===e.subscription_id?(r.queued.closers.push(s.serverId),!1):!0),r.trackedServers.length===i&&(r.trackedServers.length<=0&&(this.timedCache.add(r),clearTimeout(r.timeoutId),this.callOnClosedHandlers(r),delete this.subscriptionsList[n]),delete this.subscriptionIdToLocalKeyMap[e.subscription_id])});this.session=e,this.repository=n,this.logger=r,e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}subscribe(e,n,r,i,s,o){if(r.length===0){s({method:e,called_with:n.arguments,message:ol+" No available servers matched the target params."});return}const a=this.getNextSubscriptionLocalKey(),l=this.registerSubscription(a,e,n,i,s,n.methodResponseTimeout||1e4,o);if(typeof l!="object"){s({method:e,called_with:n.arguments,message:ol+" Unable to register the user callbacks."});return}r.forEach(u=>{const p=u.server.id,g=u.methods.find(I=>I.name===e.name);if(!g){this.logger.error(`can not find method ${e.name} for target ${u.server.id}`);return}l.trackedServers.push({serverId:p,subscriptionId:void 0});const f={type:"subscribe",server_id:p,method_id:g.gatewayId,arguments_kv:n.arguments};this.session.send(f,{serverId:p,subLocalKey:a}).then(I=>this.handleSubscribed(I)).catch(I=>this.handleErrorSubscribing(I))})}drainSubscriptions(){const e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e}drainSubscriptionsCache(){return this.timedCache.flush()}getNextSubscriptionLocalKey(){const e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e}registerSubscription(e,n,r,i,s,o,a){const l={localKey:e,status:$s,method:n,params:r,success:i,error:s,trackedServers:[],handlers:{onData:(a==null?void 0:a.handlers.onData)||[],onClosed:(a==null?void 0:a.handlers.onClosed)||[],onConnected:(a==null?void 0:a.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:()=>this.closeSubscription(e),subscription:a==null?void 0:a.subscription};return a||(r.onData&&l.handlers.onData.push(r.onData),r.onClosed&&l.handlers.onClosed.push(r.onClosed),r.onConnected&&l.handlers.onConnected.push(r.onConnected)),this.subscriptionsList[e]=l,l.timeoutId=setTimeout(()=>{if(this.subscriptionsList[e]===void 0)return;const u=this.subscriptionsList[e];u.status===$s?(s({method:n,called_with:r.arguments,message:ol+" Subscription attempt timed out after "+o+" ms."}),delete this.subscriptionsList[e]):u.status===sl&&u.trackedServers.length>0&&(u.trackedServers=u.trackedServers.filter(p=>typeof p.subscriptionId<"u"),delete u.timeoutId,u.trackedServers.length<=0&&(this.callOnClosedHandlers(u),delete this.subscriptionsList[e]))},o),l}callOnClosedHandlers(e,n){var o;const r=e.queued.closers.length,i=r>0?e.queued.closers[r-1]:null;let s;i!==void 0&&typeof i=="string"&&(s=((o=this.repository.getServerById(i))==null?void 0:o.instance)??{}),e.handlers.onClosed.forEach(a=>{typeof a=="function"&&a({message:n||G_,requestArguments:e.params.arguments||{},server:s,stream:e.method})})}closeSubscription(e){const n=this.subscriptionsList[e];typeof n=="object"&&(n.trackedServers.forEach(r=>{typeof r.subscriptionId>"u"||(n.queued.closers.push(r.serverId),this.session.sendFireAndForget({type:"unsubscribe",subscription_id:r.subscriptionId,reason_uri:"",reason:zh}),delete this.subscriptionIdToLocalKeyMap[r.subscriptionId])}),n.trackedServers=[],this.callOnClosedHandlers(n,zh),delete this.subscriptionsList[e])}}class V_{constructor(e,n,r){c(this,"session");c(this,"repository");c(this,"logger");c(this,"streaming");this.session=e,this.repository=n,this.logger=r,e.on("peer-added",i=>this.handlePeerAdded(i)),e.on("peer-removed",i=>this.handlePeerRemoved(i)),e.on("methods-added",i=>this.handleMethodsAddedMessage(i)),e.on("methods-removed",i=>this.handleMethodsRemovedMessage(i)),this.streaming=new q_(e,n,r)}subscribe(e,n,r,i,s,o){this.streaming.subscribe(e,n,r,i,s,o)}invoke(e,n,r,i){const s=i.id,o=n.gatewayId,a={type:"call",server_id:s,method_id:o,arguments_kv:r};return this.session.send(a,{invocationId:e,serverId:s}).then(l=>this.handleResultMessage(l)).catch(l=>this.handleInvocationError(l))}drainSubscriptions(){return this.streaming.drainSubscriptions()}drainSubscriptionsCache(){return this.streaming.drainSubscriptionsCache()}handlePeerAdded(e){const n=e.new_peer_id,r=e.identity,i=e.meta?e.meta.local:!0,s=Number(r.process),o={machine:r.machine,pid:isNaN(s)?r.process:s,instance:r.instance,application:r.application,applicationName:r.applicationName,environment:r.environment,region:r.region,user:r.user,windowId:r.windowId,peerId:n,api:r.api,isLocal:i};this.repository.addServer(o,n)}handlePeerRemoved(e){const n=e.removed_id,r=e.reason;this.repository.removeServerById(n,r)}handleMethodsAddedMessage(e){const n=e.server_id;e.methods.forEach(i=>{this.repository.addServerMethod(n,i)})}handleMethodsRemovedMessage(e){const n=e.server_id,r=e.methods,i=this.repository.getServerById(n);i&&Object.keys(i.methods).forEach(o=>{const a=i.methods[o];r.indexOf(a.gatewayId)>-1&&this.repository.removeServerMethod(n,o)})}handleResultMessage(e){const n=e._tag.invocationId,r=e.result,i=e._tag.serverId,s=this.repository.getServerById(i);return{invocationId:n,result:r,instance:s==null?void 0:s.instance,status:Wt.Success,message:""}}handleInvocationError(e){if(this.logger.debug(`handle invocation error ${JSON.stringify(e)}`),"_tag"in e){const n=e._tag.invocationId,r=e._tag.serverId,i=this.repository.getServerById(r),s=e.reason,o=e.context;return{invocationId:n,result:o,instance:i==null?void 0:i.instance,status:Wt.Error,message:s}}else return{invocationId:"",message:e.message,status:Wt.Error,error:e}}}function J_(t,e,n,r,i,s){const o=i.logger.subLogger("gw3-protocol");let a;const l=new Promise(S=>{a=S}),u=e.domain("agm",["subscribed"]),p=new U_(u,n,r,o.subLogger("server")),g=new V_(u,n,o.subLogger("client"));async function f(){var C,m;o.info("reconnected - will replay registered methods and subscriptions"),g.drainSubscriptionsCache().forEach(v=>{const E=v.method,x=Object.assign({},v.params);o.info(`trying to soft-re-subscribe to method ${E.name}, with params: ${JSON.stringify(x)}`),s.client.subscribe(E,x,void 0,void 0,v).then(()=>o.info(`soft-subscribing to method ${E.name} DONE`)).catch(L=>o.warn(`subscribing to method ${E.name} failed: ${JSON.stringify(L)}}`))});const S=[],k=g.drainSubscriptions();for(const v of k){const E=v.method,x=Object.assign({},v.params);o.info(`trying to re-subscribe to method ${E.name}, with params: ${JSON.stringify(x)}`),S.push(s.client.subscribe(E,x,void 0,void 0,v).then(()=>o.info(`subscribing to method ${E.name} DONE`)))}const H=r.getList();r.reset();for(const v of H){const E=v.definition;v.stream?S.push(s.server.createStream(E,v.streamCallbacks,void 0,void 0,v.stream).then(()=>o.info(`subscribing to method ${E.name} DONE`)).catch(()=>o.warn(`subscribing to method ${E.name} FAILED`))):(C=v==null?void 0:v.theFunction)!=null&&C.userCallback?S.push(s.register(E,v.theFunction.userCallback).then(()=>o.info(`registering method ${E.name} DONE`)).catch(()=>o.warn(`registering method ${E.name} FAILED`))):(m=v==null?void 0:v.theFunction)!=null&&m.userCallbackAsync&&S.push(s.registerAsync(E,v.theFunction.userCallbackAsync).then(()=>o.info(`registering method ${E.name} DONE`)).catch(()=>o.warn(`registering method ${E.name} FAILED`)))}await Promise.all(S),o.info("Interop is re-announced")}function I(){a&&(a({client:g,server:p}),a=void 0)}return u.onJoined(S=>{n.addServer(t,e.peerId),S?f().then(()=>e.setLibReAnnounced({name:"interop"})).catch(k=>o.warn(`Error while re-announcing interop: ${JSON.stringify(k)}`)):I()}),u.onLeft(()=>{n.reset()}),u.join(),l}class K_{constructor(e){c(this,"instance");c(this,"readyPromise");c(this,"client");c(this,"server");c(this,"unwrappedInstance");c(this,"protocol");c(this,"clientRepository");c(this,"serverRepository");if(typeof e>"u")throw new Error("configuration is required");if(typeof e.connection>"u")throw new Error("configuration.connections is required");const n=e.connection;typeof e.methodResponseTimeout!="number"&&(e.methodResponseTimeout=30*1e3),typeof e.waitTimeoutMs!="number"&&(e.waitTimeoutMs=30*1e3),this.unwrappedInstance=new km(this,void 0,n),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new $_(e.logger.subLogger("cRep"),this),this.serverRepository=new j_;let r;if(n.protocolVersion===3)r=J_(this.instance,n,this.clientRepository,this.serverRepository,e,this);else throw new Error(`protocol ${n.protocolVersion} not supported`);this.readyPromise=r.then(i=>(this.protocol=i,this.client=new N_(this.protocol,this.clientRepository,this.instance,e),this.server=new F_(this.protocol,this.serverRepository),this))}ready(){return this.readyPromise}serverRemoved(e){return this.client.serverRemoved(e)}serverAdded(e){return this.client.serverAdded(e)}serverMethodRemoved(e){return this.client.serverMethodRemoved(e)}serverMethodAdded(e){return this.client.serverMethodAdded(e)}methodRemoved(e){return this.client.methodRemoved(e)}methodAdded(e){return this.client.methodAdded(e)}methodsForInstance(e){return this.client.methodsForInstance(e)}methods(e){return this.client.methods(e)}servers(e){return this.client.servers(e)}subscribe(e,n,r,i){return this.client.subscribe(e,n,r,i)}createStream(e,n,r,i){return this.server.createStream(e,n,r,i)}unregister(e){return this.server.unregister(e)}registerAsync(e,n){return this.server.registerAsync(e,n)}register(e,n){return this.server.register(e,n)}invoke(e,n,r,i,s,o){return this.client.invoke(e,n,r,i,s,o)}waitForMethod(e){const n=new Oo,r=this.client.methodAdded(i=>{i.name===e&&(r(),n.resolve(i))});return n.promise}}const Q_=["subscribed","success"];class Y_{constructor(e,n){c(this,"connection");c(this,"logger");c(this,"peerId");c(this,"session");c(this,"subscriptions");c(this,"readyPromise");c(this,"publish",(e,n,r)=>{const{routingKey:i,target:s}=r||{},o=this.removeEmptyValues({type:"publish",topic:e,data:n,peer_id:this.peerId,routing_key:i,target_identity:s});this.session.send(o)});c(this,"subscribe",(e,n,r)=>new Promise((i,s)=>{const{routingKey:o,target:a}=r||{},l=this.removeEmptyValues({type:"subscribe",topic:e,peer_id:this.peerId,routing_key:o,source:a});this.session.send(l).then(u=>{const{subscription_id:p}=u;this.subscriptions.push({subscription_id:p,topic:e,callback:n,source:a}),i({unsubscribe:()=>(this.session.send({type:"unsubscribe",subscription_id:p,peer_id:this.peerId}),this.subscriptions=this.subscriptions.filter(g=>g.subscription_id!==p),Promise.resolve())})}).catch(u=>s(u))}));c(this,"watchOnEvent",()=>{this.session.on("event",e=>{const{data:n,subscription_id:r}=e,i=e["publisher-identity"],s=this.subscriptions.find(o=>o.subscription_id===r);s&&(s.source?this.keysMatch(s.source,i)&&s.callback(n,s.topic,i):s.callback(n,s.topic,i))})});this.connection=e,this.logger=n,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",Q_),this.readyPromise=this.session.join(),this.readyPromise.then(()=>{this.watchOnEvent()})}ready(){return this.readyPromise}removeEmptyValues(e){const n={};return Object.keys(e).forEach(r=>{e[r]!==void 0&&e[r]!==null&&(n[r]=e[r])}),n}keysMatch(e,n){const r=Object.keys(e);let i=!0;return r.forEach(s=>{e[s]!==n[s]&&(i=!1)}),i}}const Gr=(t,e)=>{const n=typeof window=="object"?window.iodesktop??window.glue42gd:void 0,r=typeof window=="object"?window.gdPreloadPromise??Promise.resolve():Promise.resolve(),i=Tt("glue");t=t||{},e=e||{};const s=h_(t,e,n);let o,a,l,u,p,g,f;const I={};function S(P,D,O){f=l.canPublish("trace"),f&&l.trace(`registering ${P} module`);const $=Z=>{if(D.initTime=O.stop(),D.initEndTime=O.endTime,D.marks=O.marks,!f)return;const Y=Z?`${P} failed - ${Z.message}`:`${P} is ready - ${O.endTime-O.startTime}`;l.trace(Y)};D.initStartTime=O.startTime,D.ready?D.ready().then(()=>{$()}).catch(Z=>{const Y=typeof Z=="string"?new Error(Z):Z;$(Y)}):$(),Array.isArray(P)||(P=[P]),P.forEach(Z=>{I[Z]=D,Gr[Z]=D})}function k(){const P=Tt("connection");o=new d_(s.connection,l.subLogger("connection"));let D=Promise.resolve(s.auth);return s.connection&&!s.auth&&(n?D=n.getGWToken().then(O=>({gatewayToken:O})):typeof window<"u"&&(window!=null&&window.glue42electron)?typeof window.glue42electron.gwToken=="string"&&(D=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):D=Promise.reject("You need to provide auth information")),D.then(O=>{P.mark("auth-promise-resolved");let $;if(Object.prototype.toString.call(O)==="[object Object]")$=O;else throw new Error("Invalid auth object - "+JSON.stringify(O));return o.login($)}).then(()=>(S("connection",o,P),s)).catch(O=>{throw o&&o.logout(),O})}function H(){var D;const P=Tt("logger");return l=new Mo(`${(D=s.connection.identity)==null?void 0:D.application}`,void 0,s.customLogger),l.consoleLevel(s.logger.console),l.publishLevel(s.logger.publish),l.canPublish("debug")&&l.debug("initializing glue..."),S("logger",l,P),Promise.resolve(void 0)}function C(){const P=Tt("metrics"),D=s.metrics,O=n==null?void 0:n.getMetricsPublishingEnabled,$=s.connection.identity,Z=O||(()=>!0),Y=(typeof D!="boolean"&&D.disableAutoAppSystem)??!1;return u=XI({connection:D?o:void 0,logger:l.subLogger("metrics"),canUpdateMetric:Z,system:"Glue42",service:($==null?void 0:$.service)??(n==null?void 0:n.applicationName)??s.application,instance:($==null?void 0:$.instance)??($==null?void 0:$.windowId)??Dt(10),disableAutoAppSystem:Y,pagePerformanceMetrics:typeof D!="boolean"?D==null?void 0:D.pagePerformanceMetrics:void 0}),S("metrics",u,P),Promise.resolve()}function m(){const P=Tt("interop"),D={connection:o,logger:l.subLogger("interop")};return a=new K_(D),Mo.Interop=a,S(["interop","agm"],a,P),Promise.resolve()}function v(){const P=s.activities&&o.protocolVersion===3;if(s.contexts||P){const O=Tt("contexts");return p=new v_({connection:o,logger:l.subLogger("contexts"),trackAllContexts:typeof s.contexts=="object"?s.contexts.trackAllContexts:!1,reAnnounceKnownContexts:typeof s.contexts=="object"?s.contexts.reAnnounceKnownContexts:!1}),S("contexts",p,O),p}else{const O=o.replayer;O&&O.drain(Lo.name)}}async function E(){if(!s.bus)return Promise.resolve();const P=Tt("bus");return g=new Y_(o,l.subLogger("bus")),S("bus",g,P),Promise.resolve()}function x(P){try{return P.forEach(D=>{L(D.name,D.create)}),Promise.resolve()}catch(D){return Promise.reject(D)}}function L(P,D){const O=Tt(P),$=D(I);$&&S(P,$,O)}function j(){const P=Object.keys(I).map(D=>{const O=I[D];return O.ready?O.ready():Promise.resolve()});return Promise.all(P)}function T(){const P=$=>{a&&a.invoke("T42.ACS.Feedback",$,"best")},D={coreVersion:Fo,version:s.version};i.stop();const O={feedback:P,info:D,logger:l,interop:a,agm:a,connection:o,metrics:u,contexts:p,bus:g,version:s.version,userConfig:t,done:()=>(l==null||l.info("done called by user..."),o.logout())};if(O.performance={get glueVer(){return s.version},get glueConfig(){return JSON.stringify(t)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){const $=i_();return Object.keys($).map(Z=>{const Y=$[Z];return{name:Z,duration:Y.endTime-Y.startTime,marks:Y.marks,startTime:Y.startTime,endTime:Y.endTime}})}},Object.keys(I).forEach($=>{const Z=I[$];O[$]=Z}),O.config={},Object.keys(s).forEach($=>{O.config[$]=s[$]}),e&&e.extOptions&&Object.keys(e.extOptions).forEach($=>{O.config[$]=e==null?void 0:e.extOptions[$]}),e!=null&&e.enrichGlue&&e.enrichGlue(O),n&&n.updatePerfData&&n.updatePerfData(O.performance),O.agm){const $=(Y,Xe,Ot)=>function(){return O.logger.warn(`glue.js - 'glue.agm.${Xe}' method is deprecated, use 'glue.interop.${Ot}' instead.`),Y.apply(O.agm,arguments)},Z=O.agm;Z.method_added=$(O.agm.methodAdded,"method_added","methodAdded"),Z.method_removed=$(O.agm.methodRemoved,"method_removed","methodRemoved"),Z.server_added=$(O.agm.serverAdded,"server_added","serverAdded"),Z.server_method_aded=$(O.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),Z.server_method_removed=$(O.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return O}async function J(){const P="T42.ACS.RegisterInstance";if(nn.isNode()&&typeof ag._GD_STARTING_CONTEXT_>"u"&&typeof(t==null?void 0:t.application)<"u"&&a.methods({name:P}).length>0)try{await a.invoke(P,{appName:t==null?void 0:t.application,pid:process.pid})}catch(O){const $=O;l.error(`Cannot register as an instance: ${JSON.stringify($.message)}`)}}return r.then(H).then(k).then(()=>Promise.all([C(),m(),v(),E()])).then(()=>a.readyPromise).then(()=>J()).then(()=>x(s.libs||[])).then(j).then(T).catch(P=>Promise.reject({err:P,libs:I}))};typeof window<"u"&&(window.IOConnectCore=Gr);Gr.version=Fo;Gr.default=Gr;const Iu=FI(Gr);if(typeof window<"u"){const t=window;t.IOBrowser=Iu,delete t.GlueCore,delete t.IOConnectCore}const X_=window.glue42gd||window.glue42core,Z_=window.iodesktop||window.iobrowser;!X_&&!Z_&&(window.iobrowser={webStarted:!1});!window.iodesktop&&!window.iobrowser.system&&(window.iobrowser.system=lm());Iu.version=am;const e1={browser:{config:{},factory:Iu}},t1=document.getElementById("root"),n1=ng(t1);n1.render(en.jsx(Us.StrictMode,{children:en.jsx(du,{settings:e1,children:en.jsx(Eb,{})})}));
